{"version":3,"sources":["../../../../src/viewports/web-mercator-viewport.js","../../../../../src/shaderlib/project/viewport-uniforms.js","../../../../../src/lib/attribute/shader-attribute.js","../../../../../src/lib/attribute/data-column.js","../../../../../src/lib/attribute/gl-utils.js","../../../../src/utils/range.js","../../../../src/utils/array-utils.js","../../../../../src/lib/attribute/attribute-transition-utils.js","../../../../../src/lib/attribute/attribute.js","../../../../src/transitions/gpu-interpolation-transition.js","../../../../../src/lib/attribute/attribute-transition-manager.js","../../../../src/transitions/gpu-spring-transition.js","../../../../../src/lib/attribute/attribute-manager.js","../../../../src/transitions/cpu-interpolation-transition.js","../../../../src/transitions/cpu-spring-transition.js","../../../../src/lib/uniform-transition-manager.js","../../../../src/lifecycle/props.js","../../../../src/utils/count.js","../../../../src/utils/shader.js","../../../../../src/shaderlib/project/project-functions.js","../../../../src/lifecycle/prop-types.js","../../../../src/lifecycle/create-props.js","../../../../src/lifecycle/component-state.js","../../../../src/lifecycle/component.js","../../../../src/lib/layer-state.js","../../../../src/lib/layer.js","../../../../../src/shaderlib/project32/project32.js","../../../../../src/shaderlib/picking/picking.js","../../../../src/transitions/transition-interpolator.js","../../../../src/transitions/linear-interpolator.js","../../../../src/controllers/transition-manager.js","../../../../src/controllers/controller.js","../../../../src/controllers/view-state.js","../../../../src/controllers/map-controller.js","../../../../src/views/map-view.js","../../../../src/utils/positions.js","../../../../src/views/view.js","json sync /^/.//template/..*/.json$","../../../../src/lib/constants.js","../../../../src/utils/get.js","../../../../src/helpers/parse-expression-string.js","../../../../src/utils/assert.js","../../../src/syntactic-sugar.js","../../../src/json-configuration.js","../../../../src/helpers/convert-functions.js","../../../../src/helpers/instantiate-class.js","../../../src/json-converter.js","../../../../src/helpers/parse-json.js","../../../../src/lib/composite-layer.js","../../../../src/scatterplot-layer/scatterplot-layer.js","../../../../src/scatterplot-layer/scatterplot-layer-vertex.glsl.js","../../../../src/scatterplot-layer/scatterplot-layer-fragment.glsl.js","../../../../src/utils/tesselator.js","../../../../src/path-layer/path-tesselator.js","../../../../src/path-layer/path.js","../../../../src/path-layer/path-layer.js","../../../../src/path-layer/path-layer-vertex.glsl.js","../../../../src/path-layer/path-layer-fragment.glsl.js","../../../../src/solid-polygon-layer/polygon.js","../../../../src/solid-polygon-layer/polygon-tesselator.js","../../../../src/solid-polygon-layer/solid-polygon-layer-vertex-main.glsl.js","../../../../src/solid-polygon-layer/solid-polygon-layer-vertex-top.glsl.js","../../../../src/solid-polygon-layer/solid-polygon-layer-vertex-side.glsl.js","../../../../src/solid-polygon-layer/solid-polygon-layer.js","../../../../src/solid-polygon-layer/solid-polygon-layer-fragment.glsl.js","../../../src/utils.js","../../../../src/geojson-layer/geojson.js","../../../../src/geojson-layer/geojson-layer.js","../../../../src/tile-layer/tile-2d-header.js","../../../../src/tile-layer/tile-2d-traversal.js","../../../../src/tile-layer/utils.js","../../../../src/tile-layer/tileset-2d.js","../../../../src/tile-layer/tile-layer.js","../../../../src/lib/layer-extension.js","../../../../src/mvt-layer/clip-extension.js","../../../../src/mvt-layer/mvt-layer.js","../../../src/config.js","../../../../src/api/maps-api-client.js","../../../../src/layers/carto-layer.js","../../../../src/layers/carto-bqtiler-layer.js","../../../../src/layers/carto-sql-layer.js","../../../src/basemap.js","json/configuration.js","components/deck-with-mapbox-maps.js","components/deck-with-google-maps.js","components/map.js","components/json-editor.js","views/home.js","App.js","reportWebVitals.js","index.js","../../../../src/utils/log.js","../../../../../src/lib/resource/resource.js","../../../../../src/lib/resource/resource-manager.js","../../../../../src/shaderlib/misc/geometry.js","../../../../src/shaderlib/index.js","../../../../src/lib/layer-manager.js","../../../../src/lib/view-manager.js","../../../../../src/effects/lighting/ambient-light.js","../../../../../src/effects/lighting/directional-light.js","../../../../src/lib/effect.js","../../../../src/passes/pass.js","../../../../src/passes/layers-pass.js","../../../../src/passes/shadow-pass.js","../../../../../src/shaderlib/shadow/shadow.js","../../../../../src/effects/lighting/lighting-effect.js","../../../../src/lib/effect-manager.js","../../../../src/passes/draw-layers-pass.js","../../../../src/passes/pick-layers-pass.js","../../../../src/lib/deck-renderer.js","../../../../../src/lib/picking/query-object.js","../../../../../src/lib/picking/pick-info.js","../../../../src/lib/deck-picker.js","../../../../src/lib/tooltip.js","../../../../src/utils/json-loader.js","../../../../src/lib/init.js","../../../../src/lib/deck.js","../../../../src/debug/index.js","../../../../src/lifecycle/constants.js","../../../../src/utils/math-utils.js","../../../../src/utils/typed-array-manager.js","../../../../src/transitions/transition.js","../../../../src/utils/deep-equal.js","../../../../src/utils/iterable-utils.js","../../../../src/utils/flatten.js","../../../../../src/shaderlib/project/project.glsl.js","../../../../../src/shaderlib/project/project.js","../../../../src/viewports/viewport.js","../../../../src/utils/memoize.js"],"names":["WebMercatorViewport","opts","latitude","longitude","zoom","pitch","bearing","nearZMultiplier","farZMultiplier","orthographic","repeat","worldOffset","width","height","altitude","scale","Math","getProjectionParameters","fov","aspect","focalDistance","near","far","viewMatrixUncentered","getViewMatrix","viewOffset","viewportOpts","Object","viewMatrix","fovyRadians","lngLatZ","xyz","addMetersToLngLat","lngLat","pos","fromLocation","pixelsToWorld","this","toLocation","projectFlat","translate","vec2","newCenter","unprojectFlat","options","corners","getBounds","bounds","fitBounds","_subViewports","minOffset","maxOffset","x","offsetViewport","Viewport","ZERO_VECTOR","VECTOR_TO_POINT_MATRIX","IDENTITY_MATRIX","DEFAULT_PIXELS_PER_UNIT2","DEFAULT_COORDINATE_ORIGIN","getMemoizedViewportUniforms","memoize","viewport","devicePixelRatio","coordinateSystem","coordinateOrigin","projectionMatrix","viewProjectionMatrix","projectionCenter","cameraPosCommon","getOffsetOrigin","geospatialOrigin","shaderCoordinateOrigin","positionCommonSpace","vec4","mat4","calculateMatrixAndOffset","distanceScales","viewportSize","uniforms","project_uCoordinateSystem","project_uProjectionMode","project_uCoordinateOrigin","project_uCenter","project_uAntimeridian","project_uViewportSize","project_uDevicePixelRatio","project_uFocalDistance","project_uCommonUnitsPerMeter","project_uCommonUnitsPerWorldUnit","project_uCommonUnitsPerWorldUnit2","project_uScale","project_uViewProjectionMatrix","project_uCameraPosition","distanceScalesAtOrigin","COORDINATE_SYSTEM","offsetMode","PROJECTION_MODE","getUniformsFromViewport","modelMatrix","DEFAULT","autoWrapLongitude","projectionMode","positionOrigin","assert","ShaderAttribute","buffer","source","accessor","value","size","constantValue","Float32Array","index","i","getStride","resolveShaderAttribute","baseAccessor","shaderAttributeOptions","log","stride","offset","vertexOffset","DataColumn","logicalType","doublePrecision","defaultValue","Number","Array","bufferType","gl","hasFeature","FEATURES","defaultType","glType","Error","glArrayFromType","externalBuffer","bufferAccessor","allocatedValue","constant","typedArrayManager","state","id","shaderAttributes","isBuffer64Bit","doubleShaderAttributeDefs","resolvedOptions","high","low","resolveDoublePrecisionShaderAttributes","shaderAttributeDef","ArrayBuffer","_normalizeValue","settings","_normalizeConstant","_areValuesEqual","byteOffset","toDoublePrecisionArray","data","startOffset","endOffset","startIndex","endIndex","numInstances","copy","oldValue","type","ArrayType","illegalArrayType","map","out","start","value1","value2","isIndexed","target","EMPTY","FULL","rangeList","range","newRangeList","len","insertPosition","range0","padArrayChunk","end","getData","sourceLength","targetLength","datum","j","DEFAULT_TRANSITION_SETTINGS","interpolation","duration","easing","t","spring","stiffness","damping","normalizeTransitionSettings","userSettings","layerSettings","getSourceBufferAttribute","attribute","divisor","normalized","getAttributeTypeFromSize","cycleBuffers","buffers","getAttributeBufferLength","multiplier","padBuffer","fromLength","fromStartIndices","precisionMultiplier","toStartIndices","hasStartIndices","toLength","isConstant","toData","srcByteOffset","getter","getMissingData","length","sourceStartIndices","targetStartIndices","sourceIndex","targetIndex","getChunkData","n","nextSourceIndex","nextTargetIndex","padArray","Attribute","transition","noAlloc","update","transform","startIndices","lastExternalBuffer","binaryValue","binaryAccessor","needsUpdate","needsRedraw","updateRanges","clearChangedFlags","Boolean","a","reason","dataRange","startRow","endRow","props","context","updated","byteLength","getVertexOffset","setData","needsNormalize","getAccessorFromBuffer","nested","row","shaderAttributeDefs","accessorFunc","createIterable","iterable","objectInfo","object","objectValue","numVertices","item","fillArray","count","limit","valid","layout","GPUInterpolationTransition","timeline","attributeType","vs","defines","ATTRIBUTE_TYPE","varyings","getTransform","bufferOpts","usage","transitionSettings","padBufferOpts","enter","elementCount","currentLength","sourceBuffers","aFrom","aTo","feedbackBuffers","vCurrent","time","TRANSITION_TYPES","Uint8Array","format","border","mipmaps","dataFormat","getTexture","texture","attachments","getFramebuffer","framebuffer","fs","aPrev","aCur","vNext","discard","clearRenderTarget","parameters","depthTest","blend","blendFunc","blendEquation","readPixelsToArray","AttributeTransitionManager","Transform","attributes","transitions","attributeName","animatedAttributes","isNew","TransitionType","TRACE_INVALIDATE","TRACE_UPDATE_START","TRACE_UPDATE_END","AttributeManager","stats","clearRedrawFlags","redraw","updaters","instanced","attributeNameArray","name","triggerName","invalidatedAttributes","_invalidateTrigger","debug","accessorName","transitionUpdated","attributeTransitionManager","changedAttributes","excludeAttributes","extraProps","newAttributes","newAttribute","_createAttribute","triggers","CPUInterpolationTransition","fromValue","toValue","lerp","Transition","EPSILON","updateSpringElement","prev","cur","dest","velocity","distance","distanceSquare","d","_prevValue","_currValue","nextValue","next","updateSpring","delta","UniformTransitionManager","key","propsInTransition","COMPONENT","PROP_SYMBOLS","propsChangedReason","compareProps","newProps","oldProps","propTypes","getPropTypes","ignoreProps","updateTriggers","extensions","dataChangedReason","dataChanged","dataComparator","_dataDiff","diffDataProps","updateTriggersChangedReason","diffUpdateTrigger","all","triggerChanged","diffUpdateTriggers","propsChanged","updateTriggersChanged","extensionsChanged","diffExtensions","transitionsChanged","diffTransitions","result","propType","comparePropValues","changed","newProp","oldProp","equal","oldExtensions","newTriggers","oldTriggers","layer","LayerType","container","isPlainObject","mergeShaders","module","mergedInjection","lngLatZToWorldPosition","p","z","getWorldPosition","y","normalizedParams","fromCoordinateSystem","fromCoordinateOrigin","normalizeParameters","worldPosition","position","vec3","TYPE_DEFINITIONS","boolean","validate","number","color","isArray","arrayEqual","valueType","getTypeOf","array","function","array1","array2","parsePropType","propDef","normalizePropDefinition","compare","ASYNC_ORIGINAL","ASYNC_RESOLVED","ASYNC_DEFAULTS","createProps","component","propsPrototype","getPropsPrototype","propsInstance","arguments","componentClass","defaultProps","getOwnProperty","parentClass","parentDefaultProps","componentPropDefs","propDefs","deprecatedProps","propName","parsePropTypes","parentProps","componentName","getComponentName","writable","createPropsPrototype","defaultValues","descriptors","getDescriptorForAsyncProp","addAsyncPropsToPropPrototype","enumerable","set","nameStr","newPropName","hasOwnProperty","addDeprecatedPropsToPropPrototype","createPropsPrototypeAndTypes","newValue","isAsyncIterable","get","prop","EMPTY_PROPS","ComponentState","oldAsyncProps","asyncProp","asyncProps","isAsyncPropLoading","Promise","resolvedValues","originalValues","_didAsyncInputValueChange","fetch","loadCount","promise","onDataLoad","error","pendingLoadCount","chunk","_postProcessValue","previousValue","dataTransform","lastValue","resolvedValue","resolvedLoadCount","counter","Component","LIFECYCLE","internalState","LayerState","attributeManager","EMPTY_ARRAY","areViewportsEqual","oldViewport","pickingColorCache","Uint8ClampedArray","async","optional","resourceManager","loadOptions","inResourceManager","resourceId","persistent","onChange","consumerId","requestId","load","url","visible","pickable","opacity","min","max","onHover","onClick","onDragStart","onDrag","onDragEnd","wrapLongitude","positionFormat","colorFormat","getPolygonOffset","highlightedObjectIndex","autoHighlight","highlightColor","Layer","className","constructor","layerName","updateObject","stateChanged","String","_getNeedsRedraw","shouldUpdateState","uniformTransitions","models","model","worldToPixels","xy","projectPosition","info","pickingEvent","i1","shaders","extension","changeFlags","neededPickingBuffer","needPickingBuffer","pickingColors","instancePickingColors","pickingColorsAttribute","mode","viewportChanged","getNumInstances","getStartIndices","ignoreUnknownAttributes","cacheSize","newCacheSize","pickingColor","getAttributeManager","colors","decodePickingColor","stateNeedsUpdate","currentProps","currentViewport","updateParams","oldModels","modelChanged","getModels","moduleParameters","offsets","setParameters","polygonOffset","withParameters","flags","flagChanged","propsOrDataChanged","somethingChanged","diffProps","setChangeFlags","validateProps","forceUpdate","encodePickingColor","attributeManagerNeedsRedraw","isFinite","calculateInstancePickingColors","_onAsyncPropUpdated","bind","oldLayer","dependencies","inject","order","injection","TransitionInterpolator","extract","required","nextProps","_propsToCompare","equals","startProps","endProps","startViewStateProps","endViewStateProps","DEFAULT_PROPS","DEFAULT_REQUIRED_PROPS","LinearInterpolator","transitionProps","noop","TRANSITION_EVENTS","transitionDuration","transitionEasing","transitionInterpolator","transitionInterruption","onTransitionStart","onTransitionInterrupt","onTransitionEnd","TransitionManager","_onTransitionUpdate","transitionTriggered","_shouldIgnoreViewportChange","_isTransitionEnabled","interruption","interpolator","arePropsEqual","_isUpdateDueToCurrentTransition","startViewstate","initialProps","onStart","onUpdate","onInterrupt","_onTransitionEnd","onEnd","callback","viewState","interactionState","inTransition","oldViewState","NO_TRANSITION_PROPS","EVENT_TYPES","Controller","isDragging","handleEvent","_events","event","ControllerState","makeViewport","_onPanStart","_onPan","_onPanEnd","_onPinchStart","_onPinch","_onPinchEnd","_onDoubleTap","_onWheel","_onKeyDown","offsetCenter","inside","srcEvent","_state","eventManager","scrollZoom","dragPan","dragRotate","doubleClickZoom","touchZoom","touchRotate","keyboard","isInteractive","eventNames","enabled","eventName","newControllerState","controllerState","getCenter","isPointInBounds","panStart","alternateMode","isFunctionKeyPressed","invertPan","_onPanMove","_onPanRotate","panEnd","isPanning","isRotating","pan","deltaX","deltaY","deltaScaleX","deltaScaleY","rotate","isZooming","zoomStart","rotation","startPinchRotation","zoomEnd","isZoomOut","funcKey","customEvents","ViewState","_applyConstraints","LINEAR_TRANSITION_PROPS","MAPBOX_LIMITS","DEFAULT_STATE","MapState","maxZoom","minZoom","maxPitch","minPitch","startPanLngLat","startZoomLngLat","startBearing","startPitch","startZoom","_getUpdatedState","_unproject","startPos","_interactiveState","_calculateNewLngLat","_viewportProps","_calculateNewPitchAndBearing","_calculateNewZoom","_zoomFromCenter","_panFromCenter","fromProps","clamp","normalizeViewportProps","MapController","centerY","startY","updateViewport","MapView","_getControllerProps","View","PERCENT_OR_PIXELS_REGEX","parsePosition","relative","match","parseFloat","getPosition","extent","fovy","viewportInstance","view","deepEqual","filterViewState","viewportDimensions","getDimensions","_getViewport","newViewState","defaultOpts","ViewportType","webpackContext","req","webpackContextResolve","__webpack_require__","o","e","code","keys","resolve","exports","LNGLAT","METER_OFFSETS","LNGLAT_OFFSETS","CARTESIAN","WEB_MERCATOR","GLOBE","WEB_MERCATOR_AUTO_OFFSET","IDENTITY","EVENTS","click","handler","panstart","panmove","panend","compositeKey","keyList","keyMap","getKeys","isObject","cachedExpressionMap","parseExpressionString","propValue","configuration","ast","expressionEval","traverse","node","func","visitor","element","message","FUNCTION_IDENTIFIER","CONSTANT_IDENTIFIER","TYPE_KEY","JSONConfiguration","json","configurations","convertFunction","trimFunctionIdentifier","convertFunctions","replacedProps","instantiateClass","Class","stringProps","JSON","instantiateJavaScriptClass","React","children","instantiateReactComponent","JSONConverter","config","convertedJson","convertJSONRecursively","convertJSON","parseJSON","postProcessConvertedJson","convert","typeKey","isClassInstance","convertPlainObject","convertClassInstance","string","enumVarName","enumValName","convertString","CompositeLayer","overridingProps","DefaultLayerClass","sourceObject","sourceObjectIndex","parent","sublayerProps","overridingSublayerProps","overridingSublayerTriggers","sublayerId","getSubLayerAccessor","passThroughProps","subLayers","shouldUpdate","flatten","getSubLayers","every","DEFAULT_COLOR","radiusUnits","radiusScale","radiusMinPixels","radiusMaxPixels","MAX_SAFE_INTEGER","lineWidthUnits","lineWidthScale","lineWidthMinPixels","lineWidthMaxPixels","stroked","filled","getRadius","getFillColor","getLineColor","getLineWidth","strokeWidth","deprecatedFor","outline","getColor","ScatterplotLayer","modules","project32","instancePositions","fp64","instanceRadius","instanceFillColors","instanceLineColors","instanceLineWidths","_getModel","pointRadiusMultiplier","lineWidthMultiplier","geometry","drawMode","vertexCount","positions","isInstanced","Tesselator","getGeometry","geometryBuffer","normalize","getGeometryFromBuffer","instanceCount","_attributeDefs","def","indexStarts","vertexStarts","normalizedData","dataIndex","byteStride","positionSize","bufferValue","elementStride","vertexEnd","PathTesselator","padding","initialize","segmentTypes","path","gridResolution","flatPath","cutPolylineByGrid","cutPolylineByMercatorBounds","normalizePath","subPath","getGeometrySize","numPoints","getPathLength","isClosed","geometrySize","isPathClosed","vertexStart","ptIndex","lastPointIndex","widthUnits","widthScale","widthMinPixels","widthMaxPixels","rounded","miterLimit","billboard","_pathType","getPath","getWidth","ATTRIBUTE_TRANSITION","PathLayer","instanceLeftPositions","instanceStartPositions","instanceEndPositions","instanceRightPositions","instanceTypes","instanceStrokeWidths","instanceColors","pathTesselator","use64bitPositions","getDashArray","loop","resolution","params","widthMultiplier","jointType","indices","Uint16Array","isFlatRingClosed","copyNestedRing","targetStartIndex","simplePolygon","p0","p1","isNestedRingClosed","copyFlatRing","srcStartIndex","srcEndIndex","srcLength","polygon","holeIndices","srcPositions","srcHoleIndices","isSimple","PolygonTesselator","IndexType","Float64Array","vertexValid","externalIndices","Polygon","cutPolygonByGrid","edgeTypes","cutPolygonByMercatorBounds","maxLatitude","subPolygon","geometryIndex","indexStart","normalizedPolygon","preproject","positionIndex","earcut","polygonPositions","extruded","wireframe","_normalize","elevationScale","getPolygon","f","getElevation","material","SolidPolygonLayer","polygonTesselator","hasFeatures","nextPositions","elevations","instanceElevations","fillColors","alias","lineColors","topModel","sideModel","renderUniforms","isWireframe","_getModels","getShaders","vertexPositions","isSideVertex","filter","replaceInRange","getIndex","replace","replaceStart","replaceEnd","dataLengthChanged","endChunk","separateGeojsonFeatures","features","wrapFeature","separated","pointFeatures","lineFeatures","polygonFeatures","polygonOutlineFeatures","featureIndex","feature","geometries","subGeometry","separateGeometry","sourceFeature","sourceFeatureIndex","coordinates","nestLevel","COORDINATE_NEST_LEVEL","validateGeometry","point","Point","MultiPoint","LineString","MultiLineString","MultiPolygon","lineJointRounded","lineMiterLimit","pointRadiusUnits","pointRadiusScale","pointRadiusMinPixels","pointRadiusMaxPixels","getCoordinates","GeoJsonLayer","geojson","getGeojsonFeatures","getSubLayerRow","oldFeatures","newFeatures","featuresDiff","partialFeatures","lineDashJustified","getLineDashArray","PolygonFillLayer","getSubLayerClass","PolygonStrokeLayer","LineStringsLayer","PointsLayer","polygonFillLayer","shouldRenderSubLayer","getSubLayerProps","dashJustified","_getHighlightedIndex","Tile2DHeader","onTileLoad","onTileError","getTileData","requestScheduler","bbox","signal","_abortController","tile","requestToken","_isCancelled","tileData","_isLoaded","_loadData","content","OSMNode","cullingVolume","elevationBounds","minZ","maxZ","boundingVolume","getBoundingVolume","child","zRange","originX","originY","TILE_SIZE","DEFAULT_EXTENT","urlType","getURLFromTemplate","template","properties","getTileIndex","getScale","osmTile2lngLat","lng","tile2XY","tileToBoundingBox","west","north","east","south","left","top","right","bottom","getIdentityTileIndices","bounds0","bounds1","getBoundingBox","minX","minY","maxX","maxY","tileSize","planes","normal","unitsPerMeter","elevationMin","elevationMax","root","traversalParams","getOSMTileIndices","STRATEGY_DEFAULT","Tileset2D","maxRequests","throttleRequests","tileIndices","getTileIndices","tileIndex","abortCandidates","ongoingRequestCount","_cache","isVisible","_getNearestAncestor","selectedTiles","refinementStrategy","getPlaceholderInAncestors","needsPlaceholder","getPlaceholderInChildren","maxCacheSize","maxCacheByteSize","_cacheByteSize","tileId","t1","t2","create","getTileMetadata","_minZoom","getParentIndex","_getTile","_selectedTiles","TILE_STATE_VISIBLE","renderSubLayers","onViewportLoad","onTileUnload","err","console","TileLayer","tiles","isLoaded","tileset","_onTileLoad","_onTileError","_onTileUnload","frameNumber","loadingStateChanged","tilesetChanged","getCurrentLayer","sourceLayer","layers","_offset","LayerExtension","clipBounds","shaderFunction","shaderModuleVs","injectionVs","shaderModuleFs","injectionFs","ClipExtension","clipByInstance","corner0","corner1","fetchTileJSON","MVTLayer","tileJSON","test","mvt","worldScale","xScale","yScale","xOffset","yOffset","uniqueIdProperty","hoveredFeatureId","hoveredFeature","newHoveredFeatureId","getFeatureUniqueId","highlightedFeatureId","isFeatureIdDefined","featureIdToHighlight","credentials","username","apiKey","region","mapsVersion","sqlUrl","mapsUrl","getDefaultCredentials","getMapsVersion","creds","localCreds","DEFAULT_USER_COMPONENT_IN_URL","DEFAULT_REGION_COMPONENT_IN_URL","instantiateMap","mapConfig","layergroup","buildURL","headers","Accept","response","dealWithError","cfg","encodeParameter","encodeURIComponent","tilejson","onDataError","CartoLayer","_updateTileJSON","getTileJSON","buildMapConfig","mvtLayer","CartoBQTilerLayer","version","CartoSQLLayer","bufferSize","tileExtent","sql","buffersize","vector_extent","buffer_size","tile_extent","base_url","VOYAGER","POSITRON","DARK_MATTER","classes","assign","enumerations","CARTO_BASEMAP","BASEMAP","DeckWithMapboxMaps","views","maps","mapStyle","push","Map","reuseMap","style","loadGoogleMapApi","onComplete","src","reject","script","document","createElement","addEventListener","head","appendChild","injectScript","then","catch","DeckWithGoogleMaps","googleMapsLoaded","window","google","googleMapsToken","setState","alt","DeckOverlayWrapper","isOverlayConfigured","DeckOverlay","GoogleMapsOverlay","containerRef","createRef","initialViewState","center","lat","mapTypeId","current","setMap","setProps","prevProps","prevState","snapshot","ref","StaticMap","JSONEditor","useState","stringify","text","setText","setVisible","theme","parse","editorProps","$blockScrolling","wrapEnabled","jsonConverter","JSON_CONVERTER_CONFIGURATION","Home","setJSON","jsonProps","setJSONPros","shareURL","setShareURL","location","useLocation","useEffect","query","getDefaultData","colorByValue","bqtiler","require","initJSON","URLSearchParams","search","entries","startsWith","addUpdateTriggersForAccesors","jsonText","origin","pathname","share","readOnly","App","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById","Resource","consumer","_subscribers","_error","_loader","loader","subscriber","ResourceManager","protocol","res","_resources","_consumers","request","resources","setTimeout","resource","consumers","DEFAULT_MODULES","SHADER_HOOKS","createProgramManager","programManager","ProgramManager","shaderModule","shaderHook","TRACE_SET_LAYERS","INITIAL_CONTEXT","layerManager","deck","shaderCache","pickingFBO","mousePosition","userData","LayerManager","activateViewport","layerNeedsRedraw","_needsRedraw","_needsUpdate","layerIds","layerId","newLayers","stage","oldLayers","oldLayerMap","generatedLayers","newLayer","sublayers","_debug","ViewManager","onViewStateChange","onInteractiveStateChange","controllers","controller","rect","_viewports","viewMap","viewOrViewId","find","viewId","getView","_viewportMap","viewports","pixel","_diffViews","_onViewStateChange","onStateChange","_eventCallbacks","controllerProps","_createController","oldControllers","getViewState","_updateController","newViews","oldViews","DEFAULT_LIGHT_COLOR","idCount","AmbientLight","intensity","DEFAULT_LIGHT_DIRECTION","DirectionalLight","direction","_shadow","Effect","Pass","LayersPass","_drawLayers","onViewportActive","clearCanvas","clearGLCanvas","renderStats","viewportOrDescriptor","drawLayerParams","_getDrawLayerParams","subViewport","_drawLayersInViewport","pass","layerFilter","effects","indexResolver","layerIndexResolver","layerIndex","shouldDrawLayer","_shouldDrawLayer","layerParam","layerRenderIndex","_getModuleParameters","getLayerParameters","onError","glViewport","dimensions","pixelRatio","cssToDeviceRatio","getGLViewport","clearOpts","depth","scissorTest","scissor","clear","renderStatus","totalCount","visibleCount","compositeCount","pickableCount","layerParameters","isPicking","renderPass","overrides","pickingActive","effect","getModuleParameters","layerIndices","resolvers","resolveLayerIndex","isDrawn","indexOverride","parentId","resolver","ShadowPass","depthRange","clearColor","drawToShadowMap","getMemoizedViewportCenterPosition","getMemoizedViewProjectionMatrices","shadowMatrices","projectionMatrices","pixelUnprojectionMatrix","farZ","coord","screenToCommonSpace","shadowMatrix","corner","DEFAULT_SHADOW_COLOR","createShadowUniforms","shadow_uDrawShadowMap","shadow_uUseShadowMap","shadow_uColor","shadow_uLightId","shadow_uLightCount","projectCenters","viewProjectionMatrices","viewProjectionMatrixCentered","getUniforms","shadowUniforms","shadowEnabled","DEFAULT_AMBIENT_LIGHT_PROPS","DEFAULT_DIRECTIONAL_LIGHT_PROPS","LightingEffect","lightSource","light","shadowPasses","shadowPass","shadowLightId","dummyShadowMap","shadow","shadowMaps","shadowColor","ambientLight","directionalLights","directionalLight","pointLights","pointLight","lightMatrices","eye","DEFAULT_LIGHTING_EFFECT","EffectManager","some","DrawLayersPass","PICKING_PARAMETERS","PickLayersPass","deviceRect","redrawReason","pickZ","depthMask","colorMask","pickingAttribute","lightSources","pickParameters","blendColor","DeckRenderer","drawPickingColors","layerPass","Framebuffer","outputBuffer","lastPostProcessEffect","renderBuffers","inputBuffer","swapBuffer","NO_PICKED_OBJECT","pickedColor","pickedLayer","pickedObjectIndex","getClosestObject","pickedColors","deviceX","deviceY","deviceRadius","minSquareDistanceToCenter","closestPixelIndex","dy","dy2","col","dx","d2","pickedLayerIndex","pickedX","pickedY","getEmptyPickingInfo","pickInfo","coordinate","targetZ","picked","devicePixel","processPickInfo","lastPickedInfo","affectedLayers","lastPickedObjectIndex","lastPickedLayerId","pickedLayerId","lastPickedLayer","baseInfo","infos","getLayerPickingInfo","pickingModuleParameters","pickingSelectedColor","DeckPicker","_pickClosestObject","_pickVisibleObjects","l","colorBufferFloat","isWebGL2","_pickable","pickableLayers","radius","unproject3D","_getPickable","emptyInfo","devicePixelRange","cssToDevicePixels","_getPickingRect","deviceWidth","deviceHeight","_drawAndSample","zValues","leftTop","deviceLeft","deviceTop","rightBottom","deviceRight","deviceBottom","pickInfos","uniqueColors","colorKey","getUniqueObjects","uniqueInfos","sourceX","sourceY","sourceWidth","sourceHeight","defaultStyle","zIndex","pointerEvents","backgroundColor","display","Tooltip","canvasParent","canvas","el","displayInfo","mimeTypes","testText","firstChar","lastChar","parseTextSync","existingVersion","global","VERSION","_registerLoggers","register","registerLoaders","imagebitmap","premultiplyAlpha","pickingRadius","glOptions","useDevicePixels","touchAction","_framebuffer","_animate","_typedArrayManagerProps","onWebGLInitialized","onResize","onBeforeRender","onAfterRender","onLoad","_onMetrics","getCursor","Deck","_onEvent","_onPointerDown","_onPointerMove","_pickAndCallback","_onRendererInitialized","_onRenderFrame","_onInteractiveStateChange","getBrowser","_createCanvas","_createAnimationLoop","fps","setPropsTime","updateAttributesTime","framesRedrawn","pickTime","pickCount","gpuTime","gpuTimePerFrame","cpuTime","cpuTimePerFrame","bufferMemory","textureMemory","renderbufferMemory","gpuMemory","resolvedProps","_getViewState","getViewports","viewManagerNeedsRedraw","viewManager","layerManagerNeedsRedraw","effectManagerNeedsRedraw","effectManager","deckRendererNeedsRedraw","deckRenderer","force","_pick","resourceIds","method","statKey","deckPicker","getLayers","newWidth","newHeight","autoResizeDrawingBuffer","autoResizeViewport","onCreateContext","createGLContext","onInitialize","onRender","_pickRequest","pickedInfo","handled","getTooltip","instrumentGLContext","enable","copyState","polygonOffsetFill","depthFunc","events","pointerdown","pointermove","pointerleave","renderOptions","getEffects","animationProps","_metricsCounter","interactiveState","eventOptions","getLastPickedObject","layerHandler","rootHandler","pickObject","animationLoopStats","animationLoop","metrics","memoryStats","lumaStats","PropTypes","deckGlobal","condition","loggers","handlers","eventType","deckLog","NO_STATE","MATCHED","INITIALIZED","AWAITING_GC","AWAITING_FINALIZATION","FINALIZED","Symbol","createMat4","extractCameraVectors","viewMatrixInverse","up","cameraPosition","cameraDirection","cameraUp","cameraRight","nearCenter","farCenter","getFrustumPlanes","nearFarScale","nearHeight","nearWidth","typedArray","scratchArray","TypedArrayManager","overAlloc","poolSize","Type","newSize","newArray","_allocate","pool","b","DEFAULT_SETTINGS","_handle","delay","getTime","isFinished","aValue","bValue","placeholderArray","Infinity","bytesPerElement","elementOffset","flattenArray","total","copied","COORDINATE_SYSTEM_GLSL_CONSTANTS","PROJECTION_MODE_GLSL_CONSTANTS","INITIAL_MODULE_OPTIONS","DEGREES_TO_RADIANS","DEFAULT_DISTANCE_SCALES","metersPerUnit","project","unproject","unprojectPosition","topLeft","y2","targetZWorld","X","Y","Z","lngLatToWorld","worldToLngLat","unprojectOption","topRight","bottomLeft","bottomRight","getDistanceScales","highPrecision","_frustumPlanes","isGeospatial","_getCenterInWorld","meterOffset","commonPosition","_createProjectionMatrix","vpm","viewportMatrix","pixelProjectionMatrix","isEqual","compute","cachedArgs","args","cachedResult"],"mappings":"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","file":"static/js/main.00047016.chunk.js","sourcesContent":["// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n// View and Projection Matrix calculations for mapbox-js style\n// map view properties\nimport Viewport from './viewport';\n\nimport {\n  pixelsToWorld,\n  getViewMatrix,\n  addMetersToLngLat,\n  getProjectionParameters,\n  fitBounds,\n  getBounds\n} from '@math.gl/web-mercator';\n\n// TODO - import from math.gl\nimport * as vec2 from 'gl-matrix/vec2';\nimport {Matrix4} from 'math.gl';\n\nexport default class WebMercatorViewport extends Viewport {\n  /**\n   * @classdesc\n   * Creates view/projection matrices from mercator params\n   * Note: The Viewport is immutable in the sense that it only has accessors.\n   * A new viewport instance should be created if any parameters have changed.\n   */\n  /* eslint-disable complexity, max-statements */\n  constructor(opts = {}) {\n    const {\n      latitude = 0,\n      longitude = 0,\n      zoom = 11,\n      pitch = 0,\n      bearing = 0,\n      nearZMultiplier = 0.1,\n      farZMultiplier = 1.01,\n      orthographic = false,\n\n      repeat = false,\n      worldOffset = 0\n    } = opts;\n\n    let {width, height, altitude = 1.5} = opts;\n    const scale = Math.pow(2, zoom);\n\n    // Silently allow apps to send in 0,0 to facilitate isomorphic render etc\n    width = width || 1;\n    height = height || 1;\n\n    // Altitude - prevent division by 0\n    // TODO - just throw an Error instead?\n    altitude = Math.max(0.75, altitude);\n\n    const {fov, aspect, focalDistance, near, far} = getProjectionParameters({\n      width,\n      height,\n      pitch,\n      altitude,\n      nearZMultiplier,\n      farZMultiplier\n    });\n\n    // The uncentered matrix allows us two move the center addition to the\n    // shader (cheap) which gives a coordinate system that has its center in\n    // the layer's center position. This makes rotations and other modelMatrx\n    // transforms much more useful.\n    let viewMatrixUncentered = getViewMatrix({\n      height,\n      pitch,\n      bearing,\n      scale,\n      altitude\n    });\n\n    if (worldOffset) {\n      const viewOffset = new Matrix4().translate([512 * worldOffset, 0, 0]);\n      viewMatrixUncentered = viewOffset.multiplyLeft(viewMatrixUncentered);\n    }\n\n    const viewportOpts = Object.assign({}, opts, {\n      // x, y,\n      width,\n      height,\n\n      // view matrix\n      viewMatrix: viewMatrixUncentered,\n      longitude,\n      latitude,\n      zoom,\n\n      // projection matrix parameters\n      orthographic,\n      fovyRadians: fov,\n      aspect,\n      // TODO Viewport is already carefully set up to \"focus\" on ground, so can't use focal distance\n      focalDistance: orthographic ? focalDistance : 1,\n      near,\n      far\n    });\n\n    super(viewportOpts);\n\n    // Save parameters\n    this.latitude = latitude;\n    this.longitude = longitude;\n    this.zoom = zoom;\n    this.pitch = pitch;\n    this.bearing = bearing;\n    this.altitude = altitude;\n\n    this.orthographic = orthographic;\n\n    this._subViewports = repeat ? [] : null;\n\n    Object.freeze(this);\n  }\n  /* eslint-enable complexity, max-statements */\n\n  get subViewports() {\n    if (this._subViewports && !this._subViewports.length) {\n      // Cache sub viewports so that we only calculate them once\n      const bounds = this.getBounds();\n\n      const minOffset = Math.floor((bounds[0] + 180) / 360);\n      const maxOffset = Math.ceil((bounds[2] - 180) / 360);\n\n      for (let x = minOffset; x <= maxOffset; x++) {\n        const offsetViewport = x\n          ? new WebMercatorViewport({\n              ...this,\n              worldOffset: x\n            })\n          : this;\n        this._subViewports.push(offsetViewport);\n      }\n    }\n    return this._subViewports;\n  }\n\n  /**\n   * Add a meter delta to a base lnglat coordinate, returning a new lnglat array\n   *\n   * Note: Uses simple linear approximation around the viewport center\n   * Error increases with size of offset (roughly 1% per 100km)\n   *\n   * @param {[Number,Number]|[Number,Number,Number]) lngLatZ - base coordinate\n   * @param {[Number,Number]|[Number,Number,Number]) xyz - array of meter deltas\n   * @return {[Number,Number]|[Number,Number,Number]) array of [lng,lat,z] deltas\n   */\n  addMetersToLngLat(lngLatZ, xyz) {\n    return addMetersToLngLat(lngLatZ, xyz);\n  }\n\n  /**\n   * Get the map center that place a given [lng, lat] coordinate at screen\n   * point [x, y]\n   *\n   * @param {Array} lngLat - [lng,lat] coordinates\n   *   Specifies a point on the sphere.\n   * @param {Array} pos - [x,y] coordinates\n   *   Specifies a point on the screen.\n   * @return {Array} [lng,lat] new map center.\n   */\n  getMapCenterByLngLatPosition({lngLat, pos}) {\n    const fromLocation = pixelsToWorld(pos, this.pixelUnprojectionMatrix);\n    const toLocation = this.projectFlat(lngLat);\n\n    const translate = vec2.add([], toLocation, vec2.negate([], fromLocation));\n    const newCenter = vec2.add([], this.center, translate);\n\n    return this.unprojectFlat(newCenter);\n  }\n\n  getBounds(options = {}) {\n    const corners = getBounds(this, options.z || 0);\n\n    return [\n      Math.min(corners[0][0], corners[1][0], corners[2][0], corners[3][0]),\n      Math.min(corners[0][1], corners[1][1], corners[2][1], corners[3][1]),\n      Math.max(corners[0][0], corners[1][0], corners[2][0], corners[3][0]),\n      Math.max(corners[0][1], corners[1][1], corners[2][1], corners[3][1])\n    ];\n  }\n\n  /**\n   * Returns a new viewport that fit around the given rectangle.\n   * Only supports non-perspective mode.\n   * @param {Array} bounds - [[lon, lat], [lon, lat]]\n   * @param {Number} [options.padding] - The amount of padding in pixels to add to the given bounds.\n   * @param {Array} [options.offset] - The center of the given bounds relative to the map's center,\n   *    [x, y] measured in pixels.\n   * @returns {WebMercatorViewport}\n   */\n  fitBounds(bounds, options = {}) {\n    const {width, height} = this;\n    const {longitude, latitude, zoom} = fitBounds(Object.assign({width, height, bounds}, options));\n    return new WebMercatorViewport({width, height, longitude, latitude, zoom});\n  }\n}\n\nWebMercatorViewport.displayName = 'WebMercatorViewport';\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n/* eslint-disable complexity */\n\nimport * as mat4 from 'gl-matrix/mat4';\nimport * as vec4 from 'gl-matrix/vec4';\n\nimport {COORDINATE_SYSTEM, PROJECTION_MODE} from '../../lib/constants';\n\nimport memoize from '../../utils/memoize';\nimport assert from '../../utils/assert';\n\n// To quickly set a vector to zero\nconst ZERO_VECTOR = [0, 0, 0, 0];\n// 4x4 matrix that drops 4th component of vector\nconst VECTOR_TO_POINT_MATRIX = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0];\nconst IDENTITY_MATRIX = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\nconst DEFAULT_PIXELS_PER_UNIT2 = [0, 0, 0];\nconst DEFAULT_COORDINATE_ORIGIN = [0, 0, 0];\n\nconst getMemoizedViewportUniforms = memoize(calculateViewportUniforms);\n\nexport function getOffsetOrigin(\n  viewport,\n  coordinateSystem,\n  coordinateOrigin = DEFAULT_COORDINATE_ORIGIN\n) {\n  let shaderCoordinateOrigin = coordinateOrigin;\n  let geospatialOrigin;\n  let offsetMode = true;\n\n  if (\n    coordinateSystem === COORDINATE_SYSTEM.LNGLAT_OFFSETS ||\n    coordinateSystem === COORDINATE_SYSTEM.METER_OFFSETS\n  ) {\n    geospatialOrigin = coordinateOrigin;\n  } else {\n    geospatialOrigin = viewport.isGeospatial\n      ? [Math.fround(viewport.longitude), Math.fround(viewport.latitude), 0]\n      : null;\n  }\n\n  switch (viewport.projectionMode) {\n    case PROJECTION_MODE.WEB_MERCATOR:\n      if (\n        coordinateSystem === COORDINATE_SYSTEM.LNGLAT ||\n        coordinateSystem === COORDINATE_SYSTEM.CARTESIAN\n      ) {\n        offsetMode = false;\n      }\n      break;\n\n    case PROJECTION_MODE.WEB_MERCATOR_AUTO_OFFSET:\n      if (coordinateSystem === COORDINATE_SYSTEM.LNGLAT) {\n        // viewport center in world space\n        shaderCoordinateOrigin = geospatialOrigin;\n      } else if (coordinateSystem === COORDINATE_SYSTEM.CARTESIAN) {\n        // viewport center in common space\n        shaderCoordinateOrigin = [\n          Math.fround(viewport.center[0]),\n          Math.fround(viewport.center[1]),\n          0\n        ];\n        // Geospatial origin (wgs84) must match shaderCoordinateOrigin (common)\n        geospatialOrigin = viewport.unprojectPosition(shaderCoordinateOrigin);\n        shaderCoordinateOrigin[0] -= coordinateOrigin[0];\n        shaderCoordinateOrigin[1] -= coordinateOrigin[1];\n        shaderCoordinateOrigin[2] -= coordinateOrigin[2];\n      }\n      break;\n\n    case PROJECTION_MODE.IDENTITY:\n      shaderCoordinateOrigin = viewport.position.map(Math.fround);\n      break;\n\n    case PROJECTION_MODE.GLOBE:\n      offsetMode = false;\n      break;\n\n    default:\n      // Unknown projection mode\n      offsetMode = false;\n  }\n\n  shaderCoordinateOrigin[2] = shaderCoordinateOrigin[2] || 0;\n\n  return {geospatialOrigin, shaderCoordinateOrigin, offsetMode};\n}\n\n// The code that utilizes Matrix4 does the same calculation as their mat4 counterparts,\n// has lower performance but provides error checking.\nfunction calculateMatrixAndOffset(viewport, coordinateSystem, coordinateOrigin) {\n  const {viewMatrixUncentered, projectionMatrix} = viewport;\n  let {viewMatrix, viewProjectionMatrix} = viewport;\n\n  let projectionCenter = ZERO_VECTOR;\n  let cameraPosCommon = viewport.cameraPosition;\n  const {geospatialOrigin, shaderCoordinateOrigin, offsetMode} = getOffsetOrigin(\n    viewport,\n    coordinateSystem,\n    coordinateOrigin\n  );\n\n  if (offsetMode) {\n    // Calculate transformed projectionCenter (using 64 bit precision JS)\n    // This is the key to offset mode precision\n    // (avoids doing this addition in 32 bit precision in GLSL)\n    const positionCommonSpace = viewport.projectPosition(\n      geospatialOrigin || shaderCoordinateOrigin\n    );\n\n    cameraPosCommon = [\n      cameraPosCommon[0] - positionCommonSpace[0],\n      cameraPosCommon[1] - positionCommonSpace[1],\n      cameraPosCommon[2] - positionCommonSpace[2]\n    ];\n\n    positionCommonSpace[3] = 1;\n\n    // projectionCenter = new Matrix4(viewProjectionMatrix)\n    //   .transformVector([positionPixels[0], positionPixels[1], 0.0, 1.0]);\n    projectionCenter = vec4.transformMat4([], positionCommonSpace, viewProjectionMatrix);\n\n    // Always apply uncentered projection matrix if available (shader adds center)\n    viewMatrix = viewMatrixUncentered || viewMatrix;\n\n    // Zero out 4th coordinate (\"after\" model matrix) - avoids further translations\n    // viewMatrix = new Matrix4(viewMatrixUncentered || viewMatrix)\n    //   .multiplyRight(VECTOR_TO_POINT_MATRIX);\n    viewProjectionMatrix = mat4.multiply([], projectionMatrix, viewMatrix);\n    viewProjectionMatrix = mat4.multiply([], viewProjectionMatrix, VECTOR_TO_POINT_MATRIX);\n  }\n\n  return {\n    viewMatrix,\n    viewProjectionMatrix,\n    projectionCenter,\n    cameraPosCommon,\n    shaderCoordinateOrigin,\n    geospatialOrigin\n  };\n}\n\n/**\n * Returns uniforms for shaders based on current projection\n * includes: projection matrix suitable for shaders\n *\n * TODO - Ensure this works with any viewport, not just WebMercatorViewports\n *\n * @param {WebMercatorViewport} viewport -\n * @return {Float32Array} - 4x4 projection matrix that can be used in shaders\n */\nexport function getUniformsFromViewport({\n  viewport,\n  devicePixelRatio = 1,\n  modelMatrix = null,\n  // Match Layer.defaultProps\n  coordinateSystem = COORDINATE_SYSTEM.DEFAULT,\n  coordinateOrigin,\n  autoWrapLongitude = false,\n  // Deprecated\n  projectionMode,\n  positionOrigin\n} = {}) {\n  assert(viewport);\n\n  if (coordinateSystem === COORDINATE_SYSTEM.DEFAULT) {\n    coordinateSystem = viewport.isGeospatial\n      ? COORDINATE_SYSTEM.LNGLAT\n      : COORDINATE_SYSTEM.CARTESIAN;\n  }\n\n  const uniforms = getMemoizedViewportUniforms({\n    viewport,\n    devicePixelRatio,\n    coordinateSystem,\n    coordinateOrigin\n  });\n\n  uniforms.project_uWrapLongitude = autoWrapLongitude;\n  uniforms.project_uModelMatrix = modelMatrix || IDENTITY_MATRIX;\n\n  return uniforms;\n}\n\nfunction calculateViewportUniforms({\n  viewport,\n  devicePixelRatio,\n  coordinateSystem,\n  coordinateOrigin\n}) {\n  const {\n    projectionCenter,\n    viewProjectionMatrix,\n    cameraPosCommon,\n    shaderCoordinateOrigin,\n    geospatialOrigin\n  } = calculateMatrixAndOffset(viewport, coordinateSystem, coordinateOrigin);\n\n  // Calculate projection pixels per unit\n  const distanceScales = viewport.getDistanceScales();\n\n  const viewportSize = [viewport.width * devicePixelRatio, viewport.height * devicePixelRatio];\n\n  const uniforms = {\n    // Projection mode values\n    project_uCoordinateSystem: coordinateSystem,\n    project_uProjectionMode: viewport.projectionMode,\n    project_uCoordinateOrigin: shaderCoordinateOrigin,\n    project_uCenter: projectionCenter,\n    project_uAntimeridian: (viewport.longitude || 0) - 180,\n\n    // Screen size\n    project_uViewportSize: viewportSize,\n    project_uDevicePixelRatio: devicePixelRatio,\n\n    // Distance at which screen pixels are projected\n    project_uFocalDistance: viewport.focalDistance || 1,\n    project_uCommonUnitsPerMeter: distanceScales.unitsPerMeter,\n    project_uCommonUnitsPerWorldUnit: distanceScales.unitsPerMeter,\n    project_uCommonUnitsPerWorldUnit2: DEFAULT_PIXELS_PER_UNIT2,\n    project_uScale: viewport.scale, // This is the mercator scale (2 ** zoom)\n\n    project_uViewProjectionMatrix: viewProjectionMatrix,\n\n    // This is for lighting calculations\n    project_uCameraPosition: cameraPosCommon\n  };\n\n  if (geospatialOrigin) {\n    const distanceScalesAtOrigin = viewport.getDistanceScales(geospatialOrigin);\n    switch (coordinateSystem) {\n      case COORDINATE_SYSTEM.METER_OFFSETS:\n        uniforms.project_uCommonUnitsPerWorldUnit = distanceScalesAtOrigin.unitsPerMeter;\n        uniforms.project_uCommonUnitsPerWorldUnit2 = distanceScalesAtOrigin.unitsPerMeter2;\n        break;\n\n      case COORDINATE_SYSTEM.LNGLAT:\n      case COORDINATE_SYSTEM.LNGLAT_OFFSETS:\n        uniforms.project_uCommonUnitsPerWorldUnit = distanceScalesAtOrigin.unitsPerDegree;\n        uniforms.project_uCommonUnitsPerWorldUnit2 = distanceScalesAtOrigin.unitsPerDegree2;\n        break;\n\n      // a.k.a \"preprojected\" positions\n      case COORDINATE_SYSTEM.CARTESIAN:\n        uniforms.project_uCommonUnitsPerWorldUnit = [1, 1, distanceScalesAtOrigin.unitsPerMeter[2]];\n        uniforms.project_uCommonUnitsPerWorldUnit2 = [\n          0,\n          0,\n          distanceScalesAtOrigin.unitsPerMeter2[2]\n        ];\n        break;\n\n      default:\n        break;\n    }\n  }\n\n  return uniforms;\n}\n","/* eslint-disable complexity */\n\n/* This class creates a luma.gl-compatible \"view\" on top of a DataColumn instance */\nexport default class ShaderAttribute {\n  constructor(dataColumn, opts) {\n    // Options that cannot be changed later\n    this.opts = opts;\n    this.source = dataColumn;\n  }\n\n  get value() {\n    return this.source.value;\n  }\n\n  getValue() {\n    const buffer = this.source.getBuffer();\n    const accessor = this.getAccessor();\n    if (buffer) {\n      return [buffer, accessor];\n    }\n\n    const {value} = this.source;\n    const {size} = accessor;\n    let constantValue = value;\n\n    if (value && value.length !== size) {\n      constantValue = new Float32Array(size);\n      // initiate offset values\n      const index = accessor.elementOffset || 0; // element offset\n      for (let i = 0; i < size; ++i) {\n        constantValue[i] = value[index + i];\n      }\n    }\n\n    return constantValue;\n  }\n\n  getAccessor() {\n    return {\n      // source data accessor\n      ...this.source.getAccessor(),\n      // shader attribute overrides\n      ...this.opts\n    };\n  }\n}\n","/* eslint-disable complexity */\nimport GL from '@luma.gl/constants';\nimport {hasFeature, FEATURES, Buffer} from '@luma.gl/core';\nimport ShaderAttribute from './shader-attribute';\nimport {glArrayFromType} from './gl-utils';\nimport typedArrayManager from '../../utils/typed-array-manager';\nimport {toDoublePrecisionArray} from '../../utils/math-utils';\nimport log from '../../utils/log';\n\nfunction getStride(accessor) {\n  return accessor.stride || accessor.size * accessor.bytesPerElement;\n}\n\nfunction resolveShaderAttribute(baseAccessor, shaderAttributeOptions) {\n  if (shaderAttributeOptions.offset) {\n    log.removed('shaderAttribute.offset', 'vertexOffset, elementOffset')();\n  }\n\n  // All shader attributes share the parent's stride\n  const stride = getStride(baseAccessor);\n  // `vertexOffset` is used to access the neighboring vertex's value\n  // e.g. `nextPositions` in polygon\n  const vertexOffset =\n    'vertexOffset' in shaderAttributeOptions\n      ? shaderAttributeOptions.vertexOffset\n      : baseAccessor.vertexOffset || 0;\n  // `elementOffset` is defined when shader attribute's size is smaller than the parent's\n  // e.g. `translations` in transform matrix\n  const elementOffset = shaderAttributeOptions.elementOffset || 0;\n  const offset =\n    // offsets defined by the attribute\n    vertexOffset * stride +\n    elementOffset * baseAccessor.bytesPerElement +\n    // offsets defined by external buffers if any\n    (baseAccessor.offset || 0);\n\n  return {\n    ...shaderAttributeOptions,\n    offset,\n    stride\n  };\n}\n\nfunction resolveDoublePrecisionShaderAttributes(baseAccessor, shaderAttributeOptions) {\n  const resolvedOptions = resolveShaderAttribute(baseAccessor, shaderAttributeOptions);\n\n  return {\n    high: resolvedOptions,\n    low: {\n      ...resolvedOptions,\n      offset: resolvedOptions.offset + baseAccessor.size * 4\n    }\n  };\n}\n\nexport default class DataColumn {\n  /* eslint-disable max-statements */\n  constructor(gl, opts) {\n    this.gl = gl;\n    this.id = opts.id;\n    this.size = opts.size;\n\n    const logicalType = opts.logicalType || opts.type;\n    const doublePrecision = logicalType === GL.DOUBLE;\n\n    let {defaultValue} = opts;\n    defaultValue = Number.isFinite(defaultValue)\n      ? [defaultValue]\n      : defaultValue || new Array(this.size).fill(0);\n    opts.defaultValue = defaultValue;\n\n    let bufferType = logicalType;\n    if (doublePrecision) {\n      bufferType = GL.FLOAT;\n    } else if (!bufferType && opts.isIndexed) {\n      bufferType =\n        gl && hasFeature(gl, FEATURES.ELEMENT_INDEX_UINT32) ? GL.UNSIGNED_INT : GL.UNSIGNED_SHORT;\n    } else if (!bufferType) {\n      bufferType = GL.FLOAT;\n    }\n    opts.logicalType = logicalType;\n    opts.type = bufferType;\n\n    // This is the attribute type defined by the layer\n    // If an external buffer is provided, this.type may be overwritten\n    // But we always want to use defaultType for allocation\n    let defaultType = glArrayFromType(logicalType || bufferType || GL.FLOAT);\n    this.shaderAttributes = {};\n    this.doublePrecision = doublePrecision;\n\n    // `fp64: false` tells a double-precision attribute to allocate Float32Arrays\n    // by default when using auto-packing. This is more efficient in use cases where\n    // high precision is unnecessary, but the `64Low` attribute is still required\n    // by the shader.\n    if (doublePrecision && opts.fp64 === false) {\n      defaultType = Float32Array;\n    }\n    opts.bytesPerElement = defaultType.BYTES_PER_ELEMENT;\n\n    this.defaultType = defaultType;\n    this.value = null;\n    this.settings = opts;\n    this.state = {\n      externalBuffer: null,\n      bufferAccessor: opts,\n      allocatedValue: null,\n      constant: false\n    };\n    this._buffer = null;\n\n    this.setData(opts);\n  }\n  /* eslint-enable max-statements */\n\n  get buffer() {\n    if (!this._buffer) {\n      const {isIndexed, type} = this.settings;\n      this._buffer = new Buffer(this.gl, {\n        id: this.id,\n        target: isIndexed ? GL.ELEMENT_ARRAY_BUFFER : GL.ARRAY_BUFFER,\n        accessor: {type}\n      });\n    }\n    return this._buffer;\n  }\n\n  get byteOffset() {\n    const accessor = this.getAccessor();\n    if (accessor.vertexOffset) {\n      return accessor.vertexOffset * getStride(accessor);\n    }\n    return 0;\n  }\n\n  delete() {\n    if (this._buffer) {\n      this._buffer.delete();\n      this._buffer = null;\n    }\n    typedArrayManager.release(this.state.allocatedValue);\n  }\n\n  getShaderAttributes(id, options) {\n    if (this.doublePrecision) {\n      const shaderAttributes = {};\n      const isBuffer64Bit = this.value instanceof Float64Array;\n\n      const doubleShaderAttributeDefs = resolveDoublePrecisionShaderAttributes(\n        this.getAccessor(),\n        options || {}\n      );\n\n      shaderAttributes[id] = new ShaderAttribute(this, doubleShaderAttributeDefs.high);\n      shaderAttributes[`${id}64Low`] = isBuffer64Bit\n        ? new ShaderAttribute(this, doubleShaderAttributeDefs.low)\n        : new Float32Array(this.size); // use constant for low part if buffer is 32-bit\n      return shaderAttributes;\n    }\n    if (options) {\n      const shaderAttributeDef = resolveShaderAttribute(this.getAccessor(), options);\n      return {[id]: new ShaderAttribute(this, shaderAttributeDef)};\n    }\n    return {[id]: this};\n  }\n\n  getBuffer() {\n    if (this.state.constant) {\n      return null;\n    }\n    return this.state.externalBuffer || this._buffer;\n  }\n\n  getValue() {\n    if (this.state.constant) {\n      return this.value;\n    }\n    return [this.getBuffer(), this.getAccessor()];\n  }\n\n  getAccessor() {\n    return this.state.bufferAccessor;\n  }\n\n  // returns true if success\n  // eslint-disable-next-line max-statements\n  setData(opts) {\n    const {state} = this;\n    if (ArrayBuffer.isView(opts)) {\n      opts = {value: opts};\n    } else if (opts instanceof Buffer) {\n      opts = {buffer: opts};\n    }\n\n    const accessor = {...this.settings, ...opts};\n    state.bufferAccessor = accessor;\n\n    if (opts.constant) {\n      // set constant\n      let value = opts.value;\n      value = this._normalizeValue(value, [], 0);\n      if (this.settings.normalized) {\n        value = this._normalizeConstant(value);\n      }\n      const hasChanged = !state.constant || !this._areValuesEqual(value, this.value);\n\n      if (!hasChanged) {\n        return false;\n      }\n      state.externalBuffer = null;\n      state.constant = true;\n      this.value = value;\n    } else if (opts.buffer) {\n      const buffer = opts.buffer;\n      state.externalBuffer = buffer;\n      state.constant = false;\n      this.value = opts.value;\n      const isBuffer64Bit = opts.value instanceof Float64Array;\n\n      // Copy the type of the buffer into the accessor\n      accessor.type = opts.type || buffer.accessor.type;\n      accessor.bytesPerElement = buffer.accessor.BYTES_PER_ELEMENT * (isBuffer64Bit ? 2 : 1);\n      accessor.stride = getStride(accessor);\n    } else if (opts.value) {\n      this._checkExternalBuffer(opts);\n\n      let value = opts.value;\n      state.externalBuffer = null;\n      state.constant = false;\n      this.value = value;\n\n      accessor.bytesPerElement = value.BYTES_PER_ELEMENT;\n      accessor.stride = getStride(accessor);\n\n      const {buffer, byteOffset} = this;\n\n      if (this.doublePrecision && value instanceof Float64Array) {\n        value = toDoublePrecisionArray(value, accessor);\n      }\n      // TODO: support offset in buffer.setData?\n      if (buffer.byteLength < value.byteLength + byteOffset) {\n        // Over allocation is required because shader attributes may have bigger offsets\n        buffer.reallocate((value.byteLength + byteOffset) * 2);\n      }\n      // Hack: force Buffer to infer data type\n      buffer.setAccessor(null);\n      buffer.subData({data: value, offset: byteOffset});\n      accessor.type = opts.type || buffer.accessor.type;\n    }\n\n    return true;\n  }\n\n  updateSubBuffer(opts = {}) {\n    const {value} = this;\n    const {startOffset = 0, endOffset} = opts;\n    this.buffer.subData({\n      data:\n        this.doublePrecision && value instanceof Float64Array\n          ? toDoublePrecisionArray(value, {\n              size: this.size,\n              startIndex: startOffset,\n              endIndex: endOffset\n            })\n          : value.subarray(startOffset, endOffset),\n      offset: startOffset * value.BYTES_PER_ELEMENT + this.byteOffset\n    });\n  }\n\n  allocate({numInstances, copy = false}) {\n    const {state} = this;\n    const oldValue = state.allocatedValue;\n\n    // Allocate at least one element to ensure a valid buffer\n    const value = typedArrayManager.allocate(oldValue, numInstances + 1, {\n      size: this.size,\n      type: this.defaultType,\n      copy\n    });\n\n    this.value = value;\n\n    const {buffer, byteOffset} = this;\n\n    if (buffer.byteLength < value.byteLength + byteOffset) {\n      buffer.reallocate(value.byteLength + byteOffset);\n\n      if (copy && oldValue) {\n        // Upload the full existing attribute value to the GPU, so that updateBuffer\n        // can choose to only update a partial range.\n        // TODO - copy old buffer to new buffer on the GPU\n        buffer.subData({\n          data:\n            oldValue instanceof Float64Array ? toDoublePrecisionArray(oldValue, this) : oldValue,\n          offset: byteOffset\n        });\n      }\n    }\n\n    state.allocatedValue = value;\n    state.constant = false;\n    state.externalBuffer = null;\n    state.bufferAccessor = this.settings;\n    return true;\n  }\n\n  // PRIVATE HELPER METHODS\n  _checkExternalBuffer(opts) {\n    const {value} = opts;\n    if (!opts.constant && value) {\n      const ArrayType = this.defaultType;\n\n      let illegalArrayType = false;\n      if (this.doublePrecision) {\n        // not 32bit or 64bit\n        illegalArrayType = value.BYTES_PER_ELEMENT < 4;\n      }\n      if (illegalArrayType) {\n        throw new Error(`Attribute ${this.id} does not support ${value.constructor.name}`);\n      }\n      if (!(value instanceof ArrayType) && this.settings.normalized && !('normalized' in opts)) {\n        log.warn(`Attribute ${this.id} is normalized`)();\n      }\n    }\n  }\n\n  // https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\n  _normalizeConstant(value) {\n    switch (this.settings.type) {\n      case GL.BYTE:\n        // normalize [-128, 127] to [-1, 1]\n        return new Float32Array(value).map(x => ((x + 128) / 255) * 2 - 1);\n\n      case GL.SHORT:\n        // normalize [-32768, 32767] to [-1, 1]\n        return new Float32Array(value).map(x => ((x + 32768) / 65535) * 2 - 1);\n\n      case GL.UNSIGNED_BYTE:\n        // normalize [0, 255] to [0, 1]\n        return new Float32Array(value).map(x => x / 255);\n\n      case GL.UNSIGNED_SHORT:\n        // normalize [0, 65535] to [0, 1]\n        return new Float32Array(value).map(x => x / 65535);\n\n      default:\n        // No normalization for gl.FLOAT and gl.HALF_FLOAT\n        return value;\n    }\n  }\n\n  /* check user supplied values and apply fallback */\n  _normalizeValue(value, out, start) {\n    const {defaultValue, size} = this.settings;\n\n    if (Number.isFinite(value)) {\n      out[start] = value;\n      return out;\n    }\n    if (!value) {\n      out[start] = defaultValue[0];\n      return out;\n    }\n\n    // Important - switch cases are 5x more performant than a for loop!\n    /* eslint-disable no-fallthrough, default-case */\n    switch (size) {\n      case 4:\n        out[start + 3] = Number.isFinite(value[3]) ? value[3] : defaultValue[3];\n      case 3:\n        out[start + 2] = Number.isFinite(value[2]) ? value[2] : defaultValue[2];\n      case 2:\n        out[start + 1] = Number.isFinite(value[1]) ? value[1] : defaultValue[1];\n      case 1:\n        out[start + 0] = Number.isFinite(value[0]) ? value[0] : defaultValue[0];\n        break;\n\n      default:\n        // In the rare case where the attribute size > 4, do it the slow way\n        // This is used for e.g. transform matrices\n        let i = size;\n        while (--i >= 0) {\n          out[start + i] = Number.isFinite(value[i]) ? value[i] : defaultValue[i];\n        }\n    }\n\n    return out;\n  }\n\n  _areValuesEqual(value1, value2) {\n    if (!value1 || !value2) {\n      return false;\n    }\n    const {size} = this;\n    for (let i = 0; i < size; i++) {\n      if (value1[i] !== value2[i]) {\n        return false;\n      }\n    }\n    return true;\n  }\n}\n","import GL from '@luma.gl/constants';\n\n/* eslint-disable complexity */\nexport function glArrayFromType(glType) {\n  // Sorted in some order of likelihood to reduce amount of comparisons\n  switch (glType) {\n    case GL.FLOAT:\n      return Float32Array;\n    case GL.DOUBLE:\n      return Float64Array;\n    case GL.UNSIGNED_SHORT:\n    case GL.UNSIGNED_SHORT_5_6_5:\n    case GL.UNSIGNED_SHORT_4_4_4_4:\n    case GL.UNSIGNED_SHORT_5_5_5_1:\n      return Uint16Array;\n    case GL.UNSIGNED_INT:\n      return Uint32Array;\n    case GL.UNSIGNED_BYTE:\n      return Uint8ClampedArray;\n    case GL.BYTE:\n      return Int8Array;\n    case GL.SHORT:\n      return Int16Array;\n    case GL.INT:\n      return Int32Array;\n    default:\n      throw new Error('Unknown GL type');\n  }\n}\n/* eslint-enable complexity */\n","/* \n * range (Array)\n *   + start (Number) - the start index (incl.)\n *   + end (Number) - the end index (excl.)\n * rangeList (Array) - array of sorted, combined ranges\n */\nexport const EMPTY = [];\nexport const FULL = [[0, Infinity]];\n\n// Insert a range into a range collection\nexport function add(rangeList, range) {\n  // Noop if range collection already covers all\n  if (rangeList === FULL) {\n    return rangeList;\n  }\n\n  // Validate the input range\n  if (range[0] < 0) {\n    range[0] = 0;\n  }\n  if (range[0] >= range[1]) {\n    return rangeList;\n  }\n\n  // TODO - split off to tree-shakable Range class\n  const newRangeList = [];\n  const len = rangeList.length;\n  let insertPosition = 0;\n\n  for (let i = 0; i < len; i++) {\n    const range0 = rangeList[i];\n\n    if (range0[1] < range[0]) {\n      // the current range is to the left of the new range\n      newRangeList.push(range0);\n      insertPosition = i + 1;\n    } else if (range0[0] > range[1]) {\n      // the current range is to the right of the new range\n      newRangeList.push(range0);\n    } else {\n      range = [Math.min(range0[0], range[0]), Math.max(range0[1], range[1])];\n    }\n  }\n  newRangeList.splice(insertPosition, 0, range);\n  return newRangeList;\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/*\n * Helper function for padArray\n */\nfunction padArrayChunk({source, target, start = 0, end, getData}) {\n  end = end || target.length;\n\n  const sourceLength = source.length;\n  const targetLength = end - start;\n\n  if (sourceLength > targetLength) {\n    target.set(source.subarray(0, targetLength), start);\n    return;\n  }\n\n  target.set(source, start);\n\n  if (!getData) {\n    return;\n  }\n\n  // source is not large enough to fill target space, call `getData` to get filler data\n  let i = sourceLength;\n  while (i < targetLength) {\n    const datum = getData(i, source);\n    for (let j = 0; j < datum.length; j++) {\n      target[start + i] = datum[j];\n      i++;\n    }\n  }\n}\n\n/*\n * The padArray function stretches a source array to the size of a target array.\n   The arrays can have internal structures (like the attributes of PathLayer and\n   SolidPolygonLayer), defined by the optional sourceStartIndices and targetStartIndices parameters.\n   If the target array is larger, the getData callback is used to fill in the blanks.\n * @params {TypedArray} source - original data\n * @params {TypedArray} target - output data\n * @params {Number} size - length per datum\n * @params {Function} getData - callback to get new data when source is short\n * @params {Array<Number>} [sourceStartIndices] - subdivision of the original data in [object0StartIndex, object1StartIndex, ...]\n * @params {Array<Number>} [targetStartIndices] - subdivision of the output data in [object0StartIndex, object1StartIndex, ...]\n */\nexport function padArray({source, target, size, getData, sourceStartIndices, targetStartIndices}) {\n  if (!Array.isArray(targetStartIndices)) {\n    // Flat arrays\n    padArrayChunk({\n      source,\n      target,\n      getData\n    });\n    return target;\n  }\n\n  // Arrays have internal structure\n  let sourceIndex = 0;\n  let targetIndex = 0;\n  const getChunkData = getData && ((i, chunk) => getData(i + targetIndex, chunk));\n\n  const n = Math.min(sourceStartIndices.length, targetStartIndices.length);\n\n  for (let i = 1; i < n; i++) {\n    const nextSourceIndex = sourceStartIndices[i] * size;\n    const nextTargetIndex = targetStartIndices[i] * size;\n\n    padArrayChunk({\n      source: source.subarray(sourceIndex, nextSourceIndex),\n      target,\n      start: targetIndex,\n      end: nextTargetIndex,\n      getData: getChunkData\n    });\n\n    sourceIndex = nextSourceIndex;\n    targetIndex = nextTargetIndex;\n  }\n\n  if (targetIndex < target.length) {\n    padArrayChunk({\n      source: [],\n      target,\n      start: targetIndex,\n      getData: getChunkData\n    });\n  }\n\n  return target;\n}\n","import {padArray} from '../../utils/array-utils';\n\nconst DEFAULT_TRANSITION_SETTINGS = {\n  interpolation: {\n    duration: 0,\n    easing: t => t\n  },\n  spring: {\n    stiffness: 0.05,\n    damping: 0.5\n  }\n};\n\nexport function normalizeTransitionSettings(userSettings, layerSettings) {\n  if (!userSettings) {\n    return null;\n  }\n  if (Number.isFinite(userSettings)) {\n    userSettings = {duration: userSettings};\n  }\n  userSettings.type = userSettings.type || 'interpolation';\n  return Object.assign(\n    {},\n    DEFAULT_TRANSITION_SETTINGS[userSettings.type],\n    layerSettings,\n    userSettings\n  );\n}\n\n// NOTE: NOT COPYING OVER OFFSET OR STRIDE HERE BECAUSE:\n// (1) WE DON'T SUPPORT INTERLEAVED BUFFERS FOR TRANSITIONS\n// (2) BUFFERS WITH OFFSETS ALWAYS CONTAIN VALUES OF THE SAME SIZE\n// (3) THE OPERATIONS IN THE SHADER ARE PER-COMPONENT (addition and scaling)\nexport function getSourceBufferAttribute(gl, attribute) {\n  // The Attribute we pass to Transform as a sourceBuffer must have {divisor: 0}\n  // so we create a copy of the attribute (with divisor=0) to use when running\n  // transform feedback\n  const buffer = attribute.getBuffer();\n  if (buffer) {\n    return [\n      attribute.getBuffer(),\n      {\n        divisor: 0,\n        size: attribute.size,\n        normalized: attribute.settings.normalized\n      }\n    ];\n  }\n  // constant\n  // don't pass normalized here because the `value` from a normalized attribute is\n  // already normalized\n  return attribute.value;\n}\n\nexport function getAttributeTypeFromSize(size) {\n  switch (size) {\n    case 1:\n      return 'float';\n    case 2:\n      return 'vec2';\n    case 3:\n      return 'vec3';\n    case 4:\n      return 'vec4';\n    default:\n      throw new Error(`No defined attribute type for size \"${size}\"`);\n  }\n}\n\nexport function cycleBuffers(buffers) {\n  buffers.push(buffers.shift());\n}\n\nexport function getAttributeBufferLength(attribute, numInstances) {\n  const {doublePrecision, settings, value, size} = attribute;\n  const multiplier = doublePrecision ? 2 : 1;\n  return (settings.noAlloc ? value.length : numInstances * size) * multiplier;\n}\n\n// This helper is used when transitioning attributes from a set of values in one buffer layout\n// to a set of values in a different buffer layout. (Buffer layouts are used when attribute values\n// within a buffer should be grouped for drawElements, like the Polygon layer.) For example, a\n// buffer layout of [3, 4] might have data [A1, A2, A3, B1, B2, B3, B4]. If it needs to transition\n// to a buffer layout of [4, 2], it should produce a buffer, using the transition setting's `enter`\n// function, that looks like this: [A1, A2, A3, A4 (user `enter` fn), B1, B2, 0]. Note: the final\n// 0 in this buffer is because we never shrink buffers, only grow them, for performance reasons.\nexport function padBuffer({\n  buffer,\n  numInstances,\n  attribute,\n  fromLength,\n  fromStartIndices,\n  getData = x => x\n}) {\n  // TODO: move the precisionMultiplier logic to the attribute when retrieving\n  // its `size` and `elementOffset`?\n  const precisionMultiplier = attribute.doublePrecision ? 2 : 1;\n  const size = attribute.size * precisionMultiplier;\n  const byteOffset = attribute.byteOffset;\n  const toStartIndices = attribute.startIndices;\n  const hasStartIndices = fromStartIndices && toStartIndices;\n  const toLength = getAttributeBufferLength(attribute, numInstances);\n  const isConstant = attribute.state.constant;\n\n  // check if buffer needs to be padded\n  if (!hasStartIndices && fromLength >= toLength) {\n    return;\n  }\n\n  const toData = isConstant\n    ? attribute.value\n    : attribute.getBuffer().getData({srcByteOffset: byteOffset});\n  if (attribute.settings.normalized && !isConstant) {\n    const getter = getData;\n    getData = (value, chunk) => attribute._normalizeConstant(getter(value, chunk));\n  }\n\n  const getMissingData = isConstant\n    ? (i, chunk) => getData(toData, chunk)\n    : (i, chunk) => getData(toData.subarray(i, i + size), chunk);\n\n  const source = buffer.getData({length: fromLength});\n  const data = new Float32Array(toLength);\n  padArray({\n    source,\n    target: data,\n    sourceStartIndices: fromStartIndices,\n    targetStartIndices: toStartIndices,\n    size,\n    getData: getMissingData\n  });\n\n  // TODO: support offset in buffer.setData?\n  if (buffer.byteLength < data.byteLength + byteOffset) {\n    buffer.reallocate(data.byteLength + byteOffset);\n  }\n  buffer.subData({data, offset: byteOffset});\n}\n","/* eslint-disable complexity */\nimport DataColumn from './data-column';\nimport assert from '../../utils/assert';\nimport {createIterable, getAccessorFromBuffer} from '../../utils/iterable-utils';\nimport {fillArray} from '../../utils/flatten';\nimport * as range from '../../utils/range';\nimport {normalizeTransitionSettings} from './attribute-transition-utils';\n\nexport default class Attribute extends DataColumn {\n  constructor(gl, opts = {}) {\n    super(gl, opts);\n\n    const {\n      // deck.gl fields\n      transition = false,\n      noAlloc = false,\n      update = null,\n      accessor = null,\n      transform = null,\n      startIndices = null\n    } = opts;\n\n    Object.assign(this.settings, {\n      transition,\n      noAlloc,\n      update: update || (accessor && this._autoUpdater),\n      accessor,\n      transform\n    });\n\n    Object.assign(this.state, {\n      lastExternalBuffer: null,\n      binaryValue: null,\n      binaryAccessor: null,\n      needsUpdate: true,\n      needsRedraw: false,\n      updateRanges: range.FULL,\n      startIndices\n    });\n\n    Object.seal(this.settings);\n    Object.seal(this.state);\n\n    // Check all fields and generate helpful error messages\n    this._validateAttributeUpdaters();\n  }\n\n  get startIndices() {\n    return this.state.startIndices;\n  }\n\n  set startIndices(layout) {\n    this.state.startIndices = layout;\n  }\n\n  needsUpdate() {\n    return this.state.needsUpdate;\n  }\n\n  needsRedraw({clearChangedFlags = false} = {}) {\n    const needsRedraw = this.state.needsRedraw;\n    this.state.needsRedraw = needsRedraw && !clearChangedFlags;\n    return needsRedraw;\n  }\n\n  getUpdateTriggers() {\n    const {accessor} = this.settings;\n\n    // Backards compatibility: allow attribute name to be used as update trigger key\n    return [this.id].concat((typeof accessor !== 'function' && accessor) || []);\n  }\n\n  supportsTransition() {\n    return Boolean(this.settings.transition);\n  }\n\n  // Resolve transition settings object if transition is enabled, otherwise `null`\n  getTransitionSetting(opts) {\n    const {accessor} = this.settings;\n    // TODO: have the layer resolve these transition settings itself?\n    const layerSettings = this.settings.transition;\n    if (!this.supportsTransition()) {\n      return null;\n    }\n    // these are the transition settings passed in by the user\n    const userSettings = Array.isArray(accessor)\n      ? opts[accessor.find(a => opts[a])]\n      : opts[accessor];\n\n    // Shorthand: use duration instead of parameter object\n    return normalizeTransitionSettings(userSettings, layerSettings);\n  }\n\n  setNeedsUpdate(reason = this.id, dataRange) {\n    this.state.needsUpdate = this.state.needsUpdate || reason;\n    this.setNeedsRedraw(reason);\n    if (dataRange) {\n      const {startRow = 0, endRow = Infinity} = dataRange;\n      this.state.updateRanges = range.add(this.state.updateRanges, [startRow, endRow]);\n    } else {\n      this.state.updateRanges = range.FULL;\n    }\n  }\n\n  clearNeedsUpdate() {\n    this.state.needsUpdate = false;\n    this.state.updateRanges = range.EMPTY;\n  }\n\n  setNeedsRedraw(reason = this.id) {\n    this.state.needsRedraw = this.state.needsRedraw || reason;\n  }\n\n  update(opts) {\n    // backward compatibility\n    this.setData(opts);\n  }\n\n  allocate(numInstances) {\n    const {state, settings} = this;\n\n    if (settings.noAlloc) {\n      // Data is provided through a Buffer object.\n      return false;\n    }\n\n    if (settings.update) {\n      assert(Number.isFinite(numInstances));\n      super.allocate({\n        numInstances,\n        copy: state.updateRanges !== range.FULL\n      });\n      return true;\n    }\n\n    return false;\n  }\n\n  updateBuffer({numInstances, data, props, context}) {\n    if (!this.needsUpdate()) {\n      return false;\n    }\n\n    const {\n      state: {updateRanges},\n      settings: {update, noAlloc}\n    } = this;\n\n    let updated = true;\n    if (update) {\n      // Custom updater - typically for non-instanced layers\n      for (const [startRow, endRow] of updateRanges) {\n        update.call(context, this, {data, startRow, endRow, props, numInstances});\n      }\n      if (!this.value) {\n        // no value was assigned during update\n      } else if (\n        this.constant ||\n        this.buffer.byteLength < this.value.byteLength + this.byteOffset\n      ) {\n        this.setData({\n          value: this.value,\n          constant: this.constant\n        });\n      } else {\n        for (const [startRow, endRow] of updateRanges) {\n          const startOffset = Number.isFinite(startRow) ? this.getVertexOffset(startRow) : 0;\n          const endOffset = Number.isFinite(endRow)\n            ? this.getVertexOffset(endRow)\n            : noAlloc || !Number.isFinite(numInstances)\n              ? this.value.length\n              : numInstances * this.size;\n\n          super.updateSubBuffer({startOffset, endOffset});\n        }\n      }\n      this._checkAttributeArray();\n    } else {\n      updated = false;\n    }\n\n    this.clearNeedsUpdate();\n    this.setNeedsRedraw();\n\n    return updated;\n  }\n\n  // Use generic value\n  // Returns true if successful\n  setConstantValue(value) {\n    if (value === undefined || typeof value === 'function') {\n      return false;\n    }\n\n    const hasChanged = this.setData({constant: true, value});\n\n    if (hasChanged) {\n      this.setNeedsRedraw();\n    }\n    this.clearNeedsUpdate();\n    return true;\n  }\n\n  // Use external buffer\n  // Returns true if successful\n  // eslint-disable-next-line max-statements\n  setExternalBuffer(buffer) {\n    const {state} = this;\n\n    if (!buffer) {\n      state.lastExternalBuffer = null;\n      return false;\n    }\n\n    this.clearNeedsUpdate();\n\n    if (state.lastExternalBuffer === buffer) {\n      return true;\n    }\n    state.lastExternalBuffer = buffer;\n    this.setNeedsRedraw();\n    this.setData(buffer);\n    return true;\n  }\n\n  // Binary value is a typed array packed from mapping the source data with the accessor\n  // If the returned value from the accessor is the same as the attribute value, set it directly\n  // Otherwise use the auto updater for transform/normalization\n  setBinaryValue(buffer, startIndices = null) {\n    const {state, settings} = this;\n\n    if (!buffer) {\n      state.binaryValue = null;\n      state.binaryAccessor = null;\n      return false;\n    }\n\n    if (settings.noAlloc) {\n      // Let the layer handle this\n      return false;\n    }\n\n    if (state.binaryValue === buffer) {\n      this.clearNeedsUpdate();\n      return true;\n    }\n    state.binaryValue = buffer;\n    this.setNeedsRedraw();\n\n    if (ArrayBuffer.isView(buffer)) {\n      buffer = {value: buffer};\n    }\n    const needsUpdate = settings.transform || startIndices !== this.startIndices;\n\n    if (needsUpdate) {\n      assert(ArrayBuffer.isView(buffer.value), `invalid ${settings.accessor}`);\n      const needsNormalize = buffer.size && buffer.size !== this.size;\n\n      state.binaryAccessor = getAccessorFromBuffer(buffer.value, {\n        size: buffer.size || this.size,\n        stride: buffer.stride,\n        offset: buffer.offset,\n        startIndices,\n        nested: needsNormalize\n      });\n      // Fall through to auto updater\n      return false;\n    }\n\n    this.clearNeedsUpdate();\n    this.setData(buffer);\n    return true;\n  }\n\n  getVertexOffset(row) {\n    const {startIndices} = this;\n    const vertexIndex = startIndices ? startIndices[row] : row;\n    return vertexIndex * this.size;\n  }\n\n  getShaderAttributes() {\n    const shaderAttributeDefs = this.settings.shaderAttributes || {[this.id]: null};\n    const shaderAttributes = {};\n\n    for (const shaderAttributeName in shaderAttributeDefs) {\n      Object.assign(\n        shaderAttributes,\n        super.getShaderAttributes(shaderAttributeName, shaderAttributeDefs[shaderAttributeName])\n      );\n    }\n\n    return shaderAttributes;\n  }\n\n  /* eslint-disable max-depth, max-statements */\n  _autoUpdater(attribute, {data, startRow, endRow, props, numInstances}) {\n    if (attribute.constant) {\n      return;\n    }\n    const {settings, state, value, size, startIndices} = attribute;\n\n    const {accessor, transform} = settings;\n    const accessorFunc =\n      state.binaryAccessor || (typeof accessor === 'function' ? accessor : props[accessor]);\n\n    assert(typeof accessorFunc === 'function', `accessor \"${accessor}\" is not a function`);\n\n    let i = attribute.getVertexOffset(startRow);\n    const {iterable, objectInfo} = createIterable(data, startRow, endRow);\n    for (const object of iterable) {\n      objectInfo.index++;\n\n      let objectValue = accessorFunc(object, objectInfo);\n      if (transform) {\n        // transform callbacks could be bound to a particular layer instance.\n        // always point `this` to the current layer.\n        objectValue = transform.call(this, objectValue);\n      }\n\n      if (startIndices) {\n        const numVertices =\n          (objectInfo.index < startIndices.length - 1\n            ? startIndices[objectInfo.index + 1]\n            : numInstances) - startIndices[objectInfo.index];\n        if (objectValue && Array.isArray(objectValue[0])) {\n          let startIndex = i;\n          for (const item of objectValue) {\n            attribute._normalizeValue(item, value, startIndex);\n            startIndex += size;\n          }\n        } else if (objectValue && objectValue.length > size) {\n          value.set(objectValue, i);\n        } else {\n          attribute._normalizeValue(objectValue, objectInfo.target, 0);\n          fillArray({\n            target: value,\n            source: objectInfo.target,\n            start: i,\n            count: numVertices\n          });\n        }\n        i += numVertices * size;\n      } else {\n        attribute._normalizeValue(objectValue, value, i);\n        i += size;\n      }\n    }\n  }\n  /* eslint-enable max-depth, max-statements */\n\n  // Validate deck.gl level fields\n  _validateAttributeUpdaters() {\n    const {settings} = this;\n\n    // Check that 'update' is a valid function\n    const hasUpdater = settings.noAlloc || typeof settings.update === 'function';\n    if (!hasUpdater) {\n      throw new Error(`Attribute ${this.id} missing update or accessor`);\n    }\n  }\n\n  // check that the first few elements of the attribute are reasonable\n  /* eslint-disable no-fallthrough */\n  _checkAttributeArray() {\n    const {value} = this;\n    const limit = Math.min(4, this.size);\n    if (value && value.length >= limit) {\n      let valid = true;\n      switch (limit) {\n        case 4:\n          valid = valid && Number.isFinite(value[3]);\n        case 3:\n          valid = valid && Number.isFinite(value[2]);\n        case 2:\n          valid = valid && Number.isFinite(value[1]);\n        case 1:\n          valid = valid && Number.isFinite(value[0]);\n          break;\n        default:\n          valid = false;\n      }\n\n      if (!valid) {\n        throw new Error(`Illegal attribute generated for ${this.id}`);\n      }\n    }\n  }\n  /* eslint-enable no-fallthrough */\n}\n","import GL from '@luma.gl/constants';\nimport {Buffer, Transform} from '@luma.gl/core';\nimport Attribute from '../lib/attribute/attribute';\nimport {\n  padBuffer,\n  getAttributeTypeFromSize,\n  getSourceBufferAttribute,\n  getAttributeBufferLength,\n  cycleBuffers\n} from '../lib/attribute/attribute-transition-utils';\nimport Transition from './transition';\n\nexport default class GPUInterpolationTransition {\n  constructor({gl, attribute, timeline}) {\n    this.gl = gl;\n    this.type = 'interpolation';\n    this.transition = new Transition(timeline);\n    this.attribute = attribute;\n    // this is the attribute we return during the transition - note: if it is a constant\n    // attribute, it will be converted and returned as a regular attribute\n    // `attribute.userData` is the original options passed when constructing the attribute.\n    // This ensures that we set the proper `doublePrecision` flag and shader attributes.\n    this.attributeInTransition = new Attribute(gl, attribute.settings);\n    this.currentStartIndices = attribute.startIndices;\n    // storing currentLength because this.buffer may be larger than the actual length we want to use\n    // this is because we only reallocate buffers when they grow, not when they shrink,\n    // due to performance costs\n    this.currentLength = 0;\n    this.transform = getTransform(gl, attribute);\n    const bufferOpts = {\n      byteLength: 0,\n      usage: GL.DYNAMIC_COPY\n    };\n    this.buffers = [\n      new Buffer(gl, bufferOpts), // from\n      new Buffer(gl, bufferOpts) // current\n    ];\n  }\n\n  get inProgress() {\n    return this.transition.inProgress;\n  }\n\n  // this is called when an attribute's values have changed and\n  // we need to start animating towards the new values\n  // this also correctly resizes / pads the transform's buffers\n  // in case the attribute's buffer has changed in length or in\n  // startIndices\n  start(transitionSettings, numInstances) {\n    if (transitionSettings.duration <= 0) {\n      this.transition.cancel();\n      return;\n    }\n\n    const {gl, buffers, attribute} = this;\n    // Alternate between two buffers when new transitions start.\n    // Last destination buffer is used as an attribute (from state),\n    // And the other buffer is now the current buffer.\n    cycleBuffers(buffers);\n\n    const padBufferOpts = {\n      numInstances,\n      attribute,\n      fromLength: this.currentLength,\n      fromStartIndices: this.currentStartIndices,\n      getData: transitionSettings.enter\n    };\n\n    for (const buffer of buffers) {\n      padBuffer({buffer, ...padBufferOpts});\n    }\n\n    this.currentStartIndices = attribute.startIndices;\n    this.currentLength = getAttributeBufferLength(attribute, numInstances);\n    this.attributeInTransition.update({\n      buffer: buffers[1],\n      // Hack: Float64Array is required for double-precision attributes\n      // to generate correct shader attributes\n      value: attribute.value\n    });\n\n    this.transition.start(transitionSettings);\n\n    this.transform.update({\n      elementCount: Math.floor(this.currentLength / attribute.size),\n      sourceBuffers: {\n        aFrom: buffers[0],\n        aTo: getSourceBufferAttribute(gl, attribute)\n      },\n      feedbackBuffers: {\n        vCurrent: buffers[1]\n      }\n    });\n  }\n\n  update() {\n    const updated = this.transition.update();\n    if (updated) {\n      const {\n        time,\n        settings: {duration, easing}\n      } = this.transition;\n      const t = easing(time / duration);\n      this.transform.run({\n        uniforms: {time: t}\n      });\n    }\n    return updated;\n  }\n\n  cancel() {\n    this.transition.cancel();\n    this.transform.delete();\n    while (this.buffers.length) {\n      this.buffers.pop().delete();\n    }\n  }\n}\n\nconst vs = `\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nuniform float time;\nattribute ATTRIBUTE_TYPE aFrom;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vCurrent;\n\nvoid main(void) {\n  vCurrent = mix(aFrom, aTo, time);\n  gl_Position = vec4(0.0);\n}\n`;\n\nfunction getTransform(gl, attribute) {\n  const attributeType = getAttributeTypeFromSize(attribute.size);\n  return new Transform(gl, {\n    vs,\n    defines: {\n      ATTRIBUTE_TYPE: attributeType\n    },\n    varyings: ['vCurrent']\n  });\n}\n","import {Transform} from '@luma.gl/core';\nimport GPUInterpolationTransition from '../../transitions/gpu-interpolation-transition';\nimport GPUSpringTransition from '../../transitions/gpu-spring-transition';\nimport log from '../../utils/log';\n\nconst TRANSITION_TYPES = {\n  interpolation: GPUInterpolationTransition,\n  spring: GPUSpringTransition\n};\n\nexport default class AttributeTransitionManager {\n  constructor(gl, {id, timeline}) {\n    this.id = id;\n    this.gl = gl;\n    this.timeline = timeline;\n\n    this.transitions = {};\n    this.needsRedraw = false;\n    this.numInstances = 1;\n\n    if (Transform.isSupported(gl)) {\n      this.isSupported = true;\n    } else if (gl) {\n      // This class may be instantiated without a WebGL context (e.g. web worker)\n      log.warn('WebGL2 not supported by this browser. Transition animation is disabled.')();\n    }\n  }\n\n  finalize() {\n    for (const attributeName in this.transitions) {\n      this._removeTransition(attributeName);\n    }\n  }\n\n  /* Public methods */\n\n  // Called when attribute manager updates\n  // Check the latest attributes for updates.\n  update({attributes, transitions = {}, numInstances}) {\n    // Transform class will crash if elementCount is 0\n    this.numInstances = numInstances || 1;\n\n    if (!this.isSupported) {\n      return;\n    }\n\n    for (const attributeName in attributes) {\n      const attribute = attributes[attributeName];\n      const settings = attribute.getTransitionSetting(transitions);\n\n      // this attribute might not support transitions?\n      if (!settings) continue; // eslint-disable-line no-continue\n      this._updateAttribute(attributeName, attribute, settings);\n    }\n\n    for (const attributeName in this.transitions) {\n      const attribute = attributes[attributeName];\n      if (!attribute || !attribute.getTransitionSetting(transitions)) {\n        // Animated attribute has been removed\n        this._removeTransition(attributeName);\n      }\n    }\n  }\n\n  // Returns `true` if attribute is transition-enabled\n  hasAttribute(attributeName) {\n    const transition = this.transitions[attributeName];\n    return transition && transition.inProgress;\n  }\n\n  // Get all the animated attributes\n  getAttributes() {\n    const animatedAttributes = {};\n\n    for (const attributeName in this.transitions) {\n      const transition = this.transitions[attributeName];\n      if (transition.inProgress) {\n        animatedAttributes[attributeName] = transition.attributeInTransition;\n      }\n    }\n\n    return animatedAttributes;\n  }\n\n  /* eslint-disable max-statements */\n  // Called every render cycle, run transform feedback\n  // Returns `true` if anything changes\n  run() {\n    if (!this.isSupported || this.numInstances === 0) {\n      return false;\n    }\n\n    for (const attributeName in this.transitions) {\n      const updated = this.transitions[attributeName].update();\n      if (updated) {\n        this.needsRedraw = true;\n      }\n    }\n\n    const needsRedraw = this.needsRedraw;\n    this.needsRedraw = false;\n    return needsRedraw;\n  }\n  /* eslint-enable max-statements */\n\n  /* Private methods */\n  _removeTransition(attributeName) {\n    this.transitions[attributeName].cancel();\n    delete this.transitions[attributeName];\n  }\n\n  // Check an attributes for updates\n  // Returns a transition object if a new transition is triggered.\n  _updateAttribute(attributeName, attribute, settings) {\n    const transition = this.transitions[attributeName];\n    // an attribute can change transition type when it updates\n    // let's remove the transition when that happens so we can create the new transition type\n    // TODO: when switching transition types, make sure to carry over the attribute's\n    // previous buffers, currentLength, startIndices, etc, to be used as the starting point\n    // for the next transition\n    let isNew = !transition || transition.type !== settings.type;\n    if (isNew) {\n      if (transition) {\n        this._removeTransition(attributeName);\n      }\n\n      const TransitionType = TRANSITION_TYPES[settings.type];\n      if (TransitionType) {\n        this.transitions[attributeName] = new TransitionType({\n          attribute,\n          timeline: this.timeline,\n          gl: this.gl\n        });\n      } else {\n        log.error(`unsupported transition type '${settings.type}'`)();\n        isNew = false;\n      }\n    }\n\n    if (isNew || attribute.needsRedraw()) {\n      this.needsRedraw = true;\n      this.transitions[attributeName].start(settings, this.numInstances);\n    }\n  }\n}\n","/* eslint-disable complexity, max-statements, max-params */\nimport GL from '@luma.gl/constants';\nimport {Buffer, Transform, Framebuffer, Texture2D, readPixelsToArray} from '@luma.gl/core';\nimport {\n  padBuffer,\n  getAttributeTypeFromSize,\n  getSourceBufferAttribute,\n  getAttributeBufferLength,\n  cycleBuffers\n} from '../lib/attribute/attribute-transition-utils';\nimport Attribute from '../lib/attribute/attribute';\nimport Transition from './transition';\n\nexport default class GPUSpringTransition {\n  constructor({gl, attribute, timeline}) {\n    this.gl = gl;\n    this.type = 'spring';\n    this.transition = new Transition(timeline);\n    this.attribute = attribute;\n    // this is the attribute we return during the transition - note: if it is a constant\n    // attribute, it will be converted and returned as a regular attribute\n    // `attribute.userData` is the original options passed when constructing the attribute.\n    // This ensures that we set the proper `doublePrecision` flag and shader attributes.\n    this.attributeInTransition = new Attribute(\n      gl,\n      Object.assign({}, attribute.settings, {normalized: false})\n    );\n    this.currentStartIndices = attribute.startIndices;\n    // storing currentLength because this.buffer may be larger than the actual length we want to use\n    // this is because we only reallocate buffers when they grow, not when they shrink,\n    // due to performance costs\n    this.currentLength = 0;\n    this.texture = getTexture(gl);\n    this.framebuffer = getFramebuffer(gl, this.texture);\n    this.transform = getTransform(gl, attribute, this.framebuffer);\n    const bufferOpts = {\n      byteLength: 0,\n      usage: GL.DYNAMIC_COPY\n    };\n    this.buffers = [\n      new Buffer(gl, bufferOpts), // previous\n      new Buffer(gl, bufferOpts), // current\n      new Buffer(gl, bufferOpts) // next\n    ];\n  }\n\n  get inProgress() {\n    return this.transition.inProgress;\n  }\n\n  // this is called when an attribute's values have changed and\n  // we need to start animating towards the new values\n  // this also correctly resizes / pads the transform's buffers\n  // in case the attribute's buffer has changed in length or in\n  // startIndices\n  start(transitionSettings, numInstances) {\n    const {gl, buffers, attribute} = this;\n    const padBufferOpts = {\n      numInstances,\n      attribute,\n      fromLength: this.currentLength,\n      fromStartIndices: this.currentStartIndices,\n      getData: transitionSettings.enter\n    };\n\n    for (const buffer of buffers) {\n      padBuffer({buffer, ...padBufferOpts});\n    }\n\n    this.currentStartIndices = attribute.startIndices;\n    this.currentLength = getAttributeBufferLength(attribute, numInstances);\n    this.attributeInTransition.update({\n      buffer: buffers[1],\n      // Hack: Float64Array is required for double-precision attributes\n      // to generate correct shader attributes\n      value: attribute.value\n    });\n\n    // when an attribute changes values, a new transition is started. These\n    // are properties that we have to store on this.transition but can change\n    // when new transitions are started, so we have to keep them up-to-date.\n    // this.transition.start() takes the latest settings and updates them.\n    this.transition.start(transitionSettings);\n\n    this.transform.update({\n      elementCount: Math.floor(this.currentLength / attribute.size),\n      sourceBuffers: {\n        aTo: getSourceBufferAttribute(gl, attribute)\n      }\n    });\n  }\n\n  update() {\n    const {buffers, transform, framebuffer, transition} = this;\n    const updated = transition.update();\n    if (!updated) {\n      return false;\n    }\n\n    transform.update({\n      sourceBuffers: {\n        aPrev: buffers[0],\n        aCur: buffers[1]\n      },\n      feedbackBuffers: {\n        vNext: buffers[2]\n      }\n    });\n    transform.run({\n      framebuffer,\n      discard: false,\n      clearRenderTarget: true,\n      uniforms: {\n        stiffness: transition.settings.stiffness,\n        damping: transition.settings.damping\n      },\n      parameters: {\n        depthTest: false,\n        blend: true,\n        viewport: [0, 0, 1, 1],\n        blendFunc: [GL.ONE, GL.ONE],\n        blendEquation: [GL.MAX, GL.MAX]\n      }\n    });\n\n    cycleBuffers(buffers);\n    this.attributeInTransition.update({\n      buffer: buffers[1],\n      // Hack: Float64Array is required for double-precision attributes\n      // to generate correct shader attributes\n      value: this.attribute.value\n    });\n\n    const isTransitioning = readPixelsToArray(framebuffer)[0] > 0;\n\n    if (!isTransitioning) {\n      transition.end();\n    }\n\n    return true;\n  }\n\n  cancel() {\n    this.transition.cancel();\n    this.transform.delete();\n    while (this.buffers.length) {\n      this.buffers.pop().delete();\n    }\n    this.texture.delete();\n    this.texture = null;\n    this.framebuffer.delete();\n    this.framebuffer = null;\n  }\n}\n\nfunction getTransform(gl, attribute, framebuffer) {\n  const attributeType = getAttributeTypeFromSize(attribute.size);\n  return new Transform(gl, {\n    framebuffer,\n    vs: `\n#define SHADER_NAME spring-transition-vertex-shader\n\n#define EPSILON 0.00001\n\nuniform float stiffness;\nuniform float damping;\nattribute ATTRIBUTE_TYPE aPrev;\nattribute ATTRIBUTE_TYPE aCur;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vNext;\nvarying float vIsTransitioningFlag;\n\nATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {\n  ATTRIBUTE_TYPE velocity = cur - prev;\n  ATTRIBUTE_TYPE delta = dest - cur;\n  ATTRIBUTE_TYPE spring = delta * stiffness;\n  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;\n  return spring + damper + velocity + cur;\n}\n\nvoid main(void) {\n  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;\n  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;\n\n  vNext = getNextValue(aCur, aPrev, aTo);\n  gl_Position = vec4(0, 0, 0, 1);\n  gl_PointSize = 100.0;\n}\n`,\n    fs: `\n#define SHADER_NAME spring-transition-is-transitioning-fragment-shader\n\nvarying float vIsTransitioningFlag;\n\nvoid main(void) {\n  if (vIsTransitioningFlag == 0.0) {\n    discard;\n  }\n  gl_FragColor = vec4(1.0);\n}`,\n    defines: {\n      ATTRIBUTE_TYPE: attributeType\n    },\n    varyings: ['vNext']\n  });\n}\n\nfunction getTexture(gl) {\n  return new Texture2D(gl, {\n    data: new Uint8Array(4),\n    format: GL.RGBA,\n    type: GL.UNSIGNED_BYTE,\n    border: 0,\n    mipmaps: false,\n    dataFormat: GL.RGBA,\n    width: 1,\n    height: 1\n  });\n}\n\nfunction getFramebuffer(gl, texture) {\n  return new Framebuffer(gl, {\n    id: 'spring-transition-is-transitioning-framebuffer',\n    width: 1,\n    height: 1,\n    attachments: {\n      [GL.COLOR_ATTACHMENT0]: texture\n    }\n  });\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* eslint-disable guard-for-in */\nimport Attribute from './attribute';\nimport log from '../../utils/log';\nimport debug from '../../debug';\n\nimport AttributeTransitionManager from './attribute-transition-manager';\n\nconst TRACE_INVALIDATE = 'attributeManager.invalidate';\nconst TRACE_UPDATE_START = 'attributeManager.updateStart';\nconst TRACE_UPDATE_END = 'attributeManager.updateEnd';\nconst TRACE_ATTRIBUTE_UPDATE_START = 'attribute.updateStart';\nconst TRACE_ATTRIBUTE_ALLOCATE = 'attribute.allocate';\nconst TRACE_ATTRIBUTE_UPDATE_END = 'attribute.updateEnd';\n\nexport default class AttributeManager {\n  /**\n   * @classdesc\n   * Automated attribute generation and management. Suitable when a set of\n   * vertex shader attributes are generated by iteration over a data array,\n   * and updates to these attributes are needed either when the data itself\n   * changes, or when other data relevant to the calculations change.\n   *\n   * - First the application registers descriptions of its dynamic vertex\n   *   attributes using AttributeManager.add().\n   * - Then, when any change that affects attributes is detected by the\n   *   application, the app will call AttributeManager.invalidate().\n   * - Finally before it renders, it calls AttributeManager.update() to\n   *   ensure that attributes are automatically rebuilt if anything has been\n   *   invalidated.\n   *\n   * The application provided update functions describe how attributes\n   * should be updated from a data array and are expected to traverse\n   * that data array (or iterable) and fill in the attribute's typed array.\n   *\n   * Note that the attribute manager intentionally does not do advanced\n   * change detection, but instead makes it easy to build such detection\n   * by offering the ability to \"invalidate\" each attribute separately.\n   */\n  constructor(gl, {id = 'attribute-manager', stats, timeline} = {}) {\n    this.id = id;\n    this.gl = gl;\n\n    this.attributes = {};\n\n    this.updateTriggers = {};\n    this.accessors = {};\n    this.needsRedraw = true;\n\n    this.userData = {};\n    this.stats = stats;\n\n    this.attributeTransitionManager = new AttributeTransitionManager(gl, {\n      id: `${id}-transitions`,\n      timeline\n    });\n\n    // For debugging sanity, prevent uninitialized members\n    Object.seal(this);\n  }\n\n  finalize() {\n    for (const attributeName in this.attributes) {\n      this.attributes[attributeName].delete();\n    }\n    this.attributeTransitionManager.finalize();\n  }\n\n  // Returns the redraw flag, optionally clearing it.\n  // Redraw flag will be set if any attributes attributes changed since\n  // flag was last cleared.\n  //\n  // @param {String} [clearRedrawFlags=false] - whether to clear the flag\n  // @return {false|String} - reason a redraw is needed.\n  getNeedsRedraw(opts = {clearRedrawFlags: false}) {\n    const redraw = this.needsRedraw;\n    this.needsRedraw = this.needsRedraw && !opts.clearRedrawFlags;\n    return redraw && this.id;\n  }\n\n  // Sets the redraw flag.\n  // @param {Boolean} redraw=true\n  // @return {AttributeManager} - for chaining\n  setNeedsRedraw(redraw = true) {\n    this.needsRedraw = true;\n    return this;\n  }\n\n  // Adds attributes\n  add(attributes, updaters) {\n    this._add(attributes, updaters);\n  }\n\n  // Adds attributes\n  addInstanced(attributes, updaters) {\n    this._add(attributes, updaters, {instanced: 1});\n  }\n\n  /**\n   * Removes attributes\n   * Takes an array of attribute names and delete them from\n   * the attribute map if they exists\n   *\n   * @example\n   * attributeManager.remove(['position']);\n   *\n   * @param {Object} attributeNameArray - attribute name array (see above)\n   */\n  remove(attributeNameArray) {\n    for (let i = 0; i < attributeNameArray.length; i++) {\n      const name = attributeNameArray[i];\n      if (this.attributes[name] !== undefined) {\n        this.attributes[name].delete();\n        delete this.attributes[name];\n      }\n    }\n  }\n\n  // Marks an attribute for update\n  invalidate(triggerName, dataRange) {\n    const invalidatedAttributes = this._invalidateTrigger(triggerName, dataRange);\n    // For performance tuning\n    debug(TRACE_INVALIDATE, this, triggerName, invalidatedAttributes);\n  }\n\n  invalidateAll(dataRange) {\n    for (const attributeName in this.attributes) {\n      this.attributes[attributeName].setNeedsUpdate(attributeName, dataRange);\n    }\n    // For performance tuning\n    debug(TRACE_INVALIDATE, this, 'all');\n  }\n\n  // Ensure all attribute buffers are updated from props or data.\n  update({\n    data,\n    numInstances,\n    startIndices = null,\n    transitions,\n    props = {},\n    buffers = {},\n    context = {}\n  } = {}) {\n    // keep track of whether some attributes are updated\n    let updated = false;\n\n    debug(TRACE_UPDATE_START, this);\n    if (this.stats) {\n      this.stats.get('Update Attributes').timeStart();\n    }\n\n    for (const attributeName in this.attributes) {\n      const attribute = this.attributes[attributeName];\n      const accessorName = attribute.settings.accessor;\n      attribute.startIndices = startIndices;\n\n      if (props[attributeName]) {\n        log.removed(`props.${attributeName}`, `data.attributes.${attributeName}`)();\n      }\n\n      if (attribute.setExternalBuffer(buffers[attributeName])) {\n        // Step 1: try update attribute directly from external buffers\n      } else if (attribute.setBinaryValue(buffers[accessorName], data.startIndices)) {\n        // Step 2: try set packed value from external typed array\n      } else if (!buffers[accessorName] && attribute.setConstantValue(props[accessorName])) {\n        // Step 3: try set constant value from props\n        // Note: if buffers[accessorName] is supplied, ignore props[accessorName]\n        // This may happen when setBinaryValue falls through to use the auto updater\n      } else if (attribute.needsUpdate()) {\n        // Step 4: update via updater callback\n        updated = true;\n        this._updateAttribute({\n          attribute,\n          numInstances,\n          data,\n          props,\n          context\n        });\n      }\n\n      this.needsRedraw |= attribute.needsRedraw();\n    }\n\n    if (updated) {\n      // Only initiate alloc/update (and logging) if actually needed\n      debug(TRACE_UPDATE_END, this, numInstances);\n    }\n\n    if (this.stats) {\n      this.stats.get('Update Attributes').timeEnd();\n    }\n\n    this.attributeTransitionManager.update({\n      attributes: this.attributes,\n      numInstances,\n      transitions\n    });\n  }\n\n  // Update attribute transition to the current timestamp\n  // Returns `true` if any transition is in progress\n  updateTransition() {\n    const {attributeTransitionManager} = this;\n    const transitionUpdated = attributeTransitionManager.run();\n    this.needsRedraw = this.needsRedraw || transitionUpdated;\n    return transitionUpdated;\n  }\n\n  /**\n   * Returns all attribute descriptors\n   * Note: Format matches luma.gl Model/Program.setAttributes()\n   * @return {Object} attributes - descriptors\n   */\n  getAttributes() {\n    return this.attributes;\n  }\n\n  /**\n   * Returns changed attribute descriptors\n   * This indicates which WebGLBuffers need to be updated\n   * @return {Object} attributes - descriptors\n   */\n  getChangedAttributes(opts = {clearChangedFlags: false}) {\n    const {attributes, attributeTransitionManager} = this;\n\n    const changedAttributes = Object.assign({}, attributeTransitionManager.getAttributes());\n\n    for (const attributeName in attributes) {\n      const attribute = attributes[attributeName];\n      if (attribute.needsRedraw(opts) && !attributeTransitionManager.hasAttribute(attributeName)) {\n        changedAttributes[attributeName] = attribute;\n      }\n    }\n\n    return changedAttributes;\n  }\n\n  // Returns shader attributes\n  getShaderAttributes(attributes, excludeAttributes = {}) {\n    if (!attributes) {\n      attributes = this.getAttributes();\n    }\n    const shaderAttributes = {};\n    for (const attributeName in attributes) {\n      if (!excludeAttributes[attributeName]) {\n        Object.assign(shaderAttributes, attributes[attributeName].getShaderAttributes());\n      }\n    }\n    return shaderAttributes;\n  }\n\n  // PROTECTED METHODS - Only to be used by collaborating classes, not by apps\n\n  // Returns object containing all accessors as keys, with non-null values\n  // @return {Object} - accessors object\n  getAccessors() {\n    return this.updateTriggers;\n  }\n\n  // PRIVATE METHODS\n\n  // Used to register an attribute\n  _add(attributes, updaters, extraProps = {}) {\n    if (updaters) {\n      log.warn('AttributeManager.add({updaters}) - updater map no longer supported')();\n    }\n\n    const newAttributes = {};\n\n    for (const attributeName in attributes) {\n      const attribute = attributes[attributeName];\n\n      // Initialize the attribute descriptor, with WebGL and metadata fields\n      const newAttribute = this._createAttribute(attributeName, attribute, extraProps);\n\n      newAttributes[attributeName] = newAttribute;\n    }\n\n    Object.assign(this.attributes, newAttributes);\n\n    this._mapUpdateTriggersToAttributes();\n  }\n  /* eslint-enable max-statements */\n\n  _createAttribute(name, attribute, extraProps) {\n    const props = {\n      id: name,\n      // Luma fields\n      constant: attribute.constant || false,\n      isIndexed: attribute.isIndexed || attribute.elements,\n      size: (attribute.elements && 1) || attribute.size,\n      value: attribute.value || null,\n      divisor: attribute.instanced || extraProps.instanced ? 1 : attribute.divisor\n    };\n\n    return new Attribute(this.gl, Object.assign({}, attribute, props));\n  }\n\n  // build updateTrigger name to attribute name mapping\n  _mapUpdateTriggersToAttributes() {\n    const triggers = {};\n\n    for (const attributeName in this.attributes) {\n      const attribute = this.attributes[attributeName];\n      attribute.getUpdateTriggers().forEach(triggerName => {\n        if (!triggers[triggerName]) {\n          triggers[triggerName] = [];\n        }\n        triggers[triggerName].push(attributeName);\n      });\n    }\n\n    this.updateTriggers = triggers;\n  }\n\n  _invalidateTrigger(triggerName, dataRange) {\n    const {attributes, updateTriggers} = this;\n    const invalidatedAttributes = updateTriggers[triggerName];\n\n    if (invalidatedAttributes) {\n      invalidatedAttributes.forEach(name => {\n        const attribute = attributes[name];\n        if (attribute) {\n          attribute.setNeedsUpdate(attribute.id, dataRange);\n        }\n      });\n    }\n    return invalidatedAttributes;\n  }\n\n  _updateAttribute(opts) {\n    const {attribute, numInstances} = opts;\n    debug(TRACE_ATTRIBUTE_UPDATE_START, attribute);\n\n    if (attribute.allocate(numInstances)) {\n      debug(TRACE_ATTRIBUTE_ALLOCATE, attribute, numInstances);\n    }\n\n    // Calls update on any buffers that need update\n    const updated = attribute.updateBuffer(opts);\n    if (updated) {\n      this.needsRedraw = true;\n      debug(TRACE_ATTRIBUTE_UPDATE_END, attribute, numInstances);\n    }\n  }\n}\n","import {lerp} from 'math.gl';\nimport Transition from './transition';\n\nexport default class CPUInterpolationTransition extends Transition {\n  get value() {\n    return this._value;\n  }\n\n  _onUpdate() {\n    const {\n      time,\n      settings: {fromValue, toValue, duration, easing}\n    } = this;\n    const t = easing(time / duration);\n    this._value = lerp(fromValue, toValue, t);\n  }\n}\n","import Transition from './transition';\n\nconst EPSILON = 1e-5;\n\n/*\n * Calculate the next value in the spring transition\n * @param prev {Number} - previous value\n * @param cur {Number} - current value\n * @param dest {Number} - destination value\n * @param damping {Number}\n * @param stiffness {Number}\n */\nfunction updateSpringElement(prev, cur, dest, damping, stiffness) {\n  const velocity = cur - prev;\n  const delta = dest - cur;\n  const spring = delta * stiffness;\n  const damper = -velocity * damping;\n  return spring + damper + velocity + cur;\n}\n\n/*\n * Calculate the next value in the spring transition\n * @param prev {Number|Array} - previous value\n * @param cur {Number|Array} - current value\n * @param dest {Number|Array} - destination value\n * @param damping {Number}\n * @param stiffness {Number}\n */\nfunction updateSpring(prev, cur, dest, damping, stiffness) {\n  if (Array.isArray(dest)) {\n    const next = [];\n    for (let i = 0; i < dest.length; i++) {\n      next[i] = updateSpringElement(prev[i], cur[i], dest[i], damping, stiffness);\n    }\n    return next;\n  }\n  return updateSpringElement(prev, cur, dest, damping, stiffness);\n}\n\n/*\n * Calculate the distance between two numbers or two vectors\n */\nfunction distance(value1, value2) {\n  if (Array.isArray(value1)) {\n    let distanceSquare = 0;\n    for (let i = 0; i < value1.length; i++) {\n      const d = value1[i] - value2[i];\n      distanceSquare += d * d;\n    }\n    return Math.sqrt(distanceSquare);\n  }\n  return Math.abs(value1 - value2);\n}\n\nexport default class CPUSpringTransition extends Transition {\n  get value() {\n    return this._currValue;\n  }\n\n  _onUpdate() {\n    // TODO - use timeline\n    // const {time} = this;\n\n    const {fromValue, toValue, damping, stiffness} = this.settings;\n    const {_prevValue = fromValue, _currValue = fromValue} = this;\n    let nextValue = updateSpring(_prevValue, _currValue, toValue, damping, stiffness);\n    const delta = distance(nextValue, toValue);\n    const velocity = distance(nextValue, _currValue);\n\n    if (delta < EPSILON && velocity < EPSILON) {\n      nextValue = toValue;\n      this.end();\n    }\n\n    this._prevValue = _currValue;\n    this._currValue = nextValue;\n  }\n}\n","import {normalizeTransitionSettings} from './attribute/attribute-transition-utils';\nimport CPUInterpolationTransition from '../transitions/cpu-interpolation-transition';\nimport CPUSpringTransition from '../transitions/cpu-spring-transition';\nimport log from '../utils/log';\n\nconst TRANSITION_TYPES = {\n  interpolation: CPUInterpolationTransition,\n  spring: CPUSpringTransition\n};\n\nexport default class UniformTransitionManager {\n  constructor(timeline) {\n    this.transitions = new Map();\n    this.timeline = timeline;\n  }\n\n  get active() {\n    return this.transitions.size > 0;\n  }\n\n  add(key, fromValue, toValue, settings) {\n    const {transitions} = this;\n    if (transitions.has(key)) {\n      const transition = transitions.get(key);\n      // value may not be available if `update()` has not been called. Fallback to `fromValue`\n      const {value = transition.settings.fromValue} = transition;\n      // start from interrupted position\n      fromValue = value;\n      this.remove(key);\n    }\n\n    settings = normalizeTransitionSettings(settings);\n    if (!settings) {\n      return;\n    }\n\n    const TransitionType = TRANSITION_TYPES[settings.type];\n    if (!TransitionType) {\n      log.error(`unsupported transition type '${settings.type}'`)();\n      return;\n    }\n    const transition = new TransitionType(this.timeline);\n    transition.start({\n      ...settings,\n      fromValue,\n      toValue\n    });\n    transitions.set(key, transition);\n  }\n\n  remove(key) {\n    const {transitions} = this;\n    if (transitions.has(key)) {\n      transitions.get(key).cancel();\n      transitions.delete(key);\n    }\n  }\n\n  update() {\n    const propsInTransition = {};\n\n    for (const [key, transition] of this.transitions) {\n      transition.update();\n      propsInTransition[key] = transition.value;\n      if (!transition.inProgress) {\n        // transition ended\n        this.remove(key);\n      }\n    }\n\n    return propsInTransition;\n  }\n\n  clear() {\n    for (const key of this.transitions.keys()) {\n      this.remove(key);\n    }\n  }\n}\n","import {PROP_SYMBOLS} from './constants';\n\nconst {COMPONENT} = PROP_SYMBOLS;\n\nexport function validateProps(props) {\n  const propTypes = getPropTypes(props);\n\n  for (const propName in propTypes) {\n    const propType = propTypes[propName];\n    const {validate} = propType;\n    if (validate && !validate(props[propName], propType)) {\n      throw new Error(`Invalid prop ${propName}: ${props[propName]}`);\n    }\n  }\n}\n\n// Returns an object with \"change flags\", either false or strings indicating reason for change\nexport function diffProps(props, oldProps) {\n  // First check if any props have changed (ignore props that will be examined separately)\n  const propsChangedReason = compareProps({\n    newProps: props,\n    oldProps,\n    propTypes: getPropTypes(props),\n    ignoreProps: {data: null, updateTriggers: null, extensions: null, transitions: null}\n  });\n\n  // Now check if any data related props have changed\n  const dataChangedReason = diffDataProps(props, oldProps);\n\n  // Check update triggers to determine if any attributes need regeneration\n  // Note - if data has changed, all attributes will need regeneration, so skip this step\n  let updateTriggersChangedReason = false;\n  if (!dataChangedReason) {\n    updateTriggersChangedReason = diffUpdateTriggers(props, oldProps);\n  }\n\n  return {\n    dataChanged: dataChangedReason,\n    propsChanged: propsChangedReason,\n    updateTriggersChanged: updateTriggersChangedReason,\n    extensionsChanged: diffExtensions(props, oldProps),\n    transitionsChanged: diffTransitions(props, oldProps)\n  };\n}\n\nfunction diffTransitions(props, oldProps) {\n  if (!props.transitions) {\n    return null;\n  }\n  const result = {};\n  const propTypes = getPropTypes(props);\n\n  for (const key in props.transitions) {\n    const propType = propTypes[key];\n    const type = propType && propType.type;\n    const isTransitionable = type === 'number' || type === 'color' || type === 'array';\n    if (isTransitionable && comparePropValues(props[key], oldProps[key], propType)) {\n      result[key] = true;\n    }\n  }\n  return result;\n}\n\n/**\n * Performs equality by iterating through keys on an object and returning false\n * when any key has values which are not strictly equal between the arguments.\n * @param {Object} opt.oldProps - object with old key/value pairs\n * @param {Object} opt.newProps - object with new key/value pairs\n * @param {Object} opt.ignoreProps={} - object, keys that should not be compared\n * @returns {null|String} - null when values of all keys are strictly equal.\n *   if unequal, returns a string explaining what changed.\n */\n/* eslint-disable max-statements, max-depth, complexity */\n/*\n * Note: for better performance, this function assumes that both oldProps and newProps\n   inherit the same prototype (defaultProps). That is, if neither object contains own\n   property <key>, assume `oldProps.<key>` and `newProps.<key>` are equal.\n */\nexport function compareProps({\n  newProps,\n  oldProps,\n  ignoreProps = {},\n  propTypes = {},\n  triggerName = 'props'\n} = {}) {\n  // shallow equality => deep equality\n  if (oldProps === newProps) {\n    return null;\n  }\n\n  // TODO - do we need these checks? Should never happen...\n  if (typeof newProps !== 'object' || newProps === null) {\n    return `${triggerName} changed shallowly`;\n  }\n\n  if (typeof oldProps !== 'object' || oldProps === null) {\n    return `${triggerName} changed shallowly`;\n  }\n\n  // Compare explicitly defined new props against old/default values\n  for (const key of Object.keys(newProps)) {\n    if (!(key in ignoreProps)) {\n      if (!(key in oldProps)) {\n        return `${triggerName}.${key} added`;\n      }\n      const changed = comparePropValues(newProps[key], oldProps[key], propTypes[key]);\n      if (changed) {\n        return `${triggerName}.${key} ${changed}`;\n      }\n    }\n  }\n\n  // Test if any old props have been dropped\n  for (const key of Object.keys(oldProps)) {\n    if (!(key in ignoreProps)) {\n      if (!(key in newProps)) {\n        return `${triggerName}.${key} dropped`;\n      }\n      if (!Object.hasOwnProperty.call(newProps, key)) {\n        // Compare dropped old prop against default value\n        const changed = comparePropValues(newProps[key], oldProps[key], propTypes[key]);\n        if (changed) {\n          return `${triggerName}.${key} ${changed}`;\n        }\n      }\n    }\n  }\n\n  return null;\n}\n/* eslint-enable max-statements, max-depth, complexity */\n\n// HELPERS\nfunction comparePropValues(newProp, oldProp, propType) {\n  // If prop type has an equal function, invoke it\n  let equal = propType && propType.equal;\n  if (equal && !equal(newProp, oldProp, propType)) {\n    return 'changed deeply';\n  }\n\n  if (!equal) {\n    // If object has an equals function, invoke it\n    equal = newProp && oldProp && newProp.equals;\n    if (equal && !equal.call(newProp, oldProp)) {\n      return 'changed deeply';\n    }\n  }\n\n  if (!equal && oldProp !== newProp) {\n    return 'changed shallowly';\n  }\n\n  return null;\n}\n\n// The comparison of the data prop requires special handling\n// the dataComparator should be used if supplied\nfunction diffDataProps(props, oldProps) {\n  if (oldProps === null) {\n    return 'oldProps is null, initial diff';\n  }\n\n  let dataChanged = null;\n  // Support optional app defined comparison of data\n  const {dataComparator, _dataDiff} = props;\n  if (dataComparator) {\n    if (!dataComparator(props.data, oldProps.data)) {\n      dataChanged = 'Data comparator detected a change';\n    }\n    // Otherwise, do a shallow equal on props\n  } else if (props.data !== oldProps.data) {\n    dataChanged = 'A new data container was supplied';\n  }\n  if (dataChanged && _dataDiff) {\n    dataChanged = _dataDiff(props.data, oldProps.data) || dataChanged;\n  }\n\n  return dataChanged;\n}\n\n// Checks if any update triggers have changed\n// also calls callback to invalidate attributes accordingly.\nfunction diffUpdateTriggers(props, oldProps) {\n  if (oldProps === null) {\n    return 'oldProps is null, initial diff';\n  }\n\n  // If the 'all' updateTrigger fires, ignore testing others\n  if ('all' in props.updateTriggers) {\n    const diffReason = diffUpdateTrigger(props, oldProps, 'all');\n    if (diffReason) {\n      return {all: true};\n    }\n  }\n\n  const triggerChanged = {};\n  let reason = false;\n  // If the 'all' updateTrigger didn't fire, need to check all others\n  for (const triggerName in props.updateTriggers) {\n    if (triggerName !== 'all') {\n      const diffReason = diffUpdateTrigger(props, oldProps, triggerName);\n      if (diffReason) {\n        triggerChanged[triggerName] = true;\n        reason = triggerChanged;\n      }\n    }\n  }\n\n  return reason;\n}\n\n// Returns true if any extensions have changed\nfunction diffExtensions(props, oldProps) {\n  if (oldProps === null) {\n    return 'oldProps is null, initial diff';\n  }\n\n  const oldExtensions = oldProps.extensions;\n  const {extensions} = props;\n\n  if (extensions === oldExtensions) {\n    return false;\n  }\n  if (extensions.length !== oldExtensions.length) {\n    return true;\n  }\n  for (let i = 0; i < extensions.length; i++) {\n    if (!extensions[i].equals(oldExtensions[i])) {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction diffUpdateTrigger(props, oldProps, triggerName) {\n  let newTriggers = props.updateTriggers[triggerName];\n  newTriggers = newTriggers === undefined || newTriggers === null ? {} : newTriggers;\n  let oldTriggers = oldProps.updateTriggers[triggerName];\n  oldTriggers = oldTriggers === undefined || oldTriggers === null ? {} : oldTriggers;\n  const diffReason = compareProps({\n    oldProps: oldTriggers,\n    newProps: newTriggers,\n    triggerName\n  });\n  return diffReason;\n}\n\nfunction getPropTypes(props) {\n  const layer = props[COMPONENT];\n  const LayerType = layer && layer.constructor;\n  return LayerType ? LayerType._propTypes : {};\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nconst ERR_NOT_OBJECT = 'count(): argument not an object';\nconst ERR_NOT_CONTAINER = 'count(): argument not a container';\n\n/**\n * Deduces numer of elements in a JavaScript container.\n * - Auto-deduction for ES6 containers that define a count() method\n * - Auto-deduction for ES6 containers that define a size member\n * - Auto-deduction for Classic Arrays via the built-in length attribute\n * - Also handles objects, although note that this an O(N) operation\n */\nexport function count(container) {\n  if (!isObject(container)) {\n    throw new Error(ERR_NOT_OBJECT);\n  }\n\n  // Check if ES6 collection \"count\" function is available\n  if (typeof container.count === 'function') {\n    return container.count();\n  }\n\n  // Check if ES6 collection \"size\" attribute is set\n  if (Number.isFinite(container.size)) {\n    return container.size;\n  }\n\n  // Check if array length attribute is set\n  // Note: checking this last since some ES6 collections (Immutable.js)\n  // emit profuse warnings when trying to access `length` attribute\n  if (Number.isFinite(container.length)) {\n    return container.length;\n  }\n\n  // Note that getting the count of an object is O(N)\n  if (isPlainObject(container)) {\n    return Object.keys(container).length;\n  }\n\n  throw new Error(ERR_NOT_CONTAINER);\n}\n\n/**\n * Checks if argument is a plain object (not a class or array etc)\n * @param {*} value - JavaScript value to be tested\n * @return {Boolean} - true if argument is a plain JavaScript object\n */\nfunction isPlainObject(value) {\n  return value !== null && typeof value === 'object' && value.constructor === Object;\n}\n\n/**\n * Checks if argument is an indexable object (not a primitive value, nor null)\n * @param {*} value - JavaScript value to be tested\n * @return {Boolean} - true if argument is a JavaScript object\n */\nfunction isObject(value) {\n  return value !== null && typeof value === 'object';\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n// Merge two luma.gl shader descriptors\nexport function mergeShaders(target, source) {\n  if (!source) {\n    return target;\n  }\n  const result = Object.assign({}, target, source);\n\n  if ('defines' in source) {\n    result.defines = Object.assign({}, target.defines, source.defines);\n  }\n  if ('modules' in source) {\n    result.modules = (target.modules || []).concat(source.modules);\n\n    // Hack: prject32 and project64 cannot co-exist\n    if (source.modules.some(module => module.name === 'project64')) {\n      const index = result.modules.findIndex(module => module.name === 'project32');\n      if (index >= 0) {\n        result.modules.splice(index, 1);\n      }\n    }\n  }\n  if ('inject' in source) {\n    if (!target.inject) {\n      result.inject = source.inject;\n    } else {\n      const mergedInjection = {...target.inject};\n      for (const key in source.inject) {\n        mergedInjection[key] = (mergedInjection[key] || '') + source.inject[key];\n      }\n      result.inject = mergedInjection;\n    }\n  }\n  return result;\n}\n","/**\n * Projection utils\n * TODO: move to Viewport class?\n */\nimport {COORDINATE_SYSTEM} from '../../lib/constants';\nimport {getOffsetOrigin} from './viewport-uniforms';\nimport WebMercatorViewport from '../../viewports/web-mercator-viewport';\n\nimport * as vec4 from 'gl-matrix/vec4';\nimport * as vec3 from 'gl-matrix/vec3';\nimport {addMetersToLngLat} from '@math.gl/web-mercator';\n\n// In project.glsl, offset modes calculate z differently from LNG_LAT mode.\n// offset modes apply the y adjustment (unitsPerMeter2) when projecting z\n// LNG_LAT mode only use the linear scale.\nfunction lngLatZToWorldPosition(lngLatZ, viewport, offsetMode = false) {\n  const p = viewport.projectPosition(lngLatZ);\n\n  // TODO - avoid using instanceof\n  if (offsetMode && viewport instanceof WebMercatorViewport) {\n    const [longitude, latitude, z = 0] = lngLatZ;\n    const distanceScales = viewport.getDistanceScales([longitude, latitude]);\n    p[2] = z * distanceScales.unitsPerMeter[2];\n  }\n  return p;\n}\n\nfunction normalizeParameters(opts) {\n  const normalizedParams = Object.assign({}, opts);\n\n  let {coordinateSystem} = opts;\n  const {viewport, coordinateOrigin, fromCoordinateSystem, fromCoordinateOrigin} = opts;\n\n  if (coordinateSystem === COORDINATE_SYSTEM.DEFAULT) {\n    coordinateSystem = viewport.isGeospatial\n      ? COORDINATE_SYSTEM.LNGLAT\n      : COORDINATE_SYSTEM.CARTESIAN;\n  }\n\n  if (fromCoordinateSystem === undefined) {\n    normalizedParams.fromCoordinateSystem = coordinateSystem;\n  }\n  if (fromCoordinateOrigin === undefined) {\n    normalizedParams.fromCoordinateOrigin = coordinateOrigin;\n  }\n\n  normalizedParams.coordinateSystem = coordinateSystem;\n\n  return normalizedParams;\n}\n\nexport function getWorldPosition(\n  position,\n  {viewport, modelMatrix, coordinateSystem, coordinateOrigin, offsetMode}\n) {\n  let [x, y, z = 0] = position;\n\n  if (modelMatrix) {\n    [x, y, z] = vec4.transformMat4([], [x, y, z, 1.0], modelMatrix);\n  }\n\n  switch (coordinateSystem) {\n    case COORDINATE_SYSTEM.LNGLAT:\n      return lngLatZToWorldPosition([x, y, z], viewport, offsetMode);\n\n    case COORDINATE_SYSTEM.LNGLAT_OFFSETS:\n      return lngLatZToWorldPosition(\n        [x + coordinateOrigin[0], y + coordinateOrigin[1], z + (coordinateOrigin[2] || 0)],\n        viewport,\n        offsetMode\n      );\n\n    case COORDINATE_SYSTEM.METER_OFFSETS:\n      return lngLatZToWorldPosition(\n        addMetersToLngLat(coordinateOrigin, [x, y, z]),\n        viewport,\n        offsetMode\n      );\n\n    case COORDINATE_SYSTEM.CARTESIAN:\n    default:\n      return viewport.isGeospatial\n        ? [x + coordinateOrigin[0], y + coordinateOrigin[1], z + coordinateOrigin[2]]\n        : viewport.projectPosition([x, y, z]);\n  }\n}\n\n/**\n * Equivalent to project_position in project.glsl\n * projects a user supplied position to world position directly with or without\n * a reference coordinate system\n * @param {array} position - [x, y, z]\n * @param {object} params\n * @param {Viewport} params.viewport - the current viewport\n * @param {number} params.coordinateSystem - the reference coordinate system used\n *   align world position\n * @param {array} params.coordinateOrigin - the reference coordinate origin used\n *   to align world position\n * @param {Matrix4} [params.modelMatrix] - the model matrix of the supplied position\n * @param {number} [params.fromCoordinateSystem] - the coordinate system that the\n *   supplied position is in. Default to the same as `coordinateSystem`.\n * @param {array} [params.fromCoordinateOrigin] - the coordinate origin that the\n *   supplied position is in. Default to the same as `coordinateOrigin`.\n */\nexport function projectPosition(position, params) {\n  const {\n    viewport,\n    coordinateSystem,\n    coordinateOrigin,\n    // optional\n    modelMatrix,\n    fromCoordinateSystem,\n    fromCoordinateOrigin\n  } = normalizeParameters(params);\n\n  const {geospatialOrigin, shaderCoordinateOrigin, offsetMode} = getOffsetOrigin(\n    viewport,\n    coordinateSystem,\n    coordinateOrigin\n  );\n\n  const worldPosition = getWorldPosition(position, {\n    viewport,\n    modelMatrix,\n    coordinateSystem: fromCoordinateSystem,\n    coordinateOrigin: fromCoordinateOrigin,\n    offsetMode\n  });\n\n  if (offsetMode) {\n    const positionCommonSpace = viewport.projectPosition(\n      geospatialOrigin || shaderCoordinateOrigin\n    );\n    vec3.sub(worldPosition, worldPosition, positionCommonSpace);\n  }\n\n  return worldPosition;\n}\n","const TYPE_DEFINITIONS = {\n  boolean: {\n    validate(value, propType) {\n      return true;\n    },\n    equal(value1, value2, propType) {\n      return Boolean(value1) === Boolean(value2);\n    }\n  },\n  number: {\n    validate(value, propType) {\n      return (\n        Number.isFinite(value) &&\n        (!('max' in propType) || value <= propType.max) &&\n        (!('min' in propType) || value >= propType.min)\n      );\n    }\n  },\n  color: {\n    validate(value, propType) {\n      return (\n        (propType.optional && !value) ||\n        (isArray(value) && (value.length === 3 || value.length === 4))\n      );\n    },\n    equal(value1, value2, propType) {\n      return arrayEqual(value1, value2);\n    }\n  },\n  accessor: {\n    validate(value, propType) {\n      const valueType = getTypeOf(value);\n      return valueType === 'function' || valueType === getTypeOf(propType.value);\n    },\n    equal(value1, value2, propType) {\n      if (typeof value2 === 'function') {\n        return true;\n      }\n      return arrayEqual(value1, value2);\n    }\n  },\n  array: {\n    validate(value, propType) {\n      return (propType.optional && !value) || isArray(value);\n    },\n    equal(value1, value2, propType) {\n      return propType.compare ? arrayEqual(value1, value2) : value1 === value2;\n    }\n  },\n  function: {\n    validate(value, propType) {\n      return (propType.optional && !value) || typeof value === 'function';\n    },\n    equal(value1, value2, propType) {\n      return !propType.compare || value1 === value2;\n    }\n  }\n};\n\nfunction arrayEqual(array1, array2) {\n  if (array1 === array2) {\n    return true;\n  }\n  if (!isArray(array1) || !isArray(array2)) {\n    return false;\n  }\n  const len = array1.length;\n  if (len !== array2.length) {\n    return false;\n  }\n  for (let i = 0; i < len; i++) {\n    if (array1[i] !== array2[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function parsePropTypes(propDefs) {\n  const propTypes = {};\n  const defaultProps = {};\n  const deprecatedProps = {};\n\n  for (const [propName, propDef] of Object.entries(propDefs)) {\n    if (propDef && propDef.deprecatedFor) {\n      deprecatedProps[propName] = Array.isArray(propDef.deprecatedFor)\n        ? propDef.deprecatedFor\n        : [propDef.deprecatedFor];\n    } else {\n      const propType = parsePropType(propName, propDef);\n      propTypes[propName] = propType;\n      defaultProps[propName] = propType.value;\n    }\n  }\n  return {propTypes, defaultProps, deprecatedProps};\n}\n\n// Parses one property definition entry. Either contains:\n// * a valid prop type object ({type, ...})\n// * or just a default value, in which case type and name inference is used\nfunction parsePropType(name, propDef) {\n  switch (getTypeOf(propDef)) {\n    case 'object':\n      return normalizePropDefinition(name, propDef);\n\n    case 'array':\n      return normalizePropDefinition(name, {type: 'array', value: propDef, compare: false});\n\n    case 'boolean':\n      return normalizePropDefinition(name, {type: 'boolean', value: propDef});\n\n    case 'number':\n      return normalizePropDefinition(name, {type: 'number', value: propDef});\n\n    case 'function':\n      return normalizePropDefinition(name, {type: 'function', value: propDef, compare: true});\n    // return guessFunctionType(name, propDef);\n\n    default:\n      return {name, type: 'unknown', value: propDef};\n  }\n}\n\nfunction normalizePropDefinition(name, propDef) {\n  if (!('type' in propDef)) {\n    if (!('value' in propDef)) {\n      // If no type and value this object is likely the value\n      return {name, type: 'object', value: propDef};\n    }\n    return Object.assign({name, type: getTypeOf(propDef.value)}, propDef);\n  }\n  return Object.assign({name}, TYPE_DEFINITIONS[propDef.type], propDef);\n}\n\nfunction isArray(value) {\n  return Array.isArray(value) || ArrayBuffer.isView(value);\n}\n\n// improved version of javascript typeof that can distinguish arrays and null values\nfunction getTypeOf(value) {\n  if (isArray(value)) {\n    return 'array';\n  }\n  if (value === null) {\n    return 'null';\n  }\n  return typeof value;\n}\n","import log from '../utils/log';\nimport {isAsyncIterable} from '../utils/iterable-utils';\nimport {parsePropTypes} from './prop-types';\nimport {PROP_SYMBOLS} from './constants';\n\nconst {COMPONENT, ASYNC_ORIGINAL, ASYNC_RESOLVED, ASYNC_DEFAULTS} = PROP_SYMBOLS;\n\n// Create a property object\nexport function createProps() {\n  const component = this; // eslint-disable-line\n\n  // Get default prop object (a prototype chain for now)\n  const propsPrototype = getPropsPrototype(component.constructor);\n\n  // Create a new prop object with default props object in prototype chain\n  const propsInstance = Object.create(propsPrototype);\n\n  // Props need a back pointer to the owning component\n  propsInstance[COMPONENT] = component;\n  // The supplied (original) values for those async props that are set to url strings or Promises.\n  // In this case, the actual (i.e. resolved) values are looked up from component.internalState\n  propsInstance[ASYNC_ORIGINAL] = {};\n  // Note: the actual (resolved) values for props that are NOT set to urls or Promises.\n  // in this case the values are served directly from this map\n  propsInstance[ASYNC_RESOLVED] = {};\n\n  // \"Copy\" all sync props\n  for (let i = 0; i < arguments.length; ++i) {\n    const props = arguments[i];\n    // Do not use Object.assign here to avoid Symbols in props overwriting our private fields\n    // This might happen if one of the arguments is another props instance\n    for (const key in props) {\n      propsInstance[key] = props[key];\n    }\n  }\n\n  // Props must be immutable\n  Object.freeze(propsInstance);\n\n  return propsInstance;\n}\n\n// Return precalculated defaultProps and propType objects if available\n// build them if needed\nfunction getPropsPrototype(componentClass) {\n  const defaultProps = getOwnProperty(componentClass, '_mergedDefaultProps');\n  if (!defaultProps) {\n    createPropsPrototypeAndTypes(componentClass);\n    return componentClass._mergedDefaultProps;\n  }\n  return defaultProps;\n}\n\n// Build defaultProps and propType objects by walking component prototype chain\nfunction createPropsPrototypeAndTypes(componentClass) {\n  const parent = componentClass.prototype;\n  if (!parent) {\n    return;\n  }\n\n  const parentClass = Object.getPrototypeOf(componentClass);\n  const parentDefaultProps = getPropsPrototype(parentClass);\n\n  // Parse propTypes from Component.defaultProps\n  const componentDefaultProps = getOwnProperty(componentClass, 'defaultProps') || {};\n  const componentPropDefs = parsePropTypes(componentDefaultProps);\n\n  // Create any necessary property descriptors and create the default prop object\n  // Assign merged default props\n  const defaultProps = createPropsPrototype(\n    componentPropDefs.defaultProps,\n    parentDefaultProps,\n    componentClass\n  );\n\n  // Create a merged type object\n  const propTypes = Object.assign({}, parentClass._propTypes, componentPropDefs.propTypes);\n  // Add getters/setters for async props\n  addAsyncPropsToPropPrototype(defaultProps, propTypes);\n\n  // Create a map for prop whose default value is a callback\n  const deprecatedProps = Object.assign(\n    {},\n    parentClass._deprecatedProps,\n    componentPropDefs.deprecatedProps\n  );\n  // Add setters for deprecated props\n  addDeprecatedPropsToPropPrototype(defaultProps, deprecatedProps);\n\n  // Store the precalculated props\n  componentClass._mergedDefaultProps = defaultProps;\n  componentClass._propTypes = propTypes;\n  componentClass._deprecatedProps = deprecatedProps;\n}\n\n// Builds a pre-merged default props object that component props can inherit from\nfunction createPropsPrototype(props, parentProps, componentClass) {\n  const defaultProps = Object.create(null);\n\n  Object.assign(defaultProps, parentProps, props);\n\n  // Avoid freezing `id` prop\n  const id = getComponentName(componentClass);\n  delete props.id;\n\n  Object.defineProperties(defaultProps, {\n    // `id` is treated specially because layer might need to override it\n    id: {\n      writable: true,\n      value: id\n    }\n  });\n\n  return defaultProps;\n}\n\nfunction addDeprecatedPropsToPropPrototype(defaultProps, deprecatedProps) {\n  for (const propName in deprecatedProps) {\n    /* eslint-disable accessor-pairs */\n    Object.defineProperty(defaultProps, propName, {\n      enumerable: false,\n      set(newValue) {\n        const nameStr = `${this.id}: ${propName}`;\n\n        for (const newPropName of deprecatedProps[propName]) {\n          if (!hasOwnProperty(this, newPropName)) {\n            this[newPropName] = newValue;\n          }\n        }\n\n        log.deprecated(nameStr, deprecatedProps[propName].join('/'))();\n      }\n    });\n    /* eslint-enable accessor-pairs */\n  }\n}\n\n// Create descriptors for overridable props\nfunction addAsyncPropsToPropPrototype(defaultProps, propTypes) {\n  const defaultValues = {};\n\n  const descriptors = {};\n\n  // Move async props into shadow values\n  for (const propName in propTypes) {\n    const propType = propTypes[propName];\n    const {name, value} = propType;\n\n    // Note: async is ES7 keyword, can't destructure\n    if (propType.async) {\n      defaultValues[name] = value;\n      descriptors[name] = getDescriptorForAsyncProp(name, value);\n    }\n  }\n\n  // Default \"resolved\" values for async props, returned if value not yet resolved/set.\n  defaultProps[ASYNC_DEFAULTS] = defaultValues;\n  // Shadowed object, just to make sure \"early indexing\" into the instance does not fail\n  defaultProps[ASYNC_ORIGINAL] = {};\n\n  Object.defineProperties(defaultProps, descriptors);\n}\n\n// Helper: Configures getter and setter for one async prop\nfunction getDescriptorForAsyncProp(name) {\n  return {\n    enumerable: true,\n    // Save the provided value for async props in a special map\n    set(newValue) {\n      if (\n        typeof newValue === 'string' ||\n        newValue instanceof Promise ||\n        isAsyncIterable(newValue)\n      ) {\n        this[ASYNC_ORIGINAL][name] = newValue;\n      } else {\n        this[ASYNC_RESOLVED][name] = newValue;\n      }\n    },\n    // Only the component's state knows the true value of async prop\n    get() {\n      if (this[ASYNC_RESOLVED]) {\n        // Prop value isn't async, so just return it\n        if (name in this[ASYNC_RESOLVED]) {\n          const value = this[ASYNC_RESOLVED][name];\n\n          return value || this[ASYNC_DEFAULTS][name];\n        }\n\n        if (name in this[ASYNC_ORIGINAL]) {\n          // It's an async prop value: look into component state\n          const state = this[COMPONENT] && this[COMPONENT].internalState;\n          if (state && state.hasAsyncProp(name)) {\n            return state.getAsyncProp(name) || this[ASYNC_DEFAULTS][name];\n          }\n        }\n      }\n\n      // the prop is not supplied, or\n      // component not yet initialized/matched, return the component's default value for the prop\n      return this[ASYNC_DEFAULTS][name];\n    }\n  };\n}\n\n// HELPER METHODS\n\nfunction hasOwnProperty(object, prop) {\n  return Object.prototype.hasOwnProperty.call(object, prop);\n}\n\n// Constructors have their super class constructors as prototypes\nfunction getOwnProperty(object, prop) {\n  return hasOwnProperty(object, prop) && object[prop];\n}\n\nfunction getComponentName(componentClass) {\n  const componentName =\n    getOwnProperty(componentClass, 'layerName') || getOwnProperty(componentClass, 'componentName');\n  if (!componentName) {\n    log.once(0, `${componentClass.name}.componentName not specified`)();\n  }\n  return componentName || componentClass.name;\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport log from '../utils/log';\nimport {isAsyncIterable} from '../utils/iterable-utils';\nimport {PROP_SYMBOLS} from './constants';\nconst {ASYNC_ORIGINAL, ASYNC_RESOLVED, ASYNC_DEFAULTS} = PROP_SYMBOLS;\n\nconst EMPTY_PROPS = Object.freeze({});\n\nexport default class ComponentState {\n  constructor(component = null) {\n    this.component = component;\n    this.asyncProps = {}; // Prop values that the layer sees\n    this.onAsyncPropUpdated = () => {};\n    this.oldProps = EMPTY_PROPS; // Last props before update\n    this.oldAsyncProps = null; // Last props before update, with async values copied.\n  }\n\n  getOldProps() {\n    return this.oldAsyncProps || this.oldProps;\n  }\n\n  resetOldProps() {\n    this.oldAsyncProps = null;\n    this.oldProps = this.component.props;\n  }\n\n  // Whenever async props are changing, we need to make a copy of oldProps\n  // otherwise the prop rewriting will affect the value both in props and oldProps.\n  // While the copy is relatively expensive, this only happens on load completion.\n  freezeAsyncOldProps() {\n    if (!this.oldAsyncProps) {\n      // Make sure oldProps is set\n      this.oldProps = this.oldProps || this.component.props;\n\n      // 1. inherit all synchronous props from oldProps\n      // 2. reconfigure the async prop descriptors to fixed values\n      this.oldAsyncProps = Object.create(this.oldProps);\n      for (const propName in this.asyncProps) {\n        Object.defineProperty(this.oldAsyncProps, propName, {\n          enumerable: true,\n          value: this.oldProps[propName]\n        });\n      }\n    }\n  }\n\n  // ASYNC PROP HANDLING\n  //\n\n  // Checks if a prop is overridden\n  hasAsyncProp(propName) {\n    return propName in this.asyncProps;\n  }\n\n  // Returns value of an overriden prop\n  getAsyncProp(propName) {\n    const asyncProp = this.asyncProps[propName];\n    return asyncProp && asyncProp.resolvedValue;\n  }\n\n  isAsyncPropLoading(propName) {\n    if (propName) {\n      const asyncProp = this.asyncProps[propName];\n      return Boolean(\n        asyncProp &&\n          asyncProp.pendingLoadCount > 0 &&\n          asyncProp.pendingLoadCount !== asyncProp.resolvedLoadCount\n      );\n    }\n    for (const key in this.asyncProps) {\n      if (this.isAsyncPropLoading(key)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  // Without changing the original prop value, swap out the data resolution under the hood\n  reloadAsyncProp(propName, value) {\n    this._watchPromise(propName, Promise.resolve(value));\n  }\n\n  // Updates all async/overridden props (when new props come in)\n  // Checks if urls have changed, starts loading, or removes override\n  setAsyncProps(props) {\n    // NOTE: prop param and default values are only support for testing\n    const resolvedValues = props[ASYNC_RESOLVED] || {};\n    const originalValues = props[ASYNC_ORIGINAL] || props;\n    const defaultValues = props[ASYNC_DEFAULTS] || {};\n\n    // TODO - use async props from the layer's prop types\n    for (const propName in resolvedValues) {\n      const value = resolvedValues[propName];\n      this._createAsyncPropData(propName, value, defaultValues[propName]);\n      this._updateAsyncProp(propName, value);\n    }\n\n    for (const propName in originalValues) {\n      const value = originalValues[propName];\n      // Makes sure a record exists for this prop\n      this._createAsyncPropData(propName, value, defaultValues[propName]);\n      this._updateAsyncProp(propName, value);\n    }\n  }\n\n  // Intercept strings (URLs) and Promises and activates loading and prop rewriting\n  _updateAsyncProp(propName, value) {\n    if (!this._didAsyncInputValueChange(propName, value)) {\n      return;\n    }\n\n    // interpret value string as url and start a new load tracked by a promise\n    if (typeof value === 'string') {\n      const fetch = this.layer && this.layer.props.fetch;\n      const url = value;\n      if (fetch) {\n        value = fetch(url, {propName, layer: this.layer});\n      }\n    }\n\n    // interprets promise and track the \"loading\"\n    if (value instanceof Promise) {\n      this._watchPromise(propName, value);\n      return;\n    }\n\n    if (isAsyncIterable(value)) {\n      this._resolveAsyncIterable(propName, value);\n      return;\n    }\n\n    // else, normal, non-async value. Just store value for now\n    this._setPropValue(propName, value);\n  }\n\n  // Checks if an input value actually changed (to avoid reloading/rewatching promises/urls)\n  _didAsyncInputValueChange(propName, value) {\n    const asyncProp = this.asyncProps[propName];\n    if (value === asyncProp.lastValue) {\n      return false;\n    }\n    asyncProp.lastValue = value;\n    return true;\n  }\n\n  // Set normal, non-async value\n  _setPropValue(propName, value) {\n    const asyncProp = this.asyncProps[propName];\n    asyncProp.value = value;\n    asyncProp.resolvedValue = value;\n    asyncProp.pendingLoadCount++;\n    asyncProp.resolvedLoadCount = asyncProp.pendingLoadCount;\n  }\n\n  // Set a just resolved async value, calling onAsyncPropUpdates if value changes asynchronously\n  _setAsyncPropValue(propName, value, loadCount) {\n    // Only update if loadCount is larger or equal to resolvedLoadCount\n    // otherwise a more recent load has already completed\n    const asyncProp = this.asyncProps[propName];\n    if (asyncProp && loadCount >= asyncProp.resolvedLoadCount && value !== undefined) {\n      // A chance to copy old props before updating\n      this.freezeAsyncOldProps();\n\n      asyncProp.resolvedValue = value;\n      asyncProp.resolvedLoadCount = loadCount;\n\n      // Call callback to inform listener\n      this.onAsyncPropUpdated(propName, value);\n    }\n  }\n\n  // Tracks a promise, sets the prop when loaded, handles load count\n  _watchPromise(propName, promise) {\n    const asyncProp = this.asyncProps[propName];\n    asyncProp.pendingLoadCount++;\n    const loadCount = asyncProp.pendingLoadCount;\n    promise\n      .then(data => {\n        data = this._postProcessValue(propName, data);\n        this._setAsyncPropValue(propName, data, loadCount);\n\n        const onDataLoad = this.layer && this.layer.props.onDataLoad;\n        if (propName === 'data' && onDataLoad) {\n          onDataLoad(data, {propName, layer: this.layer});\n        }\n      })\n      .catch(error => log.error(error)());\n  }\n\n  async _resolveAsyncIterable(propName, iterable) {\n    if (propName !== 'data') {\n      // we only support data as async iterable\n      this._setPropValue(propName, iterable);\n    }\n\n    const asyncProp = this.asyncProps[propName];\n    asyncProp.pendingLoadCount++;\n    const loadCount = asyncProp.pendingLoadCount;\n    let data = [];\n    let count = 0;\n\n    for await (const chunk of iterable) {\n      data = this._postProcessValue(propName, chunk, data);\n\n      // Used by the default _dataDiff function\n      Object.defineProperty(data, '__diff', {\n        enumerable: false,\n        value: [{startRow: count, endRow: data.length}]\n      });\n\n      count = data.length;\n      this._setAsyncPropValue(propName, data, loadCount);\n    }\n\n    const onDataLoad = this.layer && this.layer.props.onDataLoad;\n    if (onDataLoad) {\n      onDataLoad(data, {propName, layer: this.layer});\n    }\n  }\n\n  // Give the app a chance to post process the loaded data\n  _postProcessValue(propName, value, previousValue) {\n    const {dataTransform} = this.component ? this.component.props : {};\n    if (propName !== 'data') {\n      return value;\n    }\n    if (dataTransform) {\n      return dataTransform(value, previousValue);\n    }\n    // previousValue is assigned if loaded with async iterator\n    return previousValue ? previousValue.concat(value) : value;\n  }\n\n  // Creating an asyncProp record if needed\n  _createAsyncPropData(propName, value, defaultValue) {\n    const asyncProp = this.asyncProps[propName];\n    if (!asyncProp) {\n      // assert(defaultValue !== undefined);\n      this.asyncProps[propName] = {\n        lastValue: null, // Supplied prop value (can be url/promise, not visible to layer)\n        resolvedValue: defaultValue, // Resolved prop value (valid data, can be \"shown\" to layer)\n        pendingLoadCount: 0, // How many loads have been issued\n        resolvedLoadCount: 0 // Latest resolved load, (earlier loads will be ignored)\n      };\n    }\n  }\n}\n","import {LIFECYCLE} from '../lifecycle/constants';\nimport {createProps} from './create-props';\nimport {PROP_SYMBOLS} from './constants';\nconst {ASYNC_ORIGINAL, ASYNC_RESOLVED, ASYNC_DEFAULTS} = PROP_SYMBOLS;\nimport ComponentState from './component-state';\n\nconst defaultProps = {};\n\nlet counter = 0;\n\nexport default class Component {\n  constructor(/* ...propObjects */) {\n    // Merge supplied props with default props and freeze them.\n    /* eslint-disable prefer-spread */\n    this.props = createProps.apply(this, arguments);\n    /* eslint-enable prefer-spread */\n\n    // Define all members before layer is sealed\n    this.id = this.props.id; // The layer's id, used for matching with layers from last render cycle\n    this.count = counter++; // Keep track of how many layer instances you are generating\n    this.lifecycle = LIFECYCLE.NO_STATE; // Helps track and debug the life cycle of the layers\n    this.parent = null; // reference to the composite layer parent that rendered this layer\n    this.context = null; // Will reference layer manager's context, contains state shared by layers\n    this.state = null; // Will be set to the shared layer state object during layer matching\n    this.internalState = null;\n\n    // Seal the layer\n    Object.seal(this);\n  }\n\n  // clone this layer with modified props\n  clone(newProps) {\n    const {props} = this;\n\n    // Async props cannot be copied with Object.assign, copy them separately\n    const asyncProps = {};\n\n    // See async props definition in create-props.js\n    for (const key in props[ASYNC_DEFAULTS]) {\n      if (key in props[ASYNC_RESOLVED]) {\n        asyncProps[key] = props[ASYNC_RESOLVED][key];\n      } else if (key in props[ASYNC_ORIGINAL]) {\n        asyncProps[key] = props[ASYNC_ORIGINAL][key];\n      }\n    }\n\n    // Some custom layer implementation may not support multiple arguments in the constructor\n    return new this.constructor(Object.assign({}, props, asyncProps, newProps));\n  }\n\n  get stats() {\n    return this.internalState.stats;\n  }\n\n  // PROTECTED METHODS, override in subclass\n\n  _initState() {\n    this.internalState = new ComponentState({});\n  }\n}\n\nComponent.componentName = 'Component';\nComponent.defaultProps = defaultProps;\n","import ComponentState from '../lifecycle/component-state';\n\nexport default class LayerState extends ComponentState {\n  constructor({attributeManager, layer}) {\n    super(layer);\n    this.attributeManager = attributeManager;\n    this.model = null;\n    this.needsRedraw = true;\n    this.subLayers = null; // reference to sublayers rendered in a previous cycle\n  }\n\n  get layer() {\n    return this.component;\n  }\n\n  set layer(layer) {\n    this.component = layer;\n  }\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* eslint-disable react/no-direct-mutation-state */\nimport {COORDINATE_SYSTEM} from './constants';\nimport AttributeManager from './attribute/attribute-manager';\nimport UniformTransitionManager from './uniform-transition-manager';\nimport {diffProps, validateProps} from '../lifecycle/props';\nimport {count} from '../utils/count';\nimport log from '../utils/log';\nimport debug from '../debug';\nimport GL from '@luma.gl/constants';\nimport {withParameters, setParameters} from '@luma.gl/core';\nimport assert from '../utils/assert';\nimport memoize from '../utils/memoize';\nimport {mergeShaders} from '../utils/shader';\nimport {projectPosition, getWorldPosition} from '../shaderlib/project/project-functions';\nimport typedArrayManager from '../utils/typed-array-manager';\n\nimport Component from '../lifecycle/component';\nimport LayerState from './layer-state';\n\nimport {worldToPixels} from '@math.gl/web-mercator';\n\nimport {load} from '@loaders.gl/core';\n\nconst TRACE_CHANGE_FLAG = 'layer.changeFlag';\nconst TRACE_INITIALIZE = 'layer.initialize';\nconst TRACE_UPDATE = 'layer.update';\nconst TRACE_FINALIZE = 'layer.finalize';\nconst TRACE_MATCHED = 'layer.matched';\n\nconst EMPTY_ARRAY = Object.freeze([]);\n\n// Only compare the same two viewports once\nconst areViewportsEqual = memoize(({oldViewport, viewport}) => {\n  return oldViewport.equals(viewport);\n});\n\nlet pickingColorCache = new Uint8ClampedArray(0);\n\nconst defaultProps = {\n  // data: Special handling for null, see below\n  data: {type: 'data', value: EMPTY_ARRAY, async: true},\n  dataComparator: null,\n  _dataDiff: {type: 'function', value: data => data && data.__diff, compare: false, optional: true},\n  dataTransform: {type: 'function', value: null, compare: false, optional: true},\n  onDataLoad: {type: 'function', value: null, compare: false, optional: true},\n  fetch: {\n    type: 'function',\n    value: (url, {propName, layer}) => {\n      const {resourceManager} = layer.context;\n      const loadOptions = layer.getLoadOptions();\n      let inResourceManager = resourceManager.contains(url);\n\n      if (!inResourceManager && !loadOptions) {\n        // If there is no layer-specific load options, then attempt to cache this resource in the data manager\n        resourceManager.add({resourceId: url, data: url, persistent: false});\n        inResourceManager = true;\n      }\n      if (inResourceManager) {\n        return resourceManager.subscribe({\n          resourceId: url,\n          onChange: data => layer.internalState.reloadAsyncProp(propName, data),\n          consumerId: layer.id,\n          requestId: propName\n        });\n      }\n\n      return load(url, loadOptions);\n    },\n    compare: false\n  },\n  updateTriggers: {}, // Update triggers: a core change detection mechanism in deck.gl\n\n  visible: true,\n  pickable: false,\n  opacity: {type: 'number', min: 0, max: 1, value: 1},\n\n  onHover: {type: 'function', value: null, compare: false, optional: true},\n  onClick: {type: 'function', value: null, compare: false, optional: true},\n  onDragStart: {type: 'function', value: null, compare: false, optional: true},\n  onDrag: {type: 'function', value: null, compare: false, optional: true},\n  onDragEnd: {type: 'function', value: null, compare: false, optional: true},\n\n  coordinateSystem: COORDINATE_SYSTEM.DEFAULT,\n  coordinateOrigin: {type: 'array', value: [0, 0, 0], compare: true},\n  modelMatrix: {type: 'array', value: null, compare: true, optional: true},\n  wrapLongitude: false,\n  positionFormat: 'XYZ',\n  colorFormat: 'RGBA',\n\n  parameters: {},\n  uniforms: {},\n  extensions: [],\n\n  // Offset depth based on layer index to avoid z-fighting.\n  // Negative values pull layer towards the camera\n  // https://www.opengl.org/archives/resources/faq/technical/polygonoffset.htm\n  getPolygonOffset: {\n    type: 'function',\n    value: ({layerIndex}) => [0, -layerIndex * 100],\n    compare: false\n  },\n\n  // Selection/Highlighting\n  highlightedObjectIndex: -1,\n  autoHighlight: false,\n  highlightColor: {type: 'accessor', value: [0, 0, 128, 128]}\n};\n\nexport default class Layer extends Component {\n  toString() {\n    const className = this.constructor.layerName || this.constructor.name;\n    return `${className}({id: '${this.props.id}'})`;\n  }\n\n  // Public API\n\n  // Updates selected state members and marks the object for redraw\n  setState(updateObject) {\n    this.setChangeFlags({stateChanged: true});\n    Object.assign(this.state, updateObject);\n    this.setNeedsRedraw();\n  }\n\n  // Sets the redraw flag for this layer, will trigger a redraw next animation frame\n  setNeedsRedraw(redraw = true) {\n    if (this.internalState) {\n      this.internalState.needsRedraw = redraw;\n    }\n  }\n\n  // This layer needs a deep update\n  setNeedsUpdate() {\n    this.context.layerManager.setNeedsUpdate(String(this));\n    this.internalState.needsUpdate = true;\n  }\n\n  // Checks state of attributes and model\n  getNeedsRedraw(opts = {clearRedrawFlags: false}) {\n    return this._getNeedsRedraw(opts);\n  }\n\n  // Checks if layer attributes needs updating\n  needsUpdate() {\n    // Call subclass lifecycle method\n    return (\n      this.internalState.needsUpdate ||\n      this.hasUniformTransition() ||\n      this.shouldUpdateState(this._getUpdateParams())\n    );\n    // End lifecycle method\n  }\n\n  hasUniformTransition() {\n    return this.internalState.uniformTransitions.active;\n  }\n\n  get isLoaded() {\n    return this.internalState && !this.internalState.isAsyncPropLoading();\n  }\n\n  get wrapLongitude() {\n    return this.props.wrapLongitude;\n  }\n\n  // Returns true if the layer is pickable and visible.\n  isPickable() {\n    return this.props.pickable && this.props.visible;\n  }\n\n  // Return an array of models used by this layer, can be overriden by layer subclass\n  getModels() {\n    return this.state && (this.state.models || (this.state.model ? [this.state.model] : []));\n  }\n\n  getAttributeManager() {\n    return this.internalState && this.internalState.attributeManager;\n  }\n\n  // Returns the most recent layer that matched to this state\n  // (When reacting to an async event, this layer may no longer be the latest)\n  getCurrentLayer() {\n    return this.internalState && this.internalState.layer;\n  }\n\n  // Returns the default parse options for async props\n  getLoadOptions() {\n    return this.props.loadOptions;\n  }\n\n  // PROJECTION METHODS\n\n  // Projects a point with current map state (lat, lon, zoom, pitch, bearing)\n  // From the current layer's coordinate system to screen\n  project(xyz) {\n    const {viewport} = this.context;\n    const worldPosition = getWorldPosition(xyz, {\n      viewport,\n      modelMatrix: this.props.modelMatrix,\n      coordinateOrigin: this.props.coordinateOrigin,\n      coordinateSystem: this.props.coordinateSystem\n    });\n    const [x, y, z] = worldToPixels(worldPosition, viewport.pixelProjectionMatrix);\n    return xyz.length === 2 ? [x, y] : [x, y, z];\n  }\n\n  // Note: this does not reverse `project`.\n  // Always unprojects to the viewport's coordinate system\n  unproject(xy) {\n    const {viewport} = this.context;\n    return viewport.unproject(xy);\n  }\n\n  projectPosition(xyz) {\n    return projectPosition(xyz, {\n      viewport: this.context.viewport,\n      modelMatrix: this.props.modelMatrix,\n      coordinateOrigin: this.props.coordinateOrigin,\n      coordinateSystem: this.props.coordinateSystem\n    });\n  }\n\n  use64bitPositions() {\n    const {coordinateSystem} = this.props;\n    return (\n      coordinateSystem === COORDINATE_SYSTEM.DEFAULT ||\n      coordinateSystem === COORDINATE_SYSTEM.LNGLAT ||\n      coordinateSystem === COORDINATE_SYSTEM.CARTESIAN\n    );\n  }\n\n  // Event handling\n  onHover(info, pickingEvent) {\n    if (this.props.onHover) {\n      return this.props.onHover(info, pickingEvent);\n    }\n    return false;\n  }\n\n  onClick(info, pickingEvent) {\n    if (this.props.onClick) {\n      return this.props.onClick(info, pickingEvent);\n    }\n    return false;\n  }\n\n  // Returns the picking color that doesn't match any subfeature\n  // Use if some graphics do not belong to any pickable subfeature\n  // @return {Array} - a black color\n  nullPickingColor() {\n    return [0, 0, 0];\n  }\n\n  // Returns the picking color that doesn't match any subfeature\n  // Use if some graphics do not belong to any pickable subfeature\n  encodePickingColor(i, target = []) {\n    target[0] = (i + 1) & 255;\n    target[1] = ((i + 1) >> 8) & 255;\n    target[2] = (((i + 1) >> 8) >> 8) & 255;\n    return target;\n  }\n\n  // Returns the index corresponding to a picking color that doesn't match any subfeature\n  // @param {Uint8Array} color - color array to be decoded\n  // @return {Array} - the decoded picking color\n  decodePickingColor(color) {\n    assert(color instanceof Uint8Array);\n    const [i1, i2, i3] = color;\n    // 1 was added to seperate from no selection\n    const index = i1 + i2 * 256 + i3 * 65536 - 1;\n    return index;\n  }\n\n  // //////////////////////////////////////////////////\n  // LIFECYCLE METHODS, overridden by the layer subclasses\n\n  // Called once to set up the initial state\n  // App can create WebGL resources\n  initializeState() {\n    throw new Error(`Layer ${this} has not defined initializeState`);\n  }\n\n  getShaders(shaders) {\n    for (const extension of this.props.extensions) {\n      shaders = mergeShaders(shaders, extension.getShaders.call(this, extension));\n    }\n    return shaders;\n  }\n\n  // Let's layer control if updateState should be called\n  shouldUpdateState({oldProps, props, context, changeFlags}) {\n    return changeFlags.propsOrDataChanged;\n  }\n\n  // Default implementation, all attributes will be invalidated and updated\n  // when data changes\n  /* eslint-disable-next-line complexity */\n  updateState({oldProps, props, context, changeFlags}) {\n    const attributeManager = this.getAttributeManager();\n    if (changeFlags.dataChanged && attributeManager) {\n      const {dataChanged} = changeFlags;\n      if (Array.isArray(dataChanged)) {\n        // is partial update\n        for (const dataRange of dataChanged) {\n          attributeManager.invalidateAll(dataRange);\n        }\n      } else {\n        attributeManager.invalidateAll();\n      }\n    }\n\n    const neededPickingBuffer = oldProps.highlightedObjectIndex >= 0 || oldProps.pickable;\n    const needPickingBuffer = props.highlightedObjectIndex >= 0 || props.pickable;\n    if (neededPickingBuffer !== needPickingBuffer && attributeManager) {\n      const {pickingColors, instancePickingColors} = attributeManager.attributes;\n      const pickingColorsAttribute = pickingColors || instancePickingColors;\n      if (pickingColorsAttribute) {\n        if (needPickingBuffer && pickingColorsAttribute.constant) {\n          pickingColorsAttribute.constant = false;\n          attributeManager.invalidate(pickingColorsAttribute.id);\n        }\n        if (!pickingColorsAttribute.value && !needPickingBuffer) {\n          pickingColorsAttribute.constant = true;\n          pickingColorsAttribute.value = [0, 0, 0];\n        }\n      }\n    }\n  }\n\n  // Called once when layer is no longer matched and state will be discarded\n  // App can destroy WebGL resources here\n  finalizeState() {\n    for (const model of this.getModels()) {\n      model.delete();\n    }\n    const attributeManager = this.getAttributeManager();\n    if (attributeManager) {\n      attributeManager.finalize();\n    }\n    this.context.resourceManager.unsubscribe({consumerId: this.id});\n    this.internalState.uniformTransitions.clear();\n  }\n\n  // If state has a model, draw it with supplied uniforms\n  draw(opts) {\n    for (const model of this.getModels()) {\n      model.draw(opts);\n    }\n  }\n\n  // called to populate the info object that is passed to the event handler\n  // @return null to cancel event\n  getPickingInfo({info, mode}) {\n    const {index} = info;\n\n    if (index >= 0) {\n      // If props.data is an indexable array, get the object\n      if (Array.isArray(this.props.data)) {\n        info.object = this.props.data[index];\n      }\n    }\n\n    return info;\n  }\n\n  // END LIFECYCLE METHODS\n  // //////////////////////////////////////////////////\n\n  // INTERNAL METHODS\n  activateViewport(viewport) {\n    const oldViewport = this.internalState.viewport;\n    this.internalState.viewport = viewport;\n\n    if (!oldViewport || !areViewportsEqual({oldViewport, viewport})) {\n      this.setChangeFlags({viewportChanged: true});\n      this._update();\n    }\n  }\n\n  // Default implementation of attribute invalidation, can be redefined\n  invalidateAttribute(name = 'all', diffReason = '') {\n    const attributeManager = this.getAttributeManager();\n    if (!attributeManager) {\n      return;\n    }\n\n    if (name === 'all') {\n      attributeManager.invalidateAll();\n    } else {\n      attributeManager.invalidate(name);\n    }\n  }\n\n  updateAttributes(changedAttributes) {\n    for (const model of this.getModels()) {\n      this._setModelAttributes(model, changedAttributes);\n    }\n  }\n\n  // Calls attribute manager to update any WebGL attributes\n  _updateAttributes(props) {\n    const attributeManager = this.getAttributeManager();\n    if (!attributeManager) {\n      return;\n    }\n\n    // Figure out data length\n    const numInstances = this.getNumInstances(props);\n    const startIndices = this.getStartIndices(props);\n\n    attributeManager.update({\n      data: props.data,\n      numInstances,\n      startIndices,\n      props,\n      transitions: props.transitions,\n      buffers: props.data.attributes,\n      context: this,\n      // Don't worry about non-attribute props\n      ignoreUnknownAttributes: true\n    });\n\n    const changedAttributes = attributeManager.getChangedAttributes({clearChangedFlags: true});\n    this.updateAttributes(changedAttributes);\n  }\n\n  // Update attribute transitions. This is called in drawLayer, no model updates required.\n  _updateAttributeTransition() {\n    const attributeManager = this.getAttributeManager();\n    if (attributeManager) {\n      attributeManager.updateTransition();\n    }\n  }\n\n  // Update uniform (prop) transitions. This is called in updateState, may result in model updates.\n  _updateUniformTransition() {\n    const {uniformTransitions} = this.internalState;\n    if (uniformTransitions.active) {\n      // clone props\n      const propsInTransition = uniformTransitions.update();\n      const props = Object.create(this.props);\n      for (const key in propsInTransition) {\n        Object.defineProperty(props, key, {value: propsInTransition[key]});\n      }\n      return props;\n    }\n    return this.props;\n  }\n\n  calculateInstancePickingColors(attribute, {numInstances}) {\n    if (attribute.constant) {\n      return;\n    }\n\n    // calculateInstancePickingColors always generates the same sequence.\n    // pickingColorCache saves the largest generated sequence for reuse\n    const cacheSize = pickingColorCache.length / 3;\n\n    if (cacheSize < numInstances) {\n      pickingColorCache = typedArrayManager.allocate(pickingColorCache, numInstances, {\n        size: 3,\n        copy: true\n      });\n      // If the attribute is larger than the cache, resize the cache and populate the missing chunk\n      const newCacheSize = pickingColorCache.length / 3;\n      const pickingColor = [];\n      assert(newCacheSize < 16777215, 'index out of picking color range');\n\n      for (let i = cacheSize; i < newCacheSize; i++) {\n        this.encodePickingColor(i, pickingColor);\n        pickingColorCache[i * 3 + 0] = pickingColor[0];\n        pickingColorCache[i * 3 + 1] = pickingColor[1];\n        pickingColorCache[i * 3 + 2] = pickingColor[2];\n      }\n    }\n\n    attribute.value = pickingColorCache.subarray(0, numInstances * 3);\n  }\n\n  _setModelAttributes(model, changedAttributes) {\n    const attributeManager = this.getAttributeManager();\n    const excludeAttributes = model.userData.excludeAttributes || {};\n    const shaderAttributes = attributeManager.getShaderAttributes(\n      changedAttributes,\n      excludeAttributes\n    );\n\n    model.setAttributes(shaderAttributes);\n  }\n\n  // Sets the specified instanced picking color to null picking color. Used for multi picking.\n  clearPickingColor(color) {\n    const {pickingColors, instancePickingColors} = this.getAttributeManager().attributes;\n    const colors = pickingColors || instancePickingColors;\n\n    const i = this.decodePickingColor(color);\n    const start = colors.getVertexOffset(i);\n    const end = colors.getVertexOffset(i + 1);\n\n    // Fill the sub buffer with 0s\n    colors.buffer.subData({\n      data: new Uint8Array(end - start),\n      offset: start // 1 byte per element\n    });\n  }\n\n  restorePickingColors() {\n    const {pickingColors, instancePickingColors} = this.getAttributeManager().attributes;\n    const colors = pickingColors || instancePickingColors;\n    colors.updateSubBuffer({startOffset: 0});\n  }\n\n  // Deduces numer of instances. Intention is to support:\n  // - Explicit setting of numInstances\n  // - Auto-deduction for ES6 containers that define a size member\n  // - Auto-deduction for Classic Arrays via the built-in length attribute\n  // - Auto-deduction via arrays\n  getNumInstances(props) {\n    props = props || this.props;\n\n    // First Check if app has provided an explicit value\n    if (props.numInstances !== undefined) {\n      return props.numInstances;\n    }\n\n    // Second check if the layer has set its own value\n    if (this.state && this.state.numInstances !== undefined) {\n      return this.state.numInstances;\n    }\n\n    // Use container library to get a count for any ES6 container or object\n    return count(props.data);\n  }\n\n  // Buffer layout describes how many attribute values are packed for each data object\n  // The default (null) is one value each object.\n  // Some data formats (e.g. paths, polygons) have various length. Their buffer layout\n  //  is in the form of [L0, L1, L2, ...]\n  getStartIndices(props) {\n    props = props || this.props;\n\n    // First Check if startIndices is provided as an explicit value\n    if (props.startIndices !== undefined) {\n      return props.startIndices;\n    }\n\n    // Second check if the layer has set its own value\n    if (this.state && this.state.startIndices) {\n      return this.state.startIndices;\n    }\n\n    return null;\n  }\n\n  // LAYER MANAGER API\n  // Should only be called by the deck.gl LayerManager class\n\n  // Called by layer manager when a new layer is found\n  /* eslint-disable max-statements */\n  _initialize() {\n    debug(TRACE_INITIALIZE, this);\n\n    this._initState();\n\n    // Call subclass lifecycle methods\n    this.initializeState(this.context);\n    // Initialize extensions\n    for (const extension of this.props.extensions) {\n      extension.initializeState.call(this, this.context, extension);\n    }\n    // End subclass lifecycle methods\n\n    // initializeState callback tends to clear state\n    this.setChangeFlags({\n      dataChanged: true,\n      propsChanged: true,\n      viewportChanged: true,\n      extensionsChanged: true\n    });\n\n    this._updateState();\n  }\n\n  // Called by layer manager\n  // if this layer is new (not matched with an existing layer) oldProps will be empty object\n  _update() {\n    // Call subclass lifecycle method\n    const stateNeedsUpdate = this.needsUpdate();\n    // End lifecycle method\n    debug(TRACE_UPDATE, this, stateNeedsUpdate);\n\n    if (stateNeedsUpdate) {\n      this._updateState();\n    }\n  }\n\n  // Common code for _initialize and _update\n  _updateState() {\n    const currentProps = this.props;\n    const currentViewport = this.context.viewport;\n    const propsInTransition = this._updateUniformTransition();\n    this.internalState.propsInTransition = propsInTransition;\n    // Overwrite this.context.viewport during update to use the last activated viewport on this layer\n    // In multi-view applications, a layer may only be drawn in one of the views\n    // Which would make the \"active\" viewport different from the shared context\n    this.context.viewport = this.internalState.viewport || currentViewport;\n    // Overwrite this.props during update to use in-transition prop values\n    this.props = propsInTransition;\n\n    const updateParams = this._getUpdateParams();\n    const oldModels = this.getModels();\n\n    // Safely call subclass lifecycle methods\n    if (this.context.gl) {\n      this.updateState(updateParams);\n    } else {\n      try {\n        this.updateState(updateParams);\n      } catch (error) {\n        // ignore error if gl context is missing\n      }\n    }\n    // Execute extension updates\n    for (const extension of this.props.extensions) {\n      extension.updateState.call(this, updateParams, extension);\n    }\n\n    const modelChanged = this.getModels()[0] !== oldModels[0];\n    this._updateModules(updateParams, modelChanged);\n    // End subclass lifecycle methods\n\n    if (this.isComposite) {\n      // Render or update previously rendered sublayers\n      this._renderLayers(updateParams);\n    } else {\n      this.setNeedsRedraw();\n      // Add any subclass attributes\n      this._updateAttributes(this.props);\n\n      // Note: Automatic instance count update only works for single layers\n      if (this.state.model) {\n        this.state.model.setInstanceCount(this.getNumInstances());\n      }\n    }\n\n    // Restore shared context\n    this.context.viewport = currentViewport;\n    this.props = currentProps;\n    this.clearChangeFlags();\n    this.internalState.needsUpdate = false;\n    this.internalState.resetOldProps();\n  }\n  /* eslint-enable max-statements */\n\n  // Called by manager when layer is about to be disposed\n  // Note: not guaranteed to be called on application shutdown\n  _finalize() {\n    debug(TRACE_FINALIZE, this);\n    assert(this.internalState && this.state);\n\n    // Call subclass lifecycle method\n    this.finalizeState(this.context);\n    // Finalize extensions\n    for (const extension of this.props.extensions) {\n      extension.finalizeState.call(this, extension);\n    }\n  }\n\n  // Calculates uniforms\n  drawLayer({moduleParameters = null, uniforms = {}, parameters = {}}) {\n    this._updateAttributeTransition();\n\n    const currentProps = this.props;\n    // Overwrite this.props during redraw to use in-transition prop values\n    // `internalState.propsInTransition` could be missing if `updateState` failed\n    this.props = this.internalState.propsInTransition || currentProps;\n\n    const {opacity} = this.props;\n    // apply gamma to opacity to make it visually \"linear\"\n    uniforms.opacity = Math.pow(opacity, 1 / 2.2);\n\n    // TODO/ib - hack move to luma Model.draw\n    if (moduleParameters) {\n      this.setModuleParameters(moduleParameters);\n    }\n\n    // Apply polygon offset to avoid z-fighting\n    // TODO - move to draw-layers\n    const {getPolygonOffset} = this.props;\n    const offsets = (getPolygonOffset && getPolygonOffset(uniforms)) || [0, 0];\n\n    setParameters(this.context.gl, {polygonOffset: offsets});\n\n    // Call subclass lifecycle method\n    withParameters(this.context.gl, parameters, () => {\n      const opts = {moduleParameters, uniforms, parameters, context: this.context};\n\n      // extensions\n      for (const extension of this.props.extensions) {\n        extension.draw.call(this, opts, extension);\n      }\n\n      this.draw(opts);\n    });\n\n    // End lifecycle method\n\n    this.props = currentProps;\n  }\n\n  // Helper methods\n  getChangeFlags() {\n    return this.internalState.changeFlags;\n  }\n\n  // Dirty some change flags, will be handled by updateLayer\n  /* eslint-disable complexity */\n  setChangeFlags(flags) {\n    const {changeFlags} = this.internalState;\n\n    /* eslint-disable no-fallthrough, max-depth */\n    for (const key in flags) {\n      if (flags[key]) {\n        let flagChanged = false;\n        switch (key) {\n          case 'dataChanged':\n            // changeFlags.dataChanged may be `false`, a string (reason) or an array of ranges\n            if (Array.isArray(changeFlags[key])) {\n              changeFlags[key] = Array.isArray(flags[key])\n                ? changeFlags[key].concat(flags[key])\n                : flags[key];\n              flagChanged = true;\n            }\n\n          default:\n            if (!changeFlags[key]) {\n              changeFlags[key] = flags[key];\n              flagChanged = true;\n            }\n        }\n        if (flagChanged) {\n          debug(TRACE_CHANGE_FLAG, this, key, flags);\n        }\n      }\n    }\n    /* eslint-enable no-fallthrough, max-depth */\n\n    // Update composite flags\n    const propsOrDataChanged =\n      changeFlags.dataChanged ||\n      changeFlags.updateTriggersChanged ||\n      changeFlags.propsChanged ||\n      changeFlags.extensionsChanged;\n    changeFlags.propsOrDataChanged = propsOrDataChanged;\n    changeFlags.somethingChanged =\n      propsOrDataChanged || flags.viewportChanged || flags.stateChanged;\n  }\n  /* eslint-enable complexity */\n\n  // Clear all changeFlags, typically after an update\n  clearChangeFlags() {\n    this.internalState.changeFlags = {\n      // Primary changeFlags, can be strings stating reason for change\n      dataChanged: false,\n      propsChanged: false,\n      updateTriggersChanged: false,\n      viewportChanged: false,\n      stateChanged: false,\n      extensionsChanged: false,\n\n      // Derived changeFlags\n      propsOrDataChanged: false,\n      somethingChanged: false\n    };\n  }\n\n  // Compares the layers props with old props from a matched older layer\n  // and extracts change flags that describe what has change so that state\n  // can be update correctly with minimal effort\n  diffProps(newProps, oldProps) {\n    const changeFlags = diffProps(newProps, oldProps);\n\n    // iterate over changedTriggers\n    if (changeFlags.updateTriggersChanged) {\n      for (const key in changeFlags.updateTriggersChanged) {\n        if (changeFlags.updateTriggersChanged[key]) {\n          this.invalidateAttribute(key);\n        }\n      }\n    }\n\n    // trigger uniform transitions\n    if (changeFlags.transitionsChanged) {\n      for (const key in changeFlags.transitionsChanged) {\n        // prop changed and transition is enabled\n        this.internalState.uniformTransitions.add(\n          key,\n          oldProps[key],\n          newProps[key],\n          newProps.transitions[key]\n        );\n      }\n    }\n\n    return this.setChangeFlags(changeFlags);\n  }\n\n  // Called by layer manager to validate props (in development)\n  validateProps() {\n    validateProps(this.props);\n  }\n\n  setModuleParameters(moduleParameters) {\n    for (const model of this.getModels()) {\n      model.updateModuleSettings(moduleParameters);\n    }\n  }\n\n  // PRIVATE METHODS\n  _updateModules({props, oldProps}, forceUpdate) {\n    // Picking module parameters\n    const {autoHighlight, highlightedObjectIndex, highlightColor} = props;\n    if (\n      forceUpdate ||\n      oldProps.autoHighlight !== autoHighlight ||\n      oldProps.highlightedObjectIndex !== highlightedObjectIndex ||\n      oldProps.highlightColor !== highlightColor\n    ) {\n      const parameters = {};\n      if (!autoHighlight) {\n        parameters.pickingSelectedColor = null;\n      }\n      if (Array.isArray(highlightColor)) {\n        parameters.pickingHighlightColor = highlightColor;\n      }\n\n      // highlightedObjectIndex will overwrite any settings from auto highlighting.\n      if (Number.isInteger(highlightedObjectIndex)) {\n        parameters.pickingSelectedColor =\n          highlightedObjectIndex >= 0 ? this.encodePickingColor(highlightedObjectIndex) : null;\n      }\n\n      this.setModuleParameters(parameters);\n    }\n  }\n\n  _getUpdateParams() {\n    return {\n      props: this.props,\n      oldProps: this.internalState.getOldProps(),\n      context: this.context,\n      changeFlags: this.internalState.changeFlags\n    };\n  }\n\n  // Checks state of attributes and model\n  _getNeedsRedraw(opts) {\n    // this method may be called by the render loop as soon a the layer\n    // has been created, so guard against uninitialized state\n    if (!this.internalState) {\n      return false;\n    }\n\n    let redraw = false;\n    redraw = redraw || (this.internalState.needsRedraw && this.id);\n    this.internalState.needsRedraw = this.internalState.needsRedraw && !opts.clearRedrawFlags;\n\n    // TODO - is attribute manager needed? - Model should be enough.\n    const attributeManager = this.getAttributeManager();\n    const attributeManagerNeedsRedraw = attributeManager && attributeManager.getNeedsRedraw(opts);\n    redraw = redraw || attributeManagerNeedsRedraw;\n\n    return redraw;\n  }\n\n  // Create new attribute manager\n  _getAttributeManager() {\n    return new AttributeManager(this.context.gl, {\n      id: this.props.id,\n      stats: this.context.stats,\n      timeline: this.context.timeline\n    });\n  }\n\n  _initState() {\n    assert(!this.internalState && !this.state);\n    assert(isFinite(this.props.coordinateSystem), `${this.id}: invalid coordinateSystem`);\n\n    const attributeManager = this._getAttributeManager();\n\n    if (attributeManager) {\n      // All instanced layers get instancePickingColors attribute by default\n      // Their shaders can use it to render a picking scene\n      // TODO - this slightly slows down non instanced layers\n      attributeManager.addInstanced({\n        instancePickingColors: {\n          type: GL.UNSIGNED_BYTE,\n          size: 3,\n          noAlloc: true,\n          update: this.calculateInstancePickingColors\n        }\n      });\n    }\n\n    this.internalState = new LayerState({\n      attributeManager,\n      layer: this\n    });\n    this.clearChangeFlags(); // populate this.internalState.changeFlags\n\n    this.state = {};\n    // for backwards compatibility with older layers\n    // TODO - remove in next release\n    /* eslint-disable accessor-pairs */\n    Object.defineProperty(this.state, 'attributeManager', {\n      get: () => {\n        log.deprecated('layer.state.attributeManager', 'layer.getAttributeManager()');\n        return attributeManager;\n      }\n    });\n    /* eslint-enable accessor-pairs */\n\n    this.internalState.layer = this;\n    this.internalState.uniformTransitions = new UniformTransitionManager(this.context.timeline);\n    this.internalState.onAsyncPropUpdated = this._onAsyncPropUpdated.bind(this);\n\n    // Ensure any async props are updated\n    this.internalState.setAsyncProps(this.props);\n  }\n\n  // Called by layer manager to transfer state from an old layer\n  _transferState(oldLayer) {\n    debug(TRACE_MATCHED, this, this === oldLayer);\n\n    const {state, internalState} = oldLayer;\n    assert(state && internalState);\n\n    if (this === oldLayer) {\n      return;\n    }\n\n    // Move internalState\n    this.internalState = internalState;\n    this.internalState.layer = this;\n\n    // Move state\n    this.state = state;\n    // We keep the state ref on old layers to support async actions\n    // oldLayer.state = null;\n\n    // Ensure any async props are updated\n    this.internalState.setAsyncProps(this.props);\n\n    this.diffProps(this.props, this.internalState.getOldProps());\n  }\n\n  _onAsyncPropUpdated() {\n    this.diffProps(this.props, this.internalState.getOldProps());\n    this.setNeedsUpdate();\n  }\n}\n\nLayer.layerName = 'Layer';\nLayer.defaultProps = defaultProps;\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport project from '../project/project';\n\nconst vs = `\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64Low);\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    // offset is specified as ENU\n    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe\n    mat3 rotation = project_get_orientation_matrix(projectedPosition);\n    offset = rotation * offset;\n  }\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64Low, offset, commonPosition);\n}\n`;\n\nexport default {\n  name: 'project32',\n  dependencies: [project],\n  vs\n};\n","import {picking} from '@luma.gl/core';\n\nexport default Object.assign(\n  {\n    inject: {\n      'vs:DECKGL_FILTER_COLOR': `\n    picking_setPickingColor(geometry.pickingColor);\n    // for picking depth values\n    picking_setPickingAttribute(geometry.position.z);\n    `,\n      'fs:DECKGL_FILTER_COLOR': {\n        order: 99,\n        injection: `\n    // use highlight color if this fragment belongs to the selected object.\n    color = picking_filterHighlightColor(color);\n\n    // use picking color if rendering to picking FBO.\n    color = picking_filterPickingColor(color);\n      `\n      }\n    }\n  },\n  picking\n);\n","import {equals} from 'math.gl';\nimport assert from '../utils/assert';\n\nexport default class TransitionInterpolator {\n  /**\n   * @param opts {array|object}\n   * @param opts.compare {array} - prop names used in equality check\n   * @param opts.extract {array} - prop names needed for interpolation\n   * @param opts.required {array} - prop names that must be supplied\n   * alternatively, supply one list of prop names as `opts` if all of the above are the same.\n   */\n  constructor(opts = {}) {\n    if (Array.isArray(opts)) {\n      opts = {\n        compare: opts,\n        extract: opts,\n        required: opts\n      };\n    }\n    const {compare, extract, required} = opts;\n\n    this._propsToCompare = compare;\n    this._propsToExtract = extract;\n    this._requiredProps = required;\n  }\n\n  /**\n   * Checks if two sets of props need transition in between\n   * @param currentProps {object} - a list of viewport props\n   * @param nextProps {object} - a list of viewport props\n   * @returns {bool} - true if two props are equivalent\n   */\n  arePropsEqual(currentProps, nextProps) {\n    for (const key of this._propsToCompare || Object.keys(nextProps)) {\n      if (\n        !(key in currentProps) ||\n        !(key in nextProps) ||\n        !equals(currentProps[key], nextProps[key])\n      ) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  /**\n   * Called before transition starts to validate/pre-process start and end props\n   * @param startProps {object} - a list of starting viewport props\n   * @param endProps {object} - a list of target viewport props\n   * @returns {Object} {start, end} - start and end props to be passed\n   *   to `interpolateProps`\n   */\n  initializeProps(startProps, endProps) {\n    let result;\n\n    if (this._propsToExtract) {\n      const startViewStateProps = {};\n      const endViewStateProps = {};\n\n      for (const key of this._propsToExtract) {\n        startViewStateProps[key] = startProps[key];\n        endViewStateProps[key] = endProps[key];\n      }\n      result = {start: startViewStateProps, end: endViewStateProps};\n    } else {\n      result = {start: startProps, end: endProps};\n    }\n\n    this._checkRequiredProps(result.start);\n    this._checkRequiredProps(result.end);\n\n    return result;\n  }\n\n  /**\n   * Returns viewport props in transition\n   * @param startProps {object} - a list of starting viewport props\n   * @param endProps {object} - a list of target viewport props\n   * @param t {number} - a time factor between [0, 1]\n   * @returns {object} - a list of interpolated viewport props\n   */\n  interpolateProps(startProps, endProps, t) {\n    return endProps;\n  }\n\n  /**\n   * Returns transition duration\n   * @param startProps {object} - a list of starting viewport props\n   * @param endProps {object} - a list of target viewport props\n   * @returns {Number} - transition duration in milliseconds\n   */\n  getDuration(startProps, endProps) {\n    return endProps.transitionDuration;\n  }\n\n  _checkRequiredProps(props) {\n    if (!this._requiredProps) {\n      return;\n    }\n\n    this._requiredProps.forEach(propName => {\n      const value = props[propName];\n      assert(\n        Number.isFinite(value) || Array.isArray(value),\n        `${propName} is required for transition`\n      );\n    });\n  }\n}\n","import TransitionInterpolator from './transition-interpolator';\nimport {lerp} from 'math.gl';\n\nconst DEFAULT_PROPS = ['longitude', 'latitude', 'zoom', 'bearing', 'pitch'];\nconst DEFAULT_REQUIRED_PROPS = ['longitude', 'latitude', 'zoom'];\n\n/**\n * Performs linear interpolation of two view states.\n */\nexport default class LinearInterpolator extends TransitionInterpolator {\n  /**\n   * @param {Array} transitionProps - list of props to apply linear transition to.\n   */\n  constructor(transitionProps) {\n    super(\n      transitionProps || {\n        compare: DEFAULT_PROPS,\n        extract: DEFAULT_PROPS,\n        required: DEFAULT_REQUIRED_PROPS\n      }\n    );\n  }\n\n  interpolateProps(startProps, endProps, t) {\n    const viewport = {};\n    for (const key in endProps) {\n      viewport[key] = lerp(startProps[key] || 0, endProps[key] || 0, t);\n    }\n    return viewport;\n  }\n}\n","import LinearInterpolator from '../transitions/linear-interpolator';\nimport Transition from '../transitions/transition';\n\nconst noop = () => {};\n\nexport const TRANSITION_EVENTS = {\n  BREAK: 1,\n  SNAP_TO_END: 2,\n  IGNORE: 3\n};\n\nconst DEFAULT_PROPS = {\n  transitionDuration: 0,\n  transitionEasing: t => t,\n  transitionInterpolator: new LinearInterpolator(),\n  transitionInterruption: TRANSITION_EVENTS.BREAK,\n  onTransitionStart: noop,\n  onTransitionInterrupt: noop,\n  onTransitionEnd: noop\n};\n\nexport default class TransitionManager {\n  constructor(ControllerState, props = {}) {\n    this.ControllerState = ControllerState;\n    this.props = Object.assign({}, DEFAULT_PROPS, props);\n    this.propsInTransition = null;\n    this.transition = new Transition(props.timeline);\n\n    this.onViewStateChange = props.onViewStateChange;\n\n    this._onTransitionUpdate = this._onTransitionUpdate.bind(this);\n  }\n\n  finalize() {\n    this.transition.cancel();\n  }\n\n  // Returns current transitioned viewport.\n  getViewportInTransition() {\n    return this.propsInTransition;\n  }\n\n  // Process the vewiport change, either ignore or trigger a new transition.\n  // Return true if a new transition is triggered, false otherwise.\n  processViewStateChange(nextProps) {\n    let transitionTriggered = false;\n    const currentProps = this.props;\n    // Set this.props here as '_triggerTransition' calls '_updateViewport' that uses this.props.\n    nextProps = Object.assign({}, DEFAULT_PROPS, nextProps);\n    this.props = nextProps;\n\n    // NOTE: Be cautious re-ordering statements in this function.\n    if (this._shouldIgnoreViewportChange(currentProps, nextProps)) {\n      return transitionTriggered;\n    }\n\n    if (this._isTransitionEnabled(nextProps)) {\n      const {interruption, endProps} = this.transition.settings;\n      const startProps = Object.assign(\n        {},\n        currentProps,\n        interruption === TRANSITION_EVENTS.SNAP_TO_END\n          ? endProps\n          : this.propsInTransition || currentProps\n      );\n\n      this._triggerTransition(startProps, nextProps);\n\n      transitionTriggered = true;\n    } else {\n      this.transition.cancel();\n    }\n\n    return transitionTriggered;\n  }\n\n  updateTransition() {\n    this.transition.update();\n  }\n\n  // Helper methods\n\n  _isTransitionEnabled(props) {\n    const {transitionDuration, transitionInterpolator} = props;\n    return (\n      (transitionDuration > 0 || transitionDuration === 'auto') && Boolean(transitionInterpolator)\n    );\n  }\n\n  _isUpdateDueToCurrentTransition(props) {\n    if (this.transition.inProgress) {\n      return this.transition.settings.interpolator.arePropsEqual(props, this.propsInTransition);\n    }\n    return false;\n  }\n\n  _shouldIgnoreViewportChange(currentProps, nextProps) {\n    if (this.transition.inProgress) {\n      // Ignore update if it is requested to be ignored\n      return (\n        this.transition.settings.interruption === TRANSITION_EVENTS.IGNORE ||\n        // Ignore update if it is due to current active transition.\n        this._isUpdateDueToCurrentTransition(nextProps)\n      );\n    } else if (this._isTransitionEnabled(nextProps)) {\n      // Ignore if none of the viewport props changed.\n      return nextProps.transitionInterpolator.arePropsEqual(currentProps, nextProps);\n    }\n    return true;\n  }\n\n  _triggerTransition(startProps, endProps) {\n    const startViewstate = new this.ControllerState(startProps);\n    const endViewStateProps = new this.ControllerState(endProps).shortestPathFrom(startViewstate);\n\n    // update transitionDuration for 'auto' mode\n    const {transitionInterpolator} = endProps;\n    const duration = transitionInterpolator.getDuration\n      ? transitionInterpolator.getDuration(startProps, endProps)\n      : endProps.transitionDuration;\n\n    if (duration === 0) {\n      return;\n    }\n\n    const initialProps = endProps.transitionInterpolator.initializeProps(\n      startProps,\n      endViewStateProps\n    );\n\n    this.propsInTransition = {};\n    this.duration = duration;\n    this.transition.start({\n      duration,\n      easing: endProps.transitionEasing,\n      interpolator: endProps.transitionInterpolator,\n      interruption: endProps.transitionInterruption,\n\n      startProps: initialProps.start,\n      endProps: initialProps.end,\n\n      onStart: endProps.onTransitionStart,\n      onUpdate: this._onTransitionUpdate,\n      onInterrupt: this._onTransitionEnd(endProps.onTransitionInterrupt),\n      onEnd: this._onTransitionEnd(endProps.onTransitionEnd)\n    });\n    this.updateTransition();\n  }\n\n  _onTransitionEnd(callback) {\n    return transition => {\n      this.propsInTransition = null;\n      callback(transition);\n    };\n  }\n\n  _onTransitionUpdate(transition) {\n    // NOTE: Be cautious re-ordering statements in this function.\n    const {\n      time,\n      settings: {interpolator, startProps, endProps, duration, easing}\n    } = transition;\n    const t = easing(time / duration);\n    const viewport = interpolator.interpolateProps(startProps, endProps, t);\n\n    // This gurantees all props (e.g. bearing, longitude) are normalized\n    // So when viewports are compared they are in same range.\n    this.propsInTransition = new this.ControllerState(\n      Object.assign({}, this.props, viewport)\n    ).getViewportProps();\n\n    if (this.onViewStateChange) {\n      this.onViewStateChange({\n        viewState: this.propsInTransition,\n        interactionState: {inTransition: true},\n        oldViewState: this.props\n      });\n    }\n  }\n}\n\nTransitionManager.defaultProps = DEFAULT_PROPS;\n","// Copyright (c) 2015 Uber Technologies, Inc.\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport TransitionManager from './transition-manager';\nimport assert from '../utils/assert';\n\nconst NO_TRANSITION_PROPS = {\n  transitionDuration: 0\n};\n\n// EVENT HANDLING PARAMETERS\nconst ZOOM_ACCEL = 0.01;\n\nconst EVENT_TYPES = {\n  WHEEL: ['wheel'],\n  PAN: ['panstart', 'panmove', 'panend'],\n  PINCH: ['pinchstart', 'pinchmove', 'pinchend'],\n  DOUBLE_TAP: ['doubletap'],\n  KEYBOARD: ['keydown']\n};\n\nexport default class Controller {\n  constructor(ControllerState, options = {}) {\n    assert(ControllerState);\n    this.ControllerState = ControllerState;\n    this.controllerState = null;\n    this.controllerStateProps = null;\n    this.eventManager = null;\n    this.transitionManager = new TransitionManager(ControllerState, options);\n    this._events = null;\n    this._state = {\n      isDragging: false\n    };\n    this._customEvents = [];\n    this.onViewStateChange = null;\n    this.onStateChange = null;\n    this.invertPan = false;\n\n    this.handleEvent = this.handleEvent.bind(this);\n\n    this.setProps(options);\n  }\n\n  set events(customEvents) {\n    this.toggleEvents(this._customEvents, false);\n    this.toggleEvents(customEvents, true);\n    this._customEvents = customEvents;\n    // Make sure default events are not overwritten\n    this.setProps(this.controllerStateProps);\n  }\n\n  finalize() {\n    for (const eventName in this._events) {\n      if (this._events[eventName]) {\n        this.eventManager.off(eventName, this.handleEvent);\n      }\n    }\n    this.transitionManager.finalize();\n  }\n\n  /**\n   * Callback for events\n   * @param {hammer.Event} event\n   */\n  handleEvent(event) {\n    const {ControllerState} = this;\n    this.controllerState = new ControllerState({\n      makeViewport: this.makeViewport,\n      ...this.controllerStateProps,\n      ...this._state\n    });\n\n    switch (event.type) {\n      case 'panstart':\n        return this._onPanStart(event);\n      case 'panmove':\n        return this._onPan(event);\n      case 'panend':\n        return this._onPanEnd(event);\n      case 'pinchstart':\n        return this._onPinchStart(event);\n      case 'pinchmove':\n        return this._onPinch(event);\n      case 'pinchend':\n        return this._onPinchEnd(event);\n      case 'doubletap':\n        return this._onDoubleTap(event);\n      case 'wheel':\n        return this._onWheel(event);\n      case 'keydown':\n        return this._onKeyDown(event);\n      default:\n        return false;\n    }\n  }\n\n  /* Event utils */\n  // Event object: http://hammerjs.github.io/api/#event-object\n  getCenter(event) {\n    const {x, y} = this.controllerStateProps;\n    const {offsetCenter} = event;\n    return [offsetCenter.x - x, offsetCenter.y - y];\n  }\n\n  isPointInBounds(pos, event) {\n    const {width, height} = this.controllerStateProps;\n    if (event && event.handled) {\n      return false;\n    }\n\n    const inside = pos[0] >= 0 && pos[0] <= width && pos[1] >= 0 && pos[1] <= height;\n    if (inside && event) {\n      event.stopPropagation();\n    }\n    return inside;\n  }\n\n  isFunctionKeyPressed(event) {\n    const {srcEvent} = event;\n    return Boolean(srcEvent.metaKey || srcEvent.altKey || srcEvent.ctrlKey || srcEvent.shiftKey);\n  }\n\n  isDragging() {\n    return this._state.isDragging;\n  }\n\n  /**\n   * Extract interactivity options\n   */\n  /* eslint-disable complexity, max-statements */\n  setProps(props) {\n    if ('onViewStateChange' in props) {\n      this.onViewStateChange = props.onViewStateChange;\n    }\n    if ('onStateChange' in props) {\n      this.onStateChange = props.onStateChange;\n    }\n    if ('makeViewport' in props) {\n      this.makeViewport = props.makeViewport;\n    }\n    this.controllerStateProps = props;\n\n    if ('eventManager' in props && this.eventManager !== props.eventManager) {\n      // EventManager has changed\n      this.eventManager = props.eventManager;\n      this._events = {};\n      this.toggleEvents(this._customEvents, true);\n    }\n\n    this.transitionManager.processViewStateChange(this.controllerStateProps);\n\n    // TODO - make sure these are not reset on every setProps\n    const {\n      scrollZoom = true,\n      dragPan = true,\n      dragRotate = true,\n      doubleClickZoom = true,\n      touchZoom = true,\n      touchRotate = false,\n      keyboard = true\n    } = props;\n\n    // Register/unregister events\n    const isInteractive = Boolean(this.onViewStateChange);\n    this.toggleEvents(EVENT_TYPES.WHEEL, isInteractive && scrollZoom);\n    this.toggleEvents(EVENT_TYPES.PAN, isInteractive && (dragPan || dragRotate));\n    this.toggleEvents(EVENT_TYPES.PINCH, isInteractive && (touchZoom || touchRotate));\n    this.toggleEvents(EVENT_TYPES.DOUBLE_TAP, isInteractive && doubleClickZoom);\n    this.toggleEvents(EVENT_TYPES.KEYBOARD, isInteractive && keyboard);\n\n    // Interaction toggles\n    this.scrollZoom = scrollZoom;\n    this.dragPan = dragPan;\n    this.dragRotate = dragRotate;\n    this.doubleClickZoom = doubleClickZoom;\n    this.touchZoom = touchZoom;\n    this.touchRotate = touchRotate;\n    this.keyboard = keyboard;\n  }\n  /* eslint-enable complexity, max-statements */\n\n  updateTransition() {\n    this.transitionManager.updateTransition();\n  }\n\n  toggleEvents(eventNames, enabled) {\n    if (this.eventManager) {\n      eventNames.forEach(eventName => {\n        if (this._events[eventName] !== enabled) {\n          this._events[eventName] = enabled;\n          if (enabled) {\n            this.eventManager.on(eventName, this.handleEvent);\n          } else {\n            this.eventManager.off(eventName, this.handleEvent);\n          }\n        }\n      });\n    }\n  }\n\n  // Private Methods\n\n  /* Callback util */\n  // formats map state and invokes callback function\n  updateViewport(newControllerState, extraProps = {}, interactionState = {}) {\n    const viewState = Object.assign({}, newControllerState.getViewportProps(), extraProps);\n\n    // TODO - to restore diffing, we need to include interactionState\n    const changed = this.controllerState !== newControllerState;\n    // const oldViewState = this.controllerState.getViewportProps();\n    // const changed = Object.keys(viewState).some(key => oldViewState[key] !== viewState[key]);\n\n    if (changed) {\n      const oldViewState = this.controllerState ? this.controllerState.getViewportProps() : null;\n      if (this.onViewStateChange) {\n        this.onViewStateChange({viewState, interactionState, oldViewState});\n      }\n    }\n\n    Object.assign(this._state, newControllerState.getInteractiveState(), interactionState);\n\n    if (this.onStateChange) {\n      this.onStateChange(this._state);\n    }\n  }\n\n  /* Event handlers */\n  // Default handler for the `panstart` event.\n  _onPanStart(event) {\n    const pos = this.getCenter(event);\n    if (!this.isPointInBounds(pos, event)) {\n      return false;\n    }\n    const newControllerState = this.controllerState.panStart({pos}).rotateStart({pos});\n    this.updateViewport(newControllerState, NO_TRANSITION_PROPS, {isDragging: true});\n    return true;\n  }\n\n  // Default handler for the `panmove` event.\n  _onPan(event) {\n    if (!this.isDragging()) {\n      return false;\n    }\n    let alternateMode = this.isFunctionKeyPressed(event) || event.rightButton;\n    alternateMode = this.invertPan ? !alternateMode : alternateMode;\n    return alternateMode ? this._onPanMove(event) : this._onPanRotate(event);\n  }\n\n  // Default handler for the `panend` event.\n  _onPanEnd(event) {\n    const newControllerState = this.controllerState.panEnd().rotateEnd();\n    this.updateViewport(newControllerState, null, {\n      isDragging: false,\n      isPanning: false,\n      isRotating: false\n    });\n    return true;\n  }\n\n  // Default handler for panning to move.\n  // Called by `_onPan` when panning without function key pressed.\n  _onPanMove(event) {\n    if (!this.dragPan) {\n      return false;\n    }\n    const pos = this.getCenter(event);\n    const newControllerState = this.controllerState.pan({pos});\n    this.updateViewport(newControllerState, NO_TRANSITION_PROPS, {\n      isDragging: true,\n      isPanning: true\n    });\n    return true;\n  }\n\n  // Default handler for panning to rotate.\n  // Called by `_onPan` when panning with function key pressed.\n  _onPanRotate(event) {\n    if (!this.dragRotate) {\n      return false;\n    }\n\n    const {deltaX, deltaY} = event;\n    const {width, height} = this.controllerState.getViewportProps();\n\n    const deltaScaleX = deltaX / width;\n    const deltaScaleY = deltaY / height;\n\n    const newControllerState = this.controllerState.rotate({deltaScaleX, deltaScaleY});\n    this.updateViewport(newControllerState, NO_TRANSITION_PROPS, {\n      isDragging: true,\n      isRotating: true\n    });\n    return true;\n  }\n\n  // Default handler for the `wheel` event.\n  _onWheel(event) {\n    if (!this.scrollZoom) {\n      return false;\n    }\n    event.preventDefault();\n\n    const pos = this.getCenter(event);\n    if (!this.isPointInBounds(pos, event)) {\n      return false;\n    }\n\n    const {delta} = event;\n\n    // Map wheel delta to relative scale\n    let scale = 2 / (1 + Math.exp(-Math.abs(delta * ZOOM_ACCEL)));\n    if (delta < 0 && scale !== 0) {\n      scale = 1 / scale;\n    }\n\n    const newControllerState = this.controllerState.zoom({pos, scale});\n    this.updateViewport(newControllerState, NO_TRANSITION_PROPS, {\n      isZooming: true,\n      isPanning: true\n    });\n    return true;\n  }\n\n  // Default handler for the `pinchstart` event.\n  _onPinchStart(event) {\n    const pos = this.getCenter(event);\n    if (!this.isPointInBounds(pos, event)) {\n      return false;\n    }\n\n    const newControllerState = this.controllerState.zoomStart({pos}).rotateStart({pos});\n    // hack - hammer's `rotation` field doesn't seem to produce the correct angle\n    this._state.startPinchRotation = event.rotation;\n    this.updateViewport(newControllerState, NO_TRANSITION_PROPS, {isDragging: true});\n    return true;\n  }\n\n  // Default handler for the `pinch` event.\n  _onPinch(event) {\n    if (!this.touchZoom && !this.touchRotate) {\n      return false;\n    }\n    if (!this.isDragging()) {\n      return false;\n    }\n\n    let newControllerState = this.controllerState;\n    if (this.touchZoom) {\n      const {scale} = event;\n      const pos = this.getCenter(event);\n      newControllerState = newControllerState.zoom({pos, scale});\n    }\n    if (this.touchRotate) {\n      const {rotation} = event;\n      const {startPinchRotation} = this._state;\n      newControllerState = newControllerState.rotate({\n        deltaScaleX: -(rotation - startPinchRotation) / 180\n      });\n    }\n\n    this.updateViewport(newControllerState, NO_TRANSITION_PROPS, {\n      isDragging: true,\n      isPanning: this.touchZoom,\n      isZooming: this.touchZoom,\n      isRotating: this.touchRotate\n    });\n    return true;\n  }\n\n  // Default handler for the `pinchend` event.\n  _onPinchEnd(event) {\n    const newControllerState = this.controllerState.zoomEnd().rotateEnd();\n    this._state.startPinchRotation = 0;\n    this.updateViewport(newControllerState, null, {\n      isDragging: false,\n      isPanning: false,\n      isZooming: false,\n      isRotating: false\n    });\n    return true;\n  }\n\n  // Default handler for the `doubletap` event.\n  _onDoubleTap(event) {\n    if (!this.doubleClickZoom) {\n      return false;\n    }\n    const pos = this.getCenter(event);\n    if (!this.isPointInBounds(pos, event)) {\n      return false;\n    }\n\n    const isZoomOut = this.isFunctionKeyPressed(event);\n\n    const newControllerState = this.controllerState.zoom({pos, scale: isZoomOut ? 0.5 : 2});\n    this.updateViewport(newControllerState, this._getTransitionProps(), {\n      isZooming: true,\n      isPanning: true\n    });\n    return true;\n  }\n\n  /* eslint-disable complexity, max-statements */\n  // Default handler for the `keydown` event\n  _onKeyDown(event) {\n    if (!this.keyboard) {\n      return false;\n    }\n    const funcKey = this.isFunctionKeyPressed(event);\n    const {controllerState} = this;\n    let newControllerState;\n    const interactionState = {};\n\n    switch (event.srcEvent.code) {\n      case 'Minus':\n        newControllerState = funcKey\n          ? controllerState.zoomOut().zoomOut()\n          : controllerState.zoomOut();\n        interactionState.isZooming = true;\n        break;\n      case 'Equal':\n        newControllerState = funcKey ? controllerState.zoomIn().zoomIn() : controllerState.zoomIn();\n        interactionState.isZooming = true;\n        break;\n      case 'ArrowLeft':\n        if (funcKey) {\n          newControllerState = controllerState.rotateLeft();\n          interactionState.isRotating = true;\n        } else {\n          newControllerState = controllerState.moveLeft();\n          interactionState.isPanning = true;\n        }\n        break;\n      case 'ArrowRight':\n        if (funcKey) {\n          newControllerState = controllerState.rotateRight();\n          interactionState.isRotating = true;\n        } else {\n          newControllerState = controllerState.moveRight();\n          interactionState.isPanning = true;\n        }\n        break;\n      case 'ArrowUp':\n        if (funcKey) {\n          newControllerState = controllerState.rotateUp();\n          interactionState.isRotating = true;\n        } else {\n          newControllerState = controllerState.moveUp();\n          interactionState.isPanning = true;\n        }\n        break;\n      case 'ArrowDown':\n        if (funcKey) {\n          newControllerState = controllerState.rotateDown();\n          interactionState.isRotating = true;\n        } else {\n          newControllerState = controllerState.moveDown();\n          interactionState.isPanning = true;\n        }\n        break;\n      default:\n        return false;\n    }\n    this.updateViewport(newControllerState, this._getTransitionProps(), interactionState);\n    return true;\n  }\n  /* eslint-enable complexity */\n\n  _getTransitionProps() {\n    // Transitions on double-tap and key-down are only supported by MapController\n    return NO_TRANSITION_PROPS;\n  }\n}\n","import assert from '../utils/assert';\n\n/* Helpers */\n\nexport default class ViewState {\n  constructor(opts) {\n    assert(Number.isFinite(opts.width), '`width` must be supplied');\n    assert(Number.isFinite(opts.height), '`height` must be supplied');\n\n    this._viewportProps = this._applyConstraints(opts);\n  }\n\n  getViewportProps() {\n    return this._viewportProps;\n  }\n\n  shortestPathFrom(viewState) {\n    return this._viewportProps;\n  }\n\n  // Redefined by subclass\n  // Apply any constraints (mathematical or defined by _viewportProps) to map state\n  _applyConstraints(props) {\n    return props;\n  }\n}\n","import {clamp} from 'math.gl';\nimport Controller from './controller';\nimport ViewState from './view-state';\nimport {normalizeViewportProps} from '@math.gl/web-mercator';\nimport assert from '../utils/assert';\nimport LinearInterpolator from '../transitions/linear-interpolator';\nimport {TRANSITION_EVENTS} from './transition-manager';\n\nconst PITCH_MOUSE_THRESHOLD = 5;\nconst PITCH_ACCEL = 1.2;\n\nconst LINEAR_TRANSITION_PROPS = {\n  transitionDuration: 300,\n  transitionEasing: t => t,\n  transitionInterpolator: new LinearInterpolator(),\n  transitionInterruption: TRANSITION_EVENTS.BREAK\n};\n\nconst NO_TRANSITION_PROPS = {\n  transitionDuration: 0\n};\n\n// MAPBOX LIMITS\nexport const MAPBOX_LIMITS = {\n  minZoom: 0,\n  maxZoom: 20,\n  minPitch: 0,\n  maxPitch: 60\n};\n\nconst DEFAULT_STATE = {\n  pitch: 0,\n  bearing: 0,\n  altitude: 1.5\n};\n\n/* Utils */\n\nexport class MapState extends ViewState {\n  constructor({\n    makeViewport,\n\n    /** Mapbox viewport properties */\n    /** The width of the viewport */\n    width,\n    /** The height of the viewport */\n    height,\n    /** The latitude at the center of the viewport */\n    latitude,\n    /** The longitude at the center of the viewport */\n    longitude,\n    /** The tile zoom level of the map. */\n    zoom,\n    /** The bearing of the viewport in degrees */\n    bearing = DEFAULT_STATE.bearing,\n    /** The pitch of the viewport in degrees */\n    pitch = DEFAULT_STATE.pitch,\n    /**\n     * Specify the altitude of the viewport camera\n     * Unit: map heights, default 1.5\n     * Non-public API, see https://github.com/mapbox/mapbox-gl-js/issues/1137\n     */\n    altitude = DEFAULT_STATE.altitude,\n\n    /** Viewport constraints */\n    maxZoom = MAPBOX_LIMITS.maxZoom,\n    minZoom = MAPBOX_LIMITS.minZoom,\n    maxPitch = MAPBOX_LIMITS.maxPitch,\n    minPitch = MAPBOX_LIMITS.minPitch,\n\n    /** Interaction states, required to calculate change during transform */\n    /* The point on map being grabbed when the operation first started */\n    startPanLngLat,\n    /* Center of the zoom when the operation first started */\n    startZoomLngLat,\n    /** Bearing when current perspective rotate operation started */\n    startBearing,\n    /** Pitch when current perspective rotate operation started */\n    startPitch,\n    /** Zoom when current zoom operation started */\n    startZoom\n  } = {}) {\n    assert(Number.isFinite(longitude), '`longitude` must be supplied');\n    assert(Number.isFinite(latitude), '`latitude` must be supplied');\n    assert(Number.isFinite(zoom), '`zoom` must be supplied');\n\n    super({\n      width,\n      height,\n      latitude,\n      longitude,\n      zoom,\n      bearing,\n      pitch,\n      altitude,\n      maxZoom,\n      minZoom,\n      maxPitch,\n      minPitch\n    });\n\n    this._interactiveState = {\n      startPanLngLat,\n      startZoomLngLat,\n      startBearing,\n      startPitch,\n      startZoom\n    };\n\n    this.makeViewport = makeViewport;\n  }\n\n  /* Public API */\n\n  getViewportProps() {\n    return this._viewportProps;\n  }\n\n  getInteractiveState() {\n    return this._interactiveState;\n  }\n\n  /**\n   * Start panning\n   * @param {[Number, Number]} pos - position on screen where the pointer grabs\n   */\n  panStart({pos}) {\n    return this._getUpdatedState({\n      startPanLngLat: this._unproject(pos)\n    });\n  }\n\n  /**\n   * Pan\n   * @param {[Number, Number]} pos - position on screen where the pointer is\n   * @param {[Number, Number], optional} startPos - where the pointer grabbed at\n   *   the start of the operation. Must be supplied of `panStart()` was not called\n   */\n  pan({pos, startPos}) {\n    const startPanLngLat = this._interactiveState.startPanLngLat || this._unproject(startPos);\n\n    if (!startPanLngLat) {\n      return this;\n    }\n\n    const [longitude, latitude] = this._calculateNewLngLat({startPanLngLat, pos});\n\n    return this._getUpdatedState({\n      longitude,\n      latitude\n    });\n  }\n\n  /**\n   * End panning\n   * Must call if `panStart()` was called\n   */\n  panEnd() {\n    return this._getUpdatedState({\n      startPanLngLat: null\n    });\n  }\n\n  /**\n   * Start rotating\n   * @param {[Number, Number]} pos - position on screen where the center is\n   */\n  rotateStart({pos}) {\n    return this._getUpdatedState({\n      startBearing: this._viewportProps.bearing,\n      startPitch: this._viewportProps.pitch\n    });\n  }\n\n  /**\n   * Rotate\n   * @param {Number} deltaScaleX - a number between [-1, 1] specifying the\n   *   change to bearing.\n   * @param {Number} deltaScaleY - a number between [-1, 1] specifying the\n   *   change to pitch. -1 sets to minPitch and 1 sets to maxPitch.\n   */\n  rotate({deltaScaleX = 0, deltaScaleY = 0}) {\n    const {startBearing, startPitch} = this._interactiveState;\n\n    if (!Number.isFinite(startBearing) || !Number.isFinite(startPitch)) {\n      return this;\n    }\n\n    const {pitch, bearing} = this._calculateNewPitchAndBearing({\n      deltaScaleX,\n      deltaScaleY,\n      startBearing,\n      startPitch\n    });\n\n    return this._getUpdatedState({\n      bearing,\n      pitch\n    });\n  }\n\n  /**\n   * End rotating\n   * Must call if `rotateStart()` was called\n   */\n  rotateEnd() {\n    return this._getUpdatedState({\n      startBearing: null,\n      startPitch: null\n    });\n  }\n\n  /**\n   * Start zooming\n   * @param {[Number, Number]} pos - position on screen where the center is\n   */\n  zoomStart({pos}) {\n    return this._getUpdatedState({\n      startZoomLngLat: this._unproject(pos),\n      startZoom: this._viewportProps.zoom\n    });\n  }\n\n  /**\n   * Zoom\n   * @param {[Number, Number]} pos - position on screen where the current center is\n   * @param {[Number, Number]} startPos - the center position at\n   *   the start of the operation. Must be supplied of `zoomStart()` was not called\n   * @param {Number} scale - a number between [0, 1] specifying the accumulated\n   *   relative scale.\n   */\n  zoom({pos, startPos, scale}) {\n    // Make sure we zoom around the current mouse position rather than map center\n    let {startZoom, startZoomLngLat} = this._interactiveState;\n\n    if (!Number.isFinite(startZoom)) {\n      // We have two modes of zoom:\n      // scroll zoom that are discrete events (transform from the current zoom level),\n      // and pinch zoom that are continuous events (transform from the zoom level when\n      // pinch started).\n      // If startZoom state is defined, then use the startZoom state;\n      // otherwise assume discrete zooming\n      startZoom = this._viewportProps.zoom;\n      startZoomLngLat = this._unproject(startPos) || this._unproject(pos);\n    }\n\n    const zoom = this._calculateNewZoom({scale, startZoom});\n\n    const zoomedViewport = this.makeViewport({...this._viewportProps, zoom});\n    const [longitude, latitude] = zoomedViewport.getMapCenterByLngLatPosition({\n      lngLat: startZoomLngLat,\n      pos\n    });\n\n    return this._getUpdatedState({\n      zoom,\n      longitude,\n      latitude\n    });\n  }\n\n  /**\n   * End zooming\n   * Must call if `zoomStart()` was called\n   */\n  zoomEnd() {\n    return this._getUpdatedState({\n      startZoomLngLat: null,\n      startZoom: null\n    });\n  }\n\n  zoomIn() {\n    return this._zoomFromCenter(2);\n  }\n\n  zoomOut() {\n    return this._zoomFromCenter(0.5);\n  }\n\n  moveLeft() {\n    return this._panFromCenter([100, 0]);\n  }\n\n  moveRight() {\n    return this._panFromCenter([-100, 0]);\n  }\n\n  moveUp() {\n    return this._panFromCenter([0, 100]);\n  }\n\n  moveDown() {\n    return this._panFromCenter([0, -100]);\n  }\n\n  rotateLeft() {\n    return this._getUpdatedState({\n      bearing: this._viewportProps.bearing - 15\n    });\n  }\n\n  rotateRight() {\n    return this._getUpdatedState({\n      bearing: this._viewportProps.bearing + 15\n    });\n  }\n\n  rotateUp() {\n    return this._getUpdatedState({\n      pitch: this._viewportProps.pitch + 10\n    });\n  }\n\n  rotateDown() {\n    return this._getUpdatedState({\n      pitch: this._viewportProps.pitch - 10\n    });\n  }\n\n  shortestPathFrom(viewState) {\n    // const endViewStateProps = new this.ControllerState(endProps).shortestPathFrom(startViewstate);\n    const fromProps = viewState.getViewportProps();\n    const props = Object.assign({}, this._viewportProps);\n    const {bearing, longitude} = props;\n\n    if (Math.abs(bearing - fromProps.bearing) > 180) {\n      props.bearing = bearing < 0 ? bearing + 360 : bearing - 360;\n    }\n    if (Math.abs(longitude - fromProps.longitude) > 180) {\n      props.longitude = longitude < 0 ? longitude + 360 : longitude - 360;\n    }\n    return props;\n  }\n\n  /* Private methods */\n\n  _zoomFromCenter(scale) {\n    const {width, height} = this._viewportProps;\n    return this.zoom({\n      pos: [width / 2, height / 2],\n      scale\n    });\n  }\n\n  _panFromCenter(offset) {\n    const {width, height} = this._viewportProps;\n    return this.pan({\n      startPos: [width / 2, height / 2],\n      pos: [width / 2 + offset[0], height / 2 + offset[1]]\n    });\n  }\n\n  _getUpdatedState(newProps) {\n    // Update _viewportProps\n    return new this.constructor({\n      makeViewport: this.makeViewport,\n      ...this._viewportProps,\n      ...this._interactiveState,\n      ...newProps\n    });\n  }\n\n  // Apply any constraints (mathematical or defined by _viewportProps) to map state\n  _applyConstraints(props) {\n    // Ensure zoom is within specified range\n    const {maxZoom, minZoom, zoom} = props;\n    props.zoom = clamp(zoom, minZoom, maxZoom);\n\n    // Ensure pitch is within specified range\n    const {maxPitch, minPitch, pitch} = props;\n    props.pitch = clamp(pitch, minPitch, maxPitch);\n\n    Object.assign(props, normalizeViewportProps(props));\n\n    return props;\n  }\n\n  _unproject(pos) {\n    const viewport = this.makeViewport(this._viewportProps);\n    return pos && viewport.unproject(pos);\n  }\n\n  // Calculate a new lnglat based on pixel dragging position\n  _calculateNewLngLat({startPanLngLat, pos}) {\n    const viewport = this.makeViewport(this._viewportProps);\n    return viewport.getMapCenterByLngLatPosition({lngLat: startPanLngLat, pos});\n  }\n\n  // Calculates new zoom\n  _calculateNewZoom({scale, startZoom}) {\n    const {maxZoom, minZoom} = this._viewportProps;\n    const zoom = startZoom + Math.log2(scale);\n    return clamp(zoom, minZoom, maxZoom);\n  }\n\n  // Calculates a new pitch and bearing from a position (coming from an event)\n  _calculateNewPitchAndBearing({deltaScaleX, deltaScaleY, startBearing, startPitch}) {\n    // clamp deltaScaleY to [-1, 1] so that rotation is constrained between minPitch and maxPitch.\n    // deltaScaleX does not need to be clamped as bearing does not have constraints.\n    deltaScaleY = clamp(deltaScaleY, -1, 1);\n\n    const {minPitch, maxPitch} = this._viewportProps;\n\n    const bearing = startBearing + 180 * deltaScaleX;\n    let pitch = startPitch;\n    if (deltaScaleY > 0) {\n      // Gradually increase pitch\n      pitch = startPitch + deltaScaleY * (maxPitch - startPitch);\n    } else if (deltaScaleY < 0) {\n      // Gradually decrease pitch\n      pitch = startPitch - deltaScaleY * (minPitch - startPitch);\n    }\n\n    return {\n      pitch,\n      bearing\n    };\n  }\n}\n\nexport default class MapController extends Controller {\n  constructor(props) {\n    super(MapState, props);\n    this.invertPan = true;\n  }\n\n  _getTransitionProps() {\n    // Enables Transitions on double-tap and key-down events.\n    return LINEAR_TRANSITION_PROPS;\n  }\n\n  _onPanRotate(event) {\n    if (!this.dragRotate) {\n      return false;\n    }\n\n    const {deltaX, deltaY} = event;\n    const [, centerY] = this.getCenter(event);\n    const startY = centerY - deltaY;\n    const {width, height} = this.controllerState.getViewportProps();\n\n    const deltaScaleX = deltaX / width;\n    let deltaScaleY = 0;\n\n    if (deltaY > 0) {\n      if (Math.abs(height - startY) > PITCH_MOUSE_THRESHOLD) {\n        // Move from 0 to -1 as we drag upwards\n        deltaScaleY = (deltaY / (startY - height)) * PITCH_ACCEL;\n      }\n    } else if (deltaY < 0) {\n      if (startY > PITCH_MOUSE_THRESHOLD) {\n        // Move from 0 to 1 as we drag upwards\n        deltaScaleY = 1 - centerY / startY;\n      }\n    }\n    deltaScaleY = Math.min(1, Math.max(-1, deltaScaleY));\n\n    const newControllerState = this.controllerState.rotate({deltaScaleX, deltaScaleY});\n    return this.updateViewport(newControllerState, NO_TRANSITION_PROPS, {\n      isDragging: true,\n      isRotating: true\n    });\n  }\n}\n","import View from './view';\nimport WebMercatorViewport from '../viewports/web-mercator-viewport';\nimport MapController from '../controllers/map-controller';\n\nexport default class MapView extends View {\n  constructor(props) {\n    super(\n      Object.assign({}, props, {\n        type: WebMercatorViewport\n      })\n    );\n  }\n\n  get controller() {\n    return this._getControllerProps({\n      type: MapController\n    });\n  }\n}\n\nMapView.displayName = 'MapView';\n","const PERCENT_OR_PIXELS_REGEX = /([0-9]+\\.?[0-9]*)(%|px)/;\n\n// Takes a number or a string of formats `50%`, `33.3%` or `200px`\nexport function parsePosition(value) {\n  switch (typeof value) {\n    case 'number':\n      return {\n        position: value,\n        relative: false\n      };\n\n    case 'string':\n      const match = value.match(PERCENT_OR_PIXELS_REGEX);\n      if (match && match.length >= 3) {\n        const relative = match[2] === '%';\n        const position = parseFloat(match[1]);\n        return {\n          position: relative ? position / 100 : position,\n          relative\n        };\n      }\n    // fallthrough\n\n    default:\n      // eslint-disable-line\n      throw new Error(`Could not parse position string ${value}`);\n  }\n}\n\nexport function getPosition(position, extent) {\n  return position.relative ? Math.round(position.position * extent) : position.position;\n}\n","import Viewport from '../viewports/viewport';\nimport {parsePosition, getPosition} from '../utils/positions';\nimport {deepEqual} from '../utils/deep-equal';\nimport assert from '../utils/assert';\n\nexport default class View {\n  constructor(props = {}) {\n    const {\n      id = null,\n\n      // Window width/height in pixels (for pixel projection)\n      x = 0,\n      y = 0,\n      width = '100%',\n      height = '100%',\n\n      // Viewport Options\n      projectionMatrix = null, // Projection matrix\n      fovy = 50, // Perspective projection parameters, used if projectionMatrix not supplied\n      near = 0.1, // Distance of near clipping plane\n      far = 1000, // Distance of far clipping plane\n      modelMatrix = null, // A model matrix to be applied to position, to match the layer props API\n\n      // A View can be a wrapper for a viewport instance\n      viewportInstance = null,\n\n      // Internal: Viewport Type\n      type = Viewport // TODO - default to WebMercator?\n    } = props;\n\n    assert(!viewportInstance || viewportInstance instanceof Viewport);\n    this.viewportInstance = viewportInstance;\n\n    // Id\n    this.id = id || this.constructor.displayName || 'view';\n    this.type = type;\n\n    this.props = Object.assign({}, props, {\n      id: this.id,\n      projectionMatrix,\n      fovy,\n      near,\n      far,\n      modelMatrix\n    });\n\n    // Extents\n    this._parseDimensions({x, y, width, height});\n\n    // Bind methods for easy access\n    this.equals = this.equals.bind(this);\n\n    Object.seal(this);\n  }\n\n  equals(view) {\n    if (this === view) {\n      return true;\n    }\n\n    // if `viewportInstance` is set, it is the only prop that is used\n    // Delegate to `Viewport.equals`\n    if (this.viewportInstance) {\n      return view.viewportInstance && this.viewportInstance.equals(view.viewportInstance);\n    }\n\n    const viewChanged = deepEqual(this.props, view.props);\n\n    return viewChanged;\n  }\n\n  // Build a `Viewport` from a view descriptor\n  // TODO - add support for autosizing viewports using width and height\n  makeViewport({width, height, viewState}) {\n    if (this.viewportInstance) {\n      return this.viewportInstance;\n    }\n\n    viewState = this.filterViewState(viewState);\n\n    // Resolve relative viewport dimensions\n    const viewportDimensions = this.getDimensions({width, height});\n    const props = {...viewState, ...this.props, ...viewportDimensions};\n    return this._getViewport(props);\n  }\n\n  getViewStateId() {\n    switch (typeof this.props.viewState) {\n      case 'string':\n        // if View.viewState is a string, return it\n        return this.props.viewState;\n\n      case 'object':\n        // If it is an object, return its id component\n        return this.props.viewState && this.props.viewState.id;\n\n      default:\n        return this.id;\n    }\n  }\n\n  // Allows view to override (or completely define) viewState\n  filterViewState(viewState) {\n    if (this.props.viewState && typeof this.props.viewState === 'object') {\n      // If we have specified an id, then intent is to override,\n      // If not, completely specify the view state\n      if (!this.props.viewState.id) {\n        return this.props.viewState;\n      }\n\n      // Merge in all props from View's viewState, except id\n      const newViewState = Object.assign({}, viewState);\n      for (const key in this.props.viewState) {\n        if (key !== 'id') {\n          newViewState[key] = this.props.viewState[key];\n        }\n      }\n      return newViewState;\n    }\n\n    return viewState;\n  }\n\n  // Resolve relative viewport dimensions into actual dimensions (y='50%', width=800 => y=400)\n  getDimensions({width, height}) {\n    return {\n      x: getPosition(this._x, width),\n      y: getPosition(this._y, height),\n      width: getPosition(this._width, width),\n      height: getPosition(this._height, height)\n    };\n  }\n\n  // Used by sub classes to resolve controller props\n  _getControllerProps(defaultOpts) {\n    let opts = this.props.controller;\n\n    if (!opts) {\n      return null;\n    }\n    if (opts === true) {\n      return defaultOpts;\n    }\n    if (typeof opts === 'function') {\n      opts = {type: opts};\n    }\n    return Object.assign({}, defaultOpts, opts);\n  }\n\n  // Overridable method\n  _getViewport(props) {\n    // Get the type of the viewport\n    const {type: ViewportType} = this;\n    return new ViewportType(props);\n  }\n\n  // Parse relative viewport dimension descriptors (e.g {y: '50%', height: '50%'})\n  _parseDimensions({x, y, width, height}) {\n    this._x = parsePosition(x);\n    this._y = parsePosition(y);\n    this._width = parsePosition(width);\n    this._height = parsePosition(height);\n  }\n}\n","var map = {\n\t\"./template.sql.postgres.json\": 219,\n\t\"./template.tileset.bigquery.json\": 220\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 218;","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n// Note: The numeric values here are matched by shader code in the\n// \"project\" and \"project64\" shader modules. Both places need to be\n// updated.\nimport log from '../utils/log';\n\n// Describes the format of positions\nexport const COORDINATE_SYSTEM = {\n  // `LNGLAT` if rendering into a geospatial viewport, `CARTESIAN` otherwise\n  DEFAULT: -1,\n  // Positions are interpreted as [lng, lat, elevation]\n  // lng lat are degrees, elevation is meters. distances as meters.\n  LNGLAT: 1,\n\n  // Positions are interpreted as meter offsets, distances as meters\n  METER_OFFSETS: 2,\n\n  // Positions are interpreted as lng lat offsets: [deltaLng, deltaLat, elevation]\n  // deltaLng, deltaLat are delta degrees, elevation is meters.\n  // distances as meters.\n  LNGLAT_OFFSETS: 3,\n\n  // Non-geospatial\n  CARTESIAN: 0\n};\n\n// Deprecated\n/* eslint-disable accessor-pairs */\nObject.defineProperty(COORDINATE_SYSTEM, 'IDENTITY', {\n  get: () => log.deprecated('COORDINATE_SYSTEM.IDENTITY', 'COORDINATE_SYSTEM.CARTESIAN')() || 0\n});\n/* eslint-enable accessor-pairs */\n\n// Describes the common space\nexport const PROJECTION_MODE = {\n  WEB_MERCATOR: 1,\n  GLOBE: 2,\n\n  // This is automatically assigned by the project module\n  WEB_MERCATOR_AUTO_OFFSET: 4,\n\n  IDENTITY: 0\n};\n\nexport const EVENTS = {\n  click: {handler: 'onClick'},\n  panstart: {handler: 'onDragStart'},\n  panmove: {handler: 'onDrag'},\n  panend: {handler: 'onDragEnd'}\n};\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/**\n * Access properties of nested containers using dot-path notation\n * Returns `undefined` if any container is not valid, instead of throwing\n * @param {Object} container - container that supports get\n * @param {String|*} compositeKey - key to access, can be '.'-separated string\n * @return {*} - value in the final key of the nested container, or `undefined`\n */\nexport function get(container, compositeKey) {\n  // Split the key into subkeys\n  const keyList = getKeys(compositeKey);\n  // Recursively get the value of each key;\n  let value = container;\n  for (const key of keyList) {\n    // If any intermediate subfield is not an object, return undefined\n    value = isObject(value) ? value[key] : undefined;\n  }\n  return value;\n}\n\n/**\n * Checks if argument is an \"indexable\" object (not a primitive value, nor null)\n * @param {*} value - JavaScript value to be tested\n * @return {Boolean} - true if argument is a JavaScript object\n */\nfunction isObject(value) {\n  return value !== null && typeof value === 'object';\n}\n\n// Cache key to key arrays for speed\nconst keyMap = {};\n\n// Takes a string of '.' separated keys and returns an array of keys\n// - 'feature.geometry.type' => ['feature', 'geometry', 'type']\n// - 'feature' => ['feature']\nfunction getKeys(compositeKey) {\n  if (typeof compositeKey === 'string') {\n    // else assume string and split around dots\n    let keyList = keyMap[compositeKey];\n    if (!keyList) {\n      keyList = compositeKey.split('.');\n      keyMap[compositeKey] = keyList;\n    }\n    return keyList;\n  }\n  // Wrap in array if needed\n  return Array.isArray(compositeKey) ? compositeKey : [compositeKey];\n}\n","import {get} from '../utils/get';\n\n// expression-eval: Small jsep based expression parser that supports array and object indexing\nimport expressionEval from 'expression-eval';\n\nconst cachedExpressionMap = {\n  '-': object => object\n};\n\n// Calculates an accessor function from a JSON string\n// '-' : x => x\n// 'a.b.c': x => x.a.b.c\nexport default function parseExpressionString(propValue, configuration) {\n  // NOTE: Can be null which represents invalid function. Return null so that prop can be omitted\n  if (propValue in cachedExpressionMap) {\n    return cachedExpressionMap[propValue];\n  }\n\n  let func;\n  // Compile with expression-eval\n  const ast = expressionEval.parse(propValue);\n  if (!ast.right && !ast.left && ast.type === 'Identifier') {\n    func = row => {\n      return get(row, propValue);\n    };\n  } else {\n    // NOTE: To avoid security risks, the arguments passed to the\n    // compiled expression must only give access to pure data (no globals etc)\n    // We disable function call syntax\n    traverse(ast, node => {\n      if (node.type === 'CallExpression') {\n        throw new Error('Function calls not allowed in JSON expressions');\n      }\n    });\n    // TODO Something like `expressionEval.eval(ast, {row});` would be useful for unpacking arrays\n    func = row => {\n      return expressionEval.eval(ast, row);\n    };\n  }\n\n  // Cache the compiled function\n  cachedExpressionMap[propValue] = func;\n  return func;\n}\n\n// Helper function to search all nodes in AST returned by expressionEval\n// eslint-disable-next-line complexity\nfunction traverse(node, visitor) {\n  if (Array.isArray(node)) {\n    node.forEach(element => traverse(element, visitor));\n  } else if (node && typeof node === 'object') {\n    if (node.type) {\n      visitor(node);\n    }\n    for (const key in node) {\n      traverse(node[key], visitor);\n    }\n  }\n}\n","// Replacement for the external assert method to reduce bundle size\n// Note: We don't use the second \"message\" argument in calling code,\n// so no need to support it here\nexport default function assert(condition, message) {\n  if (!condition) {\n    throw new Error(message || 'deck.gl: assertion failed.');\n  }\n}\n","const FUNCTION_IDENTIFIER = '@@=';\nconst CONSTANT_IDENTIFIER = '@@#';\nconst TYPE_KEY = '@@type';\n\nexport {FUNCTION_IDENTIFIER, CONSTANT_IDENTIFIER, TYPE_KEY};\n","// TODO - default parsing code should not be part of the configuration.\nimport parseExpressionString from './helpers/parse-expression-string';\nimport assert from './utils/assert';\n\nimport {TYPE_KEY} from './syntactic-sugar';\n\nconst isObject = value => value && typeof value === 'object';\n\nexport default class JSONConfiguration {\n  constructor(...configurations) {\n    // Initialize config with default values\n    this.typeKey = TYPE_KEY;\n    this.log = console; // eslint-disable-line\n    this.classes = {};\n    this.reactComponents = {};\n    this.enumerations = {};\n    this.constants = {};\n    // TODO - this needs to be simpler, function conversion should be built in\n    this.convertFunction = convertFunction;\n    this.preProcessClassProps = (Class, props) => props;\n    this.postProcessConvertedJson = json => json;\n\n    for (const configuration of configurations) {\n      this.merge(configuration);\n    }\n  }\n\n  merge(configuration) {\n    for (const key in configuration) {\n      switch (key) {\n        // DEPRECATED = For backwards compatibility, add views and layers to classes;\n        case 'layers':\n        case 'views':\n          Object.assign(this.classes, configuration[key]);\n          break;\n        default:\n          // Store configuration as root fields (this.classes, ...)\n          if (key in this) {\n            const value = configuration[key];\n            this[key] = isObject(this[key]) ? Object.assign(this[key], value) : value;\n          }\n      }\n    }\n  }\n\n  validate(configuration) {\n    assert(!this.typeKey || typeof this.typeKey === 'string');\n    assert(isObject(this.classes));\n    return true;\n  }\n}\n\nfunction convertFunction(value, configuration) {\n  return parseExpressionString(value, configuration);\n}\n","import parseExpressionString from './parse-expression-string';\n\nimport {FUNCTION_IDENTIFIER} from '../syntactic-sugar';\n\nfunction hasFunctionIdentifier(value) {\n  return typeof value === 'string' && value.startsWith(FUNCTION_IDENTIFIER);\n}\n\nfunction trimFunctionIdentifier(value) {\n  return value.replace(FUNCTION_IDENTIFIER, '');\n}\n\n// Try to determine if any props are function valued\n// and if so convert their string values to functions\nexport default function convertFunctions(props, configuration) {\n  // Use deck.gl prop types if available.\n  const replacedProps = {};\n  for (const propName in props) {\n    let propValue = props[propName];\n\n    // Parse string valued expressions\n    const isFunction = hasFunctionIdentifier(propValue);\n\n    if (isFunction) {\n      // Parse string as \"expression\", return equivalent JavaScript function\n      propValue = trimFunctionIdentifier(propValue);\n      propValue = parseExpressionString(propValue, configuration);\n    }\n    replacedProps[propName] = propValue;\n  }\n\n  return replacedProps;\n}\n","import convertFunctions from './convert-functions';\n\n// This attempts to instantiate a class, either as a class or as a React component\nexport function instantiateClass(type, props, configuration) {\n  // Find the class\n  const Class = configuration.classes[type];\n  const Component = configuration.reactComponents[type];\n\n  // Check that the class is in the configuration.\n  if (!Class && !Component) {\n    const {log} = configuration; // eslint-disable-line\n    const stringProps = JSON.stringify(props, null, 0).slice(0, 40);\n    if (log) {\n      log.warn(`JSON converter: No registered class of type ${type}(${stringProps}...)  `);\n    }\n    return null;\n  }\n\n  if (Class) {\n    return instantiateJavaScriptClass(Class, props, configuration);\n  }\n\n  return instantiateReactComponent(Component, props, configuration);\n}\n\nfunction instantiateJavaScriptClass(Class, props, configuration) {\n  if (configuration.preProcessClassProps) {\n    props = configuration.preProcessClassProps(Class, props, configuration);\n  }\n  props = convertFunctions(props, configuration);\n  return new Class(props);\n}\n\nfunction instantiateReactComponent(Component, props, configuration) {\n  const {React} = configuration;\n  const {children = []} = props;\n  delete props.children;\n  if (configuration.preProcessClassProps) {\n    props = configuration.preProcessClassProps(Component, props, configuration);\n  }\n\n  props = convertFunctions(props, configuration);\n\n  return React.createElement(Component, props, children);\n}\n","// Converts JSON to props (\"hydrating\" classes, resolving enums and functions etc).\n// Lightly processes `json` props, transform string values, and extract `views` and `layers`\n// See: https://github.com/visgl/deck.gl/blob/master/dev-docs/RFCs/v6.1/json-layers-rfc.md\n//\n// NOTES:\n// * This is intended to provide minimal necessary processing required to support\n//   existing deck.gl props via JSON. This is not an implementation of alternate JSON schemas.\n// * Optionally, error checking could be applied, but ideally should leverage\n//   non-JSON specific mechanisms like prop types.\n\nimport assert from './utils/assert';\nimport JSONConfiguration from './json-configuration';\nimport {instantiateClass} from './helpers/instantiate-class';\n\nimport {FUNCTION_IDENTIFIER, CONSTANT_IDENTIFIER} from './syntactic-sugar';\nimport parseJSON from './helpers/parse-json';\n\nconst isObject = value => value && typeof value === 'object';\n\nexport default class JSONConverter {\n  constructor(props) {\n    this.log = console; // eslint-disable-line\n    this.configuration = {};\n    this.onJSONChange = () => {};\n    this.json = null;\n    this.convertedJson = null;\n    this.setProps(props);\n  }\n\n  finalize() {}\n\n  setProps(props) {\n    // HANDLE CONFIGURATION PROPS\n    if ('configuration' in props) {\n      // Accept object or `JSONConfiguration`\n      this.configuration =\n        props.configuration instanceof JSONConfiguration\n          ? props.configuration\n          : new JSONConfiguration(props.configuration);\n    }\n\n    if ('onJSONChange' in props) {\n      this.onJSONChange = props.onJSONChange;\n    }\n  }\n\n  mergeConfiguration(config) {\n    this.configuration.merge(config);\n  }\n\n  convert(json) {\n    // Use shallow equality to ensure we only convert same json once\n    if (!json || json === this.json) {\n      return this.convertedJson;\n    }\n    // Save json for shallow diffing\n    this.json = json;\n\n    // Accept JSON strings by parsing them\n    const parsedJSON = parseJSON(json);\n\n    // Convert the JSON\n    let convertedJson = convertJSON(parsedJSON, this.configuration);\n\n    convertedJson = this.configuration.postProcessConvertedJson(convertedJson);\n\n    this.convertedJson = convertedJson;\n    return convertedJson;\n  }\n\n  // DEPRECATED: Backwards compatibility\n  convertJson(json) {\n    return this.convert(json);\n  }\n}\n\nfunction convertJSON(json, configuration) {\n  // Fixup configuration\n  configuration = new JSONConfiguration(configuration);\n  return convertJSONRecursively(json, '', configuration);\n}\n\n// Converts JSON to props (\"hydrating\" classes, resolving enums and functions etc).\nfunction convertJSONRecursively(json, key, configuration) {\n  if (Array.isArray(json)) {\n    return json.map((element, i) => convertJSONRecursively(element, String(i), configuration));\n  }\n\n  // If object.type is in configuration, instantiate\n  if (isClassInstance(json, configuration)) {\n    return convertClassInstance(json, configuration);\n  }\n\n  if (isObject(json)) {\n    return convertPlainObject(json, configuration);\n  }\n\n  // Single value\n  if (typeof json === 'string') {\n    return convertString(json, key, configuration);\n  }\n\n  // Return unchanged (number, boolean, ...)\n  return json;\n}\n\n// Returns true if an object has a `type` field\nfunction isClassInstance(json, configuration) {\n  const {typeKey} = configuration;\n  const isClass = isObject(json) && Boolean(json[typeKey]);\n  return isClass;\n}\n\nfunction convertClassInstance(json, configuration) {\n  // Extract the class type field\n  const {typeKey} = configuration;\n  const type = json[typeKey];\n\n  // Prepare a props object and ensure all values have been converted\n  let props = {...json};\n  delete props[typeKey];\n\n  props = convertPlainObject(props, configuration);\n\n  return instantiateClass(type, props, configuration);\n}\n\n// Plain JS object, convert each key and return.\nfunction convertPlainObject(json, configuration) {\n  assert(isObject(json));\n\n  const result = {};\n  for (const key in json) {\n    const value = json[key];\n    result[key] = convertJSONRecursively(value, key, configuration);\n  }\n  return result;\n}\n\n// Convert one string value in an object\n// TODO - We could also support string syntax for hydrating other types, like regexps...\n// But no current use case\nfunction convertString(string, key, configuration) {\n  // Here the JSON value is supposed to be treated as a function\n  if (string.startsWith(FUNCTION_IDENTIFIER) && configuration.convertFunction) {\n    string = string.replace(FUNCTION_IDENTIFIER, '');\n    return configuration.convertFunction(string, configuration);\n  }\n  if (string.startsWith(CONSTANT_IDENTIFIER)) {\n    string = string.replace(CONSTANT_IDENTIFIER, '');\n    if (configuration.constants[string]) {\n      return configuration.constants[string];\n    }\n    // enum\n    const [enumVarName, enumValName] = string.split('.');\n    return configuration.enumerations[enumVarName][enumValName];\n  }\n  return string;\n}\n","// Accept JSON strings by parsing them\n// TODO - use a parser that provides meaninful error messages\nexport default function parseJSON(json) {\n  return typeof json === 'string' ? JSON.parse(json) : json;\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport Layer from './layer';\nimport debug from '../debug';\nimport {flatten} from '../utils/flatten';\n\nconst TRACE_RENDER_LAYERS = 'compositeLayer.renderLayers';\n\nexport default class CompositeLayer extends Layer {\n  get isComposite() {\n    return true;\n  }\n\n  get isLoaded() {\n    return super.isLoaded && this.getSubLayers().every(layer => layer.isLoaded);\n  }\n\n  getSubLayers() {\n    return (this.internalState && this.internalState.subLayers) || [];\n  }\n\n  // initializeState is usually not needed for composite layers\n  // Provide empty definition to disable check for missing definition\n  initializeState() {}\n\n  // Updates selected state members and marks the composite layer to need rerender\n  setState(updateObject) {\n    super.setState(updateObject);\n    // Trigger a layer update\n    // Although conceptually layer.draw and compositeLayer.renderLayers are equivalent,\n    // they are executed during different lifecycles.\n    // draw can be called without calling updateState (e.g. most viewport changes),\n    // while renderLayers can only be called during a recursive layer update.\n    this.setNeedsUpdate();\n  }\n\n  // called to augment the info object that is bubbled up from a sublayer\n  // override Layer.getPickingInfo() because decoding / setting uniform do\n  // not apply to a composite layer.\n  // @return null to cancel event\n  getPickingInfo({info}) {\n    const {object} = info;\n    const isDataWrapped =\n      object && object.__source && object.__source.parent && object.__source.parent.id === this.id;\n\n    if (!isDataWrapped) {\n      return info;\n    }\n\n    return Object.assign(info, {\n      // override object with picked data\n      object: object.__source.object,\n      index: object.__source.index\n    });\n  }\n\n  // Implement to generate subLayers\n  renderLayers() {\n    return null;\n  }\n\n  // Returns true if sub layer needs to be rendered\n  shouldRenderSubLayer(id, data) {\n    const {_subLayerProps: overridingProps} = this.props;\n\n    return (data && data.length) || (overridingProps && overridingProps[id]);\n  }\n\n  // Returns sub layer class for a specific sublayer\n  getSubLayerClass(id, DefaultLayerClass) {\n    const {_subLayerProps: overridingProps} = this.props;\n\n    return (\n      (overridingProps && overridingProps[id] && overridingProps[id].type) || DefaultLayerClass\n    );\n  }\n\n  // When casting user data into another format to pass to sublayers,\n  // add reference to the original object and object index\n  getSubLayerRow(row, sourceObject, sourceObjectIndex) {\n    row.__source = {\n      parent: this,\n      object: sourceObject,\n      index: sourceObjectIndex\n    };\n    return row;\n  }\n\n  // Some composite layers cast user data into another format before passing to sublayers\n  // We need to unwrap them before calling the accessor so that they see the original data\n  // objects\n  getSubLayerAccessor(accessor) {\n    if (typeof accessor === 'function') {\n      const objectInfo = {\n        data: this.props.data,\n        target: []\n      };\n      return (x, i) => {\n        if (x.__source) {\n          objectInfo.index = x.__source.index;\n          return accessor(x.__source.object, objectInfo);\n        }\n        return accessor(x, i);\n      };\n    }\n    return accessor;\n  }\n\n  // Returns sub layer props for a specific sublayer\n  getSubLayerProps(sublayerProps = {}) {\n    const {\n      opacity,\n      pickable,\n      visible,\n      parameters,\n      getPolygonOffset,\n      highlightedObjectIndex,\n      autoHighlight,\n      highlightColor,\n      coordinateSystem,\n      coordinateOrigin,\n      wrapLongitude,\n      positionFormat,\n      modelMatrix,\n      extensions,\n      _subLayerProps: overridingProps\n    } = this.props;\n    const newProps = {\n      opacity,\n      pickable,\n      visible,\n      parameters,\n      getPolygonOffset,\n      highlightedObjectIndex,\n      autoHighlight,\n      highlightColor,\n      coordinateSystem,\n      coordinateOrigin,\n      wrapLongitude,\n      positionFormat,\n      modelMatrix,\n      extensions\n    };\n\n    const overridingSublayerProps = overridingProps && overridingProps[sublayerProps.id];\n    const overridingSublayerTriggers =\n      overridingSublayerProps && overridingSublayerProps.updateTriggers;\n    const sublayerId = sublayerProps.id || 'sublayer';\n\n    if (overridingSublayerProps) {\n      const propTypes = this.constructor._propTypes;\n      for (const key in overridingSublayerProps) {\n        const propType = propTypes[key];\n        // eslint-disable-next-line\n        if (propType && propType.type === 'accessor') {\n          overridingSublayerProps[key] = this.getSubLayerAccessor(overridingSublayerProps[key]);\n        }\n      }\n    }\n\n    Object.assign(\n      newProps,\n      sublayerProps,\n      // experimental feature that allows users to override sublayer props via parent layer prop\n      overridingSublayerProps,\n      {\n        id: `${this.props.id}-${sublayerId}`,\n        updateTriggers: Object.assign(\n          {\n            all: this.props.updateTriggers.all\n          },\n          sublayerProps.updateTriggers,\n          overridingSublayerTriggers\n        )\n      }\n    );\n\n    // Pass through extension props\n    for (const extension of extensions) {\n      const passThroughProps = extension.getSubLayerProps.call(this, extension);\n      if (passThroughProps) {\n        Object.assign(newProps, passThroughProps, {\n          updateTriggers: Object.assign(newProps.updateTriggers, passThroughProps.updateTriggers)\n        });\n      }\n    }\n\n    return newProps;\n  }\n\n  _getAttributeManager() {\n    return null;\n  }\n\n  // Called by layer manager to render subLayers\n  _renderLayers() {\n    let {subLayers} = this.internalState;\n    const shouldUpdate = !subLayers || this.needsUpdate();\n    if (shouldUpdate) {\n      subLayers = this.renderLayers();\n      // Flatten the returned array, removing any null, undefined or false\n      // this allows layers to render sublayers conditionally\n      // (see CompositeLayer.renderLayers docs)\n      subLayers = flatten(subLayers, Boolean);\n      this.internalState.subLayers = subLayers;\n    }\n    debug(TRACE_RENDER_LAYERS, this, shouldUpdate, subLayers);\n\n    // populate reference to parent layer (this layer)\n    // NOTE: needs to be done even when reusing layers as the parent may have changed\n    for (const layer of subLayers) {\n      layer.parent = this;\n    }\n  }\n}\n\nCompositeLayer.layerName = 'CompositeLayer';\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport {Layer, project32, picking} from '@deck.gl/core';\nimport GL from '@luma.gl/constants';\nimport {Model, Geometry} from '@luma.gl/core';\n\nimport vs from './scatterplot-layer-vertex.glsl';\nimport fs from './scatterplot-layer-fragment.glsl';\n\nconst DEFAULT_COLOR = [0, 0, 0, 255];\n\nconst defaultProps = {\n  radiusUnits: 'meters',\n  radiusScale: {type: 'number', min: 0, value: 1},\n  radiusMinPixels: {type: 'number', min: 0, value: 0}, //  min point radius in pixels\n  radiusMaxPixels: {type: 'number', min: 0, value: Number.MAX_SAFE_INTEGER}, // max point radius in pixels\n\n  lineWidthUnits: 'meters',\n  lineWidthScale: {type: 'number', min: 0, value: 1},\n  lineWidthMinPixels: {type: 'number', min: 0, value: 0},\n  lineWidthMaxPixels: {type: 'number', min: 0, value: Number.MAX_SAFE_INTEGER},\n\n  stroked: false,\n  filled: true,\n\n  getPosition: {type: 'accessor', value: x => x.position},\n  getRadius: {type: 'accessor', value: 1},\n  getFillColor: {type: 'accessor', value: DEFAULT_COLOR},\n  getLineColor: {type: 'accessor', value: DEFAULT_COLOR},\n  getLineWidth: {type: 'accessor', value: 1},\n\n  // deprecated\n  strokeWidth: {deprecatedFor: 'getLineWidth'},\n  outline: {deprecatedFor: 'stroked'},\n  getColor: {deprecatedFor: ['getFillColor', 'getLineColor']}\n};\n\nexport default class ScatterplotLayer extends Layer {\n  getShaders(id) {\n    return super.getShaders({vs, fs, modules: [project32, picking]});\n  }\n\n  initializeState() {\n    this.getAttributeManager().addInstanced({\n      instancePositions: {\n        size: 3,\n        type: GL.DOUBLE,\n        fp64: this.use64bitPositions(),\n        transition: true,\n        accessor: 'getPosition'\n      },\n      instanceRadius: {\n        size: 1,\n        transition: true,\n        accessor: 'getRadius',\n        defaultValue: 1\n      },\n      instanceFillColors: {\n        size: this.props.colorFormat.length,\n        transition: true,\n        normalized: true,\n        type: GL.UNSIGNED_BYTE,\n        accessor: 'getFillColor',\n        defaultValue: [0, 0, 0, 255]\n      },\n      instanceLineColors: {\n        size: this.props.colorFormat.length,\n        transition: true,\n        normalized: true,\n        type: GL.UNSIGNED_BYTE,\n        accessor: 'getLineColor',\n        defaultValue: [0, 0, 0, 255]\n      },\n      instanceLineWidths: {\n        size: 1,\n        transition: true,\n        accessor: 'getLineWidth',\n        defaultValue: 1\n      }\n    });\n  }\n\n  updateState({props, oldProps, changeFlags}) {\n    super.updateState({props, oldProps, changeFlags});\n    if (changeFlags.extensionsChanged) {\n      const {gl} = this.context;\n      if (this.state.model) {\n        this.state.model.delete();\n      }\n      this.setState({model: this._getModel(gl)});\n      this.getAttributeManager().invalidateAll();\n    }\n  }\n\n  draw({uniforms}) {\n    const {viewport} = this.context;\n    const {\n      radiusUnits,\n      radiusScale,\n      radiusMinPixels,\n      radiusMaxPixels,\n      stroked,\n      filled,\n      lineWidthUnits,\n      lineWidthScale,\n      lineWidthMinPixels,\n      lineWidthMaxPixels\n    } = this.props;\n\n    const pointRadiusMultiplier = radiusUnits === 'pixels' ? viewport.metersPerPixel : 1;\n    const lineWidthMultiplier = lineWidthUnits === 'pixels' ? viewport.metersPerPixel : 1;\n\n    this.state.model\n      .setUniforms(uniforms)\n      .setUniforms({\n        stroked: stroked ? 1 : 0,\n        filled,\n        radiusScale: radiusScale * pointRadiusMultiplier,\n        radiusMinPixels,\n        radiusMaxPixels,\n        lineWidthScale: lineWidthScale * lineWidthMultiplier,\n        lineWidthMinPixels,\n        lineWidthMaxPixels\n      })\n      .draw();\n  }\n\n  _getModel(gl) {\n    // a square that minimally cover the unit circle\n    const positions = [-1, -1, 0, 1, -1, 0, 1, 1, 0, -1, 1, 0];\n\n    return new Model(\n      gl,\n      Object.assign(this.getShaders(), {\n        id: this.props.id,\n        geometry: new Geometry({\n          drawMode: GL.TRIANGLE_FAN,\n          vertexCount: 4,\n          attributes: {\n            positions: {size: 3, value: new Float32Array(positions)}\n          }\n        }),\n        isInstanced: true\n      })\n    );\n  }\n}\n\nScatterplotLayer.layerName = 'ScatterplotLayer';\nScatterplotLayer.defaultProps = defaultProps;\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nexport default `\\\n#define SHADER_NAME scatterplot-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceRadius;\nattribute float instanceLineWidths;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusScale;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float lineWidthScale;\nuniform float lineWidthMinPixels;\nuniform float lineWidthMaxPixels;\nuniform float stroked;\nuniform bool filled;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\nvarying float outerRadiusPixels;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n\n  // Multiply out radius and clamp to limits\n  outerRadiusPixels = clamp(\n    project_size_to_pixel(radiusScale * instanceRadius),\n    radiusMinPixels, radiusMaxPixels\n  );\n  \n  // Multiply out line width and clamp to limits\n  float lineWidthPixels = clamp(\n    project_size_to_pixel(lineWidthScale * instanceLineWidths),\n    lineWidthMinPixels, lineWidthMaxPixels\n  );\n\n  // outer radius needs to offset by half stroke width\n  outerRadiusPixels += stroked * lineWidthPixels / 2.0;\n\n  // position on the containing square in [-1, 1] space\n  unitPosition = positions.xy;\n  geometry.uv = unitPosition;\n  geometry.pickingColor = instancePickingColors;\n\n  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;\n  \n  vec3 offset = positions * project_pixel_size(outerRadiusPixels);\n  DECKGL_FILTER_SIZE(offset, geometry);\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  // Apply opacity to instance color, or return instance picking color\n  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);\n  DECKGL_FILTER_COLOR(vFillColor, geometry);\n  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);\n  DECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n`;\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nexport default `\\\n#define SHADER_NAME scatterplot-layer-fragment-shader\n\nprecision highp float;\n\nuniform bool filled;\nuniform float stroked;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\nvarying float outerRadiusPixels;\n\nvoid main(void) {\n  geometry.uv = unitPosition;\n\n  float distToCenter = length(unitPosition) * outerRadiusPixels;\n  float inCircle = smoothedge(distToCenter, outerRadiusPixels);\n\n  if (inCircle == 0.0) {\n    discard;\n  }\n\n  if (stroked > 0.5) {\n    float isLine = smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter);\n    if (filled) {\n      gl_FragColor = mix(vFillColor, vLineColor, isLine);\n    } else {\n      if (isLine == 0.0) {\n        discard;\n      }\n      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);\n    }\n  } else if (filled) {\n    gl_FragColor = vFillColor;\n  } else {\n    discard;\n  }\n\n  gl_FragColor.a *= inCircle;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n`;\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport {createIterable, getAccessorFromBuffer} from './iterable-utils';\nimport defaultTypedArrayManager from './typed-array-manager';\nimport assert from './assert';\n\nimport {Buffer} from '@luma.gl/core';\n\nexport default class Tesselator {\n  constructor(opts = {}) {\n    const {attributes = {}} = opts;\n\n    this.typedArrayManager = defaultTypedArrayManager;\n    this.indexStarts = null;\n    this.vertexStarts = null;\n    this.vertexCount = 0;\n    this.instanceCount = 0;\n    this.attributes = {};\n    this._attributeDefs = attributes;\n    this.opts = opts;\n\n    this.updateGeometry(opts);\n\n    Object.seal(this);\n  }\n\n  /* Public methods */\n  updateGeometry(opts) {\n    Object.assign(this.opts, opts);\n    const {\n      data,\n      buffers = {},\n      getGeometry,\n      geometryBuffer,\n      positionFormat,\n      dataChanged,\n      normalize = true\n    } = this.opts;\n    this.data = data;\n    this.getGeometry = getGeometry;\n    this.positionSize =\n      (geometryBuffer && geometryBuffer.size) || (positionFormat === 'XY' ? 2 : 3);\n    this.buffers = buffers;\n    this.normalize = normalize;\n\n    // Handle external logical value\n    if (geometryBuffer) {\n      assert(data.startIndices, 'binary data missing startIndices');\n      this.getGeometry = this.getGeometryFromBuffer(geometryBuffer);\n\n      if (!normalize) {\n        // skip packing and set attribute value directly\n        // TODO - avoid mutating user-provided object\n        buffers.positions = geometryBuffer;\n      }\n    }\n    this.geometryBuffer = buffers.positions;\n\n    if (Array.isArray(dataChanged)) {\n      // is partial update\n      for (const dataRange of dataChanged) {\n        this._rebuildGeometry(dataRange);\n      }\n    } else {\n      this._rebuildGeometry();\n    }\n  }\n\n  updatePartialGeometry({startRow, endRow}) {\n    this._rebuildGeometry({startRow, endRow});\n  }\n\n  /* Subclass interface */\n  normalizeGeometry(geometry) {\n    return geometry;\n  }\n\n  // Update the positions of a single geometry\n  updateGeometryAttributes(geometry, startIndex, size) {\n    throw new Error('Not implemented');\n  }\n\n  // Returns the number of vertices in a geometry\n  getGeometrySize(geometry) {\n    throw new Error('Not implemented');\n  }\n\n  getGeometryFromBuffer(geometryBuffer) {\n    const value = geometryBuffer.value || geometryBuffer;\n    assert(ArrayBuffer.isView(value), 'cannot read geometries');\n\n    return getAccessorFromBuffer(value, {\n      size: this.positionSize,\n      offset: geometryBuffer.offset,\n      stride: geometryBuffer.stride,\n      startIndices: this.data.startIndices\n    });\n  }\n\n  /* Private utility methods */\n  _allocate(instanceCount, copy) {\n    // allocate attributes\n    const {attributes, buffers, _attributeDefs, typedArrayManager} = this;\n    for (const name in _attributeDefs) {\n      if (name in buffers) {\n        // Use external buffer\n        typedArrayManager.release(attributes[name]);\n        attributes[name] = null;\n      } else {\n        const def = _attributeDefs[name];\n        // If dataRange is supplied, this is a partial update.\n        // In case we need to reallocate the typed array, it will need the old values copied\n        // before performing partial update.\n        def.copy = copy;\n\n        attributes[name] = typedArrayManager.allocate(attributes[name], instanceCount, def);\n      }\n    }\n  }\n\n  /**\n   * Visit all objects\n   * `data` is expected to be an iterable consistent with the base Layer expectation\n   */\n  _forEachGeometry(visitor, startRow, endRow) {\n    const {data, getGeometry} = this;\n    const {iterable, objectInfo} = createIterable(data, startRow, endRow);\n    for (const object of iterable) {\n      objectInfo.index++;\n      const geometry = getGeometry(object, objectInfo);\n      visitor(geometry, objectInfo.index);\n    }\n  }\n\n  /* eslint-disable complexity,max-statements */\n  _rebuildGeometry(dataRange) {\n    if (!this.data || !this.getGeometry) {\n      return;\n    }\n\n    let {indexStarts, vertexStarts, instanceCount} = this;\n    const {data, geometryBuffer} = this;\n    const {startRow = 0, endRow = Infinity} = dataRange || {};\n\n    const normalizedData = {};\n\n    if (!dataRange) {\n      // Full update - regenerate buffer layout from scratch\n      indexStarts = [0];\n      vertexStarts = [0];\n    }\n    if (this.normalize || !geometryBuffer) {\n      this._forEachGeometry(\n        (geometry, dataIndex) => {\n          geometry = this.normalizeGeometry(geometry);\n          normalizedData[dataIndex] = geometry;\n          vertexStarts[dataIndex + 1] = vertexStarts[dataIndex] + this.getGeometrySize(geometry);\n        },\n        startRow,\n        endRow\n      );\n      // count instances\n      instanceCount = vertexStarts[vertexStarts.length - 1];\n    } else if (geometryBuffer.buffer instanceof Buffer) {\n      const byteStride = geometryBuffer.stride || this.positionSize * 4;\n      // assume user provided data is already normalized\n      vertexStarts = data.startIndices;\n      instanceCount = vertexStarts[data.length] || geometryBuffer.buffer.byteLength / byteStride;\n    } else {\n      const bufferValue = geometryBuffer.value || geometryBuffer;\n      const elementStride =\n        geometryBuffer.stride / bufferValue.BYTES_PER_ELEMENT || this.positionSize;\n      // assume user provided data is already normalized\n      vertexStarts = data.startIndices;\n      instanceCount = vertexStarts[data.length] || bufferValue.length / elementStride;\n    }\n\n    // allocate attributes\n    this._allocate(instanceCount, Boolean(dataRange));\n\n    this.indexStarts = indexStarts;\n    this.vertexStarts = vertexStarts;\n    this.instanceCount = instanceCount;\n\n    const context = {};\n\n    this._forEachGeometry(\n      (geometry, dataIndex) => {\n        geometry = normalizedData[dataIndex] || geometry;\n        context.vertexStart = vertexStarts[dataIndex];\n        context.indexStart = indexStarts[dataIndex];\n        const vertexEnd =\n          dataIndex < vertexStarts.length - 1 ? vertexStarts[dataIndex + 1] : instanceCount;\n        context.geometrySize = vertexEnd - vertexStarts[dataIndex];\n        context.geometryIndex = dataIndex;\n        this.updateGeometryAttributes(geometry, context);\n      },\n      startRow,\n      endRow\n    );\n\n    this.vertexCount = indexStarts[indexStarts.length - 1];\n  }\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport {Tesselator} from '@deck.gl/core';\nimport {normalizePath} from './path';\n\nconst START_CAP = 1;\nconst END_CAP = 2;\nconst INVALID = 4;\n\n// This class is set up to allow querying one attribute at a time\n// the way the AttributeManager expects it\nexport default class PathTesselator extends Tesselator {\n  constructor(opts) {\n    super({\n      ...opts,\n      attributes: {\n        // Padding covers shaderAttributes for last segment in largest case fp64\n        // additional vertex + hi & low parts, 3 * 6\n        positions: {\n          size: 3,\n          padding: 18,\n          initialize: true,\n          type: opts.fp64 ? Float64Array : Float32Array\n        },\n        segmentTypes: {size: 1, type: Uint8ClampedArray}\n      }\n    });\n  }\n\n  getGeometryFromBuffer(buffer) {\n    if (this.normalize) {\n      return super.getGeometryFromBuffer(buffer);\n    }\n    // we don't need to read the positions if no normalization\n    return () => null;\n  }\n\n  normalizeGeometry(path) {\n    if (this.normalize) {\n      return normalizePath(path, this.positionSize, this.opts.resolution, this.opts.wrapLongitude);\n    }\n    return path;\n  }\n\n  /* Getters */\n  get(attributeName) {\n    return this.attributes[attributeName];\n  }\n\n  /* Implement base Tesselator interface */\n  getGeometrySize(path) {\n    if (Array.isArray(path[0])) {\n      let size = 0;\n      for (const subPath of path) {\n        size += this.getGeometrySize(subPath);\n      }\n      return size;\n    }\n    const numPoints = this.getPathLength(path);\n    if (numPoints < 2) {\n      // invalid path\n      return 0;\n    }\n    if (this.isClosed(path)) {\n      // minimum 3 vertices\n      return numPoints < 3 ? 0 : numPoints + 2;\n    }\n    return numPoints;\n  }\n\n  updateGeometryAttributes(path, context) {\n    if (context.geometrySize === 0) {\n      return;\n    }\n    if (path && Array.isArray(path[0])) {\n      for (const subPath of path) {\n        const geometrySize = this.getGeometrySize(subPath);\n        context.geometrySize = geometrySize;\n        this.updateGeometryAttributes(subPath, context);\n        context.vertexStart += geometrySize;\n      }\n    } else {\n      this._updateSegmentTypes(path, context);\n      this._updatePositions(path, context);\n    }\n  }\n\n  _updateSegmentTypes(path, context) {\n    const {segmentTypes} = this.attributes;\n    const isPathClosed = this.isClosed(path);\n    const {vertexStart, geometrySize} = context;\n\n    // positions   --  A0 A1 B0 B1 B2 B3 B0 B1 B2 --\n    // segmentTypes     3  4  4  0  0  0  0  4  4\n    segmentTypes.fill(0, vertexStart, vertexStart + geometrySize);\n    if (isPathClosed) {\n      segmentTypes[vertexStart] = INVALID;\n      segmentTypes[vertexStart + geometrySize - 2] = INVALID;\n    } else {\n      segmentTypes[vertexStart] += START_CAP;\n      segmentTypes[vertexStart + geometrySize - 2] += END_CAP;\n    }\n    segmentTypes[vertexStart + geometrySize - 1] = INVALID;\n  }\n\n  _updatePositions(path, context) {\n    const {positions} = this.attributes;\n    if (!positions) {\n      return;\n    }\n    const {vertexStart, geometrySize} = context;\n    const p = new Array(3);\n\n    // positions   --  A0 A1 B0 B1 B2 B3 B0 B1 B2 --\n    // segmentTypes     3  4  4  0  0  0  0  4  4\n    for (let i = vertexStart, ptIndex = 0; ptIndex < geometrySize; i++, ptIndex++) {\n      this.getPointOnPath(path, ptIndex, p);\n      positions[i * 3] = p[0];\n      positions[i * 3 + 1] = p[1];\n      positions[i * 3 + 2] = p[2];\n    }\n  }\n\n  /* Utilities */\n  // Returns the number of points in the path\n  getPathLength(path) {\n    return path.length / this.positionSize;\n  }\n\n  // Returns a point on the path at the specified index\n  getPointOnPath(path, index, target = []) {\n    const {positionSize} = this;\n    if (index * positionSize >= path.length) {\n      // loop\n      index += 1 - path.length / positionSize;\n    }\n    const i = index * positionSize;\n    target[0] = path[i];\n    target[1] = path[i + 1];\n    target[2] = (positionSize === 3 && path[i + 2]) || 0;\n    return target;\n  }\n\n  // Returns true if the first and last points are identical\n  isClosed(path) {\n    if (!this.normalize) {\n      return this.opts.loop;\n    }\n    const {positionSize} = this;\n    const lastPointIndex = path.length - positionSize;\n    return (\n      path[0] === path[lastPointIndex] &&\n      path[1] === path[lastPointIndex + 1] &&\n      (positionSize === 2 || path[2] === path[lastPointIndex + 2])\n    );\n  }\n}\n","import {cutPolylineByGrid, cutPolylineByMercatorBounds} from '@math.gl/polygon';\n\n/** Returns a flat array of path positions\n * Flattens a nested path object\n * Cut the feature if needed (globe projection, wrap longitude, etc.)\n */\nexport function normalizePath(path, size, gridResolution, wrapLongitude) {\n  let flatPath = path;\n  if (Array.isArray(path[0])) {\n    const length = path.length * size;\n    flatPath = new Array(length);\n    for (let i = 0; i < path.length; i++) {\n      for (let j = 0; j < size; j++) {\n        flatPath[i * size + j] = path[i][j] || 0;\n      }\n    }\n  }\n  if (gridResolution) {\n    return cutPolylineByGrid(flatPath, {size, gridResolution});\n  }\n  if (wrapLongitude) {\n    return cutPolylineByMercatorBounds(flatPath, {size});\n  }\n  return flatPath;\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport {Layer, project32, picking, log} from '@deck.gl/core';\nimport GL from '@luma.gl/constants';\nimport {Model, Geometry} from '@luma.gl/core';\n\nimport PathTesselator from './path-tesselator';\n\nimport vs from './path-layer-vertex.glsl';\nimport fs from './path-layer-fragment.glsl';\n\nconst DEFAULT_COLOR = [0, 0, 0, 255];\n\nconst defaultProps = {\n  widthUnits: 'meters',\n  widthScale: {type: 'number', min: 0, value: 1}, // stroke width in meters\n  widthMinPixels: {type: 'number', min: 0, value: 0}, //  min stroke width in pixels\n  widthMaxPixels: {type: 'number', min: 0, value: Number.MAX_SAFE_INTEGER}, // max stroke width in pixels\n  rounded: false,\n  miterLimit: {type: 'number', min: 0, value: 4},\n  billboard: false,\n  // `loop` or `open`\n  _pathType: null,\n\n  getPath: {type: 'accessor', value: object => object.path},\n  getColor: {type: 'accessor', value: DEFAULT_COLOR},\n  getWidth: {type: 'accessor', value: 1}\n};\n\nconst ATTRIBUTE_TRANSITION = {\n  enter: (value, chunk) => {\n    return chunk.length ? chunk.subarray(chunk.length - value.length) : value;\n  }\n};\n\nexport default class PathLayer extends Layer {\n  getShaders() {\n    return super.getShaders({vs, fs, modules: [project32, picking]}); // 'project' module added by default.\n  }\n\n  get wrapLongitude() {\n    return false;\n  }\n\n  initializeState() {\n    const noAlloc = true;\n    const attributeManager = this.getAttributeManager();\n    /* eslint-disable max-len */\n    attributeManager.addInstanced({\n      positions: {\n        size: 3,\n        // Start filling buffer from 1 vertex in\n        vertexOffset: 1,\n        type: GL.DOUBLE,\n        fp64: this.use64bitPositions(),\n        transition: ATTRIBUTE_TRANSITION,\n        accessor: 'getPath',\n        update: this.calculatePositions,\n        noAlloc,\n        shaderAttributes: {\n          instanceLeftPositions: {\n            vertexOffset: 0\n          },\n          instanceStartPositions: {\n            vertexOffset: 1\n          },\n          instanceEndPositions: {\n            vertexOffset: 2\n          },\n          instanceRightPositions: {\n            vertexOffset: 3\n          }\n        }\n      },\n      instanceTypes: {\n        size: 1,\n        type: GL.UNSIGNED_BYTE,\n        update: this.calculateSegmentTypes,\n        noAlloc\n      },\n      instanceStrokeWidths: {\n        size: 1,\n        accessor: 'getWidth',\n        transition: ATTRIBUTE_TRANSITION,\n        defaultValue: 1\n      },\n      instanceColors: {\n        size: this.props.colorFormat.length,\n        type: GL.UNSIGNED_BYTE,\n        normalized: true,\n        accessor: 'getColor',\n        transition: ATTRIBUTE_TRANSITION,\n        defaultValue: DEFAULT_COLOR\n      },\n      instancePickingColors: {\n        size: 3,\n        type: GL.UNSIGNED_BYTE,\n        accessor: (object, {index, target: value}) =>\n          this.encodePickingColor(object && object.__source ? object.__source.index : index, value)\n      }\n    });\n    /* eslint-enable max-len */\n\n    this.setState({\n      pathTesselator: new PathTesselator({\n        fp64: this.use64bitPositions()\n      })\n    });\n\n    if (this.props.getDashArray && !this.props.extensions.length) {\n      log.removed('getDashArray', 'PathStyleExtension')();\n    }\n  }\n\n  updateState({oldProps, props, changeFlags}) {\n    super.updateState({props, oldProps, changeFlags});\n\n    const attributeManager = this.getAttributeManager();\n\n    const geometryChanged =\n      changeFlags.dataChanged ||\n      (changeFlags.updateTriggersChanged &&\n        (changeFlags.updateTriggersChanged.all || changeFlags.updateTriggersChanged.getPath));\n\n    if (geometryChanged) {\n      const {pathTesselator} = this.state;\n      const buffers = props.data.attributes || {};\n\n      pathTesselator.updateGeometry({\n        data: props.data,\n        geometryBuffer: buffers.getPath,\n        buffers,\n        normalize: !props._pathType,\n        loop: props._pathType === 'loop',\n        getGeometry: props.getPath,\n        positionFormat: props.positionFormat,\n        wrapLongitude: props.wrapLongitude,\n        // TODO - move the flag out of the viewport\n        resolution: this.context.viewport.resolution,\n        dataChanged: changeFlags.dataChanged\n      });\n      this.setState({\n        numInstances: pathTesselator.instanceCount,\n        startIndices: pathTesselator.vertexStarts\n      });\n      if (!changeFlags.dataChanged) {\n        // Base `layer.updateState` only invalidates all attributes on data change\n        // Cover the rest of the scenarios here\n        attributeManager.invalidateAll();\n      }\n    }\n\n    if (changeFlags.extensionsChanged) {\n      const {gl} = this.context;\n      if (this.state.model) {\n        this.state.model.delete();\n      }\n      this.setState({model: this._getModel(gl)});\n      attributeManager.invalidateAll();\n    }\n  }\n\n  getPickingInfo(params) {\n    const info = super.getPickingInfo(params);\n    const {index} = info;\n    const {data} = this.props;\n\n    if (data[0] && data[0].__source) {\n      // data is wrapped\n      info.object = data.find(d => d.__source.index === index);\n    }\n    return info;\n  }\n\n  draw({uniforms}) {\n    const {viewport} = this.context;\n    const {\n      rounded,\n      billboard,\n      miterLimit,\n      widthUnits,\n      widthScale,\n      widthMinPixels,\n      widthMaxPixels\n    } = this.props;\n\n    const widthMultiplier = widthUnits === 'pixels' ? viewport.metersPerPixel : 1;\n\n    this.state.model\n      .setUniforms(\n        Object.assign({}, uniforms, {\n          jointType: Number(rounded),\n          billboard,\n          widthScale: widthScale * widthMultiplier,\n          miterLimit,\n          widthMinPixels,\n          widthMaxPixels\n        })\n      )\n      .draw();\n  }\n\n  _getModel(gl) {\n    /*\n     *       _\n     *        \"-_ 1                   3                       5\n     *     _     \"o---------------------o-------------------_-o\n     *       -   / \"\"--..__              '.             _.-' /\n     *   _     \"@- - - - - \"\"--..__- - - - x - - - -_.@'    /\n     *    \"-_  /                   \"\"--..__ '.  _,-` :     /\n     *       \"o----------------------------\"\"-o'    :     /\n     *      0,2                            4 / '.  :     /\n     *                                      /   '.:     /\n     *                                     /     :'.   /\n     *                                    /     :  ', /\n     *                                   /     :     o\n     */\n\n    // prettier-ignore\n    const SEGMENT_INDICES = [\n      // start corner\n      0, 1, 2,\n      // body\n      1, 4, 2,\n      1, 3, 4,\n      // end corner\n      3, 5, 4\n    ];\n\n    // [0] position on segment - 0: start, 1: end\n    // [1] side of path - -1: left, 0: center (joint), 1: right\n    // prettier-ignore\n    const SEGMENT_POSITIONS = [\n      // bevel start corner\n      0, 0,\n      // start inner corner\n      0, -1,\n      // start outer corner\n      0, 1,\n      // end inner corner\n      1, -1,\n      // end outer corner\n      1, 1,\n      // bevel end corner\n      1, 0\n    ];\n\n    return new Model(\n      gl,\n      Object.assign({}, this.getShaders(), {\n        id: this.props.id,\n        geometry: new Geometry({\n          drawMode: GL.TRIANGLES,\n          attributes: {\n            indices: new Uint16Array(SEGMENT_INDICES),\n            positions: {value: new Float32Array(SEGMENT_POSITIONS), size: 2}\n          }\n        }),\n        isInstanced: true\n      })\n    );\n  }\n\n  calculatePositions(attribute) {\n    const {pathTesselator} = this.state;\n\n    attribute.startIndices = pathTesselator.vertexStarts;\n    attribute.value = pathTesselator.get('positions');\n  }\n\n  calculateSegmentTypes(attribute) {\n    const {pathTesselator} = this.state;\n\n    attribute.startIndices = pathTesselator.vertexStarts;\n    attribute.value = pathTesselator.get('segmentTypes');\n  }\n}\n\nPathLayer.layerName = 'PathLayer';\nPathLayer.defaultProps = defaultProps;\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nexport default `\\\n#define SHADER_NAME path-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute float instanceTypes;\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec3 instanceLeftPositions;\nattribute vec3 instanceRightPositions;\nattribute vec3 instanceLeftPositions64Low;\nattribute vec3 instanceStartPositions64Low;\nattribute vec3 instanceEndPositions64Low;\nattribute vec3 instanceRightPositions64Low;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float miterLimit;\nuniform bool billboard;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\n\nconst float EPSILON = 0.001;\nconst vec3 ZERO_OFFSET = vec3(0.0);\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\n\n// calculate line join positions\nvec3 lineJoin(\n  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,\n  vec2 width\n) {\n  bool isEnd = positions.x > 0.0;\n  // side of the segment - -1: left, 0: center, 1: right\n  float sideOfPath = positions.y;\n  float isJoint = float(sideOfPath == 0.0);\n\n  vec3 deltaA3 = (currPoint - prevPoint);\n  vec3 deltaB3 = (nextPoint - currPoint);\n\n  mat3 rotationMatrix;\n  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);\n  if (needsRotation) {\n    deltaA3 = deltaA3 * rotationMatrix;\n    deltaB3 = deltaB3 * rotationMatrix;\n  }\n  vec2 deltaA = deltaA3.xy / width;\n  vec2 deltaB = deltaB3.xy / width;\n\n  float lenA = length(deltaA);\n  float lenB = length(deltaB);\n\n  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n\n  // tangent of the corner\n  vec2 tangent = dirA + dirB;\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  // direction of the corner\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  // direction of the segment\n  vec2 dir = isEnd ? dirA : dirB;\n  // direction of the extrusion\n  vec2 perp = isEnd ? perpA : perpB;\n  // length of the segment\n  float L = isEnd ? lenA : lenB;\n\n  // A = angle of the corner\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n\n  // -1: right, 1: left\n  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);\n\n  // relative position to the corner:\n  // -1: inside (smaller side of the angle)\n  // 0: center\n  // 1: outside (bigger side of the angle)\n  float cornerPosition = sideOfPath * turnDirection;\n\n  float miterSize = 1.0 / max(sinHalfA, EPSILON);\n  // trim if inside corner extends further than the line segment\n  miterSize = mix(\n    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),\n    miterSize,\n    step(0.0, cornerPosition)\n  );\n\n  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))\n    * (sideOfPath + isJoint * turnDirection);\n\n  // special treatment for start cap and end cap\n  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));\n  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));\n  bool isCap = isStartCap || isEndCap;\n\n  // extend out a triangle to envelope the round cap\n  if (isCap) {\n    offsetVec = mix(perp * sideOfPath, dir * jointType * 4.0 * flipIfTrue(isStartCap), isJoint);\n  }\n\n  // Generate variables for fragment shader\n  vPathLength = L;\n  vCornerOffset = offsetVec;\n  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);\n  vMiterLength = isCap ? isJoint : vMiterLength;\n\n  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);\n  vPathPosition = vec2(\n    dot(offsetFromStartOfPath, perp),\n    dot(offsetFromStartOfPath, dir)\n  );\n  geometry.uv = vPathPosition;\n\n  float isValid = step(instanceTypes, 3.5);\n  vec3 offset = vec3(offsetVec * width * isValid, 0.0);\n\n  if (needsRotation) {\n    offset = rotationMatrix * offset;\n  }\n  return currPoint + offset;\n}\n\n// In clipspace extrusion, if a line extends behind the camera, clip it to avoid visual artifacts\nvoid clipLine(inout vec4 position, vec4 refPosition) {\n  if (position.w < EPSILON) {\n    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);\n    position = refPosition + (position - refPosition) * r;\n  }\n}\n\nvoid main() {\n  geometry.worldPosition = instanceStartPositions;\n  geometry.worldPositionAlt = instanceEndPositions;\n  geometry.pickingColor = instancePickingColors;\n\n  vec2 widthPixels = vec2(clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n    widthMinPixels, widthMaxPixels) / 2.0);\n  vec3 width;\n\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);\n\n  float isEnd = positions.x;\n\n  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\n  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);\n\n  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\n  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);\n\n  if (billboard) {\n    // Extrude in clipspace\n    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);\n    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);\n    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);\n\n    clipLine(prevPositionScreen, currPositionScreen);\n    clipLine(nextPositionScreen, currPositionScreen);\n    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));\n\n    width = vec3(widthPixels, 0.0);\n    DECKGL_FILTER_SIZE(width, geometry);\n\n    vec3 pos = lineJoin(\n      prevPositionScreen.xyz / prevPositionScreen.w,\n      currPositionScreen.xyz / currPositionScreen.w,\n      nextPositionScreen.xyz / nextPositionScreen.w,\n      project_pixel_size_to_clipspace(width.xy)\n    );\n\n    gl_Position = vec4(pos * currPositionScreen.w, currPositionScreen.w);\n  } else {\n    // Extrude in commonspace\n    prevPosition = project_position(prevPosition, prevPosition64Low);\n    currPosition = project_position(currPosition, currPosition64Low);\n    nextPosition = project_position(nextPosition, nextPosition64Low);\n\n    width = vec3(project_pixel_size(widthPixels), 0.0);\n    DECKGL_FILTER_SIZE(width, geometry);\n\n    vec4 pos = vec4(\n      lineJoin(prevPosition, currPosition, nextPosition, width.xy),\n      1.0);\n    geometry.position = pos;\n    gl_Position = project_common_position_to_clipspace(pos);\n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n`;\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nexport default `\\\n#define SHADER_NAME path-layer-fragment-shader\n\nprecision highp float;\n\nuniform float jointType;\nuniform float miterLimit;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\n/*\n * vPathPosition represents the relative coordinates of the current fragment on the path segment.\n * vPathPosition.x - position along the width of the path, between [-1, 1]. 0 is the center line.\n * vPathPosition.y - position along the length of the path, between [0, L / width].\n */\nvarying vec2 vPathPosition;\nvarying float vPathLength;\n\nvoid main(void) {\n  geometry.uv = vPathPosition;\n\n  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {\n    // if joint is rounded, test distance from the corner\n    if (jointType > 0.0 && length(vCornerOffset) > 1.0) {\n      discard;\n    }\n    // trim miter\n    if (jointType == 0.0 && vMiterLength > miterLimit + 1.0) {\n      discard;\n    }\n  }\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n`;\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* eslint-disable max-params */\nimport earcut from 'earcut';\n\n// 4 data formats are supported:\n// Simple Polygon: an array of points\n// Complex Polygon: an array of array of points (array of rings)\n//   with the first ring representing the outer hull and other rings representing holes\n// Simple Flat: an array of numbers (flattened \"simple polygon\")\n// Complex Flat: {position: array<number>, holeIndices: array<number>}\n//   (flattened \"complex polygon\")\n\n/**\n * Ensure a polygon is valid format\n * @param {Array|Object} polygon\n */\nfunction validate(polygon) {\n  polygon = (polygon && polygon.positions) || polygon;\n  if (!Array.isArray(polygon) && !ArrayBuffer.isView(polygon)) {\n    throw new Error('invalid polygon');\n  }\n}\n\n/**\n * Check if a polygon is simple or complex\n * @param {Array} polygon - either a complex or simple polygon\n * @return {Boolean} - true if the polygon is a simple polygon (i.e. not an array of polygons)\n */\nfunction isSimple(polygon) {\n  return polygon.length >= 1 && polygon[0].length >= 2 && Number.isFinite(polygon[0][0]);\n}\n\n/**\n * Check if a simple polygon is a closed ring\n * @param {Array} simplePolygon - array of points\n * @return {Boolean} - true if the simple polygon is a closed ring\n */\nfunction isNestedRingClosed(simplePolygon) {\n  // check if first and last vertex are the same\n  const p0 = simplePolygon[0];\n  const p1 = simplePolygon[simplePolygon.length - 1];\n\n  return p0[0] === p1[0] && p0[1] === p1[1] && p0[2] === p1[2];\n}\n\n/**\n * Check if a simple flat array is a closed ring\n * @param {Array} positions - array of numbers\n * @param {Number} size - size of a position, 2 (xy) or 3 (xyz)\n * @param {Number} startIndex - start index of the path in the positions array\n * @param {Number} endIndex - end index of the path in the positions array\n * @return {Boolean} - true if the simple flat array is a closed ring\n */\nfunction isFlatRingClosed(positions, size, startIndex, endIndex) {\n  for (let i = 0; i < size; i++) {\n    if (positions[startIndex + i] !== positions[endIndex - size + i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Copy a simple polygon coordinates into a flat array, closes the ring if needed.\n * @param {Float64Array} target - destination\n * @param {Number} targetStartIndex - index in the destination to start copying into\n * @param {Array} simplePolygon - array of points\n * @param {Number} size - size of a position, 2 (xy) or 3 (xyz)\n * @returns {Number} - the index of the write head in the destination\n */\nfunction copyNestedRing(target, targetStartIndex, simplePolygon, size) {\n  let targetIndex = targetStartIndex;\n  const len = simplePolygon.length;\n  for (let i = 0; i < len; i++) {\n    for (let j = 0; j < size; j++) {\n      target[targetIndex++] = simplePolygon[i][j] || 0;\n    }\n  }\n\n  if (!isNestedRingClosed(simplePolygon)) {\n    for (let j = 0; j < size; j++) {\n      target[targetIndex++] = simplePolygon[0][j] || 0;\n    }\n  }\n  return targetIndex;\n}\n\n/**\n * Copy a simple flat array into another flat array, closes the ring if needed.\n * @param {Float64Array} target - destination\n * @param {Number} targetStartIndex - index in the destination to start copying into\n * @param {Array} positions - array of numbers\n * @param {Number} size - size of a position, 2 (xy) or 3 (xyz)\n * @param {Number} [srcStartIndex] - start index of the path in the positions array\n * @param {Number} [srcEndIndex] - end index of the path in the positions array\n * @returns {Number} - the index of the write head in the destination\n */\nfunction copyFlatRing(target, targetStartIndex, positions, size, srcStartIndex = 0, srcEndIndex) {\n  srcEndIndex = srcEndIndex || positions.length;\n  const srcLength = srcEndIndex - srcStartIndex;\n  if (srcLength <= 0) {\n    return targetStartIndex;\n  }\n  let targetIndex = targetStartIndex;\n\n  for (let i = 0; i < srcLength; i++) {\n    target[targetIndex++] = positions[srcStartIndex + i];\n  }\n\n  if (!isFlatRingClosed(positions, size, srcStartIndex, srcEndIndex)) {\n    for (let i = 0; i < size; i++) {\n      target[targetIndex++] = positions[srcStartIndex + i];\n    }\n  }\n  return targetIndex;\n}\n\n/**\n * Normalize any polygon representation into the \"complex flat\" format\n * @param {Array|Object} polygon\n * @param {Number} positionSize - size of a position, 2 (xy) or 3 (xyz)\n * @param {Number} [vertexCount] - pre-computed vertex count in the polygon.\n *   If provided, will skip counting.\n * @return {Object} - {positions: <Float64Array>, holeIndices: <Array|null>}\n */\n/* eslint-disable max-statements */\nexport function normalize(polygon, positionSize) {\n  validate(polygon);\n\n  const positions = [];\n  const holeIndices = [];\n\n  if (polygon.positions) {\n    // complex flat\n    const {positions: srcPositions, holeIndices: srcHoleIndices} = polygon;\n\n    if (srcHoleIndices) {\n      let targetIndex = 0;\n      // split the positions array into `holeIndices.length + 1` rings\n      // holeIndices[-1] falls back to 0\n      // holeIndices[holeIndices.length] falls back to positions.length\n      for (let i = 0; i <= srcHoleIndices.length; i++) {\n        targetIndex = copyFlatRing(\n          positions,\n          targetIndex,\n          srcPositions,\n          positionSize,\n          srcHoleIndices[i - 1],\n          srcHoleIndices[i]\n        );\n        holeIndices.push(targetIndex);\n      }\n      // The last one is not a starting index of a hole, remove\n      holeIndices.pop();\n\n      return {positions, holeIndices};\n    }\n    polygon = srcPositions;\n  }\n  if (Number.isFinite(polygon[0])) {\n    // simple flat\n    copyFlatRing(positions, 0, polygon, positionSize);\n    return positions;\n  }\n  if (!isSimple(polygon)) {\n    // complex polygon\n    let targetIndex = 0;\n\n    for (const simplePolygon of polygon) {\n      targetIndex = copyNestedRing(positions, targetIndex, simplePolygon, positionSize);\n      holeIndices.push(targetIndex);\n    }\n    // The last one is not a starting index of a hole, remove\n    holeIndices.pop();\n    // last index points to the end of the array, remove it\n    return {positions, holeIndices};\n  }\n  // simple polygon\n  copyNestedRing(positions, 0, polygon, positionSize);\n  return positions;\n}\n/* eslint-enable max-statements */\n\n/*\n * Get vertex indices for drawing polygon mesh\n * @param {Object} normalizedPolygon - {positions, holeIndices}\n * @param {Number} positionSize - size of a position, 2 (xy) or 3 (xyz)\n * @returns {Array} array of indices\n */\nexport function getSurfaceIndices(normalizedPolygon, positionSize, preproject) {\n  let holeIndices = null;\n\n  if (normalizedPolygon.holeIndices) {\n    holeIndices = normalizedPolygon.holeIndices.map(positionIndex => positionIndex / positionSize);\n  }\n  let positions = normalizedPolygon.positions || normalizedPolygon;\n\n  if (preproject) {\n    // When tesselating lnglat coordinates, project them to the common space for accuracy\n    const n = positions.length;\n    // Clone the array\n    positions = positions.slice();\n    const p = [];\n    for (let i = 0; i < n; i += positionSize) {\n      p[0] = positions[i];\n      p[1] = positions[i + 1];\n      const xy = preproject(p);\n      positions[i] = xy[0];\n      positions[i + 1] = xy[1];\n    }\n  }\n\n  // Let earcut triangulate the polygon\n  return earcut(positions, holeIndices, positionSize);\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n// Handles tesselation of polygons with holes\n// - 2D surfaces\n// - 2D outlines\n// - 3D surfaces (top and sides only)\n// - 3D wireframes (not yet)\nimport * as Polygon from './polygon';\nimport {Tesselator} from '@deck.gl/core';\nimport {cutPolygonByGrid, cutPolygonByMercatorBounds} from '@math.gl/polygon';\n\n// This class is set up to allow querying one attribute at a time\n// the way the AttributeManager expects it\nexport default class PolygonTesselator extends Tesselator {\n  constructor(opts) {\n    const {fp64, IndexType = Uint32Array} = opts;\n    super({\n      ...opts,\n      attributes: {\n        positions: {size: 3, type: fp64 ? Float64Array : Float32Array},\n        vertexValid: {type: Uint8ClampedArray, size: 1},\n        indices: {type: IndexType, size: 1}\n      }\n    });\n  }\n\n  /* Getters */\n  get(attributeName) {\n    const {attributes} = this;\n    if (attributeName === 'indices') {\n      return attributes.indices && attributes.indices.subarray(0, this.vertexCount);\n    }\n\n    return attributes[attributeName];\n  }\n\n  /* Implement base Tesselator interface */\n  updateGeometry(opts) {\n    super.updateGeometry(opts);\n\n    const externalIndices = this.buffers.indices;\n    if (externalIndices) {\n      this.vertexCount = (externalIndices.value || externalIndices).length;\n    }\n  }\n\n  normalizeGeometry(polygon) {\n    if (this.normalize) {\n      polygon = Polygon.normalize(polygon, this.positionSize);\n      if (this.opts.resolution) {\n        return cutPolygonByGrid(polygon.positions || polygon, polygon.holeIndices, {\n          size: this.positionSize,\n          gridResolution: this.opts.resolution,\n          edgeTypes: true\n        });\n      }\n      if (this.opts.wrapLongitude) {\n        return cutPolygonByMercatorBounds(polygon.positions || polygon, polygon.holeIndices, {\n          size: this.positionSize,\n          maxLatitude: 86,\n          edgeTypes: true\n        });\n      }\n    }\n    return polygon;\n  }\n\n  getGeometrySize(polygon) {\n    if (Array.isArray(polygon) && !Number.isFinite(polygon[0])) {\n      let size = 0;\n      for (const subPolygon of polygon) {\n        size += this.getGeometrySize(subPolygon);\n      }\n      return size;\n    }\n    return (polygon.positions || polygon).length / this.positionSize;\n  }\n\n  getGeometryFromBuffer(buffer) {\n    if (this.normalize || !this.buffers.indices) {\n      return super.getGeometryFromBuffer(buffer);\n    }\n    // we don't need to read the positions if no normalization/tesselation\n    return () => null;\n  }\n\n  updateGeometryAttributes(polygon, context) {\n    if (Array.isArray(polygon) && !Number.isFinite(polygon[0])) {\n      for (const subPolygon of polygon) {\n        const geometrySize = this.getGeometrySize(subPolygon);\n        context.geometrySize = geometrySize;\n        this.updateGeometryAttributes(subPolygon, context);\n        context.vertexStart += geometrySize;\n        context.indexStart = this.indexStarts[context.geometryIndex + 1];\n      }\n    } else {\n      this._updateIndices(polygon, context);\n      this._updatePositions(polygon, context);\n      this._updateVertexValid(polygon, context);\n    }\n  }\n\n  // Flatten the indices array\n  _updateIndices(polygon, {geometryIndex, vertexStart: offset, indexStart}) {\n    const {attributes, indexStarts, typedArrayManager} = this;\n\n    let target = attributes.indices;\n    if (!target) {\n      return;\n    }\n    let i = indexStart;\n\n    // 1. get triangulated indices for the internal areas\n    const indices = Polygon.getSurfaceIndices(polygon, this.positionSize, this.opts.preproject);\n\n    // make sure the buffer is large enough\n    target = typedArrayManager.allocate(target, indexStart + indices.length, {\n      copy: true\n    });\n\n    // 2. offset each index by the number of indices in previous polygons\n    for (let j = 0; j < indices.length; j++) {\n      target[i++] = indices[j] + offset;\n    }\n\n    indexStarts[geometryIndex + 1] = indexStart + indices.length;\n    attributes.indices = target;\n  }\n\n  // Flatten out all the vertices of all the sub subPolygons\n  _updatePositions(polygon, {vertexStart, geometrySize}) {\n    const {\n      attributes: {positions},\n      positionSize\n    } = this;\n    if (!positions) {\n      return;\n    }\n    const polygonPositions = polygon.positions || polygon;\n\n    for (let i = vertexStart, j = 0; j < geometrySize; i++, j++) {\n      const x = polygonPositions[j * positionSize];\n      const y = polygonPositions[j * positionSize + 1];\n      const z = positionSize > 2 ? polygonPositions[j * positionSize + 2] : 0;\n\n      positions[i * 3] = x;\n      positions[i * 3 + 1] = y;\n      positions[i * 3 + 2] = z;\n    }\n  }\n\n  _updateVertexValid(polygon, {vertexStart, geometrySize}) {\n    const {\n      attributes: {vertexValid},\n      positionSize\n    } = this;\n    const holeIndices = polygon && polygon.holeIndices;\n    /* We are reusing the some buffer for `nextPositions` by offseting one vertex\n     * to the left. As a result,\n     * the last vertex of each ring overlaps with the first vertex of the next ring.\n     * `vertexValid` is used to mark the end of each ring so we don't draw these\n     * segments:\n      positions      A0 A1 A2 A3 A4 B0 B1 B2 C0 ...\n      nextPositions  A1 A2 A3 A4 B0 B1 B2 C0 C1 ...\n      vertexValid    1  1  1  1  0  1  1  0  1 ...\n     */\n    if (polygon && polygon.edgeTypes) {\n      vertexValid.set(polygon.edgeTypes, vertexStart);\n    } else {\n      vertexValid.fill(1, vertexStart, vertexStart + geometrySize);\n    }\n    if (holeIndices) {\n      for (let j = 0; j < holeIndices.length; j++) {\n        vertexValid[vertexStart + holeIndices[j] / positionSize - 1] = 0;\n      }\n    }\n    vertexValid[vertexStart + geometrySize - 1] = 0;\n  }\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nexport default `\\\n\nattribute vec2 vertexPositions;\nattribute float vertexValid;\n\nuniform bool extruded;\nuniform bool isWireframe;\nuniform float elevationScale;\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying float isValid;\n\nstruct PolygonProps {\n  vec4 fillColors;\n  vec4 lineColors;\n  vec3 positions;\n  vec3 nextPositions;\n  vec3 pickingColors;\n  vec3 positions64Low;\n  vec3 nextPositions64Low;\n  float elevations;\n};\n\nvec3 project_offset_normal(vec3 vector) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\n    // normals generated by the polygon tesselator are in lnglat offsets instead of meters\n    return normalize(vector * project_uCommonUnitsPerWorldUnit);\n  }\n  return project_normal(vector);\n}\n\nvoid calculatePosition(PolygonProps props) {\n  vec3 pos;\n  vec3 pos64Low;\n  vec3 normal;\n  vec4 colors = isWireframe ? props.lineColors : props.fillColors;\n\n  geometry.worldPosition = props.positions;\n  geometry.worldPositionAlt = props.nextPositions;\n  geometry.pickingColor = props.pickingColors;\n\n#ifdef IS_SIDE_VERTEX\n  pos = mix(props.positions, props.nextPositions, vertexPositions.x);\n  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);\n  isValid = vertexValid;\n#else\n  pos = props.positions;\n  pos64Low = props.positions64Low;\n  isValid = 1.0;\n#endif\n\n  if (extruded) {\n    pos.z += props.elevations * vertexPositions.y * elevationScale;\n\n#ifdef IS_SIDE_VERTEX\n    normal = vec3(\n      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),\n      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),\n      0.0);\n    normal = project_offset_normal(normal);\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n    geometry.normal = normal;\n  }\n\n  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  if (extruded) {\n    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);\n    vColor = vec4(lightColor, colors.a * opacity);\n  } else {\n    vColor = vec4(colors.rgb, colors.a * opacity);\n  }\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n`;\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport main from './solid-polygon-layer-vertex-main.glsl';\n\nexport default `\\\n#define SHADER_NAME solid-polygon-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 positions64Low;\nattribute float elevations;\nattribute vec4 fillColors;\nattribute vec4 lineColors;\nattribute vec3 pickingColors;\n\n${main}\n\nvoid main(void) {\n  PolygonProps props;\n\n  props.positions = positions;\n  props.positions64Low = positions64Low;\n  props.elevations = elevations;\n  props.fillColors = fillColors;\n  props.lineColors = lineColors;\n  props.pickingColors = pickingColors;\n\n  calculatePosition(props);\n}\n`;\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport main from './solid-polygon-layer-vertex-main.glsl';\n\nexport default `\\\n#define SHADER_NAME solid-polygon-layer-vertex-shader-side\n#define IS_SIDE_VERTEX\n\n\nattribute vec3 instancePositions;\nattribute vec3 nextPositions;\nattribute vec3 instancePositions64Low;\nattribute vec3 nextPositions64Low;\nattribute float instanceElevations;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\n${main}\n\nvoid main(void) {\n  PolygonProps props;\n\n  props.positions = instancePositions;\n  props.positions64Low = instancePositions64Low;\n  props.elevations = instanceElevations;\n  props.fillColors = instanceFillColors;\n  props.lineColors = instanceLineColors;\n  props.pickingColors = instancePickingColors;\n  props.nextPositions = nextPositions;\n  props.nextPositions64Low = nextPositions64Low;\n\n  calculatePosition(props);\n}\n`;\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport {Layer, project32, gouraudLighting, picking, COORDINATE_SYSTEM} from '@deck.gl/core';\nimport GL from '@luma.gl/constants';\nimport {Model, Geometry, hasFeatures, FEATURES} from '@luma.gl/core';\n\n// Polygon geometry generation is managed by the polygon tesselator\nimport PolygonTesselator from './polygon-tesselator';\n\nimport vsTop from './solid-polygon-layer-vertex-top.glsl';\nimport vsSide from './solid-polygon-layer-vertex-side.glsl';\nimport fs from './solid-polygon-layer-fragment.glsl';\n\nconst DEFAULT_COLOR = [0, 0, 0, 255];\n\nconst defaultProps = {\n  filled: true,\n  // Whether to extrude\n  extruded: false,\n  // Whether to draw a GL.LINES wireframe of the polygon\n  wireframe: false,\n  _normalize: true,\n\n  // elevation multiplier\n  elevationScale: {type: 'number', min: 0, value: 1},\n\n  // Accessor for polygon geometry\n  getPolygon: {type: 'accessor', value: f => f.polygon},\n  // Accessor for extrusion height\n  getElevation: {type: 'accessor', value: 1000},\n  // Accessor for colors\n  getFillColor: {type: 'accessor', value: DEFAULT_COLOR},\n  getLineColor: {type: 'accessor', value: DEFAULT_COLOR},\n\n  // Optional settings for 'lighting' shader module\n  material: true\n};\n\nconst ATTRIBUTE_TRANSITION = {\n  enter: (value, chunk) => {\n    return chunk.length ? chunk.subarray(chunk.length - value.length) : value;\n  }\n};\n\nexport default class SolidPolygonLayer extends Layer {\n  getShaders(vs) {\n    return super.getShaders({\n      vs,\n      fs,\n      defines: {},\n      modules: [project32, gouraudLighting, picking]\n    });\n  }\n\n  get wrapLongitude() {\n    return false;\n  }\n\n  initializeState() {\n    const {gl, viewport} = this.context;\n    let {coordinateSystem} = this.props;\n    if (viewport.isGeospatial && coordinateSystem === COORDINATE_SYSTEM.DEFAULT) {\n      coordinateSystem = COORDINATE_SYSTEM.LNGLAT;\n    }\n\n    this.setState({\n      numInstances: 0,\n      polygonTesselator: new PolygonTesselator({\n        // Lnglat coordinates are usually projected non-linearly, which affects tesselation results\n        // Provide a preproject function if the coordinates are in lnglat\n        preproject: coordinateSystem === COORDINATE_SYSTEM.LNGLAT && viewport.projectFlat,\n        fp64: this.use64bitPositions(),\n        IndexType: !gl || hasFeatures(gl, FEATURES.ELEMENT_INDEX_UINT32) ? Uint32Array : Uint16Array\n      })\n    });\n\n    const attributeManager = this.getAttributeManager();\n    const noAlloc = true;\n\n    attributeManager.remove(['instancePickingColors']);\n\n    /* eslint-disable max-len */\n    attributeManager.add({\n      indices: {size: 1, isIndexed: true, update: this.calculateIndices, noAlloc},\n      positions: {\n        size: 3,\n        type: GL.DOUBLE,\n        fp64: this.use64bitPositions(),\n        transition: ATTRIBUTE_TRANSITION,\n        accessor: 'getPolygon',\n        update: this.calculatePositions,\n        noAlloc,\n        shaderAttributes: {\n          positions: {\n            vertexOffset: 0,\n            divisor: 0\n          },\n          instancePositions: {\n            vertexOffset: 0,\n            divisor: 1\n          },\n          nextPositions: {\n            vertexOffset: 1,\n            divisor: 1\n          }\n        }\n      },\n      vertexValid: {\n        size: 1,\n        divisor: 1,\n        type: GL.UNSIGNED_BYTE,\n        update: this.calculateVertexValid,\n        noAlloc\n      },\n      elevations: {\n        size: 1,\n        transition: ATTRIBUTE_TRANSITION,\n        accessor: 'getElevation',\n        shaderAttributes: {\n          elevations: {\n            divisor: 0\n          },\n          instanceElevations: {\n            divisor: 1\n          }\n        }\n      },\n      fillColors: {\n        alias: 'colors',\n        size: this.props.colorFormat.length,\n        type: GL.UNSIGNED_BYTE,\n        normalized: true,\n        transition: ATTRIBUTE_TRANSITION,\n        accessor: 'getFillColor',\n        defaultValue: DEFAULT_COLOR,\n        shaderAttributes: {\n          fillColors: {\n            divisor: 0\n          },\n          instanceFillColors: {\n            divisor: 1\n          }\n        }\n      },\n      lineColors: {\n        alias: 'colors',\n        size: this.props.colorFormat.length,\n        type: GL.UNSIGNED_BYTE,\n        normalized: true,\n        transition: ATTRIBUTE_TRANSITION,\n        accessor: 'getLineColor',\n        defaultValue: DEFAULT_COLOR,\n        shaderAttributes: {\n          lineColors: {\n            divisor: 0\n          },\n          instanceLineColors: {\n            divisor: 1\n          }\n        }\n      },\n      pickingColors: {\n        size: 3,\n        type: GL.UNSIGNED_BYTE,\n        accessor: (object, {index, target: value}) =>\n          this.encodePickingColor(object && object.__source ? object.__source.index : index, value),\n        shaderAttributes: {\n          pickingColors: {\n            divisor: 0\n          },\n          instancePickingColors: {\n            divisor: 1\n          }\n        }\n      }\n    });\n    /* eslint-enable max-len */\n  }\n\n  getPickingInfo(params) {\n    const info = super.getPickingInfo(params);\n    const {index} = info;\n    const {data} = this.props;\n\n    if (data[0] && data[0].__source) {\n      // data is wrapped\n      info.object = data.find(d => d.__source.index === index);\n    }\n    return info;\n  }\n\n  draw({uniforms}) {\n    const {extruded, filled, wireframe, elevationScale} = this.props;\n    const {topModel, sideModel, polygonTesselator} = this.state;\n\n    const renderUniforms = Object.assign({}, uniforms, {\n      extruded: Boolean(extruded),\n      elevationScale\n    });\n\n    // Note: the order is important\n    if (sideModel) {\n      sideModel.setInstanceCount(polygonTesselator.instanceCount - 1);\n      sideModel.setUniforms(renderUniforms);\n      if (wireframe) {\n        sideModel.setDrawMode(GL.LINE_STRIP);\n        sideModel.setUniforms({isWireframe: true}).draw();\n      }\n      if (filled) {\n        sideModel.setDrawMode(GL.TRIANGLE_FAN);\n        sideModel.setUniforms({isWireframe: false}).draw();\n      }\n    }\n\n    if (topModel) {\n      topModel.setVertexCount(polygonTesselator.vertexCount);\n      topModel.setUniforms(renderUniforms).draw();\n    }\n  }\n\n  updateState(updateParams) {\n    super.updateState(updateParams);\n\n    this.updateGeometry(updateParams);\n\n    const {props, oldProps, changeFlags} = updateParams;\n    const attributeManager = this.getAttributeManager();\n\n    const regenerateModels =\n      changeFlags.extensionsChanged ||\n      props.filled !== oldProps.filled ||\n      props.extruded !== oldProps.extruded;\n\n    if (regenerateModels) {\n      if (this.state.models) {\n        this.state.models.forEach(model => model.delete());\n      }\n\n      this.setState(this._getModels(this.context.gl));\n      attributeManager.invalidateAll();\n    }\n  }\n\n  updateGeometry({props, oldProps, changeFlags}) {\n    const geometryConfigChanged =\n      changeFlags.dataChanged ||\n      (changeFlags.updateTriggersChanged &&\n        (changeFlags.updateTriggersChanged.all || changeFlags.updateTriggersChanged.getPolygon));\n\n    // When the geometry config  or the data is changed,\n    // tessellator needs to be invoked\n    if (geometryConfigChanged) {\n      const {polygonTesselator} = this.state;\n      const buffers = props.data.attributes || {};\n      polygonTesselator.updateGeometry({\n        data: props.data,\n        normalize: props._normalize,\n        geometryBuffer: buffers.getPolygon,\n        buffers,\n        getGeometry: props.getPolygon,\n        positionFormat: props.positionFormat,\n        wrapLongitude: props.wrapLongitude,\n        // TODO - move the flag out of the viewport\n        resolution: this.context.viewport.resolution,\n        fp64: this.use64bitPositions(),\n        dataChanged: changeFlags.dataChanged\n      });\n\n      this.setState({\n        numInstances: polygonTesselator.instanceCount,\n        startIndices: polygonTesselator.vertexStarts\n      });\n\n      if (!changeFlags.dataChanged) {\n        // Base `layer.updateState` only invalidates all attributes on data change\n        // Cover the rest of the scenarios here\n        this.getAttributeManager().invalidateAll();\n      }\n    }\n  }\n\n  _getModels(gl) {\n    const {id, filled, extruded} = this.props;\n\n    let topModel;\n    let sideModel;\n\n    if (filled) {\n      const shaders = this.getShaders(vsTop);\n      shaders.defines.NON_INSTANCED_MODEL = 1;\n\n      topModel = new Model(\n        gl,\n        Object.assign({}, shaders, {\n          id: `${id}-top`,\n          drawMode: GL.TRIANGLES,\n          attributes: {\n            vertexPositions: new Float32Array([0, 1])\n          },\n          uniforms: {\n            isWireframe: false,\n            isSideVertex: false\n          },\n          vertexCount: 0,\n          isIndexed: true\n        })\n      );\n    }\n    if (extruded) {\n      sideModel = new Model(\n        gl,\n        Object.assign({}, this.getShaders(vsSide), {\n          id: `${id}-side`,\n          geometry: new Geometry({\n            drawMode: GL.LINES,\n            vertexCount: 4,\n            attributes: {\n              // top right - top left - bootom left - bottom right\n              vertexPositions: {\n                size: 2,\n                value: new Float32Array([1, 0, 0, 0, 0, 1, 1, 1])\n              }\n            }\n          }),\n          instanceCount: 0,\n          isInstanced: 1\n        })\n      );\n\n      sideModel.userData.excludeAttributes = {indices: true};\n    }\n\n    return {\n      models: [sideModel, topModel].filter(Boolean),\n      topModel,\n      sideModel\n    };\n  }\n\n  calculateIndices(attribute) {\n    const {polygonTesselator} = this.state;\n    attribute.startIndices = polygonTesselator.indexStarts;\n    attribute.value = polygonTesselator.get('indices');\n  }\n\n  calculatePositions(attribute) {\n    const {polygonTesselator} = this.state;\n    attribute.startIndices = polygonTesselator.vertexStarts;\n    attribute.value = polygonTesselator.get('positions');\n  }\n\n  calculateVertexValid(attribute) {\n    attribute.value = this.state.polygonTesselator.get('vertexValid');\n  }\n}\n\nSolidPolygonLayer.layerName = 'SolidPolygonLayer';\nSolidPolygonLayer.defaultProps = defaultProps;\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nexport default `\\\n#define SHADER_NAME solid-polygon-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying float isValid;\n\nvoid main(void) {\n  if (isValid < 0.5) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n`;\n","// Assume data array is sorted by <accessor>\n// Replaces the specified range with a new subarray\n// Mutates the data array\n// Returns {startRow, endRow} of the inserted items\nexport function replaceInRange({data, getIndex, dataRange, replace}) {\n  const {startRow = 0, endRow = Infinity} = dataRange;\n  const count = data.length;\n  let replaceStart = count;\n  let replaceEnd = count;\n  for (let i = 0; i < count; i++) {\n    const row = getIndex(data[i]);\n    if (replaceStart > i && row >= startRow) {\n      replaceStart = i;\n    }\n    if (row >= endRow) {\n      replaceEnd = i;\n      break;\n    }\n  }\n  let index = replaceStart;\n  const dataLengthChanged = replaceEnd - replaceStart !== replace.length;\n  // Save the items after replaceEnd before we overwrite data\n  const endChunk = dataLengthChanged && data.slice(replaceEnd);\n  // Insert new items\n  for (let i = 0; i < replace.length; i++) {\n    data[index++] = replace[i];\n  }\n  if (dataLengthChanged) {\n    // Append items after replaceEnd\n    for (let i = 0; i < endChunk.length; i++) {\n      data[index++] = endChunk[i];\n    }\n    // Trim additional items\n    data.length = index;\n  }\n\n  return {\n    startRow: replaceStart,\n    endRow: replaceStart + replace.length\n  };\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport {log} from '@deck.gl/core';\n\n/**\n * \"Normalizes\" complete or partial GeoJSON data into iterable list of features\n * Can accept GeoJSON geometry or \"Feature\", \"FeatureCollection\" in addition\n * to plain arrays and iterables.\n * Works by extracting the feature array or wrapping single objects in an array,\n * so that subsequent code can simply iterate over features.\n *\n * @param {object} geojson - geojson data\n * @param {Object|Array} data - geojson object (FeatureCollection, Feature or\n *  Geometry) or array of features\n * @return {Array|\"iteratable\"} - iterable list of features\n */\nexport function getGeojsonFeatures(geojson) {\n  // If array, assume this is a list of features\n  if (Array.isArray(geojson)) {\n    return geojson;\n  }\n\n  log.assert(geojson.type, 'GeoJSON does not have type');\n\n  switch (geojson.type) {\n    case 'Feature':\n      // Wrap the feature in a 'Features' array\n      return [geojson];\n    case 'FeatureCollection':\n      // Just return the 'Features' array from the collection\n      log.assert(Array.isArray(geojson.features), 'GeoJSON does not have features array');\n      return geojson.features;\n    default:\n      // Assume it's a geometry, we'll check type in separateGeojsonFeatures\n      // Wrap the geometry object in a 'Feature' object and wrap in an array\n      return [{geometry: geojson}];\n  }\n}\n\n// Linearize\nexport function separateGeojsonFeatures(features, wrapFeature, dataRange = {}) {\n  const separated = {\n    pointFeatures: [],\n    lineFeatures: [],\n    polygonFeatures: [],\n    polygonOutlineFeatures: []\n  };\n  const {startRow = 0, endRow = features.length} = dataRange;\n\n  for (let featureIndex = startRow; featureIndex < endRow; featureIndex++) {\n    const feature = features[featureIndex];\n\n    log.assert(feature && feature.geometry, 'GeoJSON does not have geometry');\n\n    const {geometry} = feature;\n\n    if (geometry.type === 'GeometryCollection') {\n      log.assert(Array.isArray(geometry.geometries), 'GeoJSON does not have geometries array');\n      const {geometries} = geometry;\n      for (let i = 0; i < geometries.length; i++) {\n        const subGeometry = geometries[i];\n        separateGeometry(subGeometry, separated, wrapFeature, feature, featureIndex);\n      }\n    } else {\n      separateGeometry(geometry, separated, wrapFeature, feature, featureIndex);\n    }\n  }\n\n  return separated;\n}\n\nfunction separateGeometry(geometry, separated, wrapFeature, sourceFeature, sourceFeatureIndex) {\n  const {type, coordinates} = geometry;\n  const {pointFeatures, lineFeatures, polygonFeatures, polygonOutlineFeatures} = separated;\n\n  if (!validateGeometry(type, coordinates)) {\n    // Avoid hard failure if some features are malformed\n    log.warn(`${type} coordinates are malformed`)();\n    return;\n  }\n\n  // Split each feature, but keep track of the source feature and index (for Multi* geometries)\n  switch (type) {\n    case 'Point':\n      pointFeatures.push(\n        wrapFeature(\n          {\n            geometry\n          },\n          sourceFeature,\n          sourceFeatureIndex\n        )\n      );\n      break;\n    case 'MultiPoint':\n      coordinates.forEach(point => {\n        pointFeatures.push(\n          wrapFeature(\n            {\n              geometry: {type: 'Point', coordinates: point}\n            },\n            sourceFeature,\n            sourceFeatureIndex\n          )\n        );\n      });\n      break;\n    case 'LineString':\n      lineFeatures.push(\n        wrapFeature(\n          {\n            geometry\n          },\n          sourceFeature,\n          sourceFeatureIndex\n        )\n      );\n      break;\n    case 'MultiLineString':\n      // Break multilinestrings into multiple lines\n      coordinates.forEach(path => {\n        lineFeatures.push(\n          wrapFeature(\n            {\n              geometry: {type: 'LineString', coordinates: path}\n            },\n            sourceFeature,\n            sourceFeatureIndex\n          )\n        );\n      });\n      break;\n    case 'Polygon':\n      polygonFeatures.push(\n        wrapFeature(\n          {\n            geometry\n          },\n          sourceFeature,\n          sourceFeatureIndex\n        )\n      );\n      // Break polygon into multiple lines\n      coordinates.forEach(path => {\n        polygonOutlineFeatures.push(\n          wrapFeature(\n            {\n              geometry: {type: 'LineString', coordinates: path}\n            },\n            sourceFeature,\n            sourceFeatureIndex\n          )\n        );\n      });\n      break;\n    case 'MultiPolygon':\n      // Break multipolygons into multiple polygons\n      coordinates.forEach(polygon => {\n        polygonFeatures.push(\n          wrapFeature(\n            {\n              geometry: {type: 'Polygon', coordinates: polygon}\n            },\n            sourceFeature,\n            sourceFeatureIndex\n          )\n        );\n        // Break polygon into multiple lines\n        polygon.forEach(path => {\n          polygonOutlineFeatures.push(\n            wrapFeature(\n              {\n                geometry: {type: 'LineString', coordinates: path}\n              },\n              sourceFeature,\n              sourceFeatureIndex\n            )\n          );\n        });\n      });\n      break;\n    default:\n  }\n}\n\n/**\n * Simple GeoJSON validation util. For perf reasons we do not validate against the full spec,\n * only the following:\n   - geometry.type is supported\n   - geometry.coordinate has correct nesting level\n */\nconst COORDINATE_NEST_LEVEL = {\n  Point: 1,\n  MultiPoint: 2,\n  LineString: 2,\n  MultiLineString: 3,\n  Polygon: 3,\n  MultiPolygon: 4\n};\n\nexport function validateGeometry(type, coordinates) {\n  let nestLevel = COORDINATE_NEST_LEVEL[type];\n\n  log.assert(nestLevel, `Unknown GeoJSON type ${type}`);\n\n  while (coordinates && --nestLevel > 0) {\n    coordinates = coordinates[0];\n  }\n\n  return coordinates && Number.isFinite(coordinates[0]);\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport {CompositeLayer, log} from '@deck.gl/core';\nimport ScatterplotLayer from '../scatterplot-layer/scatterplot-layer';\nimport PathLayer from '../path-layer/path-layer';\n// Use primitive layer to avoid \"Composite Composite\" layers for now\nimport SolidPolygonLayer from '../solid-polygon-layer/solid-polygon-layer';\nimport {replaceInRange} from '../utils';\n\nimport {getGeojsonFeatures, separateGeojsonFeatures} from './geojson';\n\nconst defaultLineColor = [0, 0, 0, 255];\nconst defaultFillColor = [0, 0, 0, 255];\n\nconst defaultProps = {\n  stroked: true,\n  filled: true,\n  extruded: false,\n  wireframe: false,\n\n  lineWidthUnits: 'meters',\n  lineWidthScale: 1,\n  lineWidthMinPixels: 0,\n  lineWidthMaxPixels: Number.MAX_SAFE_INTEGER,\n  lineJointRounded: false,\n  lineMiterLimit: 4,\n\n  elevationScale: 1,\n\n  pointRadiusUnits: 'meters',\n  pointRadiusScale: 1,\n  pointRadiusMinPixels: 0, //  min point radius in pixels\n  pointRadiusMaxPixels: Number.MAX_SAFE_INTEGER, // max point radius in pixels\n\n  // Line and polygon outline color\n  getLineColor: {type: 'accessor', value: defaultLineColor},\n  // Point and polygon fill color\n  getFillColor: {type: 'accessor', value: defaultFillColor},\n  // Point radius\n  getRadius: {type: 'accessor', value: 1},\n  // Line and polygon outline accessors\n  getLineWidth: {type: 'accessor', value: 1},\n  // Polygon extrusion accessor\n  getElevation: {type: 'accessor', value: 1000},\n  // Optional material for 'lighting' shader module\n  material: true\n};\n\nfunction getCoordinates(f) {\n  return f.geometry.coordinates;\n}\n\nexport default class GeoJsonLayer extends CompositeLayer {\n  initializeState() {\n    this.state = {\n      features: {}\n    };\n\n    if (this.props.getLineDashArray) {\n      log.removed('getLineDashArray', 'PathStyleExtension')();\n    }\n  }\n\n  updateState({props, changeFlags}) {\n    if (!changeFlags.dataChanged) {\n      return;\n    }\n    const features = getGeojsonFeatures(props.data);\n    const wrapFeature = this.getSubLayerRow.bind(this);\n\n    if (Array.isArray(changeFlags.dataChanged)) {\n      const oldFeatures = this.state.features;\n      const newFeatures = {};\n      const featuresDiff = {};\n      for (const key in oldFeatures) {\n        newFeatures[key] = oldFeatures[key].slice();\n        featuresDiff[key] = [];\n      }\n\n      for (const dataRange of changeFlags.dataChanged) {\n        const partialFeatures = separateGeojsonFeatures(features, wrapFeature, dataRange);\n        for (const key in oldFeatures) {\n          featuresDiff[key].push(\n            replaceInRange({\n              data: newFeatures[key],\n              getIndex: f => f.__source.index,\n              dataRange,\n              replace: partialFeatures[key]\n            })\n          );\n        }\n      }\n      this.setState({features: newFeatures, featuresDiff});\n    } else {\n      this.setState({\n        features: separateGeojsonFeatures(features, wrapFeature),\n        featuresDiff: {}\n      });\n    }\n  }\n\n  /* eslint-disable complexity */\n  renderLayers() {\n    const {features, featuresDiff} = this.state;\n    const {pointFeatures, lineFeatures, polygonFeatures, polygonOutlineFeatures} = features;\n\n    // Layer composition props\n    const {stroked, filled, extruded, wireframe, material, transitions} = this.props;\n\n    // Rendering props underlying layer\n    const {\n      lineWidthUnits,\n      lineWidthScale,\n      lineWidthMinPixels,\n      lineWidthMaxPixels,\n      lineJointRounded,\n      lineMiterLimit,\n      pointRadiusUnits,\n      pointRadiusScale,\n      pointRadiusMinPixels,\n      pointRadiusMaxPixels,\n      elevationScale,\n      lineDashJustified\n    } = this.props;\n\n    // Accessor props for underlying layers\n    const {\n      getLineColor,\n      getFillColor,\n      getRadius,\n      getLineWidth,\n      getLineDashArray,\n      getElevation,\n      updateTriggers\n    } = this.props;\n\n    const PolygonFillLayer = this.getSubLayerClass('polygons-fill', SolidPolygonLayer);\n    const PolygonStrokeLayer = this.getSubLayerClass('polygons-stroke', PathLayer);\n    const LineStringsLayer = this.getSubLayerClass('line-strings', PathLayer);\n    const PointsLayer = this.getSubLayerClass('points', ScatterplotLayer);\n\n    // Filled Polygon Layer\n    const polygonFillLayer =\n      this.shouldRenderSubLayer('polygons-fill', polygonFeatures) &&\n      new PolygonFillLayer(\n        {\n          _dataDiff: featuresDiff.polygonFeatures && (() => featuresDiff.polygonFeatures),\n\n          extruded,\n          elevationScale,\n          filled,\n          wireframe,\n          material,\n          getElevation: this.getSubLayerAccessor(getElevation),\n          getFillColor: this.getSubLayerAccessor(getFillColor),\n          getLineColor: this.getSubLayerAccessor(getLineColor),\n\n          transitions: transitions && {\n            getPolygon: transitions.geometry,\n            getElevation: transitions.getElevation,\n            getFillColor: transitions.getFillColor,\n            getLineColor: transitions.getLineColor\n          }\n        },\n        this.getSubLayerProps({\n          id: 'polygons-fill',\n          updateTriggers: {\n            getElevation: updateTriggers.getElevation,\n            getFillColor: updateTriggers.getFillColor,\n            getLineColor: updateTriggers.getLineColor\n          }\n        }),\n        {\n          data: polygonFeatures,\n          getPolygon: getCoordinates\n        }\n      );\n\n    const polygonLineLayer =\n      !extruded &&\n      stroked &&\n      this.shouldRenderSubLayer('polygons-stroke', polygonOutlineFeatures) &&\n      new PolygonStrokeLayer(\n        {\n          _dataDiff:\n            featuresDiff.polygonOutlineFeatures && (() => featuresDiff.polygonOutlineFeatures),\n\n          widthUnits: lineWidthUnits,\n          widthScale: lineWidthScale,\n          widthMinPixels: lineWidthMinPixels,\n          widthMaxPixels: lineWidthMaxPixels,\n          rounded: lineJointRounded,\n          miterLimit: lineMiterLimit,\n          dashJustified: lineDashJustified,\n\n          getColor: this.getSubLayerAccessor(getLineColor),\n          getWidth: this.getSubLayerAccessor(getLineWidth),\n          getDashArray: this.getSubLayerAccessor(getLineDashArray),\n\n          transitions: transitions && {\n            getPath: transitions.geometry,\n            getColor: transitions.getLineColor,\n            getWidth: transitions.getLineWidth\n          }\n        },\n        this.getSubLayerProps({\n          id: 'polygons-stroke',\n          updateTriggers: {\n            getColor: updateTriggers.getLineColor,\n            getWidth: updateTriggers.getLineWidth,\n            getDashArray: updateTriggers.getLineDashArray\n          }\n        }),\n        {\n          data: polygonOutlineFeatures,\n          getPath: getCoordinates\n        }\n      );\n\n    const pathLayer =\n      this.shouldRenderSubLayer('linestrings', lineFeatures) &&\n      new LineStringsLayer(\n        {\n          _dataDiff: featuresDiff.lineFeatures && (() => featuresDiff.lineFeatures),\n\n          widthUnits: lineWidthUnits,\n          widthScale: lineWidthScale,\n          widthMinPixels: lineWidthMinPixels,\n          widthMaxPixels: lineWidthMaxPixels,\n          rounded: lineJointRounded,\n          miterLimit: lineMiterLimit,\n          dashJustified: lineDashJustified,\n\n          getColor: this.getSubLayerAccessor(getLineColor),\n          getWidth: this.getSubLayerAccessor(getLineWidth),\n          getDashArray: this.getSubLayerAccessor(getLineDashArray),\n\n          transitions: transitions && {\n            getPath: transitions.geometry,\n            getColor: transitions.getLineColor,\n            getWidth: transitions.getLineWidth\n          }\n        },\n        this.getSubLayerProps({\n          id: 'line-strings',\n          updateTriggers: {\n            getColor: updateTriggers.getLineColor,\n            getWidth: updateTriggers.getLineWidth,\n            getDashArray: updateTriggers.getLineDashArray\n          }\n        }),\n        {\n          data: lineFeatures,\n          getPath: getCoordinates\n        }\n      );\n\n    const pointLayer =\n      this.shouldRenderSubLayer('points', pointFeatures) &&\n      new PointsLayer(\n        {\n          _dataDiff: featuresDiff.pointFeatures && (() => featuresDiff.pointFeatures),\n\n          stroked,\n          filled,\n          radiusUnits: pointRadiusUnits,\n          radiusScale: pointRadiusScale,\n          radiusMinPixels: pointRadiusMinPixels,\n          radiusMaxPixels: pointRadiusMaxPixels,\n          lineWidthUnits,\n          lineWidthScale,\n          lineWidthMinPixels,\n          lineWidthMaxPixels,\n\n          getFillColor: this.getSubLayerAccessor(getFillColor),\n          getLineColor: this.getSubLayerAccessor(getLineColor),\n          getRadius: this.getSubLayerAccessor(getRadius),\n          getLineWidth: this.getSubLayerAccessor(getLineWidth),\n\n          transitions: transitions && {\n            getPosition: transitions.geometry,\n            getFillColor: transitions.getFillColor,\n            getLineColor: transitions.getLineColor,\n            getRadius: transitions.getRadius,\n            getLineWidth: transitions.getLineWidth\n          }\n        },\n        this.getSubLayerProps({\n          id: 'points',\n          updateTriggers: {\n            getFillColor: updateTriggers.getFillColor,\n            getLineColor: updateTriggers.getLineColor,\n            getRadius: updateTriggers.getRadius,\n            getLineWidth: updateTriggers.getLineWidth\n          }\n        }),\n        {\n          data: pointFeatures,\n          getPosition: getCoordinates,\n          highlightedObjectIndex: this._getHighlightedIndex(pointFeatures)\n        }\n      );\n\n    return [\n      // If not extruded: flat fill layer is drawn below outlines\n      !extruded && polygonFillLayer,\n      polygonLineLayer,\n      pathLayer,\n      pointLayer,\n      // If extruded: draw fill layer last for correct blending behavior\n      extruded && polygonFillLayer\n    ];\n  }\n  /* eslint-enable complexity */\n\n  _getHighlightedIndex(data) {\n    const {highlightedObjectIndex} = this.props;\n    return Number.isFinite(highlightedObjectIndex)\n      ? data.findIndex(d => d.__source.index === highlightedObjectIndex)\n      : null;\n  }\n}\n\nGeoJsonLayer.layerName = 'GeoJsonLayer';\nGeoJsonLayer.defaultProps = defaultProps;\n","/* eslint-env browser */\nimport {log} from '@deck.gl/core';\n\nexport default class Tile2DHeader {\n  constructor({x, y, z, onTileLoad, onTileError}) {\n    this.x = x;\n    this.y = y;\n    this.z = z;\n    this.isVisible = false;\n    this.isSelected = false;\n    this.parent = null;\n    this.children = [];\n\n    this.content = null;\n    this._isLoaded = false;\n    this._isCancelled = false;\n\n    this.onTileLoad = onTileLoad;\n    this.onTileError = onTileError;\n  }\n\n  get data() {\n    return this._isLoaded ? this.content : this._loader;\n  }\n\n  get isLoaded() {\n    return this._isLoaded;\n  }\n\n  get isLoading() {\n    return Boolean(this._loader);\n  }\n\n  get isCancelled() {\n    return this._isCancelled;\n  }\n\n  get byteLength() {\n    const result = this.content ? this.content.byteLength : 0;\n    if (!Number.isFinite(result)) {\n      log.error('byteLength not defined in tile data')();\n    }\n    return result;\n  }\n\n  /* eslint-disable max-statements */\n  async _loadData(getTileData, requestScheduler) {\n    const {x, y, z, bbox} = this;\n\n    this._abortController = new AbortController(); // eslint-disable-line no-undef\n    const {signal} = this._abortController;\n\n    const requestToken = await requestScheduler.scheduleRequest(this, tile => {\n      return tile.isSelected ? 1 : -1;\n    });\n\n    if (!requestToken) {\n      this._isCancelled = true;\n      return;\n    }\n    // A tile can be cancelled while being scheduled\n    if (this._isCancelled) {\n      requestToken.done();\n      return;\n    }\n\n    let tileData;\n    let error;\n    try {\n      tileData = await getTileData({x, y, z, bbox, signal});\n    } catch (err) {\n      error = err || true;\n    } finally {\n      requestToken.done();\n\n      if (this._isCancelled && !tileData) {\n        this._isLoaded = false;\n      } else {\n        // Consider it loaded if we tried to cancel but `getTileData` still returned data\n        this._isLoaded = true;\n        this._isCancelled = false;\n      }\n    }\n\n    if (!this._isLoaded) {\n      return;\n    }\n\n    if (error) {\n      this.onTileError(error, this);\n    } else {\n      this.content = tileData;\n      this.onTileLoad(this);\n    }\n  }\n  /* eslint-enable max-statements */\n\n  loadData(getTileData, requestScheduler) {\n    if (!getTileData) {\n      return;\n    }\n\n    this._isCancelled = false;\n    this._loader = this._loadData(getTileData, requestScheduler);\n    this._loader.finally(() => {\n      this._loader = undefined;\n    });\n  }\n\n  abort() {\n    if (this.isLoaded) {\n      return;\n    }\n\n    this._isCancelled = true;\n    this._abortController.abort();\n  }\n}\n","/* eslint-disable complexity */\nimport {CullingVolume, Plane, AxisAlignedBoundingBox} from '@math.gl/culling';\nimport {WebMercatorViewport} from '@deck.gl/core';\nimport {fitBounds} from '@math.gl/web-mercator';\n\nconst TILE_SIZE = 512;\n// number of world copies to check\nconst MAX_MAPS = 3;\n\nclass OSMNode {\n  constructor(x, y, z) {\n    this.x = x;\n    this.y = y;\n    this.z = z;\n  }\n\n  get children() {\n    if (!this._children) {\n      const x = this.x * 2;\n      const y = this.y * 2;\n      const z = this.z + 1;\n      this._children = [\n        new OSMNode(x, y, z),\n        new OSMNode(x, y + 1, z),\n        new OSMNode(x + 1, y, z),\n        new OSMNode(x + 1, y + 1, z)\n      ];\n    }\n    return this._children;\n  }\n\n  update(params) {\n    const {viewport, cullingVolume, elevationBounds, minZ, maxZ, offset} = params;\n    const boundingVolume = this.getBoundingVolume(elevationBounds, offset);\n\n    // First, check if this tile is visible\n    const isInside = cullingVolume.computeVisibility(boundingVolume);\n    if (isInside < 0) {\n      return false;\n    }\n\n    // Avoid loading overlapping tiles - if a descendant is requested, do not request the ancester\n    if (!this.childVisible) {\n      let {z} = this;\n      if (z < maxZ && z >= minZ) {\n        // Adjust LOD\n        // If the tile is far enough from the camera, accept a lower zoom level\n        const distance =\n          (boundingVolume.distanceTo(viewport.cameraPosition) * viewport.scale) / viewport.height;\n        z += Math.floor(Math.log2(distance));\n      }\n      if (z >= maxZ) {\n        // LOD is acceptable\n        this.selected = true;\n        return true;\n      }\n    }\n\n    // LOD is not enough, recursively test child tiles\n    this.selected = false;\n    this.childVisible = true;\n    for (const child of this.children) {\n      child.update(params);\n    }\n    return true;\n  }\n\n  getSelected(result = []) {\n    if (this.selected) {\n      result.push(this);\n    }\n    if (this._children) {\n      for (const node of this._children) {\n        node.getSelected(result);\n      }\n    }\n    return result;\n  }\n\n  getBoundingVolume(zRange, worldOffset) {\n    const scale = Math.pow(2, this.z);\n    const extent = TILE_SIZE / scale;\n    const originX = this.x * extent + worldOffset * TILE_SIZE;\n    // deck's common space is y-flipped\n    const originY = TILE_SIZE - (this.y + 1) * extent;\n\n    return new AxisAlignedBoundingBox(\n      [originX, originY, zRange[0]],\n      [originX + extent, originY + extent, zRange[1]]\n    );\n  }\n}\n\nexport function getOSMTileIndices(viewport, maxZ, zRange) {\n  if (!(viewport instanceof WebMercatorViewport)) {\n    const bbox = viewport.getBounds();\n    // The width and height here are arbitrary - they just need to form a reasonable aspect ratio\n    // so that we don't get too many world copies\n    const {longitude, latitude, zoom} = fitBounds({\n      width: 100,\n      height: 100,\n      bounds: [[bbox[0], bbox[1]], [bbox[2], bbox[3]]]\n    });\n\n    viewport = new WebMercatorViewport({\n      width: 100,\n      height: 100,\n      longitude,\n      latitude,\n      zoom,\n      repeat: true\n    });\n  }\n\n  // Get the culling volume of the current camera\n  const planes = Object.values(viewport.getFrustumPlanes()).map(\n    ({normal, distance}) => new Plane(normal.clone().negate(), distance)\n  );\n  const cullingVolume = new CullingVolume(planes);\n\n  // Project zRange from meters to common space\n  const unitsPerMeter = viewport.distanceScales.unitsPerMeter[2];\n  const elevationMin = (zRange && zRange[0] * unitsPerMeter) || 0;\n  const elevationMax = (zRange && zRange[1] * unitsPerMeter) || 0;\n\n  // Always load at the current zoom level if pitch is small\n  const minZ = viewport.pitch <= 60 ? maxZ : 0;\n\n  const root = new OSMNode(0, 0, 0);\n  const traversalParams = {\n    viewport,\n    cullingVolume,\n    elevationBounds: [elevationMin, elevationMax],\n    minZ,\n    maxZ,\n    // num. of worlds from the center. For repeated maps\n    offset: 0\n  };\n\n  root.update(traversalParams);\n\n  if (viewport.subViewports && viewport.subViewports.length > 1) {\n    // Check worlds in repeated maps\n    traversalParams.offset = -1;\n    while (root.update(traversalParams)) {\n      if (--traversalParams.offset < -MAX_MAPS) {\n        break;\n      }\n    }\n    traversalParams.offset = 1;\n    while (root.update(traversalParams)) {\n      if (++traversalParams.offset > MAX_MAPS) {\n        break;\n      }\n    }\n  }\n\n  return root.getSelected();\n}\n","import {getOSMTileIndices} from './tile-2d-traversal';\n\nconst TILE_SIZE = 512;\nconst DEFAULT_EXTENT = [-Infinity, -Infinity, Infinity, Infinity];\n\nexport const urlType = {\n  type: 'url',\n  value: '',\n  validate: value =>\n    typeof value === 'string' ||\n    (Array.isArray(value) && value.every(url => typeof url === 'string')),\n  equals: (value1, value2) => {\n    if (value1 === value2) {\n      return true;\n    }\n    if (!Array.isArray(value1) || !Array.isArray(value2)) {\n      return false;\n    }\n    const len = value1.length;\n    if (len !== value2.length) {\n      return false;\n    }\n    for (let i = 0; i < len; i++) {\n      if (value1[i] !== value2[i]) {\n        return false;\n      }\n    }\n    return true;\n  }\n};\n\nexport function getURLFromTemplate(template, properties) {\n  if (!template || !template.length) {\n    return null;\n  }\n  if (Array.isArray(template)) {\n    const index = Math.abs(properties.x + properties.y) % template.length;\n    template = template[index];\n  }\n\n  const {x, y, z} = properties;\n  return template\n    .replace('{x}', x)\n    .replace('{y}', y)\n    .replace('{z}', z)\n    .replace('{-y}', Math.pow(2, z) - y - 1);\n}\n\n/**\n * gets the bounding box of a viewport\n */\nfunction getBoundingBox(viewport, zRange, extent) {\n  let bounds;\n  if (zRange && zRange.length === 2) {\n    const [minZ, maxZ] = zRange;\n    const bounds0 = viewport.getBounds({z: minZ});\n    const bounds1 = viewport.getBounds({z: maxZ});\n    bounds = [\n      Math.min(bounds0[0], bounds1[0]),\n      Math.min(bounds0[1], bounds1[1]),\n      Math.max(bounds0[2], bounds1[2]),\n      Math.max(bounds0[3], bounds1[3])\n    ];\n  } else {\n    bounds = viewport.getBounds();\n  }\n  return [\n    Math.max(bounds[0], extent[0]),\n    Math.max(bounds[1], extent[1]),\n    Math.min(bounds[2], extent[2]),\n    Math.min(bounds[3], extent[3])\n  ];\n}\n\nfunction getTileIndex([x, y], scale) {\n  return [(x * scale) / TILE_SIZE, (y * scale) / TILE_SIZE];\n}\n\nfunction getScale(z) {\n  return Math.pow(2, z);\n}\n\n// https://wiki.openstreetmap.org/wiki/Slippy_map_tilenames#Lon..2Flat._to_tile_numbers_2\nfunction osmTile2lngLat(x, y, z) {\n  const scale = getScale(z);\n  const lng = (x / scale) * 360 - 180;\n  const n = Math.PI - (2 * Math.PI * y) / scale;\n  const lat = (180 / Math.PI) * Math.atan(0.5 * (Math.exp(n) - Math.exp(-n)));\n  return [lng, lat];\n}\n\nfunction tile2XY(x, y, z) {\n  const scale = getScale(z);\n  return [(x / scale) * TILE_SIZE, (y / scale) * TILE_SIZE];\n}\n\nexport function tileToBoundingBox(viewport, x, y, z) {\n  if (viewport.isGeospatial) {\n    const [west, north] = osmTile2lngLat(x, y, z);\n    const [east, south] = osmTile2lngLat(x + 1, y + 1, z);\n    return {west, north, east, south};\n  }\n  const [left, top] = tile2XY(x, y, z);\n  const [right, bottom] = tile2XY(x + 1, y + 1, z);\n  return {left, top, right, bottom};\n}\n\nfunction getIdentityTileIndices(viewport, z, extent) {\n  const bbox = getBoundingBox(viewport, null, extent);\n  const scale = getScale(z);\n\n  const [minX, minY] = getTileIndex([bbox[0], bbox[1]], scale);\n  const [maxX, maxY] = getTileIndex([bbox[2], bbox[3]], scale);\n  const indices = [];\n\n  /*\n      |  TILE  |  TILE  |  TILE  |\n        |(minX)            |(maxX)\n   */\n  for (let x = Math.floor(minX); x < maxX; x++) {\n    for (let y = Math.floor(minY); y < maxY; y++) {\n      indices.push({x, y, z});\n    }\n  }\n  return indices;\n}\n\n/**\n * Returns all tile indices in the current viewport. If the current zoom level is smaller\n * than minZoom, return an empty array. If the current zoom level is greater than maxZoom,\n * return tiles that are on maxZoom.\n */\nexport function getTileIndices({viewport, maxZoom, minZoom, zRange, extent, tileSize = TILE_SIZE}) {\n  let z = Math.round(viewport.zoom + Math.log2(TILE_SIZE / tileSize));\n  if (Number.isFinite(minZoom) && z < minZoom) {\n    if (!extent) {\n      return [];\n    }\n    z = minZoom;\n  }\n  if (Number.isFinite(maxZoom) && z > maxZoom) {\n    z = maxZoom;\n  }\n  return viewport.isGeospatial\n    ? getOSMTileIndices(viewport, z, zRange, extent || DEFAULT_EXTENT)\n    : getIdentityTileIndices(viewport, z, extent || DEFAULT_EXTENT);\n}\n\n/**\n * Returns true if s is a valid URL template\n */\nexport function isURLTemplate(s) {\n  return /(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(s);\n}\n","import Tile2DHeader from './tile-2d-header';\nimport {getTileIndices, tileToBoundingBox} from './utils';\nimport {RequestScheduler} from '@loaders.gl/loader-utils';\n\nconst TILE_STATE_UNKNOWN = 0;\nconst TILE_STATE_VISIBLE = 1;\n/*\n   show cached parent tile if children are loading\n   +-----------+       +-----+            +-----+-----+\n   |           |       |     |            |     |     |\n   |           |       |     |            |     |     |\n   |           |  -->  +-----+-----+  ->  +-----+-----+\n   |           |             |     |      |     |     |\n   |           |             |     |      |     |     |\n   +-----------+             +-----+      +-----+-----+\n\n   show cached children tiles when parent is loading\n   +-------+----       +------------\n   |       |           |\n   |       |           |\n   |       |           |\n   +-------+----  -->  |\n   |       |           |\n */\nconst TILE_STATE_PLACEHOLDER = 3;\nconst TILE_STATE_HIDDEN = 4;\n// tiles that should be displayed in the current viewport\nconst TILE_STATE_SELECTED = 5;\n\nexport const STRATEGY_NEVER = 'never';\nexport const STRATEGY_REPLACE = 'no-overlap';\nexport const STRATEGY_DEFAULT = 'best-available';\n\nconst DEFAULT_CACHE_SCALE = 5;\n\n/**\n * Manages loading and purging of tiles data. This class caches recently visited tiles\n * and only create new tiles if they are present.\n */\n\nexport default class Tileset2D {\n  /**\n   * Takes in a function that returns tile data, a cache size, and a max and a min zoom level.\n   * Cache size defaults to 5 * number of tiles in the current viewport\n   */\n  constructor(opts) {\n    this.opts = opts;\n    this._getTileData = opts.getTileData;\n\n    this.onTileError = opts.onTileError;\n    this.onTileLoad = tile => {\n      opts.onTileLoad(tile);\n      if (this.opts.maxCacheByteSize) {\n        this._cacheByteSize += tile.byteLength;\n        this._resizeCache();\n      }\n    };\n    this.onTileUnload = opts.onTileUnload;\n\n    this._requestScheduler = new RequestScheduler({\n      maxRequests: opts.maxRequests,\n      throttleRequests: opts.maxRequests > 0\n    });\n\n    // Maps tile id in string {z}-{x}-{y} to a Tile object\n    this._cache = new Map();\n    this._tiles = [];\n    this._dirty = false;\n    this._cacheByteSize = 0;\n\n    // Cache the last processed viewport\n    this._viewport = null;\n    this._selectedTiles = null;\n    this._frameNumber = 0;\n\n    this.setOptions(opts);\n  }\n\n  /* Public API */\n  get tiles() {\n    return this._tiles;\n  }\n\n  get selectedTiles() {\n    return this._selectedTiles;\n  }\n\n  get isLoaded() {\n    return this._selectedTiles.every(tile => tile.isLoaded);\n  }\n\n  setOptions(opts) {\n    Object.assign(this.opts, opts);\n    if (Number.isFinite(opts.maxZoom)) {\n      this._maxZoom = Math.floor(opts.maxZoom);\n    }\n    if (Number.isFinite(opts.minZoom)) {\n      this._minZoom = Math.ceil(opts.minZoom);\n    }\n  }\n\n  /**\n   * Update the cache with the given viewport and triggers callback onUpdate.\n   * @param {*} viewport\n   * @param {*} onUpdate\n   */\n  update(viewport, {zRange} = {}) {\n    if (!viewport.equals(this._viewport)) {\n      this._viewport = viewport;\n      const tileIndices = this.getTileIndices({\n        viewport,\n        maxZoom: this._maxZoom,\n        minZoom: this._minZoom,\n        zRange\n      });\n      this._selectedTiles = tileIndices.map(index => this._getTile(index, true));\n\n      if (this._dirty) {\n        // Some new tiles are added\n        this._rebuildTree();\n      }\n    }\n\n    // Update tile states\n    const changed = this.updateTileStates();\n\n    if (this._dirty) {\n      // cache size is either the user defined maxSize or 5 * number of current tiles in the viewport.\n      this._resizeCache();\n    }\n\n    if (changed) {\n      this._frameNumber++;\n    }\n\n    return this._frameNumber;\n  }\n\n  /* Public interface for subclassing */\n\n  // Returns array of {x, y, z}\n  getTileIndices({viewport, maxZoom, minZoom, zRange}) {\n    const {tileSize, extent} = this.opts;\n    return getTileIndices({viewport, maxZoom, minZoom, zRange, tileSize, extent});\n  }\n\n  // Add custom metadata to tiles\n  getTileMetadata({x, y, z}) {\n    return {bbox: tileToBoundingBox(this._viewport, x, y, z)};\n  }\n\n  // Returns {x, y, z} of the parent tile\n  getParentIndex(tileIndex) {\n    // Perf: mutate the input object to avoid GC\n    tileIndex.x = Math.floor(tileIndex.x / 2);\n    tileIndex.y = Math.floor(tileIndex.y / 2);\n    tileIndex.z -= 1;\n    return tileIndex;\n  }\n\n  // Returns true if any tile's visibility changed\n  updateTileStates() {\n    this._updateTileStates(this.selectedTiles);\n\n    const {maxRequests} = this.opts;\n\n    const abortCandidates = [];\n    let ongoingRequestCount = 0;\n    let changed = false;\n    for (const tile of this._cache.values()) {\n      const isVisible = Boolean(tile.state & TILE_STATE_VISIBLE);\n      if (tile.isVisible !== isVisible) {\n        changed = true;\n        tile.isVisible = isVisible;\n      }\n\n      // isSelected used in request scheduler\n      tile.isSelected = tile.state === TILE_STATE_SELECTED;\n\n      // Keep track of all the ongoing requests\n      if (tile.isLoading) {\n        ongoingRequestCount++;\n        if (!tile.isSelected) {\n          abortCandidates.push(tile);\n        }\n      }\n    }\n\n    if (maxRequests > 0) {\n      while (ongoingRequestCount > maxRequests && abortCandidates.length > 0) {\n        // There are too many ongoing requests, so abort some that are unselected\n        const tile = abortCandidates.shift();\n        tile.abort();\n        ongoingRequestCount--;\n      }\n    }\n\n    return changed;\n  }\n\n  /* Private methods */\n\n  // This needs to be called every time some tiles have been added/removed from cache\n  _rebuildTree() {\n    const {_cache} = this;\n\n    // Reset states\n    for (const tile of _cache.values()) {\n      tile.parent = null;\n      tile.children.length = 0;\n    }\n\n    // Rebuild tree\n    for (const tile of _cache.values()) {\n      const parent = this._getNearestAncestor(tile.x, tile.y, tile.z);\n      tile.parent = parent;\n      if (parent) {\n        parent.children.push(tile);\n      }\n    }\n  }\n\n  // A selected tile is always visible.\n  // Never show two overlapping tiles.\n  // If a selected tile is loading, try showing a cached ancester with the closest z\n  // If a selected tile is loading, and no ancester is shown - try showing cached\n  // descendants with the closest z\n  _updateTileStates(selectedTiles) {\n    const {_cache} = this;\n    const refinementStrategy = this.opts.refinementStrategy || STRATEGY_DEFAULT;\n\n    // Reset states\n    for (const tile of _cache.values()) {\n      tile.state = TILE_STATE_UNKNOWN;\n    }\n\n    // For all the selected && pending tiles:\n    // - pick the closest ancestor as placeholder\n    // - if no ancestor is visible, pick the closest children as placeholder\n    for (const tile of selectedTiles) {\n      tile.state = TILE_STATE_SELECTED;\n    }\n\n    if (refinementStrategy === STRATEGY_NEVER) {\n      return;\n    }\n    for (const tile of selectedTiles) {\n      getPlaceholderInAncestors(tile, refinementStrategy);\n    }\n    for (const tile of selectedTiles) {\n      if (needsPlaceholder(tile)) {\n        getPlaceholderInChildren(tile);\n      }\n    }\n  }\n\n  /**\n   * Clear tiles that are not visible when the cache is full\n   */\n  /* eslint-disable complexity */\n  _resizeCache() {\n    const {_cache, opts} = this;\n\n    const maxCacheSize =\n      opts.maxCacheSize ||\n      (opts.maxCacheByteSize ? Infinity : DEFAULT_CACHE_SCALE * this.selectedTiles.length);\n    const maxCacheByteSize = opts.maxCacheByteSize || Infinity;\n\n    const overflown = _cache.size > maxCacheSize || this._cacheByteSize > maxCacheByteSize;\n\n    if (overflown) {\n      for (const [tileId, tile] of _cache) {\n        if (!tile.isVisible) {\n          // delete tile\n          this._cacheByteSize -= opts.maxCacheByteSize ? tile.byteLength : 0;\n          _cache.delete(tileId);\n          this.onTileUnload(tile);\n        }\n        if (_cache.size <= maxCacheSize && this._cacheByteSize <= maxCacheByteSize) {\n          break;\n        }\n      }\n      this._rebuildTree();\n      this._dirty = true;\n    }\n    if (this._dirty) {\n      this._tiles = Array.from(this._cache.values())\n        // sort by zoom level so that smaller tiles are displayed on top\n        .sort((t1, t2) => t1.z - t2.z);\n\n      this._dirty = false;\n    }\n  }\n  /* eslint-enable complexity */\n\n  _getTile({x, y, z}, create) {\n    const tileId = `${x},${y},${z}`;\n    let tile = this._cache.get(tileId);\n\n    if (!tile && create) {\n      tile = new Tile2DHeader({\n        x,\n        y,\n        z,\n        onTileLoad: this.onTileLoad,\n        onTileError: this.onTileError\n      });\n      Object.assign(tile, this.getTileMetadata(tile));\n      tile.loadData(this._getTileData, this._requestScheduler);\n      this._cache.set(tileId, tile);\n      this._dirty = true;\n    } else if (tile && tile.isCancelled && !tile.isLoading) {\n      tile.loadData(this._getTileData, this._requestScheduler);\n    }\n\n    return tile;\n  }\n\n  _getNearestAncestor(x, y, z) {\n    const {_minZoom = 0} = this;\n    let index = {x, y, z};\n\n    while (index.z > _minZoom) {\n      index = this.getParentIndex(index);\n      const parent = this._getTile(index);\n      if (parent) {\n        return parent;\n      }\n    }\n    return null;\n  }\n}\n\n// A selected tile needs placeholder from its children if\n// - it is not loaded\n// - none of its ancestors is visible and loaded\nfunction needsPlaceholder(tile) {\n  let t = tile;\n  while (t) {\n    if (t.state & (TILE_STATE_VISIBLE === 0)) {\n      return true;\n    }\n    if (t.isLoaded) {\n      return false;\n    }\n    t = t.parent;\n  }\n  return true;\n}\n\nfunction getPlaceholderInAncestors(tile, refinementStrategy) {\n  let parent;\n  let state = TILE_STATE_PLACEHOLDER;\n  while ((parent = tile.parent)) {\n    if (tile.isLoaded) {\n      // If a tile is loaded, mark all its ancestors as hidden\n      state = TILE_STATE_HIDDEN;\n      if (refinementStrategy === STRATEGY_DEFAULT) {\n        return;\n      }\n    }\n    parent.state = Math.max(parent.state, state);\n    tile = parent;\n  }\n}\n\n// Recursively set children as placeholder\nfunction getPlaceholderInChildren(tile) {\n  for (const child of tile.children) {\n    child.state = Math.max(child.state, TILE_STATE_PLACEHOLDER);\n    if (!child.isLoaded) {\n      getPlaceholderInChildren(child);\n    }\n  }\n}\n","import {CompositeLayer, _flatten as flatten} from '@deck.gl/core';\nimport {GeoJsonLayer} from '@deck.gl/layers';\nimport {load} from '@loaders.gl/core';\n\nimport Tileset2D, {STRATEGY_DEFAULT} from './tileset-2d';\nimport {urlType, getURLFromTemplate} from './utils';\n\nconst defaultProps = {\n  data: [],\n  dataComparator: urlType.equals,\n  renderSubLayers: {type: 'function', value: props => new GeoJsonLayer(props), compare: false},\n  getTileData: {type: 'function', optional: true, value: null, compare: false},\n  // TODO - change to onViewportLoad to align with Tile3DLayer\n  onViewportLoad: {type: 'function', optional: true, value: null, compare: false},\n  onTileLoad: {type: 'function', value: tile => {}, compare: false},\n  onTileUnload: {type: 'function', value: tile => {}, compare: false},\n  // eslint-disable-next-line\n  onTileError: {type: 'function', value: err => console.error(err), compare: false},\n  extent: {type: 'array', optional: true, value: null, compare: true},\n  tileSize: 512,\n  maxZoom: null,\n  minZoom: 0,\n  maxCacheSize: null,\n  maxCacheByteSize: null,\n  refinementStrategy: STRATEGY_DEFAULT,\n  zRange: null,\n  // Use load directly so we don't use ResourceManager\n  fetch: {\n    type: 'function',\n    value: (url, {layer, signal}) => {\n      const loadOptions = {signal, ...(layer.getLoadOptions() || {})};\n\n      return load(url, loadOptions);\n    },\n    compare: false\n  },\n  maxRequests: 6\n};\n\nexport default class TileLayer extends CompositeLayer {\n  initializeState() {\n    this.state = {\n      tiles: [],\n      isLoaded: false\n    };\n  }\n\n  get isLoaded() {\n    const {tileset} = this.state;\n    return tileset.selectedTiles.every(\n      tile => tile.layers && tile.layers.every(layer => layer.isLoaded)\n    );\n  }\n\n  shouldUpdateState({changeFlags}) {\n    return changeFlags.somethingChanged;\n  }\n\n  updateState({props, oldProps, context, changeFlags}) {\n    let {tileset} = this.state;\n    const createTileCache =\n      !tileset ||\n      changeFlags.dataChanged ||\n      (changeFlags.updateTriggersChanged &&\n        (changeFlags.updateTriggersChanged.all || changeFlags.updateTriggersChanged.getTileData));\n\n    if (createTileCache) {\n      const maxZoom = Number.isFinite(this.state.maxZoom) ? this.state.maxZoom : props.maxZoom;\n      const minZoom = Number.isFinite(this.state.minZoom) ? this.state.minZoom : props.minZoom;\n      const {\n        tileSize,\n        maxCacheSize,\n        maxCacheByteSize,\n        refinementStrategy,\n        extent,\n        maxRequests\n      } = props;\n      tileset = new Tileset2D({\n        getTileData: this.getTileData.bind(this),\n        maxCacheSize,\n        maxCacheByteSize,\n        maxZoom,\n        minZoom,\n        tileSize,\n        refinementStrategy,\n        extent,\n        onTileLoad: this._onTileLoad.bind(this),\n        onTileError: this._onTileError.bind(this),\n        onTileUnload: this._onTileUnload.bind(this),\n        maxRequests\n      });\n      this.setState({tileset});\n    } else if (changeFlags.propsChanged || changeFlags.updateTriggersChanged) {\n      tileset.setOptions(props);\n      // if any props changed, delete the cached layers\n      this.state.tileset.tiles.forEach(tile => {\n        tile.layers = null;\n      });\n    }\n\n    this._updateTileset();\n  }\n\n  _updateTileset() {\n    const {tileset} = this.state;\n    const {onViewportLoad, zRange} = this.props;\n    const frameNumber = tileset.update(this.context.viewport, {zRange});\n    const {isLoaded} = tileset;\n\n    const loadingStateChanged = this.state.isLoaded !== isLoaded;\n    const tilesetChanged = this.state.frameNumber !== frameNumber;\n\n    if (isLoaded && onViewportLoad && (loadingStateChanged || tilesetChanged)) {\n      onViewportLoad(tileset.selectedTiles.map(tile => tile.data));\n    }\n\n    if (tilesetChanged) {\n      // Save the tileset frame number - trigger a rerender\n      this.setState({frameNumber});\n    }\n    // Save the loaded state - should not trigger a rerender\n    this.state.isLoaded = isLoaded;\n  }\n\n  _onTileLoad(tile) {\n    const layer = this.getCurrentLayer();\n    layer.props.onTileLoad(tile);\n\n    if (tile.isVisible) {\n      this.setNeedsUpdate();\n    }\n  }\n\n  _onTileError(error, tile) {\n    const layer = this.getCurrentLayer();\n    layer.props.onTileError(error);\n    // errorred tiles should not block rendering, are considered \"loaded\" with empty data\n    layer._updateTileset();\n\n    if (tile.isVisible) {\n      this.setNeedsUpdate();\n    }\n  }\n\n  _onTileUnload(tile) {\n    const layer = this.getCurrentLayer();\n    layer.props.onTileUnload(tile);\n  }\n\n  // Methods for subclass to override\n\n  getTileData(tile) {\n    const {data} = this.props;\n    const {getTileData, fetch} = this.getCurrentLayer().props;\n    const {signal} = tile;\n\n    tile.url = getURLFromTemplate(data, tile);\n\n    if (getTileData) {\n      return getTileData(tile);\n    }\n    if (tile.url) {\n      return fetch(tile.url, {layer: this, signal});\n    }\n    return null;\n  }\n\n  renderSubLayers(props) {\n    return this.props.renderSubLayers(props);\n  }\n\n  getHighlightedObjectIndex() {\n    return -1;\n  }\n\n  getPickingInfo({info, sourceLayer}) {\n    info.sourceLayer = sourceLayer;\n    info.tile = sourceLayer.props.tile;\n    return info;\n  }\n\n  renderLayers() {\n    const {visible} = this.props;\n    return this.state.tileset.tiles.map(tile => {\n      // For a tile to be visible:\n      // - parent layer must be visible\n      // - tile must be visible in the current viewport\n      const isVisible = visible && tile.isVisible;\n      const highlightedObjectIndex = this.getHighlightedObjectIndex(tile);\n      // cache the rendered layer in the tile\n      if (!tile.isLoaded) {\n        // no op\n      } else if (!tile.layers) {\n        const layers = this.renderSubLayers(\n          Object.assign({}, this.props, {\n            id: `${this.id}-${tile.x}-${tile.y}-${tile.z}`,\n            data: tile.data,\n            visible: isVisible,\n            _offset: 0,\n            tile,\n            highlightedObjectIndex\n          })\n        );\n        tile.layers = flatten(layers, Boolean);\n      } else if (\n        tile.layers[0] &&\n        (tile.layers[0].props.visible !== isVisible ||\n          tile.layers[0].props.highlightedObjectIndex !== highlightedObjectIndex)\n      ) {\n        tile.layers = tile.layers.map(layer =>\n          layer.clone({visible: isVisible, highlightedObjectIndex})\n        );\n      }\n      return tile.layers;\n    });\n  }\n}\n\nTileLayer.layerName = 'TileLayer';\nTileLayer.defaultProps = defaultProps;\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport {deepEqual} from '../utils/deep-equal';\n\nexport default class LayerExtension {\n  constructor(opts = {}) {\n    this.opts = opts;\n  }\n\n  equals(extension) {\n    if (this === extension) {\n      return true;\n    }\n\n    return this.constructor === extension.constructor && deepEqual(this.opts, extension.opts);\n  }\n\n  getShaders(extension) {\n    return null;\n  }\n\n  getSubLayerProps(extension) {\n    const {defaultProps = {}} = extension.constructor;\n    const newProps = {\n      updateTriggers: {}\n    };\n\n    /* eslint-disable max-depth */\n    for (const key in defaultProps) {\n      if (key in this.props) {\n        const propDef = defaultProps[key];\n        const propValue = this.props[key];\n        newProps[key] = propValue;\n        if (propDef && propDef.type === 'accessor') {\n          newProps.updateTriggers[key] = this.props.updateTriggers[key];\n          if (typeof propValue === 'function') {\n            newProps[key] = this.getSubLayerAccessor(propValue, true);\n          }\n        }\n      }\n    }\n    /* eslint-enable max-depth */\n    return newProps;\n  }\n\n  initializeState(context, extension) {}\n\n  updateState(params, extension) {}\n\n  draw(params, extension) {}\n\n  finalizeState(extension) {}\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport {LayerExtension} from '@deck.gl/core';\n\nconst defaultProps = {\n  clipBounds: [0, 0, 1, 1]\n};\n\nconst shaderFunction = `\nuniform vec4 clip_bounds;\n\nbool clip_isInBounds(vec2 position) {\n  return position.x >= clip_bounds[0] && position.y >= clip_bounds[1] && position.x < clip_bounds[2] && position.y < clip_bounds[3];\n}\n`;\n\n/*\n * The vertex-shader version clips geometries by their anchor position\n * e.g. ScatterplotLayer - show if the center of a circle is within bounds\n */\nconst shaderModuleVs = {\n  name: 'clip-vs',\n  vs: shaderFunction\n};\n\nconst injectionVs = {\n  'vs:#decl': `\nvarying float clip_isVisible;\n`,\n  'vs:DECKGL_FILTER_GL_POSITION': `\n  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));\n`,\n  'fs:#decl': `\nvarying float clip_isVisible;\n`,\n  'fs:DECKGL_FILTER_COLOR': `\n  if (clip_isVisible < 0.5) discard;\n`\n};\n\n/*\n * The fragment-shader version clips pixels at the bounds\n * e.g. PolygonLayer - show the part of the polygon that intersect with the bounds \n */\nconst shaderModuleFs = {\n  name: 'clip-fs',\n  fs: shaderFunction\n};\n\nconst injectionFs = {\n  'vs:#decl': `\nvarying vec2 clip_commonPosition;\n`,\n  'vs:DECKGL_FILTER_GL_POSITION': `\n  clip_commonPosition = geometry.position.xy;\n`,\n  'fs:#decl': `\nvarying vec2 clip_commonPosition;\n`,\n  'fs:DECKGL_FILTER_COLOR': `\n  if (!clip_isInBounds(clip_commonPosition)) discard;\n`\n};\n\nexport default class ClipExtension extends LayerExtension {\n  getShaders() {\n    // If `clipByInstance: true`, the entire object is shown/hidden based on its anchor position (done by vertex shader)\n    // Otherwise, the object is trimmed by the clip bounds (done by fragment shader)\n\n    // Default behavior: consider a layer instanced if it has attribute `instancePositions`\n    let clipByInstance = 'instancePositions' in this.getAttributeManager().attributes;\n    // Users can override by setting the `clipByInstance` prop\n    if ('clipByInstance' in this.props) {\n      clipByInstance = this.props.clipByInstance;\n    }\n    this.state.clipByInstance = clipByInstance;\n\n    return clipByInstance\n      ? {\n          modules: [shaderModuleVs],\n          inject: injectionVs\n        }\n      : {\n          modules: [shaderModuleFs],\n          inject: injectionFs\n        };\n  }\n\n  draw({uniforms}) {\n    const {clipBounds = defaultProps.clipBounds} = this.props;\n    if (this.state.clipByInstance) {\n      uniforms.clip_bounds = clipBounds;\n    } else {\n      const corner0 = this.projectPosition([clipBounds[0], clipBounds[1], 0]);\n      const corner1 = this.projectPosition([clipBounds[2], clipBounds[3], 0]);\n\n      uniforms.clip_bounds = [\n        Math.min(corner0[0], corner1[0]),\n        Math.min(corner0[1], corner1[1]),\n        Math.max(corner0[0], corner1[0]),\n        Math.max(corner0[1], corner1[1])\n      ];\n    }\n  }\n}\n\nClipExtension.extensionName = 'ClipExtension';\nClipExtension.defaultProps = defaultProps;\n","import {Matrix4} from 'math.gl';\nimport {MVTLoader} from '@loaders.gl/mvt';\nimport {load} from '@loaders.gl/core';\nimport {COORDINATE_SYSTEM} from '@deck.gl/core';\n\nimport TileLayer from '../tile-layer/tile-layer';\nimport {getURLFromTemplate, isURLTemplate} from '../tile-layer/utils';\nimport ClipExtension from './clip-extension';\n\nconst WORLD_SIZE = 512;\n\nconst defaultProps = {\n  uniqueIdProperty: {type: 'string', value: ''},\n  highlightedFeatureId: null\n};\n\nasync function fetchTileJSON(url) {\n  try {\n    return await load(url);\n  } catch (error) {\n    throw new Error(`An error occurred fetching TileJSON: ${error}`);\n  }\n}\n\nexport default class MVTLayer extends TileLayer {\n  initializeState() {\n    super.initializeState();\n    this.setState({\n      data: null,\n      tileJSON: null\n    });\n  }\n\n  get isLoaded() {\n    return this.state.data && this.state.tileset && super.isLoaded;\n  }\n\n  updateState({props, oldProps, context, changeFlags}) {\n    if (changeFlags.dataChanged) {\n      this._updateTileData({props});\n    }\n\n    if (this.state.data) {\n      super.updateState({props, oldProps, context, changeFlags});\n    }\n  }\n\n  async _updateTileData({props}) {\n    const {onDataLoad} = this.props;\n    let {data} = props;\n    let tileJSON = null;\n    let {minZoom, maxZoom} = props;\n\n    if (typeof data === 'string' && !isURLTemplate(data)) {\n      this.setState({data: null, tileJSON: null});\n      tileJSON = await fetchTileJSON(data);\n\n      if (Number.isFinite(tileJSON.minzoom) && tileJSON.minzoom > minZoom) {\n        minZoom = tileJSON.minzoom;\n      }\n\n      if (\n        Number.isFinite(tileJSON.maxzoom) &&\n        (!Number.isFinite(maxZoom) || tileJSON.maxzoom < maxZoom)\n      ) {\n        maxZoom = tileJSON.maxzoom;\n      }\n\n      if (onDataLoad) {\n        onDataLoad(tileJSON);\n      }\n    } else if (data.tilejson) {\n      tileJSON = data;\n    }\n\n    if (tileJSON) {\n      data = tileJSON.tiles;\n    }\n\n    this.setState({data, tileJSON, minZoom, maxZoom});\n  }\n\n  renderLayers() {\n    if (!this.state.data) return null;\n    return super.renderLayers();\n  }\n\n  getTileData(tile) {\n    const url = getURLFromTemplate(this.state.data, tile);\n    if (!url) {\n      return Promise.reject('Invalid URL');\n    }\n    let options = this.getLoadOptions();\n    options = {\n      ...options,\n      mvt: {\n        ...(options && options.mvt),\n        coordinates: this.context.viewport.resolution ? 'wgs84' : 'local',\n        tileIndex: {x: tile.x, y: tile.y, z: tile.z}\n      }\n    };\n    return load(url, MVTLoader, options);\n  }\n\n  renderSubLayers(props) {\n    const {tile} = props;\n    const worldScale = Math.pow(2, tile.z);\n\n    const xScale = WORLD_SIZE / worldScale;\n    const yScale = -xScale;\n\n    const xOffset = (WORLD_SIZE * tile.x) / worldScale;\n    const yOffset = WORLD_SIZE * (1 - tile.y / worldScale);\n\n    const modelMatrix = new Matrix4().scale([xScale, yScale, 1]);\n\n    props.autoHighlight = false;\n    if (!this.context.viewport.resolution) {\n      props.modelMatrix = modelMatrix;\n      props.coordinateOrigin = [xOffset, yOffset, 0];\n      props.coordinateSystem = COORDINATE_SYSTEM.CARTESIAN;\n      props.extensions = [...(props.extensions || []), new ClipExtension()];\n    }\n\n    return super.renderSubLayers(props);\n  }\n\n  onHover(info, pickingEvent) {\n    const {uniqueIdProperty, autoHighlight} = this.props;\n\n    if (autoHighlight) {\n      const {hoveredFeatureId} = this.state;\n      const hoveredFeature = info.object;\n      let newHoveredFeatureId;\n\n      if (hoveredFeature) {\n        newHoveredFeatureId = getFeatureUniqueId(hoveredFeature, uniqueIdProperty);\n      }\n\n      if (hoveredFeatureId !== newHoveredFeatureId) {\n        this.setState({hoveredFeatureId: newHoveredFeatureId});\n      }\n    }\n\n    return super.onHover(info, pickingEvent);\n  }\n\n  getHighlightedObjectIndex(tile) {\n    const {hoveredFeatureId} = this.state;\n    const {uniqueIdProperty, highlightedFeatureId} = this.props;\n    const {data} = tile;\n\n    const isFeatureIdPresent =\n      isFeatureIdDefined(hoveredFeatureId) || isFeatureIdDefined(highlightedFeatureId);\n\n    if (!isFeatureIdPresent || !Array.isArray(data)) {\n      return -1;\n    }\n\n    const featureIdToHighlight = isFeatureIdDefined(highlightedFeatureId)\n      ? highlightedFeatureId\n      : hoveredFeatureId;\n\n    return data.findIndex(\n      feature => getFeatureUniqueId(feature, uniqueIdProperty) === featureIdToHighlight\n    );\n  }\n}\n\nfunction getFeatureUniqueId(feature, uniqueIdProperty) {\n  if (uniqueIdProperty) {\n    return feature.properties[uniqueIdProperty];\n  }\n\n  if ('id' in feature) {\n    return feature.id;\n  }\n\n  return -1;\n}\n\nfunction isFeatureIdDefined(value) {\n  return value !== undefined && value !== null && value !== '';\n}\n\nMVTLayer.layerName = 'MVTLayer';\nMVTLayer.defaultProps = defaultProps;\n","const defaultCredentials = {\n  username: 'public',\n  apiKey: 'default_public',\n  region: 'us',\n  // Set to null to guess from mapsUrl attribute. Other values are 'v1' or 'v2'\n  mapsVersion: null,\n  // SQL API URL\n  sqlUrl: 'https://{user}.carto.com/api/v2/sql',\n  // Maps API URL\n  mapsUrl: 'https://maps-api-v2.{region}.carto.com/user/{user}/map'\n};\n\nlet credentials = defaultCredentials;\n\nexport function setDefaultCredentials(opts) {\n  credentials = {\n    ...credentials,\n    ...opts\n  };\n}\n\nexport function getDefaultCredentials() {\n  return credentials;\n}\n\nexport function getMapsVersion(creds) {\n  const localCreds = creds || credentials;\n  if (localCreds.mapsVersion) {\n    return localCreds.mapsVersion;\n  }\n\n  return localCreds.mapsUrl.includes('api/v1/map') ? 'v1' : 'v2';\n}\n","import {getDefaultCredentials, getMapsVersion} from '../config';\n\nconst DEFAULT_USER_COMPONENT_IN_URL = '{user}';\nconst DEFAULT_REGION_COMPONENT_IN_URL = '{region}';\n\n/**\n * Obtain a TileJson from Maps API v1 and v2\n */\nexport async function getTileJSON(mapConfig, credentials) {\n  const creds = {...getDefaultCredentials(), ...credentials};\n  switch (getMapsVersion(creds)) {\n    case 'v1':\n      // Maps API v1\n      const layergroup = await instantiateMap({mapConfig, credentials: creds});\n      return layergroup.metadata.tilejson.vector;\n\n    case 'v2':\n      // Maps API v2\n      return await instantiateMap({mapConfig, credentials: creds});\n\n    default:\n      throw new Error('Invalid maps API version. It shoud be v1 or v2');\n  }\n}\n\n/**\n * Instantiate a map using Maps API\n */\nasync function instantiateMap({mapConfig, credentials}) {\n  const url = buildURL({mapConfig, credentials});\n\n  let response;\n\n  try {\n    /* global fetch */\n    /* eslint no-undef: \"error\" */\n    response = await fetch(url, {\n      headers: {\n        Accept: 'application/json'\n      }\n    });\n  } catch (error) {\n    throw new Error(`Failed to connect to Maps API: ${error}`);\n  }\n\n  const json = await response.json();\n\n  if (!response.ok) {\n    dealWithError({response, json, credentials});\n  }\n\n  return json;\n}\n\n/**\n * Display proper message from Maps API error\n */\nfunction dealWithError({response, json, credentials}) {\n  switch (response.status) {\n    case 401:\n      throw new Error(\n        `Unauthorized access to Maps API: invalid combination of user ('${\n          credentials.username\n        }') and apiKey ('${credentials.apiKey}')`\n      );\n    case 403:\n      throw new Error(\n        `Unauthorized access to dataset: the provided apiKey('${\n          credentials.apiKey\n        }') doesn't provide access to the requested data`\n      );\n\n    default:\n      const e = getMapsVersion() === 'v1' ? JSON.stringify(json.errors) : json.error;\n      throw new Error(e);\n  }\n}\n\n/**\n * Build a URL with all required parameters\n */\nfunction buildURL({mapConfig, credentials}) {\n  const cfg = JSON.stringify(mapConfig);\n  const encodedApiKey = encodeParameter('api_key', credentials.apiKey);\n  const encodedClient = encodeParameter('client', `deck-gl-carto`);\n  const parameters = [encodedApiKey, encodedClient];\n  return `${mapsUrl(credentials)}?${parameters.join('&')}&${encodeParameter('config', cfg)}`;\n}\n\n/**\n * Prepare a url valid for the specified user\n */\nfunction mapsUrl(credentials) {\n  return credentials.mapsUrl\n    .replace(DEFAULT_USER_COMPONENT_IN_URL, credentials.username)\n    .replace(DEFAULT_REGION_COMPONENT_IN_URL, credentials.region);\n}\n\n/**\n * Simple encode parameter\n */\nfunction encodeParameter(name, value) {\n  return `${name}=${encodeURIComponent(value)}`;\n}\n","import {CompositeLayer} from '@deck.gl/core';\nimport {MVTLayer} from '@deck.gl/geo-layers';\nimport {getTileJSON} from '../api/maps-api-client';\n\nconst defaultProps = {\n  data: null,\n  credentials: null,\n  onDataLoad: {type: 'function', value: tilejson => {}, compare: false},\n  // eslint-disable-next-line\n  onDataError: {type: 'function', value: err => console.error(err), compare: false}\n};\n\nexport default class CartoLayer extends CompositeLayer {\n  initializeState() {\n    this.state = {\n      tilejson: null\n    };\n  }\n\n  updateState({changeFlags}) {\n    const {data} = this.props;\n    if (changeFlags.dataChanged && data) {\n      this._updateData();\n    }\n  }\n\n  async _updateData() {\n    try {\n      const tilejson = await this._updateTileJSON();\n      this.setState({tilejson});\n      this.props.onDataLoad(tilejson);\n    } catch (err) {\n      this.props.onDataError(err);\n    }\n  }\n\n  buildMapConfig() {\n    throw new Error('You must use one of the specific carto layers: BQ or SQL type');\n  }\n\n  async _updateTileJSON() {\n    const tilejson = await getTileJSON(this.buildMapConfig(this.props), this.props.credentials);\n    return tilejson;\n  }\n\n  onHover(info, pickingEvent) {\n    const [mvtLayer] = this.getSubLayers();\n    return mvtLayer ? mvtLayer.onHover(info, pickingEvent) : super.onHover(info, pickingEvent);\n  }\n\n  renderLayers() {\n    if (!this.state.tilejson) return null;\n\n    const {updateTriggers} = this.props;\n\n    return new MVTLayer(\n      this.props,\n      this.getSubLayerProps({\n        id: 'mvt',\n        data: this.state.tilejson,\n        updateTriggers\n      })\n    );\n  }\n}\n\nCartoLayer.layerName = 'CartoLayer';\nCartoLayer.defaultProps = defaultProps;\n","import CartoLayer from './carto-layer';\n\nexport default class CartoBQTilerLayer extends CartoLayer {\n  buildMapConfig() {\n    return {\n      version: '2.0.0',\n      layers: [\n        {\n          type: 'tileset',\n          source: 'bigquery',\n          options: {\n            tileset: this.props.data\n          }\n        }\n      ]\n    };\n  }\n}\n\nCartoBQTilerLayer.layerName = 'CartoBQTilerLayer';\n","import CartoLayer from './carto-layer';\nimport {getMapsVersion} from '../config';\n\nconst defaultProps = {\n  bufferSize: 16, // MVT buffersize in pixels,\n  tileExtent: 4096, // Tile extent in tile coordinate space (MVT spec.)\n  uniqueIdProperty: 'cartodb_id'\n};\n\nexport default class CartoSQLLayer extends CartoLayer {\n  buildMapConfig() {\n    const {data, bufferSize, tileExtent} = this.props;\n\n    const version = getMapsVersion(this.props.creds);\n    const isSQL = data.search(' ') > -1;\n    const sql = isSQL ? data : `SELECT * FROM ${data}`;\n\n    switch (version) {\n      case 'v1':\n        // Map config v1\n        return {\n          version: '1.3.1',\n          buffersize: {\n            mvt: bufferSize\n          },\n          layers: [\n            {\n              type: 'mapnik',\n              options: {\n                sql: sql.trim(),\n                vector_extent: tileExtent\n              }\n            }\n          ]\n        };\n\n      case 'v2':\n        // Map config v2\n        return {\n          version: '2.0.0',\n          buffer_size: bufferSize,\n          tile_extent: tileExtent,\n          layers: [\n            {\n              type: 'query',\n              source: 'postgres',\n              options: {\n                sql: sql.trim(),\n                vector_extent: tileExtent\n              }\n            }\n          ]\n        };\n      default:\n        throw new Error(`Cannot build MapConfig for unmatching version ${version}`);\n    }\n  }\n}\n\nCartoSQLLayer.layerName = 'CartoSQLLayer';\nCartoSQLLayer.defaultProps = defaultProps;\n","const base_url = 'https://basemaps.cartocdn.com/gl/{basemap}-gl-style/style.json';\n\nexport default {\n  VOYAGER: base_url.replace('{basemap}', 'voyager'),\n  POSITRON: base_url.replace('{basemap}', 'positron'),\n  DARK_MATTER: base_url.replace('{basemap}', 'dark-matter')\n};\n","// This configuration object determines which deck.gl classes are accessible in Playground\n\nimport {MapView } from '@deck.gl/core';\n\nimport {CartoSQLLayer, CartoBQTilerLayer, BASEMAP} from '@deck.gl/carto';\n\nconst config = {\n  // Classes that should be instantiatable by JSON converter\n  classes: Object.assign(\n    {MapView},\n    {CartoBQTilerLayer, CartoSQLLayer},\n  ),\n\n  enumerations: {\n    CARTO_BASEMAP: BASEMAP\n  }\n};\n\nexport default config;\n\n\n","import React, {Component} from 'react';\nimport DeckGL from '@deck.gl/react';\nimport {View} from '@deck.gl/core';\n\nexport default class DeckWithMapboxMaps extends Component {\n  render() {\n    const {views = []} = this.props;\n\n    const maps = [];\n    for (const view of views) {\n      if (view.props.map || view.props.mapStyle) {\n        maps.push(\n          <View id={view.props.id} key={view.props.id}>\n            <this.props.Map\n              reuseMap\n              mapStyle={view.props.mapStyle}\n            />\n          </View>\n        );\n      }\n    }\n    return (\n      <DeckGL id=\"json-deck\" {...this.props}>\n        {maps}\n      </DeckGL>\n    );\n  }\n}\n","/* global console, document, window */\nimport React, {Component} from 'react';\nimport {GoogleMapsOverlay} from '@deck.gl/google-maps';\n\nconst HOST = 'https://maps.googleapis.com/maps/api/js';\nconst LOADING_GIF = 'https://upload.wikimedia.org/wikipedia/commons/d/de/Ajax-loader.gif';\n\nconst style = {\n  height: 1000,\n  width: 1000\n};\n\nfunction injectScript(src) {\n  return new Promise((resolve, reject) => {\n    const script = document.createElement('script');\n    script.src = src;\n    script.addEventListener('load', resolve);\n    script.addEventListener('error', e => reject(e.error));\n    document.head.appendChild(script);\n  });\n}\n\nfunction loadGoogleMapApi(apiKey, onComplete) {\n  const url = `${HOST}?key=${apiKey}&libraries=places`;\n  injectScript(url)\n    .then(() => onComplete())\n    // eslint-disable-next-line no-console\n    .catch(e => console.error(e));\n}\n\nexport default class DeckWithGoogleMaps extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      googleMapsLoaded: window.google && window.google.maps\n    };\n  }\n\n  componentDidMount() {\n    const {googleMapsToken} = this.props;\n    if (!window.google || (window.google && !window.google.maps)) {\n      loadGoogleMapApi(googleMapsToken, () => {\n        this.setState({googleMapsLoaded: true});\n      });\n    }\n  }\n\n  render() {\n    const {googleMapsLoaded} = this.state;\n    if (!googleMapsLoaded) {\n      return <img src={LOADING_GIF} alt=\"Loading Google Maps overlay...\" />;\n    }\n\n    return <DeckOverlayWrapper {...this.props} />;\n  }\n}\n\nclass DeckOverlayWrapper extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isOverlayConfigured: false\n    };\n    this.DeckOverlay = new GoogleMapsOverlay({layers: []});\n    this.containerRef = React.createRef();\n  }\n\n  componentDidMount() {\n    const {initialViewState} = this.props;\n    const view = {\n      center: {lat: initialViewState.latitude, lng: initialViewState.longitude},\n      mapTypeId: this.props.mapTypeId || 'satellite',\n      zoom: initialViewState.zoom\n    };\n\n    const map = new window.google.maps.Map(this.containerRef.current, view);\n    this.DeckOverlay.setMap(map);\n    this.DeckOverlay.setProps({layers: this.props.layers});\n    // eslint-disable-next-line react/no-did-mount-set-state\n    this.setState({isOverlayConfigured: true});\n  }\n\n  componentDidUpdate(prevProps, prevState, snapshot) {\n    this.DeckOverlay.setProps({layers: this.props.layers});\n  }\n\n  componentWillUnmount() {\n    delete this.DeckOverlay;\n  }\n\n  render() {\n    return <div ref={this.containerRef} style={style} />;\n  }\n}\n","import DeckWithMapboxMaps from './deck-with-mapbox-maps';\nimport DeckWithGoogleMaps from './deck-with-google-maps';\nimport {StaticMap} from 'react-map-gl';\nimport {BASEMAP} from '@deck.gl/carto';\n\nconst GOOGLE_MAPS_TOKEN = \"AIzaSyCb2CTi3B6uarznVAs33W8VMER-1wz3ZrI\"\n\nexport default function Map(props) {\n  let deckMap;\n  if (props && props && props.google) {\n    deckMap = (\n      <DeckWithGoogleMaps\n        id=\"json-deck\"\n        {...props}\n        googleMapsToken={GOOGLE_MAPS_TOKEN}\n      />\n    );\n  } else {\n    deckMap = (\n      <DeckWithMapboxMaps\n        id=\"json-deck\"\n        {...props}\n        Map={StaticMap}\n        mapStyle={BASEMAP.POSITRON}\n      />\n    );\n  }\n  \n  return deckMap;\n};\n\n","import {useState} from 'react';\nimport AceEditor from 'react-ace';\nimport 'brace/mode/json';\nimport 'brace/theme/github';\n\nexport default function JSONEditor(props) {\n  const [text, setText] = useState(JSON.stringify(props.json, null, 2));\n  const [visible, setVisible] = useState(false);\n  \n  function handleChange(text, event){\n\n    // Parse JSON, while capturing and ignoring exceptions\n    try {\n      text && JSON.parse(text);\n      setText(text);\n      if (props.onChange) {\n        props.onChange(text);\n      }\n    } catch (error) {\n      // ignore error, user is editing and not yet correct JSON\n    }\n  }\n\n  if (visible) {\n    return (\n      <div className='json-form'>\n        <AceEditor\n                  width=\"500px\"\n                  height=\"500px\"\n                  mode=\"json\"\n                  theme=\"github\"\n                  onChange={handleChange}\n                  name=\"AceEditorDiv\"\n                  editorProps={{$blockScrolling: true}}\n                  wrapEnabled={true}\n                  value={text}\n                />\n        <button onClick={() => setVisible(false)}>\n          Close\n        </button>\n      </div>\n    )\n  }\n  else {\n    return (\n      <button onClick={() => setVisible(true)}>\n      Config\n      </button>\n    )\n  }\n}","import {useState, useEffect} from 'react';\nimport {useLocation} from \"react-router-dom\";\nimport {JSONConverter, JSONConfiguration} from '@deck.gl/json';\nimport JSON_CONVERTER_CONFIGURATION from '../json/configuration';\nimport Map from '../components/map';\nimport JSONEditor from '../components/json-editor';\n\nconst configuration = new JSONConfiguration(JSON_CONVERTER_CONFIGURATION);\nconst jsonConverter = new JSONConverter({configuration});\n\nfunction addUpdateTriggersForAccesors(json) {\n  if (!json || !json.layers) return;\n\n  for (const layer of json.layers) {\n    const updateTriggers = {};\n    for (const [key, value] of Object.entries(layer)) {\n      if (key.startsWith('get') && typeof value === 'string') {\n        // it's an accesor and it's a string\n        // we add the value of the accesor to update trigger to refresh when it changes\n        updateTriggers[key] = value;\n      }\n    }\n    if (Object.keys(updateTriggers).length) {\n      layer.updateTriggers = updateTriggers;\n    }\n  }\n}\n\nfunction initJSON(query) {\n  const config = query.get('config');\n  let json;\n\n  if (!config) {\n    // valid types are query and tileset\n    let type = query.get('type') ||'sql'\n    // valid sources are postgres and bigquery\n    let source = query.get('source') ||'postgres'\n    let data = query.get('data') ||getDefaultData(type);\n    const username = query.get('username') || 'TYPE YOUR CARTO USERNAME';\n    const apiKey =  query.get('api_key') || 'default_public';\n    const colorByValue = query.get('color_by_value');\n    const bqtiler = query.get('bqtiler');\n\n    if (bqtiler) {\n      type = 'tileset';\n      source = 'bigquery';\n      data = bqtiler;\n    }\n\n    // fetch template and set parameters\n    json = require(`../json/template.${type}.${source}.json`);\n    json.layers[0].data = data;\n    json.layers[0].credentials = {username, apiKey}\n    if (colorByValue) {\n      json.layers[0].getFillColor = \n        `@@= properties.${colorByValue} > 1000000 ? [207, 89, 126] : properties.${colorByValue} > 100000 ? [232, 133, 113] : properties.${colorByValue} > 10000 ? [238, 180, 121] : properties.${colorByValue} > 1000 ? [233, 226, 156] : properties.${colorByValue} > 100 ? [156, 203, 134] : properties.${colorByValue} > 10 ? [57, 177, 133] : [0, 147, 146]`;\n    }\n  } else {\n    json = JSON.parse(config);\n  }\n\n  return json;\n}\n\nfunction getDefaultData(type) {\n  return (type === 'sql')\n    ? 'TYPE A SQL QUERY OR A DATASET NAME' \n    : 'TYPE A TILESET NAME';\n}\n\nfunction Home() {\n  const [json, setJSON] = useState();\n  const [jsonProps, setJSONPros] = useState(null);\n  const [shareURL, setShareURL] = useState();\n  const location = useLocation();\n\n  useEffect(() => {\n    const query = new URLSearchParams(location.search);\n    const json = initJSON(query);\n    setJSON(json);\n  }, [location]);\n\n  useEffect(() => {\n    addUpdateTriggersForAccesors(json);\n    const jsonProps = jsonConverter.convert(json);\n    setJSONPros(jsonProps);\n  }, [json]);\n\n  const onEditorChange = (jsonText) => {\n    setJSON(JSON.parse(jsonText));\n  }\n\n  const share = () => {\n    const {origin, pathname} = window.location;\n    const config = encodeURIComponent(JSON.stringify(json, null, 2));\n    const url = `${origin + pathname}?config=${config}`;\n    setShareURL(url)\n  }\n\n  return (\n      <div className='home'>\n        <div className='editor'>\n          {json &&\n            <JSONEditor onChange={onEditorChange} json={json}/>\n          }\n        </div>\n        <div className='share'>\n          <button onClick={() => share()}>\n            Share\n          </button>\n          {shareURL &&\n            <input value={shareURL} readOnly/>\n          }\n        </div>\n        <div className='map'>\n          {jsonProps && \n            <Map {...jsonProps} />\n          }\n        </div>\n      </div>\n  );\n}\n\nexport default Home;","import {\n  BrowserRouter as Router,\n  Switch,\n  Route\n} from \"react-router-dom\";\n\nimport './App.css';\n// import logo from './logo.svg';\n\nimport Home from './views/home';\n\nfunction App() {\n\n  return (\n    <Router>\n      <div>\n        <Switch>\n          <Route path=\"/\">\n            <Home />\n          </Route>\n        </Switch>\n      </div>\n    </Router>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","import {Log} from 'probe.gl';\n\nexport default new Log({id: 'deck'});\n","import {load} from '@loaders.gl/core';\n\nexport default class Resource {\n  constructor(id, data, context) {\n    this.id = id;\n    this.context = context;\n\n    this._loadCount = 0;\n    this._subscribers = new Set();\n\n    this.setData(data);\n  }\n\n  // consumer: {onChange: Function}\n  subscribe(consumer) {\n    this._subscribers.add(consumer);\n  }\n\n  unsubscribe(consumer) {\n    this._subscribers.delete(consumer);\n  }\n\n  inUse() {\n    return this._subscribers.size > 0;\n  }\n\n  delete() {\n    // Remove any resources created\n  }\n\n  getData() {\n    return this.isLoaded\n      ? this._error\n        ? Promise.reject(this._error)\n        : this._content\n      : this._loader.then(() => this.getData());\n  }\n\n  setData(data, forceUpdate) {\n    if (data === this._data && !forceUpdate) {\n      return;\n    }\n    this._data = data;\n    const loadCount = ++this._loadCount;\n\n    let loader = data;\n    if (typeof data === 'string') {\n      loader = load(data);\n    }\n    if (loader instanceof Promise) {\n      this.isLoaded = false;\n      this._loader = loader\n        .then(result => {\n          // check if source has changed\n          if (this._loadCount === loadCount) {\n            this.isLoaded = true;\n            this._error = null;\n            this._content = result;\n          }\n        })\n        .catch(error => {\n          if (this._loadCount === loadCount) {\n            this.isLoaded = true;\n            this._error = error || true;\n          }\n        });\n    } else {\n      this.isLoaded = true;\n      this._error = null;\n      this._content = data;\n    }\n\n    for (const subscriber of this._subscribers) {\n      subscriber.onChange(this.getData());\n    }\n  }\n}\n","/* global setTimeout */\nimport Resource from './resource';\n\nexport default class ResourceManager {\n  constructor({gl, protocol}) {\n    this.protocol = protocol || 'resource://';\n\n    this._context = {\n      gl,\n      resourceManager: this\n    };\n    this._resources = {};\n    this._consumers = {};\n\n    this._pruneRequest = null;\n  }\n\n  contains(resourceId) {\n    if (resourceId.startsWith(this.protocol)) {\n      return true;\n    }\n    return resourceId in this._resources;\n  }\n\n  add({resourceId, data, forceUpdate = false, persistent = true}) {\n    let res = this._resources[resourceId];\n\n    if (res) {\n      res.setData(data, forceUpdate);\n    } else {\n      res = new Resource(resourceId, data, this._context);\n      this._resources[resourceId] = res;\n    }\n    // persistent resources can only be removed by calling `remove`\n    // non-persistent resources may be released when there are no more consumers\n    res.persistent = persistent;\n  }\n\n  remove(resourceId) {\n    const res = this._resources[resourceId];\n\n    if (res) {\n      res.delete();\n      delete this._resources[resourceId];\n    }\n  }\n\n  unsubscribe({consumerId}) {\n    const consumer = this._consumers[consumerId];\n    if (consumer) {\n      for (const requestId in consumer) {\n        const request = consumer[requestId];\n        if (request.resource) {\n          request.resource.unsubscribe(request);\n        }\n      }\n      delete this._consumers[consumerId];\n      this.prune();\n    }\n  }\n\n  subscribe({resourceId, onChange, consumerId, requestId = 'default'}) {\n    const {_resources: resources, protocol} = this;\n    if (resourceId.startsWith(protocol)) {\n      resourceId = resourceId.replace(protocol, '');\n      if (!resources[resourceId]) {\n        // Add placeholder. When this resource becomes available, the consumer will be notified.\n        this.add({resourceId, data: null, persistent: false});\n      }\n    }\n    const res = resources[resourceId];\n    this._track(consumerId, requestId, res, onChange);\n    if (res) {\n      return res.getData();\n    }\n\n    return undefined;\n  }\n\n  prune() {\n    if (!this._pruneRequest) {\n      // prune() may be called multiple times in the same animation frame.\n      // Batch multiple requests together\n      this._pruneRequest = setTimeout(() => this._prune(), 0);\n    }\n  }\n\n  finalize() {\n    for (const key in this._resources) {\n      this._resources[key].delete();\n    }\n  }\n\n  _track(consumerId, requestId, resource, onChange) {\n    const consumers = this._consumers;\n    const consumer = (consumers[consumerId] = consumers[consumerId] || {});\n    const request = consumer[requestId] || {};\n\n    if (request.resource) {\n      request.resource.unsubscribe(request);\n      request.resource = null;\n      this.prune();\n    }\n    if (resource) {\n      consumer[requestId] = request;\n      request.onChange = onChange;\n      request.resource = resource;\n      resource.subscribe(request);\n    }\n  }\n\n  _prune() {\n    this._pruneRequest = null;\n\n    for (const key of Object.keys(this._resources)) {\n      const res = this._resources[key];\n      if (!res.persistent && !res.inUse()) {\n        res.delete();\n        delete this._resources[key];\n      }\n    }\n  }\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nconst vs = `\nstruct VertexGeometry {\n  vec4 position;\n  vec3 worldPosition;\n  vec3 worldPositionAlt;\n  vec3 normal;\n  vec2 uv;\n  vec3 pickingColor;\n} geometry;\n`;\n\nconst fs = `\n#define SMOOTH_EDGE_RADIUS 0.5\n\nstruct FragmentGeometry {\n  vec2 uv;\n} geometry;\n\nfloat smoothedge(float edge, float x) {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n`;\n\nexport default {name: 'geometry', vs, fs};\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport {ProgramManager} from '@luma.gl/core';\nimport {gouraudLighting, phongLighting} from '@luma.gl/core';\nimport geometry from './misc/geometry';\nimport project from './project/project';\nimport project32 from './project32/project32';\nimport shadow from './shadow/shadow';\nimport picking from './picking/picking';\n\nconst DEFAULT_MODULES = [geometry, project];\n\nconst SHADER_HOOKS = [\n  'vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)',\n  'vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)',\n  'vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)',\n  'fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)'\n];\n\nexport function createProgramManager(gl) {\n  const programManager = ProgramManager.getDefaultProgramManager(gl);\n\n  for (const shaderModule of DEFAULT_MODULES) {\n    programManager.addDefaultModule(shaderModule);\n  }\n  for (const shaderHook of SHADER_HOOKS) {\n    programManager.addShaderHook(shaderHook);\n  }\n\n  return programManager;\n}\n\nexport {picking, project, project32, gouraudLighting, phongLighting, shadow};\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport {Timeline} from '@luma.gl/core';\nimport Layer from './layer';\nimport {LIFECYCLE} from '../lifecycle/constants';\nimport log from '../utils/log';\nimport debug from '../debug';\nimport {flatten} from '../utils/flatten';\nimport {Stats} from 'probe.gl';\nimport ResourceManager from './resource/resource-manager';\n\nimport Viewport from '../viewports/viewport';\nimport {createProgramManager} from '../shaderlib';\n\nconst TRACE_SET_LAYERS = 'layerManager.setLayers';\nconst TRACE_ACTIVATE_VIEWPORT = 'layerManager.activateViewport';\n\n// CONTEXT IS EXPOSED TO LAYERS\nconst INITIAL_CONTEXT = Object.seal({\n  layerManager: null,\n  resourceManager: null,\n  deck: null,\n  gl: null,\n\n  // General resources\n  stats: null, // for tracking lifecycle performance\n\n  // GL Resources\n  shaderCache: null,\n  pickingFBO: null, // Screen-size framebuffer that layers can reuse\n\n  mousePosition: null,\n\n  userData: {} // Place for any custom app `context`\n});\n\nconst layerName = layer => (layer instanceof Layer ? `${layer}` : !layer ? 'null' : 'invalid');\n\nexport default class LayerManager {\n  // eslint-disable-next-line\n  constructor(gl, {deck, stats, viewport, timeline} = {}) {\n    // Currently deck.gl expects the DeckGL.layers array to be different\n    // whenever React rerenders. If the same layers array is used, the\n    // LayerManager's diffing algorithm will generate a fatal error and\n    // break the rendering.\n\n    // `this.lastRenderedLayers` stores the UNFILTERED layers sent\n    // down to LayerManager, so that `layers` reference can be compared.\n    // If it's the same across two React render calls, the diffing logic\n    // will be skipped.\n    this.lastRenderedLayers = [];\n    this.layers = [];\n    this.resourceManager = new ResourceManager({gl, protocol: 'deck://'});\n\n    this.context = Object.assign({}, INITIAL_CONTEXT, {\n      layerManager: this,\n      gl,\n      deck,\n      // Enabling luma.gl Program caching using private API (_cachePrograms)\n      programManager: gl && createProgramManager(gl),\n      stats: stats || new Stats({id: 'deck.gl'}),\n      // Make sure context.viewport is not empty on the first layer initialization\n      viewport: viewport || new Viewport({id: 'DEFAULT-INITIAL-VIEWPORT'}), // Current viewport, exposed to layers for project* function\n      timeline: timeline || new Timeline(),\n      resourceManager: this.resourceManager\n    });\n\n    this._needsRedraw = 'Initial render';\n    this._needsUpdate = false;\n    this._debug = false;\n    this._onError = null;\n\n    this.activateViewport = this.activateViewport.bind(this);\n\n    Object.seal(this);\n  }\n\n  // Method to call when the layer manager is not needed anymore.\n  finalize() {\n    this.resourceManager.finalize();\n    // Finalize all layers\n    for (const layer of this.layers) {\n      this._finalizeLayer(layer);\n    }\n  }\n\n  // Check if a redraw is needed\n  needsRedraw(opts = {clearRedrawFlags: false}) {\n    let redraw = this._needsRedraw;\n    if (opts.clearRedrawFlags) {\n      this._needsRedraw = false;\n    }\n\n    // This layers list doesn't include sublayers, relying on composite layers\n    for (const layer of this.layers) {\n      // Call every layer to clear their flags\n      const layerNeedsRedraw = layer.getNeedsRedraw(opts);\n      redraw = redraw || layerNeedsRedraw;\n    }\n\n    return redraw;\n  }\n\n  // Check if a deep update of all layers is needed\n  needsUpdate() {\n    return this._needsUpdate;\n  }\n\n  // Layers will be redrawn (in next animation frame)\n  setNeedsRedraw(reason) {\n    this._needsRedraw = this._needsRedraw || reason;\n  }\n\n  // Layers will be updated deeply (in next animation frame)\n  // Potentially regenerating attributes and sub layers\n  setNeedsUpdate(reason) {\n    this._needsUpdate = this._needsUpdate || reason;\n  }\n\n  // Gets an (optionally) filtered list of layers\n  getLayers({layerIds = null} = {}) {\n    // Filtering by layerId compares beginning of strings, so that sublayers will be included\n    // Dependes on the convention of adding suffixes to the parent's layer name\n    return layerIds\n      ? this.layers.filter(layer => layerIds.find(layerId => layer.id.indexOf(layerId) === 0))\n      : this.layers;\n  }\n\n  // Set props needed for layer rendering and picking.\n  setProps(props) {\n    if ('debug' in props) {\n      this._debug = props.debug;\n    }\n\n    // A way for apps to add data to context that can be accessed in layers\n    if ('userData' in props) {\n      this.context.userData = props.userData;\n    }\n\n    // TODO - For now we set layers before viewports to preserve changeFlags\n    if ('layers' in props) {\n      this.setLayers(props.layers);\n    }\n\n    if ('onError' in props) {\n      this._onError = props.onError;\n    }\n  }\n\n  // Supply a new layer list, initiating sublayer generation and layer matching\n  setLayers(newLayers, forceUpdate = false) {\n    // TODO - something is generating state updates that cause rerender of the same\n    const shouldUpdate = forceUpdate || newLayers !== this.lastRenderedLayers;\n    debug(TRACE_SET_LAYERS, this, shouldUpdate, newLayers);\n\n    if (!shouldUpdate) {\n      return this;\n    }\n    this.lastRenderedLayers = newLayers;\n\n    newLayers = flatten(newLayers, Boolean);\n\n    for (const layer of newLayers) {\n      layer.context = this.context;\n    }\n\n    this._updateLayers(this.layers, newLayers);\n\n    return this;\n  }\n\n  // Update layers from last cycle if `setNeedsUpdate()` has been called\n  updateLayers() {\n    // NOTE: For now, even if only some layer has changed, we update all layers\n    // to ensure that layer id maps etc remain consistent even if different\n    // sublayers are rendered\n    const reason = this.needsUpdate();\n    if (reason) {\n      this.setNeedsRedraw(`updating layers: ${reason}`);\n      // Force a full update\n      const forceUpdate = true;\n      this.setLayers(this.lastRenderedLayers, forceUpdate);\n    }\n  }\n\n  //\n  // PRIVATE METHODS\n  //\n\n  // Make a viewport \"current\" in layer context, updating viewportChanged flags\n  activateViewport(viewport) {\n    debug(TRACE_ACTIVATE_VIEWPORT, this, viewport);\n    if (viewport) {\n      this.context.viewport = viewport;\n    }\n    return this;\n  }\n\n  _handleError(stage, error, layer) {\n    if (this._onError) {\n      this._onError(error, layer);\n    } else {\n      log.error(`error during ${stage} of ${layerName(layer)}`, error)();\n    }\n  }\n\n  // Match all layers, checking for caught errors\n  // To avoid having an exception in one layer disrupt other layers\n  // TODO - mark layers with exceptions as bad and remove from rendering cycle?\n  _updateLayers(oldLayers, newLayers) {\n    // Create old layer map\n    const oldLayerMap = {};\n    for (const oldLayer of oldLayers) {\n      if (oldLayerMap[oldLayer.id]) {\n        log.warn(`Multiple old layers with same id ${layerName(oldLayer)}`)();\n      } else {\n        oldLayerMap[oldLayer.id] = oldLayer;\n      }\n    }\n\n    // Allocate array for generated layers\n    const generatedLayers = [];\n\n    // Match sublayers\n    this._updateSublayersRecursively(newLayers, oldLayerMap, generatedLayers);\n\n    // Finalize unmatched layers\n    this._finalizeOldLayers(oldLayerMap);\n\n    let needsUpdate = false;\n    for (const layer of generatedLayers) {\n      if (layer.hasUniformTransition()) {\n        needsUpdate = true;\n        break;\n      }\n    }\n\n    this._needsUpdate = needsUpdate;\n    this.layers = generatedLayers;\n  }\n\n  /* eslint-disable complexity,max-statements */\n  // Note: adds generated layers to `generatedLayers` array parameter\n  _updateSublayersRecursively(newLayers, oldLayerMap, generatedLayers) {\n    for (const newLayer of newLayers) {\n      newLayer.context = this.context;\n\n      // Given a new coming layer, find its matching old layer (if any)\n      const oldLayer = oldLayerMap[newLayer.id];\n      if (oldLayer === null) {\n        // null, rather than undefined, means this id was originally there\n        log.warn(`Multiple new layers with same id ${layerName(newLayer)}`)();\n      }\n      // Remove the old layer from candidates, as it has been matched with this layer\n      oldLayerMap[newLayer.id] = null;\n\n      let sublayers = null;\n\n      // We must not generate exceptions until after layer matching is complete\n      try {\n        if (this._debug && oldLayer !== newLayer) {\n          newLayer.validateProps();\n        }\n\n        if (!oldLayer) {\n          this._initializeLayer(newLayer);\n        } else {\n          this._transferLayerState(oldLayer, newLayer);\n          this._updateLayer(newLayer);\n        }\n        generatedLayers.push(newLayer);\n\n        // Call layer lifecycle method: render sublayers\n        sublayers = newLayer.isComposite && newLayer.getSubLayers();\n        // End layer lifecycle method: render sublayers\n      } catch (err) {\n        this._handleError('matching', err, newLayer); // Record first exception\n      }\n\n      if (sublayers) {\n        this._updateSublayersRecursively(sublayers, oldLayerMap, generatedLayers);\n      }\n    }\n  }\n  /* eslint-enable complexity,max-statements */\n\n  // Finalize any old layers that were not matched\n  _finalizeOldLayers(oldLayerMap) {\n    for (const layerId in oldLayerMap) {\n      const layer = oldLayerMap[layerId];\n      if (layer) {\n        this._finalizeLayer(layer);\n      }\n    }\n  }\n\n  // EXCEPTION SAFE LAYER ACCESS\n\n  // Initializes a single layer, calling layer methods\n  _initializeLayer(layer) {\n    try {\n      layer._initialize();\n      layer.lifecycle = LIFECYCLE.INITIALIZED;\n    } catch (err) {\n      this._handleError('initialization', err, layer);\n      // TODO - what should the lifecycle state be here? LIFECYCLE.INITIALIZATION_FAILED?\n    }\n  }\n\n  _transferLayerState(oldLayer, newLayer) {\n    newLayer._transferState(oldLayer);\n    newLayer.lifecycle = LIFECYCLE.MATCHED;\n\n    if (newLayer !== oldLayer) {\n      oldLayer.lifecycle = LIFECYCLE.AWAITING_GC;\n    }\n  }\n\n  // Updates a single layer, cleaning all flags\n  _updateLayer(layer) {\n    try {\n      layer._update();\n    } catch (err) {\n      this._handleError('update', err, layer);\n    }\n  }\n\n  // Finalizes a single layer\n  _finalizeLayer(layer) {\n    this._needsRedraw = this._needsRedraw || `finalized ${layerName(layer)}`;\n\n    layer.lifecycle = LIFECYCLE.AWAITING_FINALIZATION;\n\n    try {\n      layer._finalize();\n      layer.lifecycle = LIFECYCLE.FINALIZED;\n    } catch (err) {\n      this._handleError('finalization', err, layer);\n    }\n  }\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport assert from '../utils/assert';\nimport {deepEqual} from '../utils/deep-equal';\nimport log from '../utils/log';\nimport {flatten} from '../utils/flatten';\n\nexport default class ViewManager {\n  constructor(props = {}) {\n    // List of view descriptors, gets re-evaluated when width/height changes\n    this.views = [];\n    this.width = 100;\n    this.height = 100;\n    this.viewState = {};\n    this.controllers = {};\n    this.timeline = props.timeline;\n\n    this._viewports = []; // Generated viewports\n    this._viewportMap = {};\n    this._isUpdating = false;\n    this._needsRedraw = 'Initial render';\n    this._needsUpdate = true;\n\n    this._eventManager = props.eventManager;\n    this._eventCallbacks = {\n      onViewStateChange: props.onViewStateChange,\n      onInteractiveStateChange: props.onInteractiveStateChange\n    };\n\n    Object.seal(this);\n\n    // Init with default map viewport\n    this.setProps(props);\n  }\n\n  finalize() {\n    for (const key in this.controllers) {\n      if (this.controllers[key]) {\n        this.controllers[key].finalize();\n      }\n    }\n    this.controllers = {};\n  }\n\n  // Check if a redraw is needed\n  needsRedraw(opts = {clearRedrawFlags: false}) {\n    const redraw = this._needsRedraw;\n    if (opts.clearRedrawFlags) {\n      this._needsRedraw = false;\n    }\n    return redraw;\n  }\n\n  // Layers will be updated deeply (in next animation frame)\n  // Potentially regenerating attributes and sub layers\n  setNeedsUpdate(reason) {\n    this._needsUpdate = this._needsUpdate || reason;\n    this._needsRedraw = this._needsRedraw || reason;\n  }\n\n  // Checks each viewport for transition updates\n  updateViewStates() {\n    for (const viewId in this.controllers) {\n      const controller = this.controllers[viewId];\n      if (controller) {\n        controller.updateTransition();\n      }\n    }\n  }\n\n  /** Get a set of viewports for a given width and height\n   * TODO - Intention is for deck.gl to autodeduce width and height and drop the need for props\n   * @param rect (object, optional) - filter the viewports\n   *   + not provided - return all viewports\n   *   + {x, y} - only return viewports that contain this pixel\n   *   + {x, y, width, height} - only return viewports that overlap with this rectangle\n   */\n  getViewports(rect) {\n    if (rect) {\n      return this._viewports.filter(viewport => viewport.containsPixel(rect));\n    }\n    return this._viewports;\n  }\n\n  getViews() {\n    const viewMap = {};\n    this.views.forEach(view => {\n      viewMap[view.id] = view;\n    });\n    return viewMap;\n  }\n\n  // Resolves a viewId string to a View, if already a View returns it.\n  getView(viewOrViewId) {\n    return typeof viewOrViewId === 'string'\n      ? this.views.find(view => view.id === viewOrViewId)\n      : viewOrViewId;\n  }\n\n  // Returns the viewState for a specific viewId. Matches the viewState by\n  // 1. view.viewStateId\n  // 2. view.id\n  // 3. root viewState\n  // then applies the view's filter if any\n  getViewState(viewId) {\n    const view = this.getView(viewId);\n    // Backward compatibility: view state for single view\n    const viewState = (view && this.viewState[view.getViewStateId()]) || this.viewState;\n    return view ? view.filterViewState(viewState) : viewState;\n  }\n\n  getViewport(viewId) {\n    return this._viewportMap[viewId];\n  }\n\n  /**\n   * Unproject pixel coordinates on screen onto world coordinates,\n   * (possibly [lon, lat]) on map.\n   * - [x, y] => [lng, lat]\n   * - [x, y, z] => [lng, lat, Z]\n   * @param {Array} xyz -\n   * @param {Object} opts - options\n   * @param {Object} opts.topLeft=true - Whether origin is top left\n   * @return {Array|null} - [lng, lat, Z] or [X, Y, Z]\n   */\n  unproject(xyz, opts) {\n    const viewports = this.getViewports();\n    const pixel = {x: xyz[0], y: xyz[1]};\n    for (let i = viewports.length - 1; i >= 0; --i) {\n      const viewport = viewports[i];\n      if (viewport.containsPixel(pixel)) {\n        const p = xyz.slice();\n        p[0] -= viewport.x;\n        p[1] -= viewport.y;\n        return viewport.unproject(p, opts);\n      }\n    }\n    return null;\n  }\n\n  setProps(props) {\n    if ('views' in props) {\n      this._setViews(props.views);\n    }\n\n    // TODO - support multiple view states\n    if ('viewState' in props) {\n      this._setViewState(props.viewState);\n    }\n\n    if ('width' in props || 'height' in props) {\n      this._setSize(props.width, props.height);\n    }\n\n    // Important: avoid invoking _update() inside itself\n    // Nested updates result in unexpected side effects inside _rebuildViewports()\n    // when using auto control in pure-js\n    if (!this._isUpdating) {\n      this._update();\n    }\n  }\n\n  _update() {\n    this._isUpdating = true;\n\n    // Only rebuild viewports if the update flag is set\n    if (this._needsUpdate) {\n      this._needsUpdate = false;\n      this._rebuildViewports();\n    }\n\n    // If viewport transition(s) are triggered during viewports update, controller(s)\n    // will immediately call `onViewStateChange` which calls `viewManager.setProps` again.\n    if (this._needsUpdate) {\n      this._needsUpdate = false;\n      this._rebuildViewports();\n    }\n\n    this._isUpdating = false;\n  }\n\n  _setSize(width, height) {\n    assert(Number.isFinite(width) && Number.isFinite(height));\n    if (width !== this.width || height !== this.height) {\n      this.width = width;\n      this.height = height;\n      this.setNeedsUpdate('Size changed');\n    }\n  }\n\n  // Update the view descriptor list and set change flag if needed\n  // Does not actually rebuild the `Viewport`s until `getViewports` is called\n  _setViews(views) {\n    views = flatten(views, Boolean);\n\n    const viewsChanged = this._diffViews(views, this.views);\n    if (viewsChanged) {\n      this.setNeedsUpdate('views changed');\n    }\n\n    this.views = views;\n  }\n\n  _setViewState(viewState) {\n    if (viewState) {\n      const viewStateChanged = !deepEqual(viewState, this.viewState);\n\n      if (viewStateChanged) {\n        this.setNeedsUpdate('viewState changed');\n      }\n\n      this.viewState = viewState;\n    } else {\n      log.warn('missing `viewState` or `initialViewState`')();\n    }\n  }\n\n  //\n  // PRIVATE METHODS\n  //\n\n  _onViewStateChange(viewId, event) {\n    event.viewId = viewId;\n    this._eventCallbacks.onViewStateChange(event);\n  }\n\n  _createController(view, props) {\n    const Controller = props.type;\n\n    const controller = new Controller({\n      timeline: this.timeline,\n      eventManager: this._eventManager,\n      // Set an internal callback that calls the prop callback if provided\n      onViewStateChange: this._onViewStateChange.bind(this, props.id),\n      onStateChange: this._eventCallbacks.onInteractiveStateChange,\n      makeViewport: view._getViewport.bind(view),\n      ...props\n    });\n\n    return controller;\n  }\n\n  _updateController(view, viewState, viewport, controller) {\n    let controllerProps = view.controller;\n    if (controllerProps) {\n      controllerProps = {\n        ...viewState,\n        ...view.props,\n        ...controllerProps,\n        id: view.id,\n        x: viewport.x,\n        y: viewport.y,\n        width: viewport.width,\n        height: viewport.height\n      };\n\n      // TODO - check if view / controller type has changed, and replace the controller\n      if (controller) {\n        controller.setProps(controllerProps);\n      } else {\n        controller = this._createController(view, controllerProps);\n      }\n      return controller;\n    }\n    return null;\n  }\n\n  // Rebuilds viewports from descriptors towards a certain window size\n  _rebuildViewports() {\n    const {width, height, views} = this;\n\n    const oldControllers = this.controllers;\n    this._viewports = [];\n    this.controllers = {};\n\n    // Create controllers in reverse order, so that views on top receive events first\n    for (let i = views.length; i--; ) {\n      const view = views[i];\n      const viewState = this.getViewState(view);\n      const viewport = view.makeViewport({width, height, viewState});\n\n      // Update the controller\n      this.controllers[view.id] = this._updateController(\n        view,\n        viewState,\n        viewport,\n        oldControllers[view.id]\n      );\n\n      this._viewports.unshift(viewport);\n    }\n\n    // Remove unused controllers\n    for (const id in oldControllers) {\n      if (oldControllers[id] && !this.controllers[id]) {\n        oldControllers[id].finalize();\n      }\n    }\n\n    this._buildViewportMap();\n  }\n\n  _buildViewportMap() {\n    // Build a view id to view index\n    this._viewportMap = {};\n    this._viewports.forEach(viewport => {\n      if (viewport.id) {\n        // TODO - issue warning if multiple viewports use same id\n        this._viewportMap[viewport.id] = this._viewportMap[viewport.id] || viewport;\n      }\n    });\n  }\n\n  // Check if viewport array has changed, returns true if any change\n  // Note that descriptors can be the same\n  _diffViews(newViews, oldViews) {\n    if (newViews.length !== oldViews.length) {\n      return true;\n    }\n\n    return newViews.some((_, i) => !newViews[i].equals(oldViews[i]));\n  }\n}\n","const DEFAULT_LIGHT_COLOR = [255, 255, 255];\nconst DEFAULT_LIGHT_INTENSITY = 1.0;\n\nlet idCount = 0;\n\nexport class AmbientLight {\n  constructor(props = {}) {\n    const {color = DEFAULT_LIGHT_COLOR} = props;\n    const {intensity = DEFAULT_LIGHT_INTENSITY} = props;\n\n    this.id = props.id || `ambient-${idCount++}`;\n    this.color = color;\n    this.intensity = intensity;\n    this.type = 'ambient';\n  }\n}\n","import {Vector3} from 'math.gl';\n\nconst DEFAULT_LIGHT_COLOR = [255, 255, 255];\nconst DEFAULT_LIGHT_INTENSITY = 1.0;\nconst DEFAULT_LIGHT_DIRECTION = [0.0, 0.0, -1.0];\n\nlet idCount = 0;\n\nexport class DirectionalLight {\n  constructor(props = {}) {\n    const {color = DEFAULT_LIGHT_COLOR} = props;\n    const {intensity = DEFAULT_LIGHT_INTENSITY} = props;\n    const {direction = DEFAULT_LIGHT_DIRECTION} = props;\n    const {_shadow = false} = props;\n\n    this.id = props.id || `directional-${idCount++}`;\n    this.color = color;\n    this.intensity = intensity;\n    this.type = 'directional';\n    this.direction = new Vector3(direction).normalize().toArray();\n    this.shadow = _shadow;\n  }\n\n  getProjectedLight() {\n    return this;\n  }\n}\n","export default class Effect {\n  constructor(props = {}) {\n    const {id = 'effect'} = props;\n    this.id = id;\n    this.props = {};\n    Object.assign(this.props, props);\n  }\n\n  preRender() {}\n\n  getModuleParameters() {}\n\n  cleanup() {}\n}\n","export default class Pass {\n  constructor(gl, props = {}) {\n    const {id = 'pass'} = props;\n    this.id = id; // id of this pass\n    this.gl = gl;\n    this.props = {};\n    Object.assign(this.props, props);\n  }\n\n  setProps(props) {\n    Object.assign(this.props, props);\n  }\n\n  render() {}\n\n  cleanup() {}\n}\n","import GL from '@luma.gl/constants';\nimport Pass from './pass';\nimport {clear, setParameters, withParameters, cssToDeviceRatio} from '@luma.gl/core';\nimport log from '../utils/log';\n\nexport default class LayersPass extends Pass {\n  render(props) {\n    const gl = this.gl;\n\n    setParameters(gl, {framebuffer: props.target});\n    return this._drawLayers(props);\n  }\n\n  // PRIVATE\n  // Draw a list of layers in a list of viewports\n  _drawLayers(props) {\n    const {viewports, views, onViewportActive, clearCanvas = true} = props;\n\n    const gl = this.gl;\n    if (clearCanvas) {\n      clearGLCanvas(gl);\n    }\n\n    const renderStats = [];\n\n    for (const viewportOrDescriptor of viewports) {\n      // Get a viewport from a viewport descriptor (which can be a plain viewport)\n      const viewport = viewportOrDescriptor.viewport || viewportOrDescriptor;\n      const view = views && views[viewport.id];\n\n      // Update context to point to this viewport\n      onViewportActive(viewport);\n\n      const drawLayerParams = this._getDrawLayerParams(viewport, props);\n\n      props.view = view;\n\n      // render this viewport\n      const subViewports = viewport.subViewports || [viewport];\n      for (const subViewport of subViewports) {\n        props.viewport = subViewport;\n\n        const stats = this._drawLayersInViewport(gl, props, drawLayerParams);\n        renderStats.push(stats);\n      }\n    }\n    return renderStats;\n  }\n\n  // Resolve the parameters needed to draw each layer\n  // When a viewport contains multiple subviewports (e.g. repeated web mercator map),\n  // this is only done once for the parent viewport\n  _getDrawLayerParams(\n    viewport,\n    {layers, pass = 'unknown', layerFilter, effects, moduleParameters}\n  ) {\n    const drawLayerParams = [];\n    const indexResolver = layerIndexResolver();\n    for (let layerIndex = 0; layerIndex < layers.length; layerIndex++) {\n      const layer = layers[layerIndex];\n      // Check if we should draw layer\n      const shouldDrawLayer = this._shouldDrawLayer(layer, viewport, pass, layerFilter);\n\n      // This is the \"logical\" index for ordering this layer in the stack\n      // used to calculate polygon offsets\n      // It can be the same as another layer\n      const layerRenderIndex = indexResolver(layer, shouldDrawLayer);\n\n      const layerParam = {\n        shouldDrawLayer,\n        layerRenderIndex\n      };\n\n      if (shouldDrawLayer) {\n        layerParam.moduleParameters = this._getModuleParameters(\n          layer,\n          effects,\n          pass,\n          moduleParameters\n        );\n        layerParam.layerParameters = this.getLayerParameters(layer, layerIndex);\n      }\n      drawLayerParams[layerIndex] = layerParam;\n    }\n    return drawLayerParams;\n  }\n\n  // Draws a list of layers in one viewport\n  // TODO - when picking we could completely skip rendering viewports that dont\n  // intersect with the picking rect\n  /* eslint-disable max-depth, max-statements */\n  _drawLayersInViewport(gl, {layers, onError, viewport, view}, drawLayerParams) {\n    const glViewport = getGLViewport(gl, {viewport});\n\n    if (view && view.props.clear) {\n      const clearOpts = view.props.clear === true ? {color: true, depth: true} : view.props.clear;\n      withParameters(\n        gl,\n        {\n          scissorTest: true,\n          scissor: glViewport\n        },\n        () => clear(gl, clearOpts)\n      );\n    }\n\n    // render layers in normal colors\n    const renderStatus = {\n      totalCount: layers.length,\n      visibleCount: 0,\n      compositeCount: 0,\n      pickableCount: 0\n    };\n\n    setParameters(gl, {viewport: glViewport});\n\n    // render layers in normal colors\n    for (let layerIndex = 0; layerIndex < layers.length; layerIndex++) {\n      const layer = layers[layerIndex];\n      const {\n        shouldDrawLayer,\n        layerRenderIndex,\n        moduleParameters,\n        layerParameters\n      } = drawLayerParams[layerIndex];\n\n      // Calculate stats\n      if (shouldDrawLayer && layer.props.pickable) {\n        renderStatus.pickableCount++;\n      }\n      if (layer.isComposite) {\n        renderStatus.compositeCount++;\n      } else if (shouldDrawLayer) {\n        // Draw the layer\n        renderStatus.visibleCount++;\n\n        // overwrite layer.context.viewport with the sub viewport\n        moduleParameters.viewport = viewport;\n\n        try {\n          layer.drawLayer({\n            moduleParameters,\n            uniforms: {layerIndex: layerRenderIndex},\n            parameters: layerParameters\n          });\n        } catch (err) {\n          if (onError) {\n            onError(err, layer);\n          } else {\n            log.error(`error during drawing of ${layer}`, err)();\n          }\n        }\n      }\n    }\n\n    return renderStatus;\n  }\n  /* eslint-enable max-depth, max-statements */\n\n  /* Methods for subclass overrides */\n  shouldDrawLayer(layer) {\n    return true;\n  }\n\n  getModuleParameters(layer, effects) {\n    return null;\n  }\n\n  getLayerParameters(layer, layerIndex) {\n    return layer.props.parameters;\n  }\n\n  /* Private */\n  _shouldDrawLayer(layer, viewport, pass, layerFilter) {\n    let shouldDrawLayer = this.shouldDrawLayer(layer) && layer.props.visible;\n\n    if (shouldDrawLayer && layerFilter) {\n      shouldDrawLayer = layerFilter({\n        layer,\n        viewport,\n        isPicking: pass.startsWith('picking'),\n        renderPass: pass\n      });\n    }\n    if (shouldDrawLayer) {\n      // If a layer is drawn, update its viewportChanged flag\n      layer.activateViewport(viewport);\n    }\n\n    return shouldDrawLayer;\n  }\n\n  _getModuleParameters(layer, effects, pass, overrides) {\n    const moduleParameters = Object.assign(Object.create(layer.props), {\n      autoWrapLongitude: layer.wrapLongitude,\n      viewport: layer.context.viewport,\n      mousePosition: layer.context.mousePosition,\n      pickingActive: 0,\n      devicePixelRatio: cssToDeviceRatio(this.gl)\n    });\n\n    if (effects) {\n      for (const effect of effects) {\n        Object.assign(moduleParameters, effect.getModuleParameters(layer));\n      }\n    }\n\n    return Object.assign(moduleParameters, this.getModuleParameters(layer, effects), overrides);\n  }\n}\n\n// If the _index prop is defined, return a layer index that's relative to its parent\n// Otherwise return the index of the layer among all rendered layers\n// This is done recursively, i.e. if the user overrides a layer's default index,\n// all its descendants will be resolved relative to that index.\n// This implementation assumes that parent layers always appear before its children\n// which is true if the layer array comes from the LayerManager\nexport function layerIndexResolver(startIndex = 0, layerIndices = {}) {\n  const resolvers = {};\n\n  const resolveLayerIndex = (layer, isDrawn) => {\n    const indexOverride = layer.props._offset;\n    const layerId = layer.id;\n    const parentId = layer.parent && layer.parent.id;\n\n    let index;\n\n    if (parentId && !(parentId in layerIndices)) {\n      // Populate layerIndices with the parent layer's index\n      resolveLayerIndex(layer.parent, false);\n    }\n\n    if (parentId in resolvers) {\n      const resolver = (resolvers[parentId] =\n        resolvers[parentId] || layerIndexResolver(layerIndices[parentId], layerIndices));\n      index = resolver(layer, isDrawn);\n      resolvers[layerId] = resolver;\n    } else if (Number.isFinite(indexOverride)) {\n      index = indexOverride + (layerIndices[parentId] || 0);\n      // Mark layer as needing its own resolver\n      // We don't actually create it until it's used for the first time\n      resolvers[layerId] = null;\n    } else {\n      index = startIndex;\n    }\n\n    if (isDrawn && index >= startIndex) {\n      startIndex = index + 1;\n    }\n\n    layerIndices[layerId] = index;\n    return index;\n  };\n  return resolveLayerIndex;\n}\n\n// Convert viewport top-left CSS coordinates to bottom up WebGL coordinates\nfunction getGLViewport(gl, {viewport}) {\n  // TODO - dummy default for node\n  // Fallback to width/height when clientWidth/clientHeight are 0 or undefined.\n  const height = gl.canvas ? gl.canvas.clientHeight || gl.canvas.height : 100;\n  // Convert viewport top-left CSS coordinates to bottom up WebGL coordinates\n  const dimensions = viewport;\n  const pixelRatio = cssToDeviceRatio(gl);\n  return [\n    dimensions.x * pixelRatio,\n    (height - dimensions.y - dimensions.height) * pixelRatio,\n    dimensions.width * pixelRatio,\n    dimensions.height * pixelRatio\n  ];\n}\n\nfunction clearGLCanvas(gl) {\n  const width = gl.drawingBufferWidth;\n  const height = gl.drawingBufferHeight;\n  // clear depth and color buffers, restoring transparency\n  setParameters(gl, {viewport: [0, 0, width, height]});\n  gl.clear(GL.COLOR_BUFFER_BIT | GL.DEPTH_BUFFER_BIT);\n}\n","import {default as LayersPass} from './layers-pass';\nimport {\n  Framebuffer,\n  Texture2D,\n  Renderbuffer,\n  withParameters,\n  cssToDeviceRatio\n} from '@luma.gl/core';\n\nexport default class ShadowPass extends LayersPass {\n  constructor(gl, props) {\n    super(gl, props);\n\n    // The shadowMap texture\n    this.shadowMap = new Texture2D(gl, {\n      width: 1,\n      height: 1,\n      parameters: {\n        [gl.TEXTURE_MIN_FILTER]: gl.LINEAR,\n        [gl.TEXTURE_MAG_FILTER]: gl.LINEAR,\n        [gl.TEXTURE_WRAP_S]: gl.CLAMP_TO_EDGE,\n        [gl.TEXTURE_WRAP_T]: gl.CLAMP_TO_EDGE\n      }\n    });\n\n    this.depthBuffer = new Renderbuffer(gl, {\n      format: gl.DEPTH_COMPONENT16,\n      width: 1,\n      height: 1\n    });\n\n    this.fbo = new Framebuffer(gl, {\n      id: 'shadowmap',\n      width: 1,\n      height: 1,\n      attachments: {\n        [gl.COLOR_ATTACHMENT0]: this.shadowMap,\n        // Depth attachment has to be specified for depth test to work\n        [gl.DEPTH_ATTACHMENT]: this.depthBuffer\n      }\n    });\n  }\n\n  render(params) {\n    const target = this.fbo;\n\n    withParameters(\n      this.gl,\n      {\n        depthRange: [0, 1],\n        depthTest: true,\n        blend: false,\n        clearColor: [1, 1, 1, 1]\n      },\n      () => {\n        const viewport = params.viewports[0];\n        const pixelRatio = cssToDeviceRatio(this.gl);\n        const width = viewport.width * pixelRatio;\n        const height = viewport.height * pixelRatio;\n        if (width !== target.width || height !== target.height) {\n          target.resize({width, height});\n        }\n\n        super.render({...params, target, pass: 'shadow'});\n      }\n    );\n  }\n\n  shouldDrawLayer(layer) {\n    return layer.props.shadowEnabled !== false;\n  }\n\n  getModuleParameters() {\n    return {\n      drawToShadowMap: true\n    };\n  }\n\n  delete() {\n    if (this.fbo) {\n      this.fbo.delete();\n      this.fbo = null;\n    }\n\n    if (this.shadowMap) {\n      this.shadowMap.delete();\n      this.shadowMap = null;\n    }\n\n    if (this.depthBuffer) {\n      this.depthBuffer.delete();\n      this.depthBuffer = null;\n    }\n  }\n}\n","// Copyright (c) 2015-2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport {COORDINATE_SYSTEM, PROJECTION_MODE} from '../../lib/constants';\nimport project from '../project/project';\nimport {Vector3, Matrix4} from 'math.gl';\nimport memoize from '../../utils/memoize';\nimport {pixelsToWorld} from '@math.gl/web-mercator';\n\nconst vs = `\nconst int max_lights = 2;\nuniform mat4 shadow_uViewProjectionMatrices[max_lights];\nuniform vec4 shadow_uProjectCenters[max_lights];\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform int shadow_uLightId;\nuniform float shadow_uLightCount;\n\nvarying vec3 shadow_vPosition[max_lights];\n\nvec4 shadow_setVertexPosition(vec4 position_commonspace) {\n  if (shadow_uDrawShadowMap) {\n    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);\n  }\n  if (shadow_uUseShadowMap) {\n    for (int i = 0; i < max_lights; i++) {\n      if(i < int(shadow_uLightCount)) {\n        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);\n        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;\n      }\n    }\n  }\n  return gl_Position;\n}\n`;\n\nconst fs = `\nconst int max_lights = 2;\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform sampler2D shadow_uShadowMap0;\nuniform sampler2D shadow_uShadowMap1;\nuniform vec4 shadow_uColor;\nuniform float shadow_uLightCount;\n\nvarying vec3 shadow_vPosition[max_lights];\n\nconst vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\nconst vec4 bitUnpackShift = 1.0 / bitPackShift;\nconst vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);\n\nfloat shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {\n  vec4 rgbaDepth = texture2D(shadowMap, position.xy);\n\n  float z = dot(rgbaDepth, bitUnpackShift);\n  return smoothstep(0.001, 0.01, position.z - z);\n}\n\nvec4 shadow_filterShadowColor(vec4 color) {\n  if (shadow_uDrawShadowMap) {\n    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);\n    rgbaDepth -= rgbaDepth.gbaa * bitMask;\n    return rgbaDepth;\n  }\n  if (shadow_uUseShadowMap) {\n    float shadowAlpha = 0.0;\n    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);\n    if(shadow_uLightCount > 1.0) {\n      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);\n    }\n    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;\n    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);\n\n    return vec4(\n      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),\n      blendedAlpha\n    );\n  }\n  return color;\n}\n`;\n\nconst getMemoizedViewportCenterPosition = memoize(getViewportCenterPosition);\nconst getMemoizedViewProjectionMatrices = memoize(getViewProjectionMatrices);\n\nconst DEFAULT_SHADOW_COLOR = [0, 0, 0, 1.0];\nconst VECTOR_TO_POINT_MATRIX = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0];\n\nfunction screenToCommonSpace(xyz, pixelUnprojectionMatrix) {\n  const [x, y, z] = xyz;\n  const coord = pixelsToWorld([x, y, z], pixelUnprojectionMatrix);\n\n  if (Number.isFinite(z)) {\n    return coord;\n  }\n  return [coord[0], coord[1], 0];\n}\n\nfunction getViewportCenterPosition({viewport, center}) {\n  return new Matrix4(viewport.viewProjectionMatrix).invert().transform(center);\n}\n\nfunction getViewProjectionMatrices({viewport, shadowMatrices}) {\n  const projectionMatrices = [];\n  const pixelUnprojectionMatrix = viewport.pixelUnprojectionMatrix;\n  const farZ = viewport.isGeospatial ? undefined : 1;\n  const corners = [\n    [0, 0, farZ], // top left ground\n    [viewport.width, 0, farZ], // top right ground\n    [0, viewport.height, farZ], // bottom left ground\n    [viewport.width, viewport.height, farZ], // bottom right ground\n    [0, 0, -1], // top left near\n    [viewport.width, 0, -1], // top right near\n    [0, viewport.height, -1], // bottom left near\n    [viewport.width, viewport.height, -1] // bottom right near\n  ].map(pixel => screenToCommonSpace(pixel, pixelUnprojectionMatrix));\n\n  for (const shadowMatrix of shadowMatrices) {\n    const viewMatrix = shadowMatrix.clone().translate(new Vector3(viewport.center).negate());\n    const positions = corners.map(corner => viewMatrix.transform(corner));\n    const projectionMatrix = new Matrix4().ortho({\n      left: Math.min(...positions.map(position => position[0])),\n      right: Math.max(...positions.map(position => position[0])),\n      bottom: Math.min(...positions.map(position => position[1])),\n      top: Math.max(...positions.map(position => position[1])),\n      near: Math.min(...positions.map(position => -position[2])),\n      far: Math.max(...positions.map(position => -position[2]))\n    });\n    projectionMatrices.push(projectionMatrix.multiplyRight(shadowMatrix));\n  }\n  return projectionMatrices;\n}\n\nfunction createShadowUniforms(opts = {}, context = {}) {\n  const uniforms = {\n    shadow_uDrawShadowMap: Boolean(opts.drawToShadowMap),\n    shadow_uUseShadowMap: opts.shadowMaps ? opts.shadowMaps.length > 0 : false,\n    shadow_uColor: opts.shadowColor || DEFAULT_SHADOW_COLOR,\n    shadow_uLightId: opts.shadowLightId || 0,\n    shadow_uLightCount: opts.shadowMatrices.length\n  };\n\n  const center = getMemoizedViewportCenterPosition({\n    viewport: opts.viewport,\n    center: context.project_uCenter\n  });\n\n  const projectCenters = [];\n  const viewProjectionMatrices = getMemoizedViewProjectionMatrices({\n    shadowMatrices: opts.shadowMatrices,\n    viewport: opts.viewport\n  }).slice();\n\n  for (let i = 0; i < opts.shadowMatrices.length; i++) {\n    const viewProjectionMatrix = viewProjectionMatrices[i];\n    const viewProjectionMatrixCentered = viewProjectionMatrix\n      .clone()\n      .translate(new Vector3(opts.viewport.center).negate());\n\n    if (\n      context.project_uCoordinateSystem === COORDINATE_SYSTEM.LNGLAT &&\n      context.project_uProjectionMode === PROJECTION_MODE.WEB_MERCATOR\n    ) {\n      viewProjectionMatrices[i] = viewProjectionMatrixCentered;\n      projectCenters[i] = center;\n    } else {\n      viewProjectionMatrices[i] = viewProjectionMatrix\n        .clone()\n        .multiplyRight(VECTOR_TO_POINT_MATRIX);\n      projectCenters[i] = viewProjectionMatrixCentered.transform(center);\n    }\n  }\n\n  for (let i = 0; i < viewProjectionMatrices.length; i++) {\n    uniforms[`shadow_uViewProjectionMatrices[${i}]`] = viewProjectionMatrices[i];\n    uniforms[`shadow_uProjectCenters[${i}]`] = projectCenters[i];\n\n    if (opts.shadowMaps && opts.shadowMaps.length > 0) {\n      uniforms[`shadow_uShadowMap${i}`] = opts.shadowMaps[i];\n    } else {\n      uniforms[`shadow_uShadowMap${i}`] = opts.dummyShadowMap;\n    }\n  }\n  return uniforms;\n}\n\nexport default {\n  name: 'shadow',\n  dependencies: [project],\n  vs,\n  fs,\n  inject: {\n    'vs:DECKGL_FILTER_GL_POSITION': `\n    position = shadow_setVertexPosition(geometry.position);\n    `,\n    'fs:DECKGL_FILTER_COLOR': `\n    color = shadow_filterShadowColor(color);\n    `\n  },\n  getUniforms: (opts = {}, context = {}) => {\n    if (opts.drawToShadowMap || (opts.shadowMaps && opts.shadowMaps.length > 0)) {\n      const shadowUniforms = {};\n      const {shadowEnabled = true} = opts;\n      if (shadowEnabled && opts.shadowMatrices && opts.shadowMatrices.length > 0) {\n        Object.assign(shadowUniforms, createShadowUniforms(opts, context));\n      } else {\n        Object.assign(shadowUniforms, {\n          shadow_uDrawShadowMap: false,\n          shadow_uUseShadowMap: false\n        });\n      }\n\n      return shadowUniforms;\n    }\n    return {};\n  }\n};\n","import {Texture2D, ProgramManager} from '@luma.gl/core';\nimport {AmbientLight} from './ambient-light';\nimport {DirectionalLight} from './directional-light';\nimport Effect from '../../lib/effect';\nimport {Matrix4, Vector3} from 'math.gl';\nimport ShadowPass from '../../passes/shadow-pass';\nimport {default as shadow} from '../../shaderlib/shadow/shadow';\n\nconst DEFAULT_AMBIENT_LIGHT_PROPS = {color: [255, 255, 255], intensity: 1.0};\nconst DEFAULT_DIRECTIONAL_LIGHT_PROPS = [\n  {\n    color: [255, 255, 255],\n    intensity: 1.0,\n    direction: [-1, 3, -1]\n  },\n  {\n    color: [255, 255, 255],\n    intensity: 0.9,\n    direction: [1, -8, -2.5]\n  }\n];\nconst DEFAULT_SHADOW_COLOR = [0, 0, 0, 200 / 255];\n\n// Class to manage ambient, point and directional light sources in deck\nexport default class LightingEffect extends Effect {\n  constructor(props) {\n    super(props);\n    this.ambientLight = null;\n    this.directionalLights = [];\n    this.pointLights = [];\n\n    this.shadowColor = DEFAULT_SHADOW_COLOR;\n    this.shadowPasses = [];\n    this.shadowMaps = [];\n    this.dummyShadowMap = null;\n    this.shadow = false;\n    this.programManager = null;\n\n    for (const key in props) {\n      const lightSource = props[key];\n\n      switch (lightSource.type) {\n        case 'ambient':\n          this.ambientLight = lightSource;\n          break;\n\n        case 'directional':\n          this.directionalLights.push(lightSource);\n          break;\n\n        case 'point':\n          this.pointLights.push(lightSource);\n          break;\n        default:\n      }\n    }\n    this._applyDefaultLights();\n\n    this.shadow = this.directionalLights.some(light => light.shadow);\n  }\n\n  preRender(gl, {layers, layerFilter, viewports, onViewportActive, views}) {\n    if (!this.shadow) return;\n\n    // create light matrix every frame to make sure always updated from light source\n    this.shadowMatrices = this._createLightMatrix();\n\n    if (this.shadowPasses.length === 0) {\n      this._createShadowPasses(gl);\n    }\n    if (!this.programManager) {\n      // TODO - support multiple contexts\n      this.programManager = ProgramManager.getDefaultProgramManager(gl);\n      if (shadow) {\n        this.programManager.addDefaultModule(shadow);\n      }\n    }\n\n    if (!this.dummyShadowMap) {\n      this.dummyShadowMap = new Texture2D(gl, {\n        width: 1,\n        height: 1\n      });\n    }\n\n    for (let i = 0; i < this.shadowPasses.length; i++) {\n      const shadowPass = this.shadowPasses[i];\n      shadowPass.render({\n        layers,\n        layerFilter,\n        viewports,\n        onViewportActive,\n        views,\n        moduleParameters: {\n          shadowLightId: i,\n          dummyShadowMap: this.dummyShadowMap,\n          shadowMatrices: this.shadowMatrices\n        }\n      });\n    }\n  }\n\n  getModuleParameters(layer) {\n    const parameters = this.shadow\n      ? {\n          shadowMaps: this.shadowMaps,\n          dummyShadowMap: this.dummyShadowMap,\n          shadowColor: this.shadowColor,\n          shadowMatrices: this.shadowMatrices\n        }\n      : {};\n\n    // when not rendering to screen, turn off lighting by adding empty light source object\n    // lights shader module relies on the `lightSources` to turn on/off lighting\n    parameters.lightSources = {\n      ambientLight: this.ambientLight,\n      directionalLights: this.directionalLights.map(directionalLight =>\n        directionalLight.getProjectedLight({layer})\n      ),\n      pointLights: this.pointLights.map(pointLight => pointLight.getProjectedLight({layer}))\n    };\n\n    return parameters;\n  }\n\n  cleanup() {\n    for (const shadowPass of this.shadowPasses) {\n      shadowPass.delete();\n    }\n    this.shadowPasses.length = 0;\n    this.shadowMaps.length = 0;\n\n    if (this.dummyShadowMap) {\n      this.dummyShadowMap.delete();\n      this.dummyShadowMap = null;\n    }\n\n    if (this.shadow && this.programManager) {\n      this.programManager.removeDefaultModule(shadow);\n      this.programManager = null;\n    }\n  }\n\n  _createLightMatrix() {\n    const lightMatrices = [];\n    for (const light of this.directionalLights) {\n      const viewMatrix = new Matrix4().lookAt({\n        eye: new Vector3(light.direction).negate()\n      });\n\n      lightMatrices.push(viewMatrix);\n    }\n    return lightMatrices;\n  }\n\n  _createShadowPasses(gl) {\n    for (let i = 0; i < this.directionalLights.length; i++) {\n      const shadowPass = new ShadowPass(gl);\n      this.shadowPasses[i] = shadowPass;\n      this.shadowMaps[i] = shadowPass.shadowMap;\n    }\n  }\n\n  _applyDefaultLights() {\n    const {ambientLight, pointLights, directionalLights} = this;\n    if (!ambientLight && pointLights.length === 0 && directionalLights.length === 0) {\n      this.ambientLight = new AmbientLight(DEFAULT_AMBIENT_LIGHT_PROPS);\n      this.directionalLights.push(\n        new DirectionalLight(DEFAULT_DIRECTIONAL_LIGHT_PROPS[0]),\n        new DirectionalLight(DEFAULT_DIRECTIONAL_LIGHT_PROPS[1])\n      );\n    }\n  }\n}\n","import {deepEqual} from '../utils/deep-equal';\nimport {default as LightingEffect} from '../effects/lighting/lighting-effect';\n\nconst DEFAULT_LIGHTING_EFFECT = new LightingEffect();\n\nexport default class EffectManager {\n  constructor() {\n    this.effects = [];\n    this._internalEffects = [];\n    this._needsRedraw = 'Initial render';\n    this.setEffects();\n  }\n\n  setProps(props) {\n    if ('effects' in props) {\n      if (props.effects.length !== this.effects.length || !deepEqual(props.effects, this.effects)) {\n        this.setEffects(props.effects);\n        this._needsRedraw = 'effects changed';\n      }\n    }\n  }\n\n  needsRedraw(opts = {clearRedrawFlags: false}) {\n    const redraw = this._needsRedraw;\n    if (opts.clearRedrawFlags) {\n      this._needsRedraw = false;\n    }\n    return redraw;\n  }\n\n  getEffects() {\n    return this._internalEffects;\n  }\n\n  finalize() {\n    this.cleanup();\n  }\n\n  // Private\n  setEffects(effects = []) {\n    this.cleanup();\n    this.effects = effects;\n    this._createInternalEffects();\n  }\n\n  cleanup() {\n    for (const effect of this.effects) {\n      effect.cleanup();\n    }\n\n    for (const effect of this._internalEffects) {\n      effect.cleanup();\n    }\n    this.effects.length = 0;\n    this._internalEffects.length = 0;\n  }\n\n  _createInternalEffects() {\n    this._internalEffects = this.effects.slice();\n    if (!this.effects.some(effect => effect instanceof LightingEffect)) {\n      this._internalEffects.push(DEFAULT_LIGHTING_EFFECT);\n    }\n  }\n}\n","import LayersPass from './layers-pass';\n\nexport default class DrawLayersPass extends LayersPass {}\n","import LayersPass from './layers-pass';\nimport {withParameters} from '@luma.gl/core';\nimport GL from '@luma.gl/constants';\n\nconst PICKING_PARAMETERS = {\n  blendFunc: [GL.ONE, GL.ZERO, GL.CONSTANT_ALPHA, GL.ZERO],\n  blendEquation: GL.FUNC_ADD\n};\n\nexport default class PickLayersPass extends LayersPass {\n  render(props) {\n    if (props.pickingFBO) {\n      this._drawPickingBuffer(props);\n    } else {\n      super.render(props);\n    }\n  }\n\n  // Private\n  // Draws list of layers and viewports into the picking buffer\n  // Note: does not sample the buffer, that has to be done by the caller\n  _drawPickingBuffer({\n    layers,\n    layerFilter,\n    views,\n    viewports,\n    onViewportActive,\n    pickingFBO,\n    deviceRect: {x, y, width, height},\n    pass = 'picking',\n    redrawReason,\n    pickZ\n  }) {\n    const gl = this.gl;\n    this.pickZ = pickZ;\n\n    // Make sure we clear scissor test and fbo bindings in case of exceptions\n    // We are only interested in one pixel, no need to render anything else\n    // Note that the callback here is called synchronously.\n    // Set blend mode for picking\n    // always overwrite existing pixel with [r,g,b,layerIndex]\n    return withParameters(\n      gl,\n      {\n        scissorTest: true,\n        scissor: [x, y, width, height],\n        clearColor: [0, 0, 0, 0],\n        // When used as Mapbox custom layer, the context state may be dirty\n        // TODO - Remove when mapbox fixes this issue\n        // https://github.com/mapbox/mapbox-gl-js/issues/7801\n        depthMask: true,\n        depthTest: true,\n        depthRange: [0, 1],\n        colorMask: [true, true, true, true],\n        // Blending\n        ...PICKING_PARAMETERS,\n        blend: !pickZ\n      },\n      () => {\n        super.render({\n          target: pickingFBO,\n          layers,\n          layerFilter,\n          views,\n          viewports,\n          onViewportActive,\n          pass,\n          redrawReason\n        });\n      }\n    );\n  }\n\n  // PRIVATE\n  shouldDrawLayer(layer) {\n    return layer.props.pickable;\n  }\n\n  getModuleParameters() {\n    return {\n      pickingActive: 1,\n      pickingAttribute: this.pickZ,\n      // turn off lighting by adding empty light source object\n      // lights shader module relies on the `lightSources` to turn on/off lighting\n      lightSources: {}\n    };\n  }\n\n  getLayerParameters(layer, layerIndex) {\n    // These will override any layer parameters\n    const pickParameters = this.pickZ\n      ? {blend: false}\n      : {...PICKING_PARAMETERS, blend: true, blendColor: [0, 0, 0, (layerIndex + 1) / 255]};\n\n    // Override layer parameters with pick parameters\n    return Object.assign({}, layer.props.parameters, pickParameters);\n  }\n}\n","import debug from '../debug';\nimport DrawLayersPass from '../passes/draw-layers-pass';\nimport PickLayersPass from '../passes/pick-layers-pass';\nimport {Framebuffer} from '@luma.gl/core';\n\nconst TRACE_RENDER_LAYERS = 'deckRenderer.renderLayers';\n\nexport default class DeckRenderer {\n  constructor(gl) {\n    this.gl = gl;\n    this.layerFilter = null;\n    this.drawPickingColors = false;\n    this.drawLayersPass = new DrawLayersPass(gl);\n    this.pickLayersPass = new PickLayersPass(gl);\n    this.renderCount = 0;\n    this._needsRedraw = 'Initial render';\n    this.renderBuffers = [];\n    this.lastPostProcessEffect = null;\n    this._onError = null;\n  }\n\n  setProps(props) {\n    if ('layerFilter' in props && this.layerFilter !== props.layerFilter) {\n      this.layerFilter = props.layerFilter;\n      this._needsRedraw = 'layerFilter changed';\n    }\n\n    if ('drawPickingColors' in props && this.drawPickingColors !== props.drawPickingColors) {\n      this.drawPickingColors = props.drawPickingColors;\n      this._needsRedraw = 'drawPickingColors changed';\n    }\n\n    if ('onError' in props) {\n      this._onError = props.onError;\n    }\n  }\n\n  /*\n    target,\n    layers,\n    viewports,\n    onViewportActive,\n    views,\n    redrawReason,\n    clearCanvas,\n    effects,\n    pass,\n    stats\n  */\n  renderLayers(opts) {\n    const layerPass = this.drawPickingColors ? this.pickLayersPass : this.drawLayersPass;\n\n    opts.layerFilter = this.layerFilter;\n    opts.onError = this._onError;\n    opts.effects = opts.effects || [];\n    opts.target = opts.target || Framebuffer.getDefaultFramebuffer(this.gl);\n\n    this._preRender(opts.effects, opts);\n\n    const outputBuffer = this.lastPostProcessEffect ? this.renderBuffers[0] : opts.target;\n    const renderStats = layerPass.render({...opts, target: outputBuffer});\n\n    this._postRender(opts.effects, opts);\n\n    this.renderCount++;\n\n    debug(TRACE_RENDER_LAYERS, this, renderStats, opts);\n  }\n\n  needsRedraw(opts = {clearRedrawFlags: false}) {\n    const redraw = this._needsRedraw;\n    if (opts.clearRedrawFlags) {\n      this._needsRedraw = false;\n    }\n    return redraw;\n  }\n\n  finalize() {\n    const {renderBuffers} = this;\n    for (const buffer of renderBuffers) {\n      buffer.delete();\n    }\n    renderBuffers.length = 0;\n  }\n\n  // Private\n  _preRender(effects, opts) {\n    let lastPostProcessEffect = null;\n\n    for (const effect of effects) {\n      effect.preRender(this.gl, opts);\n      if (effect.postRender) {\n        lastPostProcessEffect = effect;\n      }\n    }\n\n    if (lastPostProcessEffect) {\n      this._resizeRenderBuffers();\n    }\n    this.lastPostProcessEffect = lastPostProcessEffect;\n  }\n\n  _resizeRenderBuffers() {\n    const {renderBuffers} = this;\n    if (renderBuffers.length === 0) {\n      renderBuffers.push(new Framebuffer(this.gl), new Framebuffer(this.gl));\n    }\n    for (const buffer of renderBuffers) {\n      buffer.resize();\n    }\n  }\n\n  _postRender(effects, opts) {\n    const {renderBuffers} = this;\n    const params = {\n      inputBuffer: renderBuffers[0],\n      swapBuffer: renderBuffers[1],\n      target: null\n    };\n    for (const effect of effects) {\n      if (effect.postRender) {\n        if (effect === this.lastPostProcessEffect) {\n          params.target = opts.target;\n          effect.postRender(this.gl, params);\n          break;\n        }\n        const buffer = effect.postRender(this.gl, params);\n        params.inputBuffer = buffer;\n        params.swapBuffer = buffer === renderBuffers[0] ? renderBuffers[1] : renderBuffers[0];\n      }\n    }\n  }\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport log from '../../utils/log';\n\nconst NO_PICKED_OBJECT = {\n  pickedColor: null,\n  pickedLayer: null,\n  pickedObjectIndex: -1\n};\n\n/* eslint-disable max-depth, max-statements */\n/**\n * Pick at a specified pixel with a tolerance radius\n * Returns the closest object to the pixel in shape `{pickedColor, pickedLayer, pickedObjectIndex}`\n */\nexport function getClosestObject({\n  pickedColors,\n  layers,\n  deviceX,\n  deviceY,\n  deviceRadius,\n  deviceRect\n}) {\n  if (pickedColors) {\n    // Traverse all pixels in picking results and find the one closest to the supplied\n    // [deviceX, deviceY]\n    const {x, y, width, height} = deviceRect;\n    let minSquareDistanceToCenter = deviceRadius * deviceRadius;\n    let closestPixelIndex = -1;\n    let i = 0;\n\n    for (let row = 0; row < height; row++) {\n      const dy = row + y - deviceY;\n      const dy2 = dy * dy;\n\n      if (dy2 > minSquareDistanceToCenter) {\n        // skip this row\n        i += 4 * width;\n      } else {\n        for (let col = 0; col < width; col++) {\n          // Decode picked layer from color\n          const pickedLayerIndex = pickedColors[i + 3] - 1;\n\n          if (pickedLayerIndex >= 0) {\n            const dx = col + x - deviceX;\n            const d2 = dx * dx + dy2;\n\n            if (d2 <= minSquareDistanceToCenter) {\n              minSquareDistanceToCenter = d2;\n              closestPixelIndex = i;\n            }\n          }\n          i += 4;\n        }\n      }\n    }\n\n    if (closestPixelIndex >= 0) {\n      // Decode picked object index from color\n      const pickedLayerIndex = pickedColors[closestPixelIndex + 3] - 1;\n      const pickedColor = pickedColors.slice(closestPixelIndex, closestPixelIndex + 4);\n      const pickedLayer = layers[pickedLayerIndex];\n      if (pickedLayer) {\n        const pickedObjectIndex = pickedLayer.decodePickingColor(pickedColor);\n        const dy = Math.floor(closestPixelIndex / 4 / width);\n        const dx = closestPixelIndex / 4 - dy * width;\n        return {pickedColor, pickedLayer, pickedObjectIndex, pickedX: x + dx, pickedY: y + dy};\n      }\n      log.error('Picked non-existent layer. Is picking buffer corrupt?')();\n    }\n  }\n  return NO_PICKED_OBJECT;\n}\n\n/**\n * Examines a picking buffer for unique colors\n * Returns array of unique objects in shape `{x, y, pickedColor, pickedLayer, pickedObjectIndex}`\n */\nexport function getUniqueObjects({pickedColors, layers}) {\n  const uniqueColors = new Map();\n\n  // Traverse all pixels in picking results and get unique colors\n  if (pickedColors) {\n    for (let i = 0; i < pickedColors.length; i += 4) {\n      // Decode picked layer from color\n      const pickedLayerIndex = pickedColors[i + 3] - 1;\n\n      if (pickedLayerIndex >= 0) {\n        const pickedColor = pickedColors.slice(i, i + 4);\n        const colorKey = pickedColor.join(',');\n        // eslint-disable-next-line\n        if (!uniqueColors.has(colorKey)) {\n          const pickedLayer = layers[pickedLayerIndex];\n          // eslint-disable-next-line\n          if (pickedLayer) {\n            uniqueColors.set(colorKey, {\n              pickedColor,\n              pickedLayer,\n              pickedObjectIndex: pickedLayer.decodePickingColor(pickedColor)\n            });\n          } else {\n            log.error('Picked non-existent layer. Is picking buffer corrupt?')();\n          }\n        }\n      }\n    }\n  }\n\n  return Array.from(uniqueColors.values());\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n// Even if nothing gets picked, we need to expose some information of the picking action:\n// x, y, coordinates etc.\nexport function getEmptyPickingInfo({pickInfo, viewports, pixelRatio, x, y, z}) {\n  const viewport = getViewportFromCoordinates({viewports}); // TODO - add coords\n  const coordinate = viewport && viewport.unproject([x - viewport.x, y - viewport.y], {targetZ: z});\n\n  return {\n    color: null,\n    layer: null,\n    index: -1,\n    picked: false,\n    x,\n    y,\n    pixel: [x, y],\n    coordinate,\n    // TODO remove the lngLat prop after compatibility check\n    lngLat: coordinate,\n    devicePixel: pickInfo && [pickInfo.pickedX, pickInfo.pickedY],\n    pixelRatio\n  };\n}\n\n/* eslint-disable max-depth */\nexport function processPickInfo(opts) {\n  const {pickInfo, lastPickedInfo, mode, layers} = opts;\n  const {pickedColor, pickedLayer, pickedObjectIndex} = pickInfo;\n\n  const affectedLayers = pickedLayer ? [pickedLayer] : [];\n\n  if (mode === 'hover') {\n    // only invoke onHover events if picked object has changed\n    const lastPickedObjectIndex = lastPickedInfo.index;\n    const lastPickedLayerId = lastPickedInfo.layerId;\n    const pickedLayerId = pickedLayer && pickedLayer.props.id;\n\n    // proceed only if picked object changed\n    if (pickedLayerId !== lastPickedLayerId || pickedObjectIndex !== lastPickedObjectIndex) {\n      if (pickedLayerId !== lastPickedLayerId) {\n        // We cannot store a ref to lastPickedLayer in the context because\n        // the state of an outdated layer is no longer valid\n        // and the props may have changed\n        const lastPickedLayer = layers.find(layer => layer.props.id === lastPickedLayerId);\n        if (lastPickedLayer) {\n          // Let leave event fire before enter event\n          affectedLayers.unshift(lastPickedLayer);\n        }\n      }\n\n      // Update layer manager context\n      lastPickedInfo.layerId = pickedLayerId;\n      lastPickedInfo.index = pickedObjectIndex;\n      lastPickedInfo.info = null;\n    }\n  }\n\n  const baseInfo = getEmptyPickingInfo(opts);\n\n  // Use a Map to store all picking infos.\n  // The following two forEach loops are the result of\n  // https://github.com/visgl/deck.gl/issues/443\n  // Please be very careful when changing this pattern\n  const infos = new Map();\n\n  // Make sure infos always contain something even if no layer is affected\n  infos.set(null, baseInfo);\n\n  affectedLayers.forEach(layer => {\n    let info = Object.assign({}, baseInfo);\n\n    if (layer === pickedLayer) {\n      info.color = pickedColor;\n      info.index = pickedObjectIndex;\n      info.picked = true;\n    }\n\n    info = getLayerPickingInfo({layer, info, mode});\n\n    if (layer === pickedLayer && mode === 'hover') {\n      lastPickedInfo.info = info;\n    }\n\n    // This guarantees that there will be only one copy of info for\n    // one composite layer\n    if (info) {\n      infos.set(info.layer.id, info);\n    }\n\n    if (mode === 'hover' && layer.props.autoHighlight) {\n      const pickingModuleParameters = {\n        pickingSelectedColor: pickedLayer === layer ? pickedColor : null\n      };\n      const {highlightColor} = layer.props;\n      if (pickedLayer === layer && typeof highlightColor === 'function') {\n        pickingModuleParameters.pickingHighlightColor = highlightColor(info);\n      }\n      layer.setModuleParameters(pickingModuleParameters);\n      // setModuleParameters does not trigger redraw\n      layer.setNeedsRedraw();\n    }\n  });\n\n  return infos;\n}\n\n// Walk up the layer composite chain to populate the info object\nexport function getLayerPickingInfo({layer, info, mode}) {\n  while (layer && info) {\n    // For a composite layer, sourceLayer will point to the sublayer\n    // where the event originates from.\n    // It provides additional context for the composite layer's\n    // getPickingInfo() method to populate the info object\n    const sourceLayer = info.layer || layer;\n    info.layer = layer;\n    // layer.pickLayer() function requires a non-null ```layer.state```\n    // object to function properly. So the layer referenced here\n    // must be the \"current\" layer, not an \"out-dated\" / \"invalidated\" layer\n    info = layer.getPickingInfo({info, mode, sourceLayer});\n    layer = layer.parent;\n  }\n  return info;\n}\n\n// Indentifies which viewport, if any corresponds to x and y\n// Returns first viewport if no match\n// TODO - need to determine which viewport we are in\n// TODO - document concept of \"primary viewport\" that matches all coords?\n// TODO - static method on Viewport class?\nfunction getViewportFromCoordinates({viewports}) {\n  const viewport = viewports[0];\n  return viewport;\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport {\n  Framebuffer,\n  Texture2D,\n  isWebGL2,\n  readPixelsToArray,\n  cssToDeviceRatio,\n  cssToDevicePixels\n} from '@luma.gl/core';\nimport GL from '@luma.gl/constants';\nimport assert from '../utils/assert';\nimport log from '../utils/log';\nimport PickLayersPass from '../passes/pick-layers-pass';\nimport {getClosestObject, getUniqueObjects} from './picking/query-object';\nimport {processPickInfo, getLayerPickingInfo, getEmptyPickingInfo} from './picking/pick-info';\n\nexport default class DeckPicker {\n  constructor(gl) {\n    this.gl = gl;\n    this.pickingFBO = null;\n    this.pickLayersPass = new PickLayersPass(gl);\n    this.layerFilter = null;\n    this.lastPickedInfo = {\n      // For callback tracking and auto highlight\n      index: -1,\n      layerId: null,\n      info: null\n    };\n    this._onError = null;\n  }\n\n  setProps(props) {\n    if ('layerFilter' in props) {\n      this.layerFilter = props.layerFilter;\n    }\n\n    if ('onError' in props) {\n      this._onError = props.onError;\n    }\n\n    if ('_pickable' in props) {\n      this._pickable = props._pickable;\n    }\n  }\n\n  finalize() {\n    if (this.pickingFBO) {\n      this.pickingFBO.delete();\n    }\n    if (this.depthFBO) {\n      this.depthFBO.color.delete();\n      this.depthFBO.delete();\n    }\n  }\n\n  // Pick the closest info at given coordinate\n  pickObject(opts) {\n    return this._pickClosestObject(opts);\n  }\n\n  // Get all unique infos within a bounding box\n  pickObjects(opts) {\n    return this._pickVisibleObjects(opts);\n  }\n\n  // Returns a new picking info object by assuming the last picked object is still picked\n  getLastPickedObject({x, y, layers, viewports}, lastPickedInfo = this.lastPickedInfo.info) {\n    const lastPickedLayerId = lastPickedInfo && lastPickedInfo.layer && lastPickedInfo.layer.id;\n    const layer = lastPickedLayerId ? layers.find(l => l.id === lastPickedLayerId) : null;\n    const coordinate = viewports[0] && viewports[0].unproject([x, y]);\n\n    const info = {\n      x,\n      y,\n      coordinate,\n      // TODO remove the lngLat prop after compatibility check\n      lngLat: coordinate,\n      layer\n    };\n\n    if (layer) {\n      return Object.assign({}, lastPickedInfo, info);\n    }\n    return Object.assign(info, {color: null, object: null, index: -1});\n  }\n\n  // Private\n  _resizeBuffer() {\n    const {gl} = this;\n\n    // Create a frame buffer if not already available\n    if (!this.pickingFBO) {\n      this.pickingFBO = new Framebuffer(gl);\n      if (Framebuffer.isSupported(gl, {colorBufferFloat: true})) {\n        this.depthFBO = new Framebuffer(gl);\n        this.depthFBO.attach({\n          [GL.COLOR_ATTACHMENT0]: new Texture2D(gl, {\n            format: isWebGL2(gl) ? GL.RGBA32F : GL.RGBA,\n            type: GL.FLOAT\n          })\n        });\n      }\n    }\n    // Resize it to current canvas size (this is a noop if size hasn't changed)\n    this.pickingFBO.resize({width: gl.canvas.width, height: gl.canvas.height});\n    if (this.depthFBO) {\n      this.depthFBO.resize({width: gl.canvas.width, height: gl.canvas.height});\n    }\n    return this.pickingFBO;\n  }\n\n  // picking can only handle up to 255 layers. Drop non-pickable/invisible layers from the list.\n  _getPickable(layers) {\n    if (this._pickable === false) {\n      return null;\n    }\n    const pickableLayers = layers.filter(layer => layer.isPickable() && !layer.isComposite);\n    if (pickableLayers.length > 255) {\n      log.warn('Too many pickable layers, only picking the first 255')();\n      return pickableLayers.slice(0, 255);\n    }\n    return pickableLayers.length ? pickableLayers : null;\n  }\n\n  // Pick the closest object at the given (x,y) coordinate\n  // eslint-disable-next-line max-statements,complexity\n  _pickClosestObject({\n    layers,\n    views,\n    viewports,\n    x,\n    y,\n    radius = 0,\n    depth = 1,\n    mode = 'query',\n    unproject3D,\n    onViewportActive\n  }) {\n    layers = this._getPickable(layers);\n\n    if (!layers) {\n      return {\n        result: [],\n        emptyInfo: getEmptyPickingInfo({viewports, x, y})\n      };\n    }\n\n    this._resizeBuffer();\n\n    // Convert from canvas top-left to WebGL bottom-left coordinates\n    // Top-left coordinates [x, y] to bottom-left coordinates [deviceX, deviceY]\n    // And compensate for pixelRatio\n    const pixelRatio = cssToDeviceRatio(this.gl);\n    const devicePixelRange = cssToDevicePixels(this.gl, [x, y], true);\n    const devicePixel = [\n      devicePixelRange.x + Math.floor(devicePixelRange.width / 2),\n      devicePixelRange.y + Math.floor(devicePixelRange.height / 2)\n    ];\n\n    const deviceRadius = Math.round(radius * pixelRatio);\n    const {width, height} = this.pickingFBO;\n    const deviceRect = this._getPickingRect({\n      deviceX: devicePixel[0],\n      deviceY: devicePixel[1],\n      deviceRadius,\n      deviceWidth: width,\n      deviceHeight: height\n    });\n\n    let infos;\n    const result = [];\n    const affectedLayers = {};\n\n    for (let i = 0; i < depth; i++) {\n      const pickedColors =\n        deviceRect &&\n        this._drawAndSample({\n          layers,\n          views,\n          viewports,\n          onViewportActive,\n          deviceRect,\n          pass: `picking:${mode}`,\n          redrawReason: mode\n        });\n\n      const pickInfo = getClosestObject({\n        pickedColors,\n        layers,\n        deviceX: devicePixel[0],\n        deviceY: devicePixel[1],\n        deviceRadius,\n        deviceRect\n      });\n\n      let z;\n      if (pickInfo.pickedLayer && unproject3D && this.depthFBO) {\n        const zValues = this._drawAndSample({\n          layers: [pickInfo.pickedLayer],\n          views,\n          viewports,\n          onViewportActive,\n          deviceRect: {x: pickInfo.pickedX, y: pickInfo.pickedY, width: 1, height: 1},\n          pass: `picking:${mode}`,\n          redrawReason: 'pick-z',\n          pickZ: true\n        });\n        // picked value is in common space (pixels) from the camera target (viewport.position)\n        // convert it to meters from the ground\n        z = zValues[0] * viewports[0].distanceScales.metersPerUnit[2] + viewports[0].position[2];\n      }\n\n      // Only exclude if we need to run picking again.\n      // We need to run picking again if an object is detected AND\n      // we have not exhausted the requested depth.\n      if (pickInfo.pickedColor && i + 1 < depth) {\n        const layerId = pickInfo.pickedColor[3] - 1;\n        affectedLayers[layerId] = true;\n        layers[layerId].clearPickingColor(pickInfo.pickedColor);\n      }\n\n      // This logic needs to run even if no object is picked.\n      infos = processPickInfo({\n        pickInfo,\n        lastPickedInfo: this.lastPickedInfo,\n        mode,\n        layers,\n        viewports,\n        x,\n        y,\n        z,\n        pixelRatio\n      });\n\n      for (const info of infos.values()) {\n        if (info.layer) {\n          result.push(info);\n        }\n      }\n\n      // If no object is picked stop.\n      if (!pickInfo.pickedColor) {\n        break;\n      }\n    }\n\n    // reset only affected buffers\n    for (const layerId in affectedLayers) {\n      layers[layerId].restorePickingColors();\n    }\n\n    return {result, emptyInfo: infos && infos.get(null)};\n  }\n\n  // Pick all objects within the given bounding box\n  _pickVisibleObjects({\n    layers,\n    views,\n    viewports,\n    x,\n    y,\n    width = 1,\n    height = 1,\n    mode = 'query',\n    onViewportActive\n  }) {\n    layers = this._getPickable(layers);\n\n    if (!layers) {\n      return [];\n    }\n\n    this._resizeBuffer();\n    // Convert from canvas top-left to WebGL bottom-left coordinates\n    // And compensate for pixelRatio\n    const pixelRatio = cssToDeviceRatio(this.gl);\n    const leftTop = cssToDevicePixels(this.gl, [x, y], true);\n\n    // take left and top (y inverted in device pixels) from start location\n    const deviceLeft = leftTop.x;\n    const deviceTop = leftTop.y + leftTop.height;\n\n    // take right and bottom (y inverted in device pixels) from end location\n    const rightBottom = cssToDevicePixels(this.gl, [x + width, y + height], true);\n    const deviceRight = rightBottom.x + rightBottom.width;\n    const deviceBottom = rightBottom.y;\n\n    const deviceRect = {\n      x: deviceLeft,\n      y: deviceBottom,\n      // deviceTop and deviceRight represent the first pixel outside the desired rect\n      width: deviceRight - deviceLeft,\n      height: deviceTop - deviceBottom\n    };\n\n    const pickedColors = this._drawAndSample({\n      layers,\n      views,\n      viewports,\n      onViewportActive,\n      deviceRect,\n      pass: `picking:${mode}`,\n      redrawReason: mode\n    });\n\n    const pickInfos = getUniqueObjects({pickedColors, layers});\n\n    // Only return unique infos, identified by info.object\n    const uniqueInfos = new Map();\n\n    pickInfos.forEach(pickInfo => {\n      let info = {\n        color: pickInfo.pickedColor,\n        layer: null,\n        index: pickInfo.pickedObjectIndex,\n        picked: true,\n        x,\n        y,\n        width,\n        height,\n        pixelRatio\n      };\n\n      info = getLayerPickingInfo({layer: pickInfo.pickedLayer, info, mode});\n      if (!uniqueInfos.has(info.object)) {\n        uniqueInfos.set(info.object, info);\n      }\n    });\n\n    return Array.from(uniqueInfos.values());\n  }\n\n  // returns pickedColor or null if no pickable layers found.\n  _drawAndSample({\n    layers,\n    views,\n    viewports,\n    onViewportActive,\n    deviceRect,\n    pass,\n    redrawReason,\n    pickZ\n  }) {\n    assert(deviceRect.width > 0 && deviceRect.height > 0);\n\n    if (layers.length < 1) {\n      return null;\n    }\n\n    const pickingFBO = pickZ ? this.depthFBO : this.pickingFBO;\n\n    this.pickLayersPass.render({\n      layers,\n      layerFilter: this.layerFilter,\n      onError: this._onError,\n      views,\n      viewports,\n      onViewportActive,\n      pickingFBO,\n      deviceRect,\n      pass,\n      redrawReason,\n      pickZ\n    });\n\n    // Read from an already rendered picking buffer\n    // Returns an Uint8ClampedArray of picked pixels\n    const {x, y, width, height} = deviceRect;\n    const pickedColors = new (pickZ ? Float32Array : Uint8Array)(width * height * 4);\n    readPixelsToArray(pickingFBO, {\n      sourceX: x,\n      sourceY: y,\n      sourceWidth: width,\n      sourceHeight: height,\n      target: pickedColors\n    });\n\n    return pickedColors;\n  }\n\n  // Calculate a picking rect centered on deviceX and deviceY and clipped to device\n  // Returns null if pixel is outside of device\n  _getPickingRect({deviceX, deviceY, deviceRadius, deviceWidth, deviceHeight}) {\n    // Create a box of size `radius * 2 + 1` centered at [deviceX, deviceY]\n    const x = Math.max(0, deviceX - deviceRadius);\n    const y = Math.max(0, deviceY - deviceRadius);\n    const width = Math.min(deviceWidth, deviceX + deviceRadius + 1) - x;\n    const height = Math.min(deviceHeight, deviceY + deviceRadius + 1) - y;\n\n    // x, y out of bounds.\n    if (width <= 0 || height <= 0) {\n      return null;\n    }\n\n    return {x, y, width, height};\n  }\n}\n","// Copyright (c) 2015 - 2019 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* global document */\nconst defaultStyle = {\n  zIndex: 1,\n  position: 'absolute',\n  pointerEvents: 'none',\n  color: '#a0a7b4',\n  backgroundColor: '#29323c',\n  padding: '10px',\n  top: 0,\n  left: 0,\n  display: 'none'\n};\n\nexport default class Tooltip {\n  constructor(canvas) {\n    const canvasParent = canvas.parentElement;\n\n    if (canvasParent) {\n      this.el = document.createElement('div');\n      this.el.className = 'deck-tooltip';\n      Object.assign(this.el.style, defaultStyle);\n      canvasParent.appendChild(this.el);\n    }\n  }\n\n  setTooltip(displayInfo, x, y) {\n    const el = this.el;\n\n    if (typeof displayInfo === 'string') {\n      el.innerText = displayInfo;\n    } else if (!displayInfo) {\n      el.style.display = 'none';\n      return;\n    } else {\n      if ('text' in displayInfo) {\n        el.innerText = displayInfo.text;\n      }\n      if ('html' in displayInfo) {\n        el.innerHTML = displayInfo.html;\n      }\n      if ('className' in displayInfo) {\n        el.className = displayInfo.className;\n      }\n      Object.assign(el.style, displayInfo.style);\n    }\n    el.style.display = 'block';\n    el.style.transform = `translate(${x}px, ${y}px)`;\n  }\n\n  remove() {\n    if (this.el) {\n      this.el.remove();\n    }\n  }\n}\n","function isJSON(text) {\n  const firstChar = text[0];\n  const lastChar = text[text.length - 1];\n  return (firstChar === '{' && lastChar === '}') || (firstChar === '[' && lastChar === ']');\n}\n\n// TODO - replace with the version in loaders.gl\nexport default {\n  name: 'JSON',\n  // TODO - can we stream process geojson?\n  extensions: ['json', 'geojson'],\n  mimeTypes: ['application/json', 'application/geo+json'],\n  testText: isJSON,\n  parseTextSync: JSON.parse\n};\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport {registerLoaders} from '@loaders.gl/core';\nimport {ImageLoader} from '@loaders.gl/images';\n\nimport {global} from 'probe.gl/env';\nimport log from '../utils/log';\nimport {register} from '../debug';\nimport jsonLoader from '../utils/json-loader';\n\n// Version detection using babel plugin\n// Fallback for tests and SSR since global variable is defined by Webpack.\n/* global __VERSION__ */\nconst version =\n  typeof __VERSION__ !== 'undefined' ? __VERSION__ : global.DECK_VERSION || 'untranspiled source';\n\n// Note: a `deck` object not created by deck.gl may exist in the global scope\nconst existingVersion = global.deck && global.deck.VERSION;\n\nif (existingVersion && existingVersion !== version) {\n  throw new Error(`deck.gl - multiple versions detected: ${existingVersion} vs ${version}`);\n}\n\nif (!existingVersion) {\n  // eslint-disable-next-line\n  if (process.env.NODE_ENV !== 'production') {\n    log.log(\n      0,\n      `deck.gl ${version} - set deck.log.level=1 (or higher) to trace attribute updates`\n    )();\n  }\n\n  global.deck = Object.assign(global.deck || {}, {\n    VERSION: version,\n    version,\n    log,\n    // experimental\n    _registerLoggers: register\n  });\n\n  registerLoaders([jsonLoader, [ImageLoader, {imagebitmap: {premultiplyAlpha: 'none'}}]]);\n}\n\nexport default global.deck;\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport LayerManager from './layer-manager';\nimport ViewManager from './view-manager';\nimport MapView from '../views/map-view';\nimport EffectManager from './effect-manager';\nimport Effect from './effect';\nimport DeckRenderer from './deck-renderer';\nimport DeckPicker from './deck-picker';\nimport Tooltip from './tooltip';\nimport log from '../utils/log';\nimport {deepEqual} from '../utils/deep-equal';\nimport typedArrayManager from '../utils/typed-array-manager';\nimport deckGlobal from './init';\n\nimport {getBrowser} from 'probe.gl/env';\nimport GL from '@luma.gl/constants';\nimport {\n  AnimationLoop,\n  createGLContext,\n  instrumentGLContext,\n  setParameters,\n  Timeline,\n  lumaStats\n} from '@luma.gl/core';\nimport {Stats} from 'probe.gl';\nimport {EventManager} from 'mjolnir.js';\n\nimport assert from '../utils/assert';\nimport {EVENTS} from './constants';\n/* global document */\n\nfunction noop() {}\n\nconst getCursor = ({isDragging}) => (isDragging ? 'grabbing' : 'grab');\n\nfunction getPropTypes(PropTypes) {\n  // Note: Arrays (layers, views, ) can contain falsy values\n  return {\n    id: PropTypes.string,\n    width: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n    height: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n\n    // layer/view/controller settings\n    layers: PropTypes.oneOfType([PropTypes.object, PropTypes.array]),\n    layerFilter: PropTypes.func,\n    views: PropTypes.oneOfType([PropTypes.object, PropTypes.array]),\n    viewState: PropTypes.object,\n    effects: PropTypes.arrayOf(PropTypes.instanceOf(Effect)),\n    controller: PropTypes.oneOfType([PropTypes.func, PropTypes.bool, PropTypes.object]),\n\n    // GL settings\n    gl: PropTypes.object,\n    glOptions: PropTypes.object,\n    parameters: PropTypes.object,\n    pickingRadius: PropTypes.number,\n    useDevicePixels: PropTypes.oneOfType([PropTypes.bool, PropTypes.number]),\n    touchAction: PropTypes.string,\n\n    // Callbacks\n    onWebGLInitialized: PropTypes.func,\n    onResize: PropTypes.func,\n    onViewStateChange: PropTypes.func,\n    onBeforeRender: PropTypes.func,\n    onAfterRender: PropTypes.func,\n    onLoad: PropTypes.func,\n    onError: PropTypes.func,\n\n    // Debug settings\n    debug: PropTypes.bool,\n    drawPickingColors: PropTypes.bool,\n\n    // Experimental props\n    _framebuffer: PropTypes.object,\n    // Forces a redraw every animation frame\n    _animate: PropTypes.bool,\n\n    // UNSAFE options - not exhaustively tested, not guaranteed to work in all cases, use at your own risk\n\n    // Set to false to disable picking - avoiding picking buffer creation can save memory for mobile web browsers\n    _pickable: PropTypes.bool,\n\n    // Adjust parameters of typed array manager, can save memory e.g. for mobile web browsers\n    _typedArrayManagerProps: PropTypes.object //  {overAlloc: number, poolSize: number}\n  };\n}\n\nconst defaultProps = {\n  id: 'deckgl-overlay',\n  width: '100%',\n  height: '100%',\n\n  pickingRadius: 0,\n  layerFilter: null,\n  glOptions: {},\n  gl: null,\n  layers: [],\n  effects: [],\n  views: null,\n  controller: null, // Rely on external controller, e.g. react-map-gl\n  useDevicePixels: true,\n  touchAction: 'none',\n  _framebuffer: null,\n  _animate: false,\n  _pickable: true,\n  _typedArrayManagerProps: {},\n\n  onWebGLInitialized: noop,\n  onResize: noop,\n  onViewStateChange: noop,\n  onBeforeRender: noop,\n  onAfterRender: noop,\n  onLoad: noop,\n  onError: null,\n  _onMetrics: null,\n\n  getCursor,\n\n  debug: false,\n  drawPickingColors: false\n};\n\n/* eslint-disable max-statements */\nexport default class Deck {\n  constructor(props) {\n    props = Object.assign({}, defaultProps, props);\n    this.props = {};\n\n    this.width = 0; // \"read-only\", auto-updated from canvas\n    this.height = 0; // \"read-only\", auto-updated from canvas\n\n    // Maps view descriptors to vieports, rebuilds when width/height/viewState/views change\n    this.viewManager = null;\n    this.layerManager = null;\n    this.effectManager = null;\n    this.deckRenderer = null;\n    this.deckPicker = null;\n\n    this._needsRedraw = true;\n    this._pickRequest = {};\n    // Pick and store the object under the pointer on `pointerdown`.\n    // This object is reused for subsequent `onClick` and `onDrag*` callbacks.\n    this._lastPointerDownInfo = null;\n\n    this.viewState = null; // Internal view state if no callback is supplied\n    this.interactiveState = {\n      isDragging: false // Whether the cursor is down\n    };\n\n    // Bind methods\n    this._onEvent = this._onEvent.bind(this);\n    this._onPointerDown = this._onPointerDown.bind(this);\n    this._onPointerMove = this._onPointerMove.bind(this);\n    this._pickAndCallback = this._pickAndCallback.bind(this);\n    this._onRendererInitialized = this._onRendererInitialized.bind(this);\n    this._onRenderFrame = this._onRenderFrame.bind(this);\n    this._onViewStateChange = this._onViewStateChange.bind(this);\n    this._onInteractiveStateChange = this._onInteractiveStateChange.bind(this);\n\n    if (props.viewState && props.initialViewState) {\n      log.warn(\n        'View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.'\n      )();\n    }\n    if (getBrowser() === 'IE') {\n      log.warn('IE 11 support will be deprecated in v8.0')();\n    }\n\n    if (!props.gl) {\n      // Note: LayerManager creation deferred until gl context available\n      if (typeof document !== 'undefined') {\n        this.canvas = this._createCanvas(props);\n      }\n    }\n    this.animationLoop = this._createAnimationLoop(props);\n\n    this.stats = new Stats({id: 'deck.gl'});\n    this.metrics = {\n      fps: 0,\n      setPropsTime: 0,\n      updateAttributesTime: 0,\n      framesRedrawn: 0,\n      pickTime: 0,\n      pickCount: 0,\n      gpuTime: 0,\n      gpuTimePerFrame: 0,\n      cpuTime: 0,\n      cpuTimePerFrame: 0,\n      bufferMemory: 0,\n      textureMemory: 0,\n      renderbufferMemory: 0,\n      gpuMemory: 0\n    };\n    this._metricsCounter = 0;\n\n    this.setProps(props);\n\n    // UNSAFE/experimental prop: only set at initialization to avoid performance hit\n    if (props._typedArrayManagerProps) {\n      typedArrayManager.setProps(props._typedArrayManagerProps);\n    }\n\n    this.animationLoop.start();\n  }\n\n  finalize() {\n    this.animationLoop.stop();\n    this.animationLoop = null;\n    this._lastPointerDownInfo = null;\n\n    if (this.layerManager) {\n      this.layerManager.finalize();\n      this.layerManager = null;\n\n      this.viewManager.finalize();\n      this.viewManager = null;\n\n      this.effectManager.finalize();\n      this.effectManager = null;\n\n      this.deckRenderer.finalize();\n      this.deckRenderer = null;\n\n      this.deckPicker.finalize();\n      this.deckPicker = null;\n\n      this.eventManager.destroy();\n      this.eventManager = null;\n\n      this.tooltip.remove();\n      this.tooltip = null;\n    }\n\n    if (!this.props.canvas && !this.props.gl && this.canvas) {\n      // remove internally created canvas\n      this.canvas.parentElement.removeChild(this.canvas);\n      this.canvas = null;\n    }\n  }\n\n  setProps(props) {\n    this.stats.get('setProps Time').timeStart();\n\n    if ('onLayerHover' in props) {\n      log.removed('onLayerHover', 'onHover')();\n    }\n    if ('onLayerClick' in props) {\n      log.removed('onLayerClick', 'onClick')();\n    }\n    if (props.initialViewState && !deepEqual(this.props.initialViewState, props.initialViewState)) {\n      // Overwrite internal view state\n      this.viewState = props.initialViewState;\n    }\n\n    // Merge with existing props\n    Object.assign(this.props, props);\n\n    // Update CSS size of canvas\n    this._setCanvasSize(this.props);\n\n    // We need to overwrite CSS style width and height with actual, numeric values\n    const resolvedProps = Object.create(this.props);\n    Object.assign(resolvedProps, {\n      views: this._getViews(),\n      width: this.width,\n      height: this.height,\n      viewState: this._getViewState()\n    });\n\n    // Update the animation loop\n    this.animationLoop.setProps(resolvedProps);\n\n    // If initialized, update sub manager props\n    if (this.layerManager) {\n      this.viewManager.setProps(resolvedProps);\n      // Make sure that any new layer gets initialized with the current viewport\n      this.layerManager.activateViewport(this.getViewports()[0]);\n      this.layerManager.setProps(resolvedProps);\n      this.effectManager.setProps(resolvedProps);\n      this.deckRenderer.setProps(resolvedProps);\n      this.deckPicker.setProps(resolvedProps);\n    }\n\n    this.stats.get('setProps Time').timeEnd();\n  }\n\n  // Public API\n  // Check if a redraw is needed\n  // Returns `false` or a string summarizing the redraw reason\n  // opts.clearRedrawFlags (Boolean) - clear the redraw flag. Default `true`\n  needsRedraw(opts = {clearRedrawFlags: false}) {\n    if (this.props._animate) {\n      return 'Deck._animate';\n    }\n\n    let redraw = this._needsRedraw;\n\n    if (opts.clearRedrawFlags) {\n      this._needsRedraw = false;\n    }\n\n    const viewManagerNeedsRedraw = this.viewManager.needsRedraw(opts);\n    const layerManagerNeedsRedraw = this.layerManager.needsRedraw(opts);\n    const effectManagerNeedsRedraw = this.effectManager.needsRedraw(opts);\n    const deckRendererNeedsRedraw = this.deckRenderer.needsRedraw(opts);\n\n    redraw =\n      redraw ||\n      viewManagerNeedsRedraw ||\n      layerManagerNeedsRedraw ||\n      effectManagerNeedsRedraw ||\n      deckRendererNeedsRedraw;\n    return redraw;\n  }\n\n  redraw(force) {\n    if (!this.layerManager) {\n      // Not yet initialized\n      return;\n    }\n    // If force is falsy, check if we need to redraw\n    const redrawReason = force || this.needsRedraw({clearRedrawFlags: true});\n\n    if (!redrawReason) {\n      return;\n    }\n\n    this.stats.get('Redraw Count').incrementCount();\n    if (this.props._customRender) {\n      this.props._customRender(redrawReason);\n    } else {\n      this._drawLayers(redrawReason);\n    }\n  }\n\n  getViews() {\n    return this.viewManager.views;\n  }\n\n  // Get a set of viewports for a given width and height\n  getViewports(rect) {\n    return this.viewManager.getViewports(rect);\n  }\n\n  /* {x, y, radius = 0, layerIds = null, unproject3D} */\n  pickObject(opts) {\n    const infos = this._pick('pickObject', 'pickObject Time', opts).result;\n    return infos.length ? infos[0] : null;\n  }\n\n  /* {x, y, radius = 0, layerIds = null, unproject3D, depth = 10} */\n  pickMultipleObjects(opts) {\n    opts.depth = opts.depth || 10;\n    return this._pick('pickObject', 'pickMultipleObjects Time', opts).result;\n  }\n\n  /* {x, y, width = 1, height = 1, layerIds = null} */\n  pickObjects(opts) {\n    return this._pick('pickObjects', 'pickObjects Time', opts);\n  }\n\n  // Experimental\n\n  _addResources(resources, forceUpdate = false) {\n    for (const id in resources) {\n      this.layerManager.resourceManager.add({resourceId: id, data: resources[id], forceUpdate});\n    }\n  }\n\n  _removeResources(resourceIds) {\n    for (const id of resourceIds) {\n      this.layerManager.resourceManager.remove(id);\n    }\n  }\n\n  // Private Methods\n\n  _pick(method, statKey, opts) {\n    const {stats} = this;\n\n    stats.get('Pick Count').incrementCount();\n    stats.get(statKey).timeStart();\n\n    const infos = this.deckPicker[method](\n      Object.assign(\n        {\n          layers: this.layerManager.getLayers(opts),\n          views: this.viewManager.getViews(),\n          viewports: this.getViewports(opts),\n          onViewportActive: this.layerManager.activateViewport\n        },\n        opts\n      )\n    );\n\n    stats.get(statKey).timeEnd();\n\n    return infos;\n  }\n\n  // canvas, either string, canvas or `null`\n  _createCanvas(props) {\n    let canvas = props.canvas;\n\n    // TODO EventManager should accept element id\n    if (typeof canvas === 'string') {\n      canvas = document.getElementById(canvas);\n      assert(canvas);\n    }\n\n    if (!canvas) {\n      canvas = document.createElement('canvas');\n      const parent = props.parent || document.body;\n      parent.appendChild(canvas);\n    }\n\n    const {id, style} = props;\n    canvas.id = id;\n    Object.assign(canvas.style, style);\n\n    return canvas;\n  }\n\n  // Updates canvas width and/or height, if provided as props\n  _setCanvasSize(props) {\n    if (!this.canvas) {\n      return;\n    }\n\n    let {width, height} = props;\n    // Set size ONLY if props are being provided, otherwise let canvas be layouted freely\n    if (width || width === 0) {\n      width = Number.isFinite(width) ? `${width}px` : width;\n      this.canvas.style.width = width;\n    }\n    if (height || height === 0) {\n      height = Number.isFinite(height) ? `${height}px` : height;\n      // Note: position==='absolute' required for height 100% to work\n      this.canvas.style.position = 'absolute';\n      this.canvas.style.height = height;\n    }\n  }\n\n  // If canvas size has changed, updates\n  _updateCanvasSize() {\n    if (this._checkForCanvasSizeChange()) {\n      const {width, height} = this;\n      this.viewManager.setProps({width, height});\n      this.props.onResize({width: this.width, height: this.height});\n    }\n  }\n\n  // If canvas size has changed, reads out the new size and returns true\n  _checkForCanvasSizeChange() {\n    const {canvas} = this;\n    if (!canvas) {\n      return false;\n    }\n    // Fallback to width/height when clientWidth/clientHeight are 0 or undefined.\n    const newWidth = canvas.clientWidth || canvas.width;\n    const newHeight = canvas.clientHeight || canvas.height;\n    if (newWidth !== this.width || newHeight !== this.height) {\n      this.width = newWidth;\n      this.height = newHeight;\n      return true;\n    }\n    return false;\n  }\n\n  _createAnimationLoop(props) {\n    const {width, height, gl, glOptions, debug, useDevicePixels, autoResizeDrawingBuffer} = props;\n\n    return new AnimationLoop({\n      width,\n      height,\n      useDevicePixels,\n      autoResizeDrawingBuffer,\n      autoResizeViewport: false,\n      gl,\n      onCreateContext: opts =>\n        createGLContext(Object.assign({}, glOptions, opts, {canvas: this.canvas, debug})),\n      onInitialize: this._onRendererInitialized,\n      onRender: this._onRenderFrame,\n      onBeforeRender: props.onBeforeRender,\n      onAfterRender: props.onAfterRender\n    });\n  }\n\n  // Get the most relevant view state: props.viewState, if supplied, shadows internal viewState\n  // TODO: For backwards compatibility ensure numeric width and height is added to the viewState\n  _getViewState() {\n    return this.props.viewState || this.viewState;\n  }\n\n  // Get the view descriptor list\n  _getViews() {\n    // Default to a full screen map view port\n    let views = this.props.views || [new MapView({id: 'default-view'})];\n    views = Array.isArray(views) ? views : [views];\n    if (views.length && this.props.controller) {\n      // Backward compatibility: support controller prop\n      views[0].props.controller = this.props.controller;\n    }\n    return views;\n  }\n\n  // The `pointermove` event may fire multiple times in between two animation frames,\n  // it's a waste of time to run picking without rerender. Instead we save the last pick\n  // request and only do it once on the next animation frame.\n  _onPointerMove(event) {\n    const {_pickRequest} = this;\n    if (event.type === 'pointerleave') {\n      _pickRequest.x = -1;\n      _pickRequest.y = -1;\n      _pickRequest.radius = 0;\n    } else if (event.leftButton || event.rightButton) {\n      // Do not trigger onHover callbacks if mouse button is down.\n      return;\n    } else {\n      const pos = event.offsetCenter;\n      // Do not trigger callbacks when click/hover position is invalid. Doing so will cause a\n      // assertion error when attempting to unproject the position.\n      if (!pos) {\n        return;\n      }\n      _pickRequest.x = pos.x;\n      _pickRequest.y = pos.y;\n      _pickRequest.radius = this.props.pickingRadius;\n    }\n\n    if (this.layerManager) {\n      this.layerManager.context.mousePosition = {x: _pickRequest.x, y: _pickRequest.y};\n    }\n\n    _pickRequest.event = event;\n    _pickRequest.mode = 'hover';\n  }\n\n  // Actually run picking\n  _pickAndCallback() {\n    const {_pickRequest} = this;\n\n    if (_pickRequest.event) {\n      // Perform picking\n      const {result, emptyInfo} = this._pick('pickObject', 'pickObject Time', _pickRequest);\n\n      // There are 4 possible scenarios:\n      // result is [outInfo, pickedInfo] (moved from one pickable layer to another)\n      // result is [outInfo] (moved outside of a pickable layer)\n      // result is [pickedInfo] (moved into or over a pickable layer)\n      // result is [] (nothing is or was picked)\n      //\n      // `layer.props.onHover` should be called on all affected layers (out/over)\n      // `deck.props.onHover` should be called with the picked info if any, or empty info otherwise\n      // `deck.props.getTooltip` should be called with the picked info if any, or empty info otherwise\n\n      // Execute callbacks\n      let pickedInfo = emptyInfo;\n      let handled = false;\n      for (const info of result) {\n        pickedInfo = info;\n        handled = info.layer.onHover(info, _pickRequest.event);\n      }\n      if (!handled && this.props.onHover) {\n        this.props.onHover(pickedInfo, _pickRequest.event);\n      }\n\n      // Update tooltip\n      if (this.props.getTooltip) {\n        const displayInfo = this.props.getTooltip(pickedInfo);\n        this.tooltip.setTooltip(displayInfo, pickedInfo.x, pickedInfo.y);\n      }\n\n      // Clear pending pickRequest\n      _pickRequest.event = null;\n    }\n  }\n\n  _updateCursor() {\n    const container = this.props.parent || this.canvas;\n    if (container) {\n      container.style.cursor = this.props.getCursor(this.interactiveState);\n    }\n  }\n\n  _setGLContext(gl) {\n    if (this.layerManager) {\n      return;\n    }\n\n    // if external context...\n    if (!this.canvas) {\n      this.canvas = gl.canvas;\n      instrumentGLContext(gl, {enable: true, copyState: true});\n    }\n\n    this.tooltip = new Tooltip(this.canvas);\n\n    setParameters(gl, {\n      blend: true,\n      blendFunc: [GL.SRC_ALPHA, GL.ONE_MINUS_SRC_ALPHA, GL.ONE, GL.ONE_MINUS_SRC_ALPHA],\n      polygonOffsetFill: true,\n      depthTest: true,\n      depthFunc: GL.LEQUAL\n    });\n\n    this.props.onWebGLInitialized(gl);\n\n    // timeline for transitions\n    const timeline = new Timeline();\n    timeline.play();\n    this.animationLoop.attachTimeline(timeline);\n\n    this.eventManager = new EventManager(this.props.parent || gl.canvas, {\n      touchAction: this.props.touchAction,\n      events: {\n        pointerdown: this._onPointerDown,\n        pointermove: this._onPointerMove,\n        pointerleave: this._onPointerMove\n      }\n    });\n    for (const eventType in EVENTS) {\n      this.eventManager.on(eventType, this._onEvent);\n    }\n\n    this.viewManager = new ViewManager({\n      timeline,\n      eventManager: this.eventManager,\n      onViewStateChange: this._onViewStateChange,\n      onInteractiveStateChange: this._onInteractiveStateChange,\n      views: this._getViews(),\n      viewState: this._getViewState(),\n      width: this.width,\n      height: this.height\n    });\n\n    // viewManager must be initialized before layerManager\n    // layerManager depends on viewport created by viewManager.\n    const viewport = this.viewManager.getViewports()[0];\n\n    // Note: avoid React setState due GL animation loop / setState timing issue\n    this.layerManager = new LayerManager(gl, {\n      deck: this,\n      stats: this.stats,\n      viewport,\n      timeline\n    });\n\n    this.effectManager = new EffectManager();\n\n    this.deckRenderer = new DeckRenderer(gl);\n\n    this.deckPicker = new DeckPicker(gl);\n\n    this.setProps(this.props);\n\n    this._updateCanvasSize();\n    this.props.onLoad();\n  }\n\n  _drawLayers(redrawReason, renderOptions) {\n    const {gl} = this.layerManager.context;\n\n    setParameters(gl, this.props.parameters);\n\n    this.props.onBeforeRender({gl});\n\n    this.deckRenderer.renderLayers(\n      Object.assign(\n        {\n          target: this.props._framebuffer,\n          layers: this.layerManager.getLayers(),\n          viewports: this.viewManager.getViewports(),\n          onViewportActive: this.layerManager.activateViewport,\n          views: this.viewManager.getViews(),\n          pass: 'screen',\n          redrawReason,\n          effects: this.effectManager.getEffects()\n        },\n        renderOptions\n      )\n    );\n\n    this.props.onAfterRender({gl});\n  }\n\n  // Callbacks\n\n  _onRendererInitialized({gl}) {\n    this._setGLContext(gl);\n  }\n\n  _onRenderFrame(animationProps) {\n    this._getFrameStats();\n\n    // Log perf stats every second\n    if (this._metricsCounter++ % 60 === 0) {\n      this._getMetrics();\n      this.stats.reset();\n      log.table(4, this.metrics)();\n\n      // Experimental: report metrics\n      if (this.props._onMetrics) {\n        this.props._onMetrics(this.metrics);\n      }\n    }\n\n    this._updateCanvasSize();\n\n    this._updateCursor();\n\n    // Update layers if needed (e.g. some async prop has loaded)\n    // Note: This can trigger a redraw\n    this.layerManager.updateLayers();\n\n    // Perform picking request if any\n    this._pickAndCallback();\n\n    // Redraw if necessary\n    this.redraw(false);\n\n    // Update viewport transition if needed\n    // Note: this can trigger `onViewStateChange`, and affect layers\n    // We want to defer these changes to the next frame\n    if (this.viewManager) {\n      this.viewManager.updateViewStates();\n    }\n  }\n\n  // Callbacks\n\n  _onViewStateChange(params) {\n    // Let app know that view state is changing, and give it a chance to change it\n    const viewState = this.props.onViewStateChange(params) || params.viewState;\n\n    // If initialViewState was set on creation, auto track position\n    if (this.viewState) {\n      this.viewState = {...this.viewState, [params.viewId]: viewState};\n      if (!this.props.viewState) {\n        // Apply internal view state\n        this.viewManager.setProps({viewState: this.viewState});\n      }\n    }\n  }\n\n  _onInteractiveStateChange({isDragging = false}) {\n    if (isDragging !== this.interactiveState.isDragging) {\n      this.interactiveState.isDragging = isDragging;\n    }\n  }\n\n  _onEvent(event) {\n    const eventOptions = EVENTS[event.type];\n    const pos = event.offsetCenter;\n\n    if (!eventOptions || !pos) {\n      return;\n    }\n\n    // Reuse last picked object\n    const layers = this.layerManager.getLayers();\n    const info = this.deckPicker.getLastPickedObject(\n      {\n        x: pos.x,\n        y: pos.y,\n        layers,\n        viewports: this.getViewports(pos)\n      },\n      this._lastPointerDownInfo\n    );\n\n    const {layer} = info;\n    const layerHandler =\n      layer && (layer[eventOptions.handler] || layer.props[eventOptions.handler]);\n    const rootHandler = this.props[eventOptions.handler];\n    let handled = false;\n\n    if (layerHandler) {\n      handled = layerHandler.call(layer, info, event);\n    }\n    if (!handled && rootHandler) {\n      rootHandler(info, event);\n    }\n  }\n\n  _onPointerDown(event) {\n    const pos = event.offsetCenter;\n    this._lastPointerDownInfo = this.pickObject({\n      x: pos.x,\n      y: pos.y,\n      radius: this.props.pickingRadius\n    });\n  }\n\n  _getFrameStats() {\n    const {stats} = this;\n    stats.get('frameRate').timeEnd();\n    stats.get('frameRate').timeStart();\n\n    // Get individual stats from luma.gl so reset works\n    const animationLoopStats = this.animationLoop.stats;\n    stats.get('GPU Time').addTime(animationLoopStats.get('GPU Time').lastTiming);\n    stats.get('CPU Time').addTime(animationLoopStats.get('CPU Time').lastTiming);\n  }\n\n  _getMetrics() {\n    const {metrics, stats} = this;\n    metrics.fps = stats.get('frameRate').getHz();\n    metrics.setPropsTime = stats.get('setProps Time').time;\n    metrics.updateAttributesTime = stats.get('Update Attributes').time;\n    metrics.framesRedrawn = stats.get('Redraw Count').count;\n    metrics.pickTime =\n      stats.get('pickObject Time').time +\n      stats.get('pickMultipleObjects Time').time +\n      stats.get('pickObjects Time').time;\n    metrics.pickCount = stats.get('Pick Count').count;\n\n    // Luma stats\n    metrics.gpuTime = stats.get('GPU Time').time;\n    metrics.cpuTime = stats.get('CPU Time').time;\n    metrics.gpuTimePerFrame = stats.get('GPU Time').getAverageTime();\n    metrics.cpuTimePerFrame = stats.get('CPU Time').getAverageTime();\n\n    const memoryStats = lumaStats.get('Memory Usage');\n    metrics.bufferMemory = memoryStats.get('Buffer Memory').count;\n    metrics.textureMemory = memoryStats.get('Texture Memory').count;\n    metrics.renderbufferMemory = memoryStats.get('Renderbuffer Memory').count;\n    metrics.gpuMemory = memoryStats.get('GPU Memory').count;\n  }\n}\n\nDeck.getPropTypes = getPropTypes;\nDeck.defaultProps = defaultProps;\n\n// This is used to defeat tree shaking of init.js\n// https://github.com/visgl/deck.gl/issues/3213\nDeck.VERSION = deckGlobal.VERSION;\n","import deckLog from '../utils/log';\nimport {getLoggers} from './loggers';\n\n/* debug utility */\n\nlet loggers = {};\n\n// Conditionally load default loggers in development mode\n// eslint-disable-next-line\nif (process.env.NODE_ENV !== 'production') {\n  loggers = getLoggers(deckLog);\n}\n\nexport function register(handlers) {\n  loggers = handlers;\n}\n\nexport default function debug(eventType) {\n  if (deckLog.level > 0 && loggers[eventType]) {\n    // Not using ...args to defeat perf hit from array construction\n    loggers[eventType].call(...arguments);\n  }\n}\n","export const LIFECYCLE = {\n  NO_STATE: 'Awaiting state',\n  MATCHED: 'Matched. State transferred from previous layer',\n  INITIALIZED: 'Initialized',\n  AWAITING_GC: 'Discarded. Awaiting garbage collection',\n  AWAITING_FINALIZATION: 'No longer matched. Awaiting garbage collection',\n  FINALIZED: 'Finalized! Awaiting garbage collection'\n};\n\n/* Secret props keys */\n// Symbols are non-enumerable by default, does not show in for...in or Object.keys\n// but are copied with Object.assign \\_()_/\n// Supported everywhere except IE11, can be polyfilled with core-js\nexport const PROP_SYMBOLS = {\n  COMPONENT: Symbol.for('component'),\n  ASYNC_DEFAULTS: Symbol.for('asyncPropDefaults'),\n  ASYNC_ORIGINAL: Symbol.for('asyncPropOriginal'),\n  ASYNC_RESOLVED: Symbol.for('asyncPropResolved')\n};\n","// Extensions to math.gl library. Intended to be folded back.\nimport typedArrayManager from './typed-array-manager';\nimport {Vector3} from 'math.gl';\n\n// Helper, avoids low-precision 32 bit matrices from gl-matrix mat4.create()\nexport function createMat4() {\n  return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n}\n\nexport function mod(value, divisor) {\n  const modulus = value % divisor;\n  return modulus < 0 ? divisor + modulus : modulus;\n}\n\n// Extract camera vectors (move to math library?)\nexport function extractCameraVectors({viewMatrix, viewMatrixInverse}) {\n  // Read the translation from the inverse view matrix\n  return {\n    eye: [viewMatrixInverse[12], viewMatrixInverse[13], viewMatrixInverse[14]],\n    direction: [-viewMatrix[2], -viewMatrix[6], -viewMatrix[10]],\n    up: [viewMatrix[1], viewMatrix[5], viewMatrix[9]],\n    right: [viewMatrix[0], viewMatrix[4], viewMatrix[8]]\n  };\n}\n\nconst cameraPosition = new Vector3();\nconst cameraDirection = new Vector3();\nconst cameraUp = new Vector3();\nconst cameraRight = new Vector3();\nconst nearCenter = new Vector3();\nconst farCenter = new Vector3();\nconst a = new Vector3();\n\n/* eslint-disable max-statements */\n\n// Extract frustum planes in common space.\n// Note that common space is left-handed\n// (with y pointing down)\nexport function getFrustumPlanes({aspect, near, far, fovyRadians, position, direction, up, right}) {\n  cameraDirection.copy(direction);\n\n  // Account for any scaling of the z axis (e.g. in\n  // mercator view matrix)\n  const nearFarScale = 1 / cameraDirection.len();\n  cameraDirection.normalize();\n\n  cameraPosition.copy(position);\n\n  cameraUp.copy(up);\n  // Account for scaling of the xy axis\n  const widthScale = 1 / cameraUp.len();\n  cameraUp.normalize();\n  cameraRight.copy(right).normalize();\n\n  const nearHeight = 2 * Math.tan(fovyRadians / 2) * near * widthScale;\n  const nearWidth = nearHeight * aspect;\n\n  nearCenter\n    .copy(cameraDirection)\n    .scale(near * nearFarScale)\n    .add(cameraPosition);\n  farCenter\n    .copy(cameraDirection)\n    .scale(far * nearFarScale)\n    .add(cameraPosition);\n\n  let normal = cameraDirection.clone().negate();\n  let distance = normal.dot(nearCenter);\n\n  const planes = {\n    near: {\n      distance,\n      normal\n    },\n    far: {\n      distance: cameraDirection.dot(farCenter),\n      normal: cameraDirection.clone()\n    }\n  };\n\n  a.copy(cameraRight)\n    .scale(nearWidth * 0.5)\n    .add(nearCenter)\n    .subtract(cameraPosition)\n    .normalize();\n  normal = new Vector3(a).cross(cameraUp);\n  distance = cameraPosition.dot(normal);\n  planes.right = {normal, distance};\n\n  a.copy(cameraRight)\n    .scale(-nearWidth * 0.5)\n    .add(nearCenter)\n    .subtract(cameraPosition)\n    .normalize();\n  normal = new Vector3(cameraUp).cross(a);\n  distance = cameraPosition.dot(normal);\n  planes.left = {normal, distance};\n\n  a.copy(cameraUp)\n    .scale(nearHeight * 0.5)\n    .add(nearCenter)\n    .subtract(cameraPosition)\n    .normalize();\n  normal = new Vector3(cameraRight).cross(a);\n  distance = cameraPosition.dot(normal);\n  planes.top = {normal, distance};\n\n  a.copy(cameraUp)\n    .scale(-nearHeight * 0.5)\n    .add(nearCenter)\n    .subtract(cameraPosition)\n    .normalize();\n  normal = new Vector3(a).cross(cameraRight);\n  distance = cameraPosition.dot(normal);\n  planes.bottom = {normal, distance};\n\n  return planes;\n}\n\n/**\n * Calculate the low part of a WebGL 64 bit float\n * @param x {number} - the input float number\n * @returns {number} - the lower 32 bit of the number\n */\nexport function fp64LowPart(x) {\n  return x - Math.fround(x);\n}\n\nlet scratchArray;\n\n/**\n * Split a Float64Array into a double-length Float32Array\n * @param typedArray {Float64Array}\n * @param size {Number} - per attribute size\n * @param [startIndex] {Number} - start index in the source array\n * @param [endIndex] {Number} - end index in the source array\n * @returns {Float32Array} - high part, low part for each attribute:\n    [1xHi, 1yHi, 1zHi, 1xLow, 1yLow, 1zLow, 2xHi, ...]\n */\nexport function toDoublePrecisionArray(typedArray, {size = 1, startIndex = 0, endIndex}) {\n  if (!Number.isFinite(endIndex)) {\n    endIndex = typedArray.length;\n  }\n  const count = (endIndex - startIndex) / size;\n  scratchArray = typedArrayManager.allocate(scratchArray, count, {\n    type: Float32Array,\n    size: size * 2\n  });\n\n  let sourceIndex = startIndex;\n  let targetIndex = 0;\n  while (sourceIndex < endIndex) {\n    for (let j = 0; j < size; j++) {\n      const value = typedArray[sourceIndex++];\n      scratchArray[targetIndex + j] = value;\n      scratchArray[targetIndex + j + size] = fp64LowPart(value);\n    }\n    targetIndex += size * 2;\n  }\n\n  return scratchArray.subarray(0, count * size * 2);\n}\n","export class TypedArrayManager {\n  constructor(props) {\n    this._pool = [];\n    this.props = {overAlloc: 2, poolSize: 100};\n    this.setProps(props);\n  }\n\n  setProps(props) {\n    Object.assign(this.props, props);\n  }\n\n  allocate(typedArray, count, {size = 1, type, padding = 0, copy = false, initialize = false}) {\n    const Type = type || (typedArray && typedArray.constructor) || Float32Array;\n\n    const newSize = count * size + padding;\n    if (ArrayBuffer.isView(typedArray)) {\n      if (newSize <= typedArray.length) {\n        return typedArray;\n      }\n      if (newSize * typedArray.BYTES_PER_ELEMENT <= typedArray.buffer.byteLength) {\n        return new Type(typedArray.buffer, 0, newSize);\n      }\n    }\n\n    const newArray = this._allocate(Type, newSize, initialize);\n\n    if (typedArray && copy) {\n      newArray.set(typedArray);\n    } else if (!initialize) {\n      // Hack - always initialize the first 4 elements. NaNs crashe the Attribute validation\n      newArray.fill(0, 0, 4);\n    }\n\n    this._release(typedArray);\n    return newArray;\n  }\n\n  release(typedArray) {\n    this._release(typedArray);\n  }\n\n  _allocate(Type, size, initialize) {\n    // Allocate at least one element to ensure a valid buffer\n    size = Math.max(Math.ceil(size * this.props.overAlloc), 1);\n\n    // Check if available in pool\n    const pool = this._pool;\n    const byteLength = Type.BYTES_PER_ELEMENT * size;\n    const i = pool.findIndex(b => b.byteLength >= byteLength);\n    if (i >= 0) {\n      // Create a new array using an existing buffer\n      const array = new Type(pool.splice(i, 1)[0], 0, size);\n      if (initialize) {\n        // Viewing a buffer with a different type may create NaNs\n        array.fill(0);\n      }\n      return array;\n    }\n    return new Type(size);\n  }\n\n  _release(typedArray) {\n    if (!ArrayBuffer.isView(typedArray)) {\n      return;\n    }\n    const pool = this._pool;\n    const {buffer} = typedArray;\n    // Save the buffer of the released array into the pool\n    // Sort buffers by size\n    // TODO - implement binary search?\n    const {byteLength} = buffer;\n    const i = pool.findIndex(b => b.byteLength >= byteLength);\n    if (i < 0) {\n      pool.push(buffer);\n    } else if (i > 0 || pool.length < this.props.poolSize) {\n      pool.splice(i, 0, buffer);\n    }\n    if (pool.length > this.props.poolSize) {\n      // Drop the smallest one\n      pool.shift();\n    }\n  }\n}\n\nexport default new TypedArrayManager();\n","function noop() {}\n\nconst DEFAULT_SETTINGS = {\n  onStart: noop,\n  onUpdate: noop,\n  onInterrupt: noop,\n  onEnd: noop\n};\n\nexport default class Transition {\n  /**\n   * @params timeline {Timeline}\n   */\n  constructor(timeline) {\n    this._inProgress = false;\n    this._handle = null;\n    this.timeline = timeline;\n\n    // Defaults\n    this.settings = {};\n  }\n\n  /* Public API */\n  get inProgress() {\n    return this._inProgress;\n  }\n\n  /**\n   * (re)start this transition.\n   * @params props {object} - optional overriding props. see constructor\n   */\n  start(props) {\n    this.cancel();\n    this.settings = Object.assign({}, DEFAULT_SETTINGS, props);\n    this._inProgress = true;\n    this.settings.onStart(this);\n  }\n\n  /**\n   * end this transition if it is in progress.\n   */\n  end() {\n    if (this._inProgress) {\n      this.timeline.removeChannel(this._handle);\n      this._handle = null;\n      this._inProgress = false;\n      this.settings.onEnd(this);\n    }\n  }\n\n  /**\n   * cancel this transition if it is in progress.\n   */\n  cancel() {\n    if (this._inProgress) {\n      this.settings.onInterrupt(this);\n      this.timeline.removeChannel(this._handle);\n      this._handle = null;\n      this._inProgress = false;\n    }\n  }\n\n  /**\n   * update this transition. Returns `true` if updated.\n   */\n  update() {\n    if (!this._inProgress) {\n      return false;\n    }\n\n    // It is important to initialize the handle during `update` instead of `start`.\n    // The CPU time that the `start` frame takes should not be counted towards the duration.\n    // On the other hand, `update` always happens during a render cycle. The clock starts when the\n    // transition is rendered for the first time.\n    if (this._handle === null) {\n      const {timeline, settings} = this;\n      this._handle = timeline.addChannel({\n        delay: timeline.getTime(),\n        duration: settings.duration\n      });\n    }\n\n    this.time = this.timeline.getTime(this._handle);\n    // Call subclass method\n    this._onUpdate();\n    // Call user callback\n    this.settings.onUpdate(this);\n\n    // This only works if `settings.duration` is set\n    // Spring transition must call `end` manually\n    if (this.timeline.isFinished(this._handle)) {\n      this.end();\n    }\n    return true;\n  }\n\n  /* Private API */\n\n  _onUpdate() {\n    // for subclass override\n  }\n}\n","// Partial deep equal (only recursive on arrays)\nexport function deepEqual(a, b) {\n  if (a === b) {\n    return true;\n  }\n  if (!a || !b) {\n    return false;\n  }\n  for (const key in a) {\n    const aValue = a[key];\n    const bValue = b[key];\n    const equals =\n      aValue === bValue ||\n      (Array.isArray(aValue) && Array.isArray(bValue) && deepEqual(aValue, bValue));\n    if (!equals) {\n      return false;\n    }\n  }\n  return true;\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nconst EMPTY_ARRAY = [];\nconst placeholderArray = [];\n\n/*\n * Create an Iterable\n * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols\n * and a \"context\" tracker from the given data\n */\nexport function createIterable(data, startRow = 0, endRow = Infinity) {\n  let iterable = EMPTY_ARRAY;\n\n  const objectInfo = {\n    index: -1,\n    data,\n    // visitor can optionally utilize this to avoid constructing a new array for every object\n    target: []\n  };\n\n  if (!data) {\n    iterable = EMPTY_ARRAY;\n  } else if (typeof data[Symbol.iterator] === 'function') {\n    // data is already an iterable\n    iterable = data;\n  } else if (data.length > 0) {\n    placeholderArray.length = data.length;\n    iterable = placeholderArray;\n  }\n\n  if (startRow > 0 || Number.isFinite(endRow)) {\n    iterable = (Array.isArray(iterable) ? iterable : Array.from(iterable)).slice(startRow, endRow);\n    objectInfo.index = startRow - 1;\n  }\n\n  return {iterable, objectInfo};\n}\n\n/*\n * Returns true if data is an async iterable object\n */\nexport function isAsyncIterable(data) {\n  return data && data[Symbol.asyncIterator];\n}\n\n/*\n * Create an accessor function from a flat buffer that yields the value at each object index\n */\nexport function getAccessorFromBuffer(typedArray, {size, stride, offset, startIndices, nested}) {\n  const bytesPerElement = typedArray.BYTES_PER_ELEMENT;\n  const elementStride = stride ? stride / bytesPerElement : size;\n  const elementOffset = offset ? offset / bytesPerElement : 0;\n  const vertexCount = Math.floor((typedArray.length - elementOffset) / elementStride);\n\n  return (_, {index, target}) => {\n    if (!startIndices) {\n      const sourceIndex = index * elementStride + elementOffset;\n      for (let j = 0; j < size; j++) {\n        target[j] = typedArray[sourceIndex + j];\n      }\n      return target;\n    }\n    const startIndex = startIndices[index];\n    const endIndex = startIndices[index + 1] || vertexCount;\n    let result;\n\n    if (nested) {\n      result = new Array(endIndex - startIndex);\n      for (let i = startIndex; i < endIndex; i++) {\n        const sourceIndex = i * elementStride + elementOffset;\n        target = new Array(size);\n        for (let j = 0; j < size; j++) {\n          target[j] = typedArray[sourceIndex + j];\n        }\n        result[i - startIndex] = target;\n      }\n    } else if (elementStride === size) {\n      result = typedArray.subarray(\n        startIndex * size + elementOffset,\n        endIndex * size + elementOffset\n      );\n    } else {\n      result = new typedArray.constructor((endIndex - startIndex) * size);\n      let targetIndex = 0;\n      for (let i = startIndex; i < endIndex; i++) {\n        const sourceIndex = i * elementStride + elementOffset;\n        for (let j = 0; j < size; j++) {\n          result[targetIndex++] = typedArray[sourceIndex + j];\n        }\n      }\n    }\n\n    return result;\n  };\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/**\n * Flattens a nested array into a single level array,\n * or a single value into an array with one value\n * @example flatten([[1, [2]], [3], 4]) => [1, 2, 3, 4]\n * @example flatten(1) => [1]\n * @param {Array} array The array to flatten.\n * @param {Function} filter= - Optional predicate called on each `value` to\n *   determine if it should be included (pushed onto) the resulting array.\n * @param {Function} map= - Optional transform applied to each array elements.\n * @param {Array} result=[] - Optional array to push value into\n * @return {Array} Returns the new flattened array (new array or `result` if provided)\n */\nexport function flatten(array, filter = () => true) {\n  // Wrap single object in array\n  if (!Array.isArray(array)) {\n    return filter(array) ? [array] : [];\n  }\n  // Deep flatten and filter the array\n  return flattenArray(array, filter, []);\n}\n\n// Deep flattens an array. Helper to `flatten`, see its parameters\nfunction flattenArray(array, filter, result) {\n  let index = -1;\n  while (++index < array.length) {\n    const value = array[index];\n    if (Array.isArray(value)) {\n      flattenArray(value, filter, result);\n    } else if (filter(value)) {\n      result.push(value);\n    }\n  }\n  return result;\n}\n\n// Uses copyWithin to significantly speed up typed array value filling\nexport function fillArray({target, source, start = 0, count = 1}) {\n  const length = source.length;\n  const total = count * length;\n  let copied = 0;\n  for (let i = start; copied < length; copied++) {\n    target[i++] = source[copied];\n  }\n\n  while (copied < total) {\n    // If we have copied less than half, copy everything we got\n    // else copy remaining in one operation\n    if (copied < total - copied) {\n      target.copyWithin(start + copied, start, start + copied);\n      copied *= 2;\n    } else {\n      target.copyWithin(start + copied, start, start + total - copied);\n      copied = total;\n    }\n  }\n\n  return target;\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport {COORDINATE_SYSTEM, PROJECTION_MODE} from '../../lib/constants';\n\n// We are generating these from the js code in constants.js\nconst COORDINATE_SYSTEM_GLSL_CONSTANTS = Object.keys(COORDINATE_SYSTEM)\n  .map(key => `const int COORDINATE_SYSTEM_${key} = ${COORDINATE_SYSTEM[key]};`)\n  .join('');\nconst PROJECTION_MODE_GLSL_CONSTANTS = Object.keys(PROJECTION_MODE)\n  .map(key => `const int PROJECTION_MODE_${key} = ${PROJECTION_MODE[key]};`)\n  .join('');\n\nexport default `\\\n${COORDINATE_SYSTEM_GLSL_CONSTANTS}\n${PROJECTION_MODE_GLSL_CONSTANTS}\n\nuniform int project_uCoordinateSystem;\nuniform int project_uProjectionMode;\nuniform float project_uScale;\nuniform bool project_uWrapLongitude;\nuniform float project_uAntimeridian;\nuniform vec3 project_uCommonUnitsPerMeter;\nuniform vec3 project_uCommonUnitsPerWorldUnit;\nuniform vec3 project_uCommonUnitsPerWorldUnit2;\nuniform vec4 project_uCenter;\nuniform mat4 project_uModelMatrix;\nuniform mat4 project_uViewProjectionMatrix;\nuniform vec2 project_uViewportSize;\nuniform float project_uDevicePixelRatio;\nuniform float project_uFocalDistance;\nuniform vec3 project_uCameraPosition;\nuniform vec3 project_uCoordinateOrigin;\n\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec3 ZERO_64_LOW = vec3(0.0);\nconst float EARTH_RADIUS = 6370972.0; // meters\nconst float GLOBE_RADIUS = 256.0;\n\n//\n// Scaling offsets - scales meters to \"world distance\"\n// Note the scalar version of project_size is for scaling the z component only\n//\nfloat project_size(float meters) {\n  return meters * project_uCommonUnitsPerMeter.z;\n}\n\nvec2 project_size(vec2 meters) {\n  return meters * project_uCommonUnitsPerMeter.xy;\n}\n\nvec3 project_size(vec3 meters) {\n  return meters * project_uCommonUnitsPerMeter;\n}\n\nvec4 project_size(vec4 meters) {\n  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);\n}\n\n//\n// Projecting normal - transform deltas from current coordinate system to\n// normals in the worldspace\n//\nvec3 project_normal(vec3 vector) {\n  // Apply model matrix\n  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);\n  return normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);\n}\n\nvec4 project_offset_(vec4 offset) {\n  float dy = offset.y;\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n    dy = clamp(dy, -1., 1.);\n  }\n  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;\n  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\n\n//\n// Projecting positions - non-linear projection: lnglats => unit tile [0-1, 0-1]\n//\nvec2 project_mercator_(vec2 lnglat) {\n  float x = lnglat.x;\n  if (project_uWrapLongitude) {\n    x = mod(x - project_uAntimeridian, 360.0) + project_uAntimeridian;\n  }\n  return vec2(\n    radians(x) + PI,\n    PI + log(tan_fp32(PI * 0.25 + radians(lnglat.y) * 0.5))\n  );\n}\n\nvec3 project_globe_(vec3 lnglatz) {\n  float lambda = radians(lnglatz.x);\n  float phi = radians(lnglatz.y);\n  float cosPhi = cos(phi);\n  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\n\n  return vec3(\n    sin(lambda) * cosPhi,\n    -cos(lambda) * cosPhi,\n    sin(phi)\n  ) * D;\n}\n\n//\n// Projects positions (defined by project_uCoordinateSystem) to common space (defined by project_uProjectionMode)\n//\nvec4 project_position(vec4 position, vec3 position64Low) {\n  vec4 position_world = project_uModelMatrix * position;\n\n  // Work around for a Mac+NVIDIA bug https://github.com/visgl/deck.gl/issues/4145\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4(\n        project_mercator_(position_world.xy) * WORLD_SCALE,\n        project_size(position_world.z),\n        position_world.w\n      );\n    }\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\n      position_world.xyz += project_uCoordinateOrigin;\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4(\n        project_globe_(position_world.xyz),\n        position_world.w\n      );\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||\n    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\n    // Subtract high part of 64 bit value. Convert remainder to float32, preserving precision.\n    position_world.xyz -= project_uCoordinateOrigin;\n  }\n\n  // Translation is already added to the high parts\n  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));\n}\n\nvec4 project_position(vec4 position) {\n  return project_position(position, ZERO_64_LOW);\n}\n\nvec3 project_position(vec3 position, vec3 position64Low) {\n  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);\n  return projected_position.xyz;\n}\n\nvec3 project_position(vec3 position) {\n  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);\n  return projected_position.xyz;\n}\n\nvec2 project_position(vec2 position) {\n  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);\n  return projected_position.xy;\n}\n\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\n  return viewProjectionMatrix * position + center;\n}\n\n//\n// Projects from common space coordinates to clip space.\n// Uses project_uViewProjectionMatrix\n//\nvec4 project_common_position_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);\n}\n\n// Returns a clip space offset that corresponds to a given number of screen pixels\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;\n  return offset * project_uFocalDistance;\n}\n\nfloat project_size_to_pixel(float meters) {\n  return project_size(meters) * project_uScale;\n}\nfloat project_pixel_size(float pixels) {\n  return pixels / project_uScale;\n}\nvec2 project_pixel_size(vec2 pixels) {\n  return pixels / project_uScale;\n}\n\n// Get rotation matrix that aligns the z axis with the given up vector\n// Find 3 unit vectors ux, uy, uz that are perpendicular to each other and uz == up\nmat3 project_get_orientation_matrix(vec3 up) {\n  vec3 uz = normalize(up);\n  // Tangent on XY plane\n  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));\n  vec3 uy = cross(uz, ux);\n  return mat3(ux, uy, uz);\n}\n\nbool project_needs_rotation(vec3 commonPosition, out mat3 transform) {\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    transform = project_get_orientation_matrix(commonPosition);\n    return true;\n  }\n  return false;\n}\n`;\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport {fp32} from '@luma.gl/core';\nimport projectShader from './project.glsl';\nimport {getUniformsFromViewport} from './viewport-uniforms';\n\nconst INITIAL_MODULE_OPTIONS = {};\n\nfunction getUniforms(opts = INITIAL_MODULE_OPTIONS) {\n  if (opts.viewport) {\n    return getUniformsFromViewport(opts);\n  }\n  return {};\n}\n\nexport default {\n  name: 'project',\n  dependencies: [fp32],\n  vs: projectShader,\n  getUniforms\n};\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport log from '../utils/log';\nimport {createMat4, extractCameraVectors, getFrustumPlanes} from '../utils/math-utils';\n\nimport {Matrix4, Vector3, equals} from 'math.gl';\nimport * as mat4 from 'gl-matrix/mat4';\n\nimport {\n  getDistanceScales,\n  getMeterZoom,\n  lngLatToWorld,\n  worldToLngLat,\n  worldToPixels,\n  pixelsToWorld\n} from '@math.gl/web-mercator';\n\nimport {PROJECTION_MODE} from '../lib/constants';\n\nconst DEGREES_TO_RADIANS = Math.PI / 180;\n\nconst IDENTITY = createMat4();\n\nconst ZERO_VECTOR = [0, 0, 0];\n\nconst DEFAULT_ZOOM = 0;\n\nconst DEFAULT_DISTANCE_SCALES = {\n  unitsPerMeter: [1, 1, 1],\n  metersPerUnit: [1, 1, 1]\n};\n\nexport default class Viewport {\n  /**\n   * @classdesc\n   * Manages coordinate system transformations for deck.gl.\n   *\n   * Note: The Viewport is immutable in the sense that it only has accessors.\n   * A new viewport instance should be created if any parameters have changed.\n   */\n  constructor(opts = {}) {\n    const {\n      id = null,\n      // Window width/height in pixels (for pixel projection)\n      x = 0,\n      y = 0,\n      width = 1,\n      height = 1\n    } = opts;\n\n    this.id = id || this.constructor.displayName || 'viewport';\n\n    this.x = x;\n    this.y = y;\n    // Silently allow apps to send in w,h = 0,0\n    this.width = width || 1;\n    this.height = height || 1;\n    this._frustumPlanes = {};\n\n    this._initViewMatrix(opts);\n    this._initProjectionMatrix(opts);\n    this._initPixelMatrices();\n\n    // Bind methods for easy access\n    this.equals = this.equals.bind(this);\n    this.project = this.project.bind(this);\n    this.unproject = this.unproject.bind(this);\n    this.projectPosition = this.projectPosition.bind(this);\n    this.unprojectPosition = this.unprojectPosition.bind(this);\n    this.projectFlat = this.projectFlat.bind(this);\n    this.unprojectFlat = this.unprojectFlat.bind(this);\n  }\n\n  get metersPerPixel() {\n    return this.distanceScales.metersPerUnit[2] / this.scale;\n  }\n\n  get projectionMode() {\n    if (this.isGeospatial) {\n      return this.zoom < 12\n        ? PROJECTION_MODE.WEB_MERCATOR\n        : PROJECTION_MODE.WEB_MERCATOR_AUTO_OFFSET;\n    }\n    return PROJECTION_MODE.IDENTITY;\n  }\n\n  // Two viewports are equal if width and height are identical, and if\n  // their view and projection matrices are (approximately) equal.\n  equals(viewport) {\n    if (!(viewport instanceof Viewport)) {\n      return false;\n    }\n    if (this === viewport) {\n      return true;\n    }\n\n    return (\n      viewport.width === this.width &&\n      viewport.height === this.height &&\n      viewport.scale === this.scale &&\n      equals(viewport.projectionMatrix, this.projectionMatrix) &&\n      equals(viewport.viewMatrix, this.viewMatrix)\n    );\n    // TODO - check distance scales?\n  }\n\n  /**\n   * Projects xyz (possibly latitude and longitude) to pixel coordinates in window\n   * using viewport projection parameters\n   * - [longitude, latitude] to [x, y]\n   * - [longitude, latitude, Z] => [x, y, z]\n   * Note: By default, returns top-left coordinates for canvas/SVG type render\n   *\n   * @param {Array} lngLatZ - [lng, lat] or [lng, lat, Z]\n   * @param {Object} opts - options\n   * @param {Object} opts.topLeft=true - Whether projected coords are top left\n   * @return {Array} - [x, y] or [x, y, z] in top left coords\n   */\n  project(xyz, {topLeft = true} = {}) {\n    const worldPosition = this.projectPosition(xyz);\n    const coord = worldToPixels(worldPosition, this.pixelProjectionMatrix);\n\n    const [x, y] = coord;\n    const y2 = topLeft ? y : this.height - y;\n    return xyz.length === 2 ? [x, y2] : [x, y2, coord[2]];\n  }\n\n  /**\n   * Unproject pixel coordinates on screen onto world coordinates,\n   * (possibly [lon, lat]) on map.\n   * - [x, y] => [lng, lat]\n   * - [x, y, z] => [lng, lat, Z]\n   * @param {Array} xyz -\n   * @param {Object} opts - options\n   * @param {Object} opts.topLeft=true - Whether origin is top left\n   * @return {Array|null} - [lng, lat, Z] or [X, Y, Z]\n   */\n  unproject(xyz, {topLeft = true, targetZ} = {}) {\n    const [x, y, z] = xyz;\n\n    const y2 = topLeft ? y : this.height - y;\n    const targetZWorld = targetZ && targetZ * this.distanceScales.unitsPerMeter[2];\n    const coord = pixelsToWorld([x, y2, z], this.pixelUnprojectionMatrix, targetZWorld);\n    const [X, Y, Z] = this.unprojectPosition(coord);\n\n    if (Number.isFinite(z)) {\n      return [X, Y, Z];\n    }\n    return Number.isFinite(targetZ) ? [X, Y, targetZ] : [X, Y];\n  }\n\n  // NON_LINEAR PROJECTION HOOKS\n  // Used for web meractor projection\n\n  projectPosition(xyz) {\n    const [X, Y] = this.projectFlat(xyz);\n    const Z = (xyz[2] || 0) * this.distanceScales.unitsPerMeter[2];\n    return [X, Y, Z];\n  }\n\n  unprojectPosition(xyz) {\n    const [X, Y] = this.unprojectFlat(xyz);\n    const Z = (xyz[2] || 0) * this.distanceScales.metersPerUnit[2];\n    return [X, Y, Z];\n  }\n\n  /**\n   * Project [lng,lat] on sphere onto [x,y] on 512*512 Mercator Zoom 0 tile.\n   * Performs the nonlinear part of the web mercator projection.\n   * Remaining projection is done with 4x4 matrices which also handles\n   * perspective.\n   * @param {Array} lngLat - [lng, lat] coordinates\n   *   Specifies a point on the sphere to project onto the map.\n   * @return {Array} [x,y] coordinates.\n   */\n  projectFlat(xyz) {\n    if (this.isGeospatial) {\n      return lngLatToWorld(xyz);\n    }\n    return xyz;\n  }\n\n  /**\n   * Unproject world point [x,y] on map onto {lat, lon} on sphere\n   * @param {object|Vector} xy - object with {x,y} members\n   *  representing point on projected map plane\n   * @return {GeoCoordinates} - object with {lat,lon} of point on sphere.\n   *   Has toArray method if you need a GeoJSON Array.\n   *   Per cartographic tradition, lat and lon are specified as degrees.\n   */\n  unprojectFlat(xyz) {\n    if (this.isGeospatial) {\n      return worldToLngLat(xyz);\n    }\n    return xyz;\n  }\n\n  getBounds(options = {}) {\n    const unprojectOption = {targetZ: options.z || 0};\n\n    const topLeft = this.unproject([0, 0], unprojectOption);\n    const topRight = this.unproject([this.width, 0], unprojectOption);\n    const bottomLeft = this.unproject([0, this.height], unprojectOption);\n    const bottomRight = this.unproject([this.width, this.height], unprojectOption);\n\n    return [\n      Math.min(topLeft[0], topRight[0], bottomLeft[0], bottomRight[0]),\n      Math.min(topLeft[1], topRight[1], bottomLeft[1], bottomRight[1]),\n      Math.max(topLeft[0], topRight[0], bottomLeft[0], bottomRight[0]),\n      Math.max(topLeft[1], topRight[1], bottomLeft[1], bottomRight[1])\n    ];\n  }\n\n  getDistanceScales(coordinateOrigin = null) {\n    if (coordinateOrigin) {\n      return getDistanceScales({\n        longitude: coordinateOrigin[0],\n        latitude: coordinateOrigin[1],\n        highPrecision: true\n      });\n    }\n    return this.distanceScales;\n  }\n\n  containsPixel({x, y, width = 1, height = 1}) {\n    return (\n      x < this.x + this.width &&\n      this.x < x + width &&\n      y < this.y + this.height &&\n      this.y < y + height\n    );\n  }\n\n  // Extract frustum planes in common space\n  getFrustumPlanes() {\n    if (this._frustumPlanes.near) {\n      return this._frustumPlanes;\n    }\n\n    const {near, far, fovyRadians, aspect} = this.projectionProps;\n\n    Object.assign(\n      this._frustumPlanes,\n      getFrustumPlanes({\n        aspect,\n        near,\n        far,\n        fovyRadians,\n        position: this.cameraPosition,\n        direction: this.cameraDirection,\n        up: this.cameraUp,\n        right: this.cameraRight\n      })\n    );\n\n    return this._frustumPlanes;\n  }\n\n  // EXPERIMENTAL METHODS\n\n  getCameraPosition() {\n    return this.cameraPosition;\n  }\n\n  getCameraDirection() {\n    return this.cameraDirection;\n  }\n\n  getCameraUp() {\n    return this.cameraUp;\n  }\n\n  // INTERNAL METHODS\n\n  _createProjectionMatrix({orthographic, fovyRadians, aspect, focalDistance, near, far}) {\n    return orthographic\n      ? new Matrix4().orthographic({fovy: fovyRadians, aspect, focalDistance, near, far})\n      : new Matrix4().perspective({fovy: fovyRadians, aspect, near, far});\n  }\n\n  /* eslint-disable complexity, max-statements */\n  _initViewMatrix(opts) {\n    const {\n      // view matrix\n      viewMatrix = IDENTITY,\n\n      longitude = null, // Anchor: lng lat zoom makes viewport work w/ geospatial coordinate systems\n      latitude = null,\n      zoom = null,\n\n      position = null, // Anchor position offset (in meters for geospatial viewports)\n      modelMatrix = null, // A model matrix to be applied to position, to match the layer props API\n      focalDistance = 1, // Only needed for orthographic views\n\n      distanceScales = null\n    } = opts;\n\n    // Check if we have a geospatial anchor\n    this.isGeospatial = Number.isFinite(latitude) && Number.isFinite(longitude);\n\n    this.zoom = zoom;\n    if (!Number.isFinite(this.zoom)) {\n      this.zoom = this.isGeospatial\n        ? getMeterZoom({latitude}) + Math.log2(focalDistance)\n        : DEFAULT_ZOOM;\n    }\n    const scale = Math.pow(2, this.zoom);\n    this.scale = scale;\n\n    // Calculate distance scales if lng/lat/zoom are provided\n    this.distanceScales = this.isGeospatial\n      ? getDistanceScales({latitude, longitude})\n      : distanceScales || DEFAULT_DISTANCE_SCALES;\n\n    this.focalDistance = focalDistance;\n\n    this.distanceScales.metersPerUnit = new Vector3(this.distanceScales.metersPerUnit);\n    this.distanceScales.unitsPerMeter = new Vector3(this.distanceScales.unitsPerMeter);\n\n    this.position = ZERO_VECTOR;\n    this.meterOffset = ZERO_VECTOR;\n    if (position) {\n      // Apply model matrix if supplied\n      this.position = position;\n      this.modelMatrix = modelMatrix;\n      this.meterOffset = modelMatrix ? modelMatrix.transformVector(position) : position;\n    }\n\n    if (this.isGeospatial) {\n      // Determine camera center\n      this.longitude = longitude;\n      this.latitude = latitude;\n      this.center = this._getCenterInWorld({longitude, latitude});\n    } else {\n      this.center = position ? this.projectPosition(position) : [0, 0, 0];\n    }\n    this.viewMatrixUncentered = viewMatrix;\n    // Make a centered version of the matrix for projection modes without an offset\n    this.viewMatrix = new Matrix4()\n      // Apply the uncentered view matrix\n      .multiplyRight(this.viewMatrixUncentered)\n      // And center it\n      .translate(new Vector3(this.center || ZERO_VECTOR).negate());\n  }\n  /* eslint-enable complexity, max-statements */\n\n  _getCenterInWorld({longitude, latitude}) {\n    const {meterOffset, distanceScales} = this;\n\n    // Make a centered version of the matrix for projection modes without an offset\n    const center = new Vector3(this.projectPosition([longitude, latitude, 0]));\n\n    if (meterOffset) {\n      const commonPosition = new Vector3(meterOffset)\n        // Convert to pixels in current zoom\n        .scale(distanceScales.unitsPerMeter);\n      center.add(commonPosition);\n    }\n\n    return center;\n  }\n\n  _initProjectionMatrix(opts) {\n    const {\n      // Projection matrix\n      projectionMatrix = null,\n\n      // Projection matrix parameters, used if projectionMatrix not supplied\n      orthographic = false,\n      fovyRadians,\n      fovy = 75,\n      near = 0.1, // Distance of near clipping plane\n      far = 1000, // Distance of far clipping plane\n      focalDistance = 1\n    } = opts;\n\n    this.projectionProps = {\n      orthographic,\n      fovyRadians: fovyRadians || fovy * DEGREES_TO_RADIANS,\n      aspect: this.width / this.height,\n      focalDistance,\n      near,\n      far\n    };\n\n    this.projectionMatrix = projectionMatrix || this._createProjectionMatrix(this.projectionProps);\n  }\n\n  _initPixelMatrices() {\n    // Note: As usual, matrix operations should be applied in \"reverse\" order\n    // since vectors will be multiplied in from the right during transformation\n    const vpm = createMat4();\n    mat4.multiply(vpm, vpm, this.projectionMatrix);\n    mat4.multiply(vpm, vpm, this.viewMatrix);\n    this.viewProjectionMatrix = vpm;\n\n    // console.log('VPM', this.viewMatrix, this.projectionMatrix, this.viewProjectionMatrix);\n\n    // Calculate inverse view matrix\n    this.viewMatrixInverse = mat4.invert([], this.viewMatrix) || this.viewMatrix;\n\n    // Decompose camera directions\n    const {eye, direction, up, right} = extractCameraVectors({\n      viewMatrix: this.viewMatrix,\n      viewMatrixInverse: this.viewMatrixInverse\n    });\n    this.cameraPosition = eye;\n    this.cameraDirection = direction;\n    this.cameraUp = up;\n    this.cameraRight = right;\n\n    // console.log(this.cameraPosition, this.cameraDirection, this.cameraUp);\n\n    /*\n     * Builds matrices that converts preprojected lngLats to screen pixels\n     * and vice versa.\n     * Note: Currently returns bottom-left coordinates!\n     * Note: Starts with the GL projection matrix and adds steps to the\n     *       scale and translate that matrix onto the window.\n     * Note: WebGL controls clip space to screen projection with gl.viewport\n     *       and does not need this step.\n     */\n\n    // matrix for conversion from world location to screen (pixel) coordinates\n    const viewportMatrix = createMat4(); // matrix from NDC to viewport.\n    const pixelProjectionMatrix = createMat4(); // matrix from world space to viewport.\n    mat4.scale(viewportMatrix, viewportMatrix, [this.width / 2, -this.height / 2, 1]);\n    mat4.translate(viewportMatrix, viewportMatrix, [1, -1, 0]);\n    mat4.multiply(pixelProjectionMatrix, viewportMatrix, this.viewProjectionMatrix);\n    this.pixelProjectionMatrix = pixelProjectionMatrix;\n    this.viewportMatrix = viewportMatrix;\n\n    this.pixelUnprojectionMatrix = mat4.invert(createMat4(), this.pixelProjectionMatrix);\n    if (!this.pixelUnprojectionMatrix) {\n      log.warn('Pixel project matrix not invertible')();\n      // throw new Error('Pixel project matrix not invertible');\n    }\n  }\n}\n\nViewport.displayName = 'Viewport';\n","function isEqual(a, b) {\n  if (a === b) {\n    return true;\n  }\n  if (Array.isArray(a)) {\n    // Special treatment for arrays: compare 1-level deep\n    // This is to support equality of matrix/coordinate props\n    const len = a.length;\n    if (!b || b.length !== len) {\n      return false;\n    }\n\n    for (let i = 0; i < len; i++) {\n      if (a[i] !== b[i]) {\n        return false;\n      }\n    }\n    return true;\n  }\n  return false;\n}\n\n/**\n * Speed up consecutive function calls by caching the result of calls with identical input\n * https://en.wikipedia.org/wiki/Memoization\n * @param {function} compute - the function to be memoized\n */\nexport default function memoize(compute) {\n  let cachedArgs = {};\n  let cachedResult;\n\n  return args => {\n    for (const key in args) {\n      if (!isEqual(args[key], cachedArgs[key])) {\n        cachedResult = compute(args);\n        cachedArgs = args;\n        break;\n      }\n    }\n    return cachedResult;\n  };\n}\n"],"sourceRoot":""}