(this["webpackJsonp@carto/viewer"]=this["webpackJsonp@carto/viewer"]||[]).push([[0],{121:function(t,e){},170:function(t,e,n){},171:function(t,e,n){},172:function(t,e){},202:function(t,e,n){var r={"./template.bigquery.json":203,"./template.sql.json":204};function i(t){var e=a(t);return n(e)}function a(t){if(!n.o(r,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return r[t]}i.keys=function(){return Object.keys(r)},i.resolve=a,t.exports=i,i.id=202},203:function(t){t.exports=JSON.parse('{"description":"CartoBQTilerLayer declarative example","initialViewState":{"latitude":0,"longitude":0,"zoom":2,"pitch":0,"bearing":0},"views":[{"@@type":"MapView","controller":true,"mapStyle":"@@#CARTO_BASEMAP.POSITRON"}],"layers":[{"@@type":"CartoBQTilerLayer","getFillColor":[232,133,113],"pointRadiusMinPixels":2,"stroked":false}]}')},204:function(t){t.exports=JSON.parse('{"description":"CartoSQLLayer declarative example","initialViewState":{"latitude":0,"longitude":0,"zoom":1,"pitch":0,"bearing":0},"views":[{"@@type":"MapView","controller":true,"mapStyle":"@@#CARTO_BASEMAP.POSITRON"}],"layers":[{"@@type":"CartoSQLLayer","getLineColor":[255,255,255],"getFillColor":[255,221,154],"pointRadiusMinPixels":5,"lineWidthMinPixels":1}]}')},207:function(t,e,n){"use strict";n.r(e);var r=n(10),i=n(6),a=n.n(i),o=n(143),s=n.n(o),c=(n(170),n(120)),u=n(38),l=(n(171),n(43)),h=n(21),f=n(106),p=n(2),d=n(1),v=n(19);function y(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return g(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function b(t,e){var n,r=t,i=y(function(t){if("string"===typeof t){var e=w[t];return e||(e=t.split("."),w[t]=e),e}return Array.isArray(t)?t:[t]}(e));try{for(i.s();!(n=i.n()).done;){var a=n.value;r=m(r)?r[a]:void 0}}catch(o){i.e(o)}finally{i.f()}return r}function m(t){return null!==t&&"object"===Object(v.a)(t)}var w={};var O=n(124),j=n.n(O),_={"-":function(t){return t}};function P(t,e){if(t in _)return _[t];var n,r=j.a.parse(t);return r.right||r.left||"Identifier"!==r.type?(S(r,(function(t){if("CallExpression"===t.type)throw new Error("Function calls not allowed in JSON expressions")})),n=function(t){return j.a.eval(r,t)}):n=function(e){return b(e,t)},_[t]=n,n}function S(t,e){if(Array.isArray(t))t.forEach((function(t){return S(t,e)}));else if(t&&"object"===Object(v.a)(t))for(var n in t.type&&e(t),t)S(t[n],e)}function k(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!t)throw new Error("JSON conversion error ".concat(e))}var x="@@=",C="@@#",A="@@type",M=function(t){return t&&"object"===Object(v.a)(t)},L=function(){function t(){Object(p.a)(this,t),this.typeKey=A,this.log=console,this.classes={},this.reactComponents={},this.enumerations={},this.constants={},this.convertFunction=R,this.preProcessClassProps=function(t,e){return e},this.postProcessConvertedJson=function(t){return t};for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];this.merge(o)}}return Object(d.a)(t,[{key:"merge",value:function(t){for(var e in t)switch(e){case"layers":case"views":Object.assign(this.classes,t[e]);break;default:if(e in this){var n=t[e];this[e]=M(this[e])?Object.assign(this[e],n):n}}}},{key:"validate",value:function(t){return k(!this.typeKey||"string"===typeof this.typeKey),k(M(this.classes)),!0}}]),t}();function R(t,e){return P(t)}var E=n(14),T=n(0);function I(t){return t.replace(x,"")}function D(t,e){var n,r={};for(var i in t){var a=t[i];"string"===typeof(n=a)&&n.startsWith(x)&&(a=P(a=I(a))),r[i]=a}return r}function z(t,e,n){var r=n.classes[t],i=n.reactComponents[t];if(!r&&!i){var a=n.log,o=JSON.stringify(e,null,0).slice(0,40);return a&&a.warn("JSON converter: No registered class of type ".concat(t,"(").concat(o,"...)  ")),null}return r?function(t,e,n){n.preProcessClassProps&&(e=n.preProcessClassProps(t,e,n));return e=D(e),new t(e)}(r,e,n):function(t,e,n){var r=n.React,i=e.children,a=void 0===i?[]:i;delete e.children,n.preProcessClassProps&&(e=n.preProcessClassProps(t,e,n));return e=D(e),r.createElement(t,e,a)}(i,e,n)}function F(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}var N=function(t){return t&&"object"===Object(v.a)(t)},V=function(){function t(e){Object(p.a)(this,t),this.log=console,this.configuration={},this.onJSONChange=function(){},this.json=null,this.convertedJson=null,this.setProps(e)}return Object(d.a)(t,[{key:"finalize",value:function(){}},{key:"setProps",value:function(t){"configuration"in t&&(this.configuration=t.configuration instanceof L?t.configuration:new L(t.configuration)),"onJSONChange"in t&&(this.onJSONChange=t.onJSONChange)}},{key:"mergeConfiguration",value:function(t){this.configuration.merge(t)}},{key:"convert",value:function(t){if(!t||t===this.json)return this.convertedJson;this.json=t;var e=function(t,e){return e=new L(e),U(t,"",e)}(function(t){return"string"===typeof t?JSON.parse(t):t}(t),this.configuration);return e=this.configuration.postProcessConvertedJson(e),this.convertedJson=e,e}},{key:"convertJson",value:function(t){return this.convert(t)}}]),t}();function U(t,e,n){return Array.isArray(t)?t.map((function(t,e){return U(t,String(e),n)})):function(t,e){var n=e.typeKey;return N(t)&&Boolean(t[n])}(t,n)?function(t,e){var n=e.typeKey,r=t[n],i=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?F(Object(n),!0).forEach((function(e){Object(T.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):F(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},t);return delete i[n],i=B(i,e),z(r,i,e)}(t,n):N(t)?B(t,n):"string"===typeof t?function(t,e,n){if(t.startsWith(x)&&n.convertFunction)return t=t.replace(x,""),n.convertFunction(t,n);if(t.startsWith(C)){if(t=t.replace(C,""),n.constants[t])return n.constants[t];var r=t.split("."),i=Object(E.a)(r,2),a=i[0],o=i[1];return n.enumerations[a][o]}return t}(t,0,n):t}function B(t,e){k(N(t));var n={};for(var r in t){var i=t[r];n[r]=U(i,0,e)}return n}var G=n(11),W=n(12),Z=n(5),q=new(n(229).a)({id:"deck"}),Y=new(function(){function t(e){Object(p.a)(this,t),this._pool=[],this.props={overAlloc:2,poolSize:100},this.setProps(e)}return Object(d.a)(t,[{key:"setProps",value:function(t){Object.assign(this.props,t)}},{key:"allocate",value:function(t,e,n){var r=n.size,i=void 0===r?1:r,a=n.type,o=n.padding,s=void 0===o?0:o,c=n.copy,u=void 0!==c&&c,l=n.initialize,h=void 0!==l&&l,f=a||t&&t.constructor||Float32Array,p=e*i+s;if(ArrayBuffer.isView(t)){if(p<=t.length)return t;if(p*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new f(t.buffer,0,p)}var d=this._allocate(f,p,h);return t&&u?d.set(t):h||d.fill(0,0,4),this._release(t),d}},{key:"release",value:function(t){this._release(t)}},{key:"_allocate",value:function(t,e,n){e=Math.max(Math.ceil(e*this.props.overAlloc),1);var r=this._pool,i=t.BYTES_PER_ELEMENT*e,a=r.findIndex((function(t){return t.byteLength>=i}));if(a>=0){var o=new t(r.splice(a,1)[0],0,e);return n&&o.fill(0),o}return new t(e)}},{key:"_release",value:function(t){if(ArrayBuffer.isView(t)){var e=this._pool,n=t.buffer,r=n.byteLength,i=e.findIndex((function(t){return t.byteLength>=r}));i<0?e.push(n):(i>0||e.length<this.props.poolSize)&&e.splice(i,0,n),e.length>this.props.poolSize&&e.shift()}}}]),t}()),J=n(23);var H,K=new J.b,X=new J.b,$=new J.b,Q=new J.b,tt=new J.b,et=new J.b,nt=new J.b;function rt(t,e){var n=e.size,r=void 0===n?1:n,i=e.startIndex,a=void 0===i?0:i,o=e.endIndex;Number.isFinite(o)||(o=t.length);var s=(o-a)/r;H=Y.allocate(H,s,{type:Float32Array,size:2*r});for(var c,u=a,l=0;u<o;){for(var h=0;h<r;h++){var f=t[u++];H[l+h]=f,H[l+h+r]=(c=f)-Math.fround(c)}l+=2*r}return H.subarray(0,s*r*2)}var it=n(24),at=n(35),ot={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(ot,"IDENTITY",{get:function(){return q.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")()||0}});var st={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},ct={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},ut=Math.PI/180,lt=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],ht=[0,0,0],ft={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]},pt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(p.a)(this,t);var n=e.id,r=void 0===n?null:n,i=e.x,a=void 0===i?0:i,o=e.y,s=void 0===o?0:o,c=e.width,u=void 0===c?1:c,l=e.height,h=void 0===l?1:l;this.id=r||this.constructor.displayName||"viewport",this.x=a,this.y=s,this.width=u||1,this.height=h||1,this._frustumPlanes={},this._initViewMatrix(e),this._initProjectionMatrix(e),this._initPixelMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return Object(d.a)(t,[{key:"equals",value:function(e){return e instanceof t&&(this===e||e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Object(J.d)(e.projectionMatrix,this.projectionMatrix)&&Object(J.d)(e.viewMatrix,this.viewMatrix))}},{key:"project",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,r=void 0===n||n,i=this.projectPosition(t),a=Object(at.l)(i,this.pixelProjectionMatrix),o=Object(E.a)(a,2),s=o[0],c=o[1],u=r?c:this.height-c;return 2===t.length?[s,u]:[s,u,a[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,r=void 0===n||n,i=e.targetZ,a=Object(E.a)(t,3),o=a[0],s=a[1],c=a[2],u=r?s:this.height-s,l=i&&i*this.distanceScales.unitsPerMeter[2],h=Object(at.j)([o,u,c],this.pixelUnprojectionMatrix,l),f=this.unprojectPosition(h),p=Object(E.a)(f,3),d=p[0],v=p[1],y=p[2];return Number.isFinite(c)?[d,v,y]:Number.isFinite(i)?[d,v,i]:[d,v]}},{key:"projectPosition",value:function(t){var e=this.projectFlat(t),n=Object(E.a)(e,2);return[n[0],n[1],(t[2]||0)*this.distanceScales.unitsPerMeter[2]]}},{key:"unprojectPosition",value:function(t){var e=this.unprojectFlat(t),n=Object(E.a)(e,2);return[n[0],n[1],(t[2]||0)*this.distanceScales.metersPerUnit[2]]}},{key:"projectFlat",value:function(t){return this.isGeospatial?Object(at.h)(t):t}},{key:"unprojectFlat",value:function(t){return this.isGeospatial?Object(at.k)(t):t}},{key:"getBounds",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={targetZ:t.z||0},n=this.unproject([0,0],e),r=this.unproject([this.width,0],e),i=this.unproject([0,this.height],e),a=this.unproject([this.width,this.height],e);return[Math.min(n[0],r[0],i[0],a[0]),Math.min(n[1],r[1],i[1],a[1]),Math.max(n[0],r[0],i[0],a[0]),Math.max(n[1],r[1],i[1],a[1])]}},{key:"getDistanceScales",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return t?Object(at.d)({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}},{key:"containsPixel",value:function(t){var e=t.x,n=t.y,r=t.width,i=void 0===r?1:r,a=t.height,o=void 0===a?1:a;return e<this.x+this.width&&this.x<e+i&&n<this.y+this.height&&this.y<n+o}},{key:"getFrustumPlanes",value:function(){if(this._frustumPlanes.near)return this._frustumPlanes;var t=this.projectionProps,e=t.near,n=t.far,r=t.fovyRadians,i=t.aspect;return Object.assign(this._frustumPlanes,function(t){var e=t.aspect,n=t.near,r=t.far,i=t.fovyRadians,a=t.position,o=t.direction,s=t.up,c=t.right;X.copy(o);var u=1/X.len();X.normalize(),K.copy(a),$.copy(s);var l=1/$.len();$.normalize(),Q.copy(c).normalize();var h=2*Math.tan(i/2)*n*l,f=h*e;tt.copy(X).scale(n*u).add(K),et.copy(X).scale(r*u).add(K);var p=X.clone().negate(),d=p.dot(tt),v={near:{distance:d,normal:p},far:{distance:X.dot(et),normal:X.clone()}};return nt.copy(Q).scale(.5*f).add(tt).subtract(K).normalize(),p=new J.b(nt).cross($),d=K.dot(p),v.right={normal:p,distance:d},nt.copy(Q).scale(.5*-f).add(tt).subtract(K).normalize(),p=new J.b($).cross(nt),d=K.dot(p),v.left={normal:p,distance:d},nt.copy($).scale(.5*h).add(tt).subtract(K).normalize(),p=new J.b(Q).cross(nt),d=K.dot(p),v.top={normal:p,distance:d},nt.copy($).scale(.5*-h).add(tt).subtract(K).normalize(),p=new J.b(nt).cross(Q),d=K.dot(p),v.bottom={normal:p,distance:d},v}({aspect:i,near:e,far:n,fovyRadians:r,position:this.cameraPosition,direction:this.cameraDirection,up:this.cameraUp,right:this.cameraRight})),this._frustumPlanes}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"getCameraDirection",value:function(){return this.cameraDirection}},{key:"getCameraUp",value:function(){return this.cameraUp}},{key:"_createProjectionMatrix",value:function(t){var e=t.orthographic,n=t.fovyRadians,r=t.aspect,i=t.focalDistance,a=t.near,o=t.far;return e?(new J.a).orthographic({fovy:n,aspect:r,focalDistance:i,near:a,far:o}):(new J.a).perspective({fovy:n,aspect:r,near:a,far:o})}},{key:"_initViewMatrix",value:function(t){var e=t.viewMatrix,n=void 0===e?lt:e,r=t.longitude,i=void 0===r?null:r,a=t.latitude,o=void 0===a?null:a,s=t.zoom,c=void 0===s?null:s,u=t.position,l=void 0===u?null:u,h=t.modelMatrix,f=void 0===h?null:h,p=t.focalDistance,d=void 0===p?1:p,v=t.distanceScales,y=void 0===v?null:v;this.isGeospatial=Number.isFinite(o)&&Number.isFinite(i),this.zoom=c,Number.isFinite(this.zoom)||(this.zoom=this.isGeospatial?Object(at.e)({latitude:o})+Math.log2(d):0);var g=Math.pow(2,this.zoom);this.scale=g,this.distanceScales=this.isGeospatial?Object(at.d)({latitude:o,longitude:i}):y||ft,this.focalDistance=d,this.distanceScales.metersPerUnit=new J.b(this.distanceScales.metersPerUnit),this.distanceScales.unitsPerMeter=new J.b(this.distanceScales.unitsPerMeter),this.position=ht,this.meterOffset=ht,l&&(this.position=l,this.modelMatrix=f,this.meterOffset=f?f.transformVector(l):l),this.isGeospatial?(this.longitude=i,this.latitude=o,this.center=this._getCenterInWorld({longitude:i,latitude:o})):this.center=l?this.projectPosition(l):[0,0,0],this.viewMatrixUncentered=n,this.viewMatrix=(new J.a).multiplyRight(this.viewMatrixUncentered).translate(new J.b(this.center||ht).negate())}},{key:"_getCenterInWorld",value:function(t){var e=t.longitude,n=t.latitude,r=this.meterOffset,i=this.distanceScales,a=new J.b(this.projectPosition([e,n,0]));if(r){var o=new J.b(r).scale(i.unitsPerMeter);a.add(o)}return a}},{key:"_initProjectionMatrix",value:function(t){var e=t.projectionMatrix,n=void 0===e?null:e,r=t.orthographic,i=void 0!==r&&r,a=t.fovyRadians,o=t.fovy,s=void 0===o?75:o,c=t.near,u=void 0===c?.1:c,l=t.far,h=void 0===l?1e3:l,f=t.focalDistance,p=void 0===f?1:f;this.projectionProps={orthographic:i,fovyRadians:a||s*ut,aspect:this.width/this.height,focalDistance:p,near:u,far:h},this.projectionMatrix=n||this._createProjectionMatrix(this.projectionProps)}},{key:"_initPixelMatrices",value:function(){var t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];it.h(t,t,this.projectionMatrix),it.h(t,t,this.viewMatrix),this.viewProjectionMatrix=t,this.viewMatrixInverse=it.f([],this.viewMatrix)||this.viewMatrix;var e=function(t){var e=t.viewMatrix,n=t.viewMatrixInverse;return{eye:[n[12],n[13],n[14]],direction:[-e[2],-e[6],-e[10]],up:[e[1],e[5],e[9]],right:[e[0],e[4],e[8]]}}({viewMatrix:this.viewMatrix,viewMatrixInverse:this.viewMatrixInverse}),n=e.eye,r=e.direction,i=e.up,a=e.right;this.cameraPosition=n,this.cameraDirection=r,this.cameraUp=i,this.cameraRight=a;var o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];it.o(o,o,[this.width/2,-this.height/2,1]),it.p(o,o,[1,-1,0]),it.h(s,o,this.viewProjectionMatrix),this.pixelProjectionMatrix=s,this.viewportMatrix=o,this.pixelUnprojectionMatrix=it.f([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||q.warn("Pixel project matrix not invertible")()}},{key:"metersPerPixel",get:function(){return this.distanceScales.metersPerUnit[2]/this.scale}},{key:"projectionMode",get:function(){return this.isGeospatial?this.zoom<12?st.WEB_MERCATOR:st.WEB_MERCATOR_AUTO_OFFSET:st.IDENTITY}}]),t}();pt.displayName="Viewport";var dt=/([0-9]+\.?[0-9]*)(%|px)/;function vt(t){switch(Object(v.a)(t)){case"number":return{position:t,relative:!1};case"string":var e=t.match(dt);if(e&&e.length>=3){var n="%"===e[2],r=parseFloat(e[1]);return{position:n?r/100:r,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function yt(t,e){return t.relative?Math.round(t.position*e):t.position}function gt(t,e){if(t===e)return!0;if(!t||!e)return!1;for(var n in t){var r=t[n],i=e[n];if(!(r===i||Array.isArray(r)&&Array.isArray(i)&&gt(r,i)))return!1}return!0}function bt(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}function mt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function wt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?mt(Object(n),!0).forEach((function(e){Object(T.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):mt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Ot=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(p.a)(this,t);var n=e.id,r=void 0===n?null:n,i=e.x,a=void 0===i?0:i,o=e.y,s=void 0===o?0:o,c=e.width,u=void 0===c?"100%":c,l=e.height,h=void 0===l?"100%":l,f=e.projectionMatrix,d=void 0===f?null:f,v=e.fovy,y=void 0===v?50:v,g=e.near,b=void 0===g?.1:g,m=e.far,w=void 0===m?1e3:m,O=e.modelMatrix,j=void 0===O?null:O,_=e.viewportInstance,P=void 0===_?null:_,S=e.type,k=void 0===S?pt:S;bt(!P||P instanceof pt),this.viewportInstance=P,this.id=r||this.constructor.displayName||"view",this.type=k,this.props=Object.assign({},e,{id:this.id,projectionMatrix:d,fovy:y,near:b,far:w,modelMatrix:j}),this._parseDimensions({x:a,y:s,width:u,height:h}),this.equals=this.equals.bind(this),Object.seal(this)}return Object(d.a)(t,[{key:"equals",value:function(t){return this===t||(this.viewportInstance?t.viewportInstance&&this.viewportInstance.equals(t.viewportInstance):gt(this.props,t.props))}},{key:"makeViewport",value:function(t){var e=t.width,n=t.height,r=t.viewState;if(this.viewportInstance)return this.viewportInstance;r=this.filterViewState(r);var i=this.getDimensions({width:e,height:n}),a=wt(wt(wt({},r),this.props),i);return this._getViewport(a)}},{key:"getViewStateId",value:function(){switch(Object(v.a)(this.props.viewState)){case"string":return this.props.viewState;case"object":return this.props.viewState&&this.props.viewState.id;default:return this.id}}},{key:"filterViewState",value:function(t){if(this.props.viewState&&"object"===Object(v.a)(this.props.viewState)){if(!this.props.viewState.id)return this.props.viewState;var e=Object.assign({},t);for(var n in this.props.viewState)"id"!==n&&(e[n]=this.props.viewState[n]);return e}return t}},{key:"getDimensions",value:function(t){var e=t.width,n=t.height;return{x:yt(this._x,e),y:yt(this._y,n),width:yt(this._width,e),height:yt(this._height,n)}}},{key:"_getControllerProps",value:function(t){var e=this.props.controller;return e?!0===e?t:("function"===typeof e&&(e={type:e}),Object.assign({},t,e)):null}},{key:"_getViewport",value:function(t){return new(0,this.type)(t)}},{key:"_parseDimensions",value:function(t){var e=t.x,n=t.y,r=t.width,i=t.height;this._x=vt(e),this._y=vt(n),this._width=vt(r),this._height=vt(i)}}]),t}(),jt=n(33),_t=n(39);function Pt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function St(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Pt(Object(n),!0).forEach((function(e){Object(T.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Pt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function kt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}var xt=function(t){Object(G.a)(n,t);var e=kt(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(p.a)(this,n);var i=r.latitude,a=void 0===i?0:i,o=r.longitude,s=void 0===o?0:o,c=r.zoom,u=void 0===c?11:c,l=r.pitch,h=void 0===l?0:l,f=r.bearing,d=void 0===f?0:f,v=r.nearZMultiplier,y=void 0===v?.1:v,g=r.farZMultiplier,b=void 0===g?1.01:g,m=r.orthographic,w=void 0!==m&&m,O=r.repeat,j=void 0!==O&&O,_=r.worldOffset,P=void 0===_?0:_,S=r.width,k=r.height,x=r.altitude,C=void 0===x?1.5:x,A=Math.pow(2,u);S=S||1,k=k||1,C=Math.max(.75,C);var M=Object(at.f)({width:S,height:k,pitch:h,altitude:C,nearZMultiplier:y,farZMultiplier:b}),L=M.fov,R=M.aspect,E=M.focalDistance,T=M.near,I=M.far,D=Object(at.g)({height:k,pitch:h,bearing:d,scale:A,altitude:C});if(P){var z=(new J.a).translate([512*P,0,0]);D=z.multiplyLeft(D)}var F=Object.assign({},r,{width:S,height:k,viewMatrix:D,longitude:s,latitude:a,zoom:u,orthographic:w,fovyRadians:L,aspect:R,focalDistance:w?E:1,near:T,far:I});return(t=e.call(this,F)).latitude=a,t.longitude=s,t.zoom=u,t.pitch=h,t.bearing=d,t.altitude=C,t.orthographic=w,t._subViewports=j?[]:null,Object.freeze(Object(jt.a)(t)),t}return Object(d.a)(n,[{key:"addMetersToLngLat",value:function(t,e){return Object(at.a)(t,e)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e=t.lngLat,n=t.pos,r=Object(at.j)(n,this.pixelUnprojectionMatrix),i=this.projectFlat(e),a=_t.a([],i,_t.d([],r)),o=_t.a([],this.center,a);return this.unprojectFlat(o)}},{key:"getBounds",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object(at.c)(this,t.z||0);return[Math.min(e[0][0],e[1][0],e[2][0],e[3][0]),Math.min(e[0][1],e[1][1],e[2][1],e[3][1]),Math.max(e[0][0],e[1][0],e[2][0],e[3][0]),Math.max(e[0][1],e[1][1],e[2][1],e[3][1])]}},{key:"fitBounds",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.width,i=this.height,a=Object(at.b)(Object.assign({width:r,height:i,bounds:t},e)),o=a.longitude,s=a.latitude,c=a.zoom;return new n({width:r,height:i,longitude:o,latitude:s,zoom:c})}},{key:"subViewports",get:function(){if(this._subViewports&&!this._subViewports.length)for(var t=this.getBounds(),e=Math.floor((t[0]+180)/360),r=Math.ceil((t[2]-180)/360),i=e;i<=r;i++){var a=i?new n(St(St({},this),{},{worldOffset:i})):this;this._subViewports.push(a)}return this._subViewports}}]),n}(pt);function Ct(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return At(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return At(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function At(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}xt.displayName="WebMercatorViewport";var Mt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(p.a)(this,t),Array.isArray(e)&&(e={compare:e,extract:e,required:e});var n=e,r=n.compare,i=n.extract,a=n.required;this._propsToCompare=r,this._propsToExtract=i,this._requiredProps=a}return Object(d.a)(t,[{key:"arePropsEqual",value:function(t,e){var n,r=Ct(this._propsToCompare||Object.keys(e));try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!(i in t)||!(i in e)||!Object(J.d)(t[i],e[i]))return!1}}catch(a){r.e(a)}finally{r.f()}return!0}},{key:"initializeProps",value:function(t,e){var n;if(this._propsToExtract){var r,i={},a={},o=Ct(this._propsToExtract);try{for(o.s();!(r=o.n()).done;){var s=r.value;i[s]=t[s],a[s]=e[s]}}catch(c){o.e(c)}finally{o.f()}n={start:i,end:a}}else n={start:t,end:e};return this._checkRequiredProps(n.start),this._checkRequiredProps(n.end),n}},{key:"interpolateProps",value:function(t,e,n){return e}},{key:"getDuration",value:function(t,e){return e.transitionDuration}},{key:"_checkRequiredProps",value:function(t){this._requiredProps&&this._requiredProps.forEach((function(e){var n=t[e];bt(Number.isFinite(n)||Array.isArray(n),"".concat(e," is required for transition"))}))}}]),t}();function Lt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}var Rt=["longitude","latitude","zoom","bearing","pitch"],Et=["longitude","latitude","zoom"],Tt=function(t){Object(G.a)(n,t);var e=Lt(n);function n(t){return Object(p.a)(this,n),e.call(this,t||{compare:Rt,extract:Rt,required:Et})}return Object(d.a)(n,[{key:"interpolateProps",value:function(t,e,n){var r={};for(var i in e)r[i]=Object(J.e)(t[i]||0,e[i]||0,n);return r}}]),n}(Mt);function It(){}var Dt={onStart:It,onUpdate:It,onInterrupt:It,onEnd:It},zt=function(){function t(e){Object(p.a)(this,t),this._inProgress=!1,this._handle=null,this.timeline=e,this.settings={}}return Object(d.a)(t,[{key:"start",value:function(t){this.cancel(),this.settings=Object.assign({},Dt,t),this._inProgress=!0,this.settings.onStart(this)}},{key:"end",value:function(){this._inProgress&&(this.timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd(this))}},{key:"cancel",value:function(){this._inProgress&&(this.settings.onInterrupt(this),this.timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}},{key:"update",value:function(){if(!this._inProgress)return!1;if(null===this._handle){var t=this.timeline,e=this.settings;this._handle=t.addChannel({delay:t.getTime(),duration:e.duration})}return this.time=this.timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate(this),this.timeline.isFinished(this._handle)&&this.end(),!0}},{key:"_onUpdate",value:function(){}},{key:"inProgress",get:function(){return this._inProgress}}]),t}(),Ft=function(){},Nt=1,Vt=2,Ut=3,Bt={transitionDuration:0,transitionEasing:function(t){return t},transitionInterpolator:new Tt,transitionInterruption:Nt,onTransitionStart:Ft,onTransitionInterrupt:Ft,onTransitionEnd:Ft},Gt=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(p.a)(this,t),this.ControllerState=e,this.props=Object.assign({},Bt,n),this.propsInTransition=null,this.transition=new zt(n.timeline),this.onViewStateChange=n.onViewStateChange,this._onTransitionUpdate=this._onTransitionUpdate.bind(this)}return Object(d.a)(t,[{key:"finalize",value:function(){this.transition.cancel()}},{key:"getViewportInTransition",value:function(){return this.propsInTransition}},{key:"processViewStateChange",value:function(t){var e=!1,n=this.props;if(t=Object.assign({},Bt,t),this.props=t,this._shouldIgnoreViewportChange(n,t))return e;if(this._isTransitionEnabled(t)){var r=this.transition.settings,i=r.interruption,a=r.endProps,o=Object.assign({},n,i===Vt?a:this.propsInTransition||n);this._triggerTransition(o,t),e=!0}else this.transition.cancel();return e}},{key:"updateTransition",value:function(){this.transition.update()}},{key:"_isTransitionEnabled",value:function(t){var e=t.transitionDuration,n=t.transitionInterpolator;return(e>0||"auto"===e)&&Boolean(n)}},{key:"_isUpdateDueToCurrentTransition",value:function(t){return!!this.transition.inProgress&&this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition)}},{key:"_shouldIgnoreViewportChange",value:function(t,e){return this.transition.inProgress?this.transition.settings.interruption===Ut||this._isUpdateDueToCurrentTransition(e):!this._isTransitionEnabled(e)||e.transitionInterpolator.arePropsEqual(t,e)}},{key:"_triggerTransition",value:function(t,e){var n=new this.ControllerState(t),r=new this.ControllerState(e).shortestPathFrom(n),i=e.transitionInterpolator,a=i.getDuration?i.getDuration(t,e):e.transitionDuration;if(0!==a){var o=e.transitionInterpolator.initializeProps(t,r);this.propsInTransition={},this.duration=a,this.transition.start({duration:a,easing:e.transitionEasing,interpolator:e.transitionInterpolator,interruption:e.transitionInterruption,startProps:o.start,endProps:o.end,onStart:e.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(e.onTransitionInterrupt),onEnd:this._onTransitionEnd(e.onTransitionEnd)}),this.updateTransition()}}},{key:"_onTransitionEnd",value:function(t){var e=this;return function(n){e.propsInTransition=null,t(n)}}},{key:"_onTransitionUpdate",value:function(t){var e=t.time,n=t.settings,r=n.interpolator,i=n.startProps,a=n.endProps,o=n.duration,s=(0,n.easing)(e/o),c=r.interpolateProps(i,a,s);this.propsInTransition=new this.ControllerState(Object.assign({},this.props,c)).getViewportProps(),this.onViewStateChange&&this.onViewStateChange({viewState:this.propsInTransition,interactionState:{inTransition:!0},oldViewState:this.props})}}]),t}();function Wt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Zt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Wt(Object(n),!0).forEach((function(e){Object(T.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Wt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}Gt.defaultProps=Bt;var qt={transitionDuration:0},Yt=["wheel"],Jt=["panstart","panmove","panend"],Ht=["pinchstart","pinchmove","pinchend"],Kt=["doubletap"],Xt=["keydown"],$t=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(p.a)(this,t),bt(e),this.ControllerState=e,this.controllerState=null,this.controllerStateProps=null,this.eventManager=null,this.transitionManager=new Gt(e,n),this._events=null,this._state={isDragging:!1},this._customEvents=[],this.onViewStateChange=null,this.onStateChange=null,this.invertPan=!1,this.handleEvent=this.handleEvent.bind(this),this.setProps(n)}return Object(d.a)(t,[{key:"finalize",value:function(){for(var t in this._events)this._events[t]&&this.eventManager.off(t,this.handleEvent);this.transitionManager.finalize()}},{key:"handleEvent",value:function(t){var e=this.ControllerState;switch(this.controllerState=new e(Zt(Zt({makeViewport:this.makeViewport},this.controllerStateProps),this._state)),t.type){case"panstart":return this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}},{key:"getCenter",value:function(t){var e=this.controllerStateProps,n=e.x,r=e.y,i=t.offsetCenter;return[i.x-n,i.y-r]}},{key:"isPointInBounds",value:function(t,e){var n=this.controllerStateProps,r=n.width,i=n.height;if(e&&e.handled)return!1;var a=t[0]>=0&&t[0]<=r&&t[1]>=0&&t[1]<=i;return a&&e&&e.stopPropagation(),a}},{key:"isFunctionKeyPressed",value:function(t){var e=t.srcEvent;return Boolean(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}},{key:"isDragging",value:function(){return this._state.isDragging}},{key:"setProps",value:function(t){"onViewStateChange"in t&&(this.onViewStateChange=t.onViewStateChange),"onStateChange"in t&&(this.onStateChange=t.onStateChange),"makeViewport"in t&&(this.makeViewport=t.makeViewport),this.controllerStateProps=t,"eventManager"in t&&this.eventManager!==t.eventManager&&(this.eventManager=t.eventManager,this._events={},this.toggleEvents(this._customEvents,!0)),this.transitionManager.processViewStateChange(this.controllerStateProps);var e=t.scrollZoom,n=void 0===e||e,r=t.dragPan,i=void 0===r||r,a=t.dragRotate,o=void 0===a||a,s=t.doubleClickZoom,c=void 0===s||s,u=t.touchZoom,l=void 0===u||u,h=t.touchRotate,f=void 0!==h&&h,p=t.keyboard,d=void 0===p||p,v=Boolean(this.onViewStateChange);this.toggleEvents(Yt,v&&n),this.toggleEvents(Jt,v&&(i||o)),this.toggleEvents(Ht,v&&(l||f)),this.toggleEvents(Kt,v&&c),this.toggleEvents(Xt,v&&d),this.scrollZoom=n,this.dragPan=i,this.dragRotate=o,this.doubleClickZoom=c,this.touchZoom=l,this.touchRotate=f,this.keyboard=d}},{key:"updateTransition",value:function(){this.transitionManager.updateTransition()}},{key:"toggleEvents",value:function(t,e){var n=this;this.eventManager&&t.forEach((function(t){n._events[t]!==e&&(n._events[t]=e,e?n.eventManager.on(t,n.handleEvent):n.eventManager.off(t,n.handleEvent))}))}},{key:"updateViewport",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Object.assign({},t.getViewportProps(),e),i=this.controllerState!==t;if(i){var a=this.controllerState?this.controllerState.getViewportProps():null;this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:n,oldViewState:a})}Object.assign(this._state,t.getInteractiveState(),n),this.onStateChange&&this.onStateChange(this._state)}},{key:"_onPanStart",value:function(t){var e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;var n=this.controllerState.panStart({pos:e}).rotateStart({pos:e});return this.updateViewport(n,qt,{isDragging:!0}),!0}},{key:"_onPan",value:function(t){if(!this.isDragging())return!1;var e=this.isFunctionKeyPressed(t)||t.rightButton;return(e=this.invertPan?!e:e)?this._onPanMove(t):this._onPanRotate(t)}},{key:"_onPanEnd",value:function(t){var e=this.controllerState.panEnd().rotateEnd();return this.updateViewport(e,null,{isDragging:!1,isPanning:!1,isRotating:!1}),!0}},{key:"_onPanMove",value:function(t){if(!this.dragPan)return!1;var e=this.getCenter(t),n=this.controllerState.pan({pos:e});return this.updateViewport(n,qt,{isDragging:!0,isPanning:!0}),!0}},{key:"_onPanRotate",value:function(t){if(!this.dragRotate)return!1;var e=t.deltaX,n=t.deltaY,r=this.controllerState.getViewportProps(),i=e/r.width,a=n/r.height,o=this.controllerState.rotate({deltaScaleX:i,deltaScaleY:a});return this.updateViewport(o,qt,{isDragging:!0,isRotating:!0}),!0}},{key:"_onWheel",value:function(t){if(!this.scrollZoom)return!1;t.preventDefault();var e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;var n=t.delta,r=2/(1+Math.exp(-Math.abs(.01*n)));n<0&&0!==r&&(r=1/r);var i=this.controllerState.zoom({pos:e,scale:r});return this.updateViewport(i,qt,{isZooming:!0,isPanning:!0}),!0}},{key:"_onPinchStart",value:function(t){var e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;var n=this.controllerState.zoomStart({pos:e}).rotateStart({pos:e});return this._state.startPinchRotation=t.rotation,this.updateViewport(n,qt,{isDragging:!0}),!0}},{key:"_onPinch",value:function(t){if(!this.touchZoom&&!this.touchRotate)return!1;if(!this.isDragging())return!1;var e=this.controllerState;if(this.touchZoom){var n=t.scale,r=this.getCenter(t);e=e.zoom({pos:r,scale:n})}if(this.touchRotate){var i=t.rotation,a=this._state.startPinchRotation;e=e.rotate({deltaScaleX:-(i-a)/180})}return this.updateViewport(e,qt,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),!0}},{key:"_onPinchEnd",value:function(t){var e=this.controllerState.zoomEnd().rotateEnd();return this._state.startPinchRotation=0,this.updateViewport(e,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1}),!0}},{key:"_onDoubleTap",value:function(t){if(!this.doubleClickZoom)return!1;var e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;var n=this.isFunctionKeyPressed(t),r=this.controllerState.zoom({pos:e,scale:n?.5:2});return this.updateViewport(r,this._getTransitionProps(),{isZooming:!0,isPanning:!0}),!0}},{key:"_onKeyDown",value:function(t){if(!this.keyboard)return!1;var e,n=this.isFunctionKeyPressed(t),r=this.controllerState,i={};switch(t.srcEvent.code){case"Minus":e=n?r.zoomOut().zoomOut():r.zoomOut(),i.isZooming=!0;break;case"Equal":e=n?r.zoomIn().zoomIn():r.zoomIn(),i.isZooming=!0;break;case"ArrowLeft":n?(e=r.rotateLeft(),i.isRotating=!0):(e=r.moveLeft(),i.isPanning=!0);break;case"ArrowRight":n?(e=r.rotateRight(),i.isRotating=!0):(e=r.moveRight(),i.isPanning=!0);break;case"ArrowUp":n?(e=r.rotateUp(),i.isRotating=!0):(e=r.moveUp(),i.isPanning=!0);break;case"ArrowDown":n?(e=r.rotateDown(),i.isRotating=!0):(e=r.moveDown(),i.isPanning=!0);break;default:return!1}return this.updateViewport(e,this._getTransitionProps(),i),!0}},{key:"_getTransitionProps",value:function(){return qt}},{key:"events",set:function(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.setProps(this.controllerStateProps)}}]),t}(),Qt=function(){function t(e){Object(p.a)(this,t),bt(Number.isFinite(e.width),"`width` must be supplied"),bt(Number.isFinite(e.height),"`height` must be supplied"),this._viewportProps=this._applyConstraints(e)}return Object(d.a)(t,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"shortestPathFrom",value:function(t){return this._viewportProps}},{key:"_applyConstraints",value:function(t){return t}}]),t}();function te(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ee(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?te(Object(n),!0).forEach((function(e){Object(T.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):te(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function ne(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}var re={transitionDuration:300,transitionEasing:function(t){return t},transitionInterpolator:new Tt,transitionInterruption:Nt},ie={transitionDuration:0},ae=0,oe=20,se=0,ce=60,ue=0,le=0,he=1.5,fe=function(t){Object(G.a)(n,t);var e=ne(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=r.makeViewport,a=r.width,o=r.height,s=r.latitude,c=r.longitude,u=r.zoom,l=r.bearing,h=void 0===l?le:l,f=r.pitch,d=void 0===f?ue:f,v=r.altitude,y=void 0===v?he:v,g=r.maxZoom,b=void 0===g?oe:g,m=r.minZoom,w=void 0===m?ae:m,O=r.maxPitch,j=void 0===O?ce:O,_=r.minPitch,P=void 0===_?se:_,S=r.startPanLngLat,k=r.startZoomLngLat,x=r.startBearing,C=r.startPitch,A=r.startZoom;return Object(p.a)(this,n),bt(Number.isFinite(c),"`longitude` must be supplied"),bt(Number.isFinite(s),"`latitude` must be supplied"),bt(Number.isFinite(u),"`zoom` must be supplied"),(t=e.call(this,{width:a,height:o,latitude:s,longitude:c,zoom:u,bearing:h,pitch:d,altitude:y,maxZoom:b,minZoom:w,maxPitch:j,minPitch:P}))._interactiveState={startPanLngLat:S,startZoomLngLat:k,startBearing:x,startPitch:C,startZoom:A},t.makeViewport=i,t}return Object(d.a)(n,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getInteractiveState",value:function(){return this._interactiveState}},{key:"panStart",value:function(t){var e=t.pos;return this._getUpdatedState({startPanLngLat:this._unproject(e)})}},{key:"pan",value:function(t){var e=t.pos,n=t.startPos,r=this._interactiveState.startPanLngLat||this._unproject(n);if(!r)return this;var i=this._calculateNewLngLat({startPanLngLat:r,pos:e}),a=Object(E.a)(i,2),o=a[0],s=a[1];return this._getUpdatedState({longitude:o,latitude:s})}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanLngLat:null})}},{key:"rotateStart",value:function(t){t.pos;return this._getUpdatedState({startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}},{key:"rotate",value:function(t){var e=t.deltaScaleX,n=void 0===e?0:e,r=t.deltaScaleY,i=void 0===r?0:r,a=this._interactiveState,o=a.startBearing,s=a.startPitch;if(!Number.isFinite(o)||!Number.isFinite(s))return this;var c=this._calculateNewPitchAndBearing({deltaScaleX:n,deltaScaleY:i,startBearing:o,startPitch:s}),u=c.pitch,l=c.bearing;return this._getUpdatedState({bearing:l,pitch:u})}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(t){var e=t.pos;return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var e=t.pos,n=t.startPos,r=t.scale,i=this._interactiveState,a=i.startZoom,o=i.startZoomLngLat;Number.isFinite(a)||(a=this._viewportProps.zoom,o=this._unproject(n)||this._unproject(e));var s=this._calculateNewZoom({scale:r,startZoom:a}),c=this.makeViewport(ee(ee({},this._viewportProps),{},{zoom:s})).getMapCenterByLngLatPosition({lngLat:o,pos:e}),u=Object(E.a)(c,2),l=u[0],h=u[1];return this._getUpdatedState({zoom:s,longitude:l,latitude:h})}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}},{key:"zoomIn",value:function(){return this._zoomFromCenter(2)}},{key:"zoomOut",value:function(){return this._zoomFromCenter(.5)}},{key:"moveLeft",value:function(){return this._panFromCenter([100,0])}},{key:"moveRight",value:function(){return this._panFromCenter([-100,0])}},{key:"moveUp",value:function(){return this._panFromCenter([0,100])}},{key:"moveDown",value:function(){return this._panFromCenter([0,-100])}},{key:"rotateLeft",value:function(){return this._getUpdatedState({bearing:this._viewportProps.bearing-15})}},{key:"rotateRight",value:function(){return this._getUpdatedState({bearing:this._viewportProps.bearing+15})}},{key:"rotateUp",value:function(){return this._getUpdatedState({pitch:this._viewportProps.pitch+10})}},{key:"rotateDown",value:function(){return this._getUpdatedState({pitch:this._viewportProps.pitch-10})}},{key:"shortestPathFrom",value:function(t){var e=t.getViewportProps(),n=Object.assign({},this._viewportProps),r=n.bearing,i=n.longitude;return Math.abs(r-e.bearing)>180&&(n.bearing=r<0?r+360:r-360),Math.abs(i-e.longitude)>180&&(n.longitude=i<0?i+360:i-360),n}},{key:"_zoomFromCenter",value:function(t){var e=this._viewportProps,n=e.width,r=e.height;return this.zoom({pos:[n/2,r/2],scale:t})}},{key:"_panFromCenter",value:function(t){var e=this._viewportProps,n=e.width,r=e.height;return this.pan({startPos:[n/2,r/2],pos:[n/2+t[0],r/2+t[1]]})}},{key:"_getUpdatedState",value:function(t){return new this.constructor(ee(ee(ee({makeViewport:this.makeViewport},this._viewportProps),this._interactiveState),t))}},{key:"_applyConstraints",value:function(t){var e=t.maxZoom,n=t.minZoom,r=t.zoom;t.zoom=Object(J.c)(r,n,e);var i=t.maxPitch,a=t.minPitch,o=t.pitch;return t.pitch=Object(J.c)(o,a,i),Object.assign(t,Object(at.i)(t)),t}},{key:"_unproject",value:function(t){var e=this.makeViewport(this._viewportProps);return t&&e.unproject(t)}},{key:"_calculateNewLngLat",value:function(t){var e=t.startPanLngLat,n=t.pos;return this.makeViewport(this._viewportProps).getMapCenterByLngLatPosition({lngLat:e,pos:n})}},{key:"_calculateNewZoom",value:function(t){var e=t.scale,n=t.startZoom,r=this._viewportProps,i=r.maxZoom,a=r.minZoom,o=n+Math.log2(e);return Object(J.c)(o,a,i)}},{key:"_calculateNewPitchAndBearing",value:function(t){var e=t.deltaScaleX,n=t.deltaScaleY,r=t.startBearing,i=t.startPitch;n=Object(J.c)(n,-1,1);var a=this._viewportProps,o=a.minPitch,s=a.maxPitch,c=i;return n>0?c=i+n*(s-i):n<0&&(c=i-n*(o-i)),{pitch:c,bearing:r+180*e}}}]),n}(Qt),pe=function(t){Object(G.a)(n,t);var e=ne(n);function n(t){var r;return Object(p.a)(this,n),(r=e.call(this,fe,t)).invertPan=!0,r}return Object(d.a)(n,[{key:"_getTransitionProps",value:function(){return re}},{key:"_onPanRotate",value:function(t){if(!this.dragRotate)return!1;var e=t.deltaX,n=t.deltaY,r=this.getCenter(t),i=Object(E.a)(r,2)[1],a=i-n,o=this.controllerState.getViewportProps(),s=o.width,c=o.height,u=e/s,l=0;n>0?Math.abs(c-a)>5&&(l=n/(a-c)*1.2):n<0&&a>5&&(l=1-i/a),l=Math.min(1,Math.max(-1,l));var h=this.controllerState.rotate({deltaScaleX:u,deltaScaleY:l});return this.updateViewport(h,ie,{isDragging:!0,isRotating:!0})}}]),n}($t);function de(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}var ve=function(t){Object(G.a)(n,t);var e=de(n);function n(t){return Object(p.a)(this,n),e.call(this,Object.assign({},t,{type:xt}))}return Object(d.a)(n,[{key:"controller",get:function(){return this._getControllerProps({type:pe})}}]),n}(Ot);ve.displayName="MapView";var ye=n(7),ge=n.n(ye),be=n(18),me=n(25),we=n(209),Oe=n(122),je=n(40);function _e(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Pe(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?_e(Object(n),!0).forEach((function(e){Object(T.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Se=function(){function t(e,n){Object(p.a)(this,t),this.opts=n,this.source=e}return Object(d.a)(t,[{key:"getValue",value:function(){var t=this.source.getBuffer(),e=this.getAccessor();if(t)return[t,e];var n=this.source.value,r=e.size,i=n;if(n&&n.length!==r){i=new Float32Array(r);for(var a=e.elementOffset||0,o=0;o<r;++o)i[o]=n[a+o]}return i}},{key:"getAccessor",value:function(){return Pe(Pe({},this.source.getAccessor()),this.opts)}},{key:"value",get:function(){return this.source.value}}]),t}();function ke(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function xe(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ke(Object(n),!0).forEach((function(e){Object(T.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ke(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Ce(t){return t.stride||t.size*t.bytesPerElement}function Ae(t,e){e.offset&&q.removed("shaderAttribute.offset","vertexOffset, elementOffset")();var n=Ce(t),r=("vertexOffset"in e?e.vertexOffset:t.vertexOffset||0)*n+(e.elementOffset||0)*t.bytesPerElement+(t.offset||0);return xe(xe({},e),{},{offset:r,stride:n})}var Me=function(){function t(e,n){Object(p.a)(this,t),this.gl=e,this.id=n.id,this.size=n.size;var r=n.logicalType||n.type,i=5130===r,a=n.defaultValue;a=Number.isFinite(a)?[a]:a||new Array(this.size).fill(0),n.defaultValue=a;var o=r;i?o=5126:!o&&n.isIndexed?o=e&&Object(we.b)(e,Oe.a.ELEMENT_INDEX_UINT32)?5125:5123:o||(o=5126),n.logicalType=r,n.type=o;var s=function(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}(r||o||5126);this.shaderAttributes={},this.doublePrecision=i,i&&!1===n.fp64&&(s=Float32Array),n.bytesPerElement=s.BYTES_PER_ELEMENT,this.defaultType=s,this.value=null,this.settings=n,this.state={externalBuffer:null,bufferAccessor:n,allocatedValue:null,constant:!1},this._buffer=null,this.setData(n)}return Object(d.a)(t,[{key:"delete",value:function(){this._buffer&&(this._buffer.delete(),this._buffer=null),Y.release(this.state.allocatedValue)}},{key:"getShaderAttributes",value:function(t,e){if(this.doublePrecision){var n={},r=this.value instanceof Float64Array,i=function(t,e){var n=Ae(t,e);return{high:n,low:xe(xe({},n),{},{offset:n.offset+4*t.size})}}(this.getAccessor(),e||{});return n[t]=new Se(this,i.high),n["".concat(t,"64Low")]=r?new Se(this,i.low):new Float32Array(this.size),n}if(e){var a=Ae(this.getAccessor(),e);return Object(T.a)({},t,new Se(this,a))}return Object(T.a)({},t,this)}},{key:"getBuffer",value:function(){return this.state.constant?null:this.state.externalBuffer||this._buffer}},{key:"getValue",value:function(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}},{key:"getAccessor",value:function(){return this.state.bufferAccessor}},{key:"setData",value:function(t){var e=this.state;ArrayBuffer.isView(t)?t={value:t}:t instanceof je.a&&(t={buffer:t});var n=xe(xe({},this.settings),t);if(e.bufferAccessor=n,t.constant){var r=t.value;if(r=this._normalizeValue(r,[],0),this.settings.normalized&&(r=this._normalizeConstant(r)),!(!e.constant||!this._areValuesEqual(r,this.value)))return!1;e.externalBuffer=null,e.constant=!0,this.value=r}else if(t.buffer){var i=t.buffer;e.externalBuffer=i,e.constant=!1,this.value=t.value;var a=t.value instanceof Float64Array;n.type=t.type||i.accessor.type,n.bytesPerElement=i.accessor.BYTES_PER_ELEMENT*(a?2:1),n.stride=Ce(n)}else if(t.value){this._checkExternalBuffer(t);var o=t.value;e.externalBuffer=null,e.constant=!1,this.value=o,n.bytesPerElement=o.BYTES_PER_ELEMENT,n.stride=Ce(n);var s=this.buffer,c=this.byteOffset;this.doublePrecision&&o instanceof Float64Array&&(o=rt(o,n)),s.byteLength<o.byteLength+c&&s.reallocate(2*(o.byteLength+c)),s.setAccessor(null),s.subData({data:o,offset:c}),n.type=t.type||s.accessor.type}return!0}},{key:"updateSubBuffer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.value,n=t.startOffset,r=void 0===n?0:n,i=t.endOffset;this.buffer.subData({data:this.doublePrecision&&e instanceof Float64Array?rt(e,{size:this.size,startIndex:r,endIndex:i}):e.subarray(r,i),offset:r*e.BYTES_PER_ELEMENT+this.byteOffset})}},{key:"allocate",value:function(t){var e=t.numInstances,n=t.copy,r=void 0!==n&&n,i=this.state,a=i.allocatedValue,o=Y.allocate(a,e+1,{size:this.size,type:this.defaultType,copy:r});this.value=o;var s=this.buffer,c=this.byteOffset;return s.byteLength<o.byteLength+c&&(s.reallocate(o.byteLength+c),r&&a&&s.subData({data:a instanceof Float64Array?rt(a,this):a,offset:c})),i.allocatedValue=o,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}},{key:"_checkExternalBuffer",value:function(t){var e=t.value;if(!t.constant&&e){var n=this.defaultType,r=!1;if(this.doublePrecision&&(r=e.BYTES_PER_ELEMENT<4),r)throw new Error("Attribute ".concat(this.id," does not support ").concat(e.constructor.name));e instanceof n||!this.settings.normalized||"normalized"in t||q.warn("Attribute ".concat(this.id," is normalized"))()}}},{key:"_normalizeConstant",value:function(t){switch(this.settings.type){case 5120:return new Float32Array(t).map((function(t){return(t+128)/255*2-1}));case 5122:return new Float32Array(t).map((function(t){return(t+32768)/65535*2-1}));case 5121:return new Float32Array(t).map((function(t){return t/255}));case 5123:return new Float32Array(t).map((function(t){return t/65535}));default:return t}}},{key:"_normalizeValue",value:function(t,e,n){var r=this.settings,i=r.defaultValue,a=r.size;if(Number.isFinite(t))return e[n]=t,e;if(!t)return e[n]=i[0],e;switch(a){case 4:e[n+3]=Number.isFinite(t[3])?t[3]:i[3];case 3:e[n+2]=Number.isFinite(t[2])?t[2]:i[2];case 2:e[n+1]=Number.isFinite(t[1])?t[1]:i[1];case 1:e[n+0]=Number.isFinite(t[0])?t[0]:i[0];break;default:for(var o=a;--o>=0;)e[n+o]=Number.isFinite(t[o])?t[o]:i[o]}return e}},{key:"_areValuesEqual",value:function(t,e){if(!t||!e)return!1;for(var n=this.size,r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}},{key:"buffer",get:function(){if(!this._buffer){var t=this.settings,e=t.isIndexed,n=t.type;this._buffer=new je.a(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:n}})}return this._buffer}},{key:"byteOffset",get:function(){var t=this.getAccessor();return t.vertexOffset?t.vertexOffset*Ce(t):0}}]),t}(),Le=[],Re=[];function Ee(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,r=Le,i={index:-1,data:t,target:[]};return t?"function"===typeof t[Symbol.iterator]?r=t:t.length>0&&(Re.length=t.length,r=Re):r=Le,(e>0||Number.isFinite(n))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,n),i.index=e-1),{iterable:r,objectInfo:i}}function Te(t){return t&&t[Symbol.asyncIterator]}function Ie(t,e){var n=e.size,r=e.stride,i=e.offset,a=e.startIndices,o=e.nested,s=t.BYTES_PER_ELEMENT,c=r?r/s:n,u=i?i/s:0,l=Math.floor((t.length-u)/c);return function(e,r){var i=r.index,s=r.target;if(!a){for(var h=i*c+u,f=0;f<n;f++)s[f]=t[h+f];return s}var p,d=a[i],v=a[i+1]||l;if(o){p=new Array(v-d);for(var y=d;y<v;y++){var g=y*c+u;s=new Array(n);for(var b=0;b<n;b++)s[b]=t[g+b];p[y-d]=s}}else if(c===n)p=t.subarray(d*n+u,v*n+u);else{p=new t.constructor((v-d)*n);for(var m=0,w=d;w<v;w++)for(var O=w*c+u,j=0;j<n;j++)p[m++]=t[O+j]}return p}}function De(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0};return Array.isArray(t)?ze(t,e,[]):e(t)?[t]:[]}function ze(t,e,n){for(var r=-1;++r<t.length;){var i=t[r];Array.isArray(i)?ze(i,e,n):e(i)&&n.push(i)}return n}function Fe(t){for(var e=t.target,n=t.source,r=t.start,i=void 0===r?0:r,a=t.count,o=void 0===a?1:a,s=n.length,c=o*s,u=0,l=i;u<s;u++)e[l++]=n[u];for(;u<c;)u<c-u?(e.copyWithin(i+u,i,i+u),u*=2):(e.copyWithin(i+u,i,i+c-u),u=c);return e}var Ne=[],Ve=[[0,1/0]];function Ue(t,e){if(t===Ve)return t;if(e[0]<0&&(e[0]=0),e[0]>=e[1])return t;for(var n=[],r=t.length,i=0,a=0;a<r;a++){var o=t[a];o[1]<e[0]?(n.push(o),i=a+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(i,0,e),n}function Be(t){var e=t.source,n=t.target,r=t.start,i=void 0===r?0:r,a=t.end,o=t.getData;a=a||n.length;var s=e.length,c=a-i;if(s>c)n.set(e.subarray(0,c),i);else if(n.set(e,i),o)for(var u=s;u<c;)for(var l=o(u,e),h=0;h<l.length;h++)n[i+u]=l[h],u++}var Ge={interpolation:{duration:0,easing:function(t){return t}},spring:{stiffness:.05,damping:.5}};function We(t,e){return t?(Number.isFinite(t)&&(t={duration:t}),t.type=t.type||"interpolation",Object.assign({},Ge[t.type],e,t)):null}function Ze(t,e){return e.getBuffer()?[e.getBuffer(),{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function qe(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function Ye(t){t.push(t.shift())}function Je(t,e){var n=t.doublePrecision,r=t.settings,i=t.value,a=t.size,o=n?2:1;return(r.noAlloc?i.length:e*a)*o}function He(t){var e=t.buffer,n=t.numInstances,r=t.attribute,i=t.fromLength,a=t.fromStartIndices,o=t.getData,s=void 0===o?function(t){return t}:o,c=r.doublePrecision?2:1,u=r.size*c,l=r.byteOffset,h=r.startIndices,f=a&&h,p=Je(r,n),d=r.state.constant;if(f||!(i>=p)){var v=d?r.value:r.getBuffer().getData({srcByteOffset:l});if(r.settings.normalized&&!d){var y=s;s=function(t,e){return r._normalizeConstant(y(t,e))}}var g=d?function(t,e){return s(v,e)}:function(t,e){return s(v.subarray(t,t+u),e)},b=e.getData({length:i}),m=new Float32Array(p);!function(t){var e=t.source,n=t.target,r=t.size,i=t.getData,a=t.sourceStartIndices,o=t.targetStartIndices;if(!Array.isArray(o))return Be({source:e,target:n,getData:i}),n;for(var s=0,c=0,u=i&&function(t,e){return i(t+c,e)},l=Math.min(a.length,o.length),h=1;h<l;h++){var f=a[h]*r,p=o[h]*r;Be({source:e.subarray(s,f),target:n,start:c,end:p,getData:u}),s=f,c=p}c<n.length&&Be({source:[],target:n,start:c,getData:u})}({source:b,target:m,sourceStartIndices:a,targetStartIndices:h,size:u,getData:g}),e.byteLength<m.byteLength+l&&e.reallocate(m.byteLength+l),e.subData({data:m,offset:l})}}function Ke(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return Xe(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Xe(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Xe(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function $e(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}var Qe=function(t){Object(G.a)(n,t);var e=$e(n);function n(t){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(p.a)(this,n),r=e.call(this,t,i);var a=i.transition,o=void 0!==a&&a,s=i.noAlloc,c=void 0!==s&&s,u=i.update,l=void 0===u?null:u,h=i.accessor,f=void 0===h?null:h,d=i.transform,v=void 0===d?null:d,y=i.startIndices,g=void 0===y?null:y;return Object.assign(r.settings,{transition:o,noAlloc:c,update:l||f&&r._autoUpdater,accessor:f,transform:v}),Object.assign(r.state,{lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:Ve,startIndices:g}),Object.seal(r.settings),Object.seal(r.state),r._validateAttributeUpdaters(),r}return Object(d.a)(n,[{key:"needsUpdate",value:function(){return this.state.needsUpdate}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.clearChangedFlags,n=void 0!==e&&e,r=this.state.needsRedraw;return this.state.needsRedraw=r&&!n,r}},{key:"getUpdateTriggers",value:function(){var t=this.settings.accessor;return[this.id].concat("function"!==typeof t&&t||[])}},{key:"supportsTransition",value:function(){return Boolean(this.settings.transition)}},{key:"getTransitionSetting",value:function(t){var e=this.settings.accessor,n=this.settings.transition;return this.supportsTransition()?We(Array.isArray(e)?t[e.find((function(e){return t[e]}))]:t[e],n):null}},{key:"setNeedsUpdate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id,e=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),e){var n=e.startRow,r=void 0===n?0:n,i=e.endRow,a=void 0===i?1/0:i;this.state.updateRanges=Ue(this.state.updateRanges,[r,a])}else this.state.updateRanges=Ve}},{key:"clearNeedsUpdate",value:function(){this.state.needsUpdate=!1,this.state.updateRanges=Ne}},{key:"setNeedsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||t}},{key:"update",value:function(t){this.setData(t)}},{key:"allocate",value:function(t){var e=this.state,r=this.settings;return!r.noAlloc&&(!!r.update&&(bt(Number.isFinite(t)),Object(me.a)(Object(Z.a)(n.prototype),"allocate",this).call(this,{numInstances:t,copy:e.updateRanges!==Ve}),!0))}},{key:"updateBuffer",value:function(t){var e=t.numInstances,r=t.data,i=t.props,a=t.context;if(!this.needsUpdate())return!1;var o=this.state.updateRanges,s=this.settings,c=s.update,u=s.noAlloc,l=!0;if(c){var h,f=Ke(o);try{for(f.s();!(h=f.n()).done;){var p=Object(E.a)(h.value,2),d=p[0],v=p[1];c.call(a,this,{data:r,startRow:d,endRow:v,props:i,numInstances:e})}}catch(_){f.e(_)}finally{f.f()}if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant});else{var y,g=Ke(o);try{for(g.s();!(y=g.n()).done;){var b=Object(E.a)(y.value,2),m=b[0],w=b[1],O=Number.isFinite(m)?this.getVertexOffset(m):0,j=Number.isFinite(w)?this.getVertexOffset(w):u||!Number.isFinite(e)?this.value.length:e*this.size;Object(me.a)(Object(Z.a)(n.prototype),"updateSubBuffer",this).call(this,{startOffset:O,endOffset:j})}}catch(_){g.e(_)}finally{g.f()}}else;this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}},{key:"setConstantValue",value:function(t){return void 0!==t&&"function"!==typeof t&&(this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}},{key:"setExternalBuffer",value:function(t){var e=this.state;return t?(this.clearNeedsUpdate(),e.lastExternalBuffer===t||(e.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(e.lastExternalBuffer=null,!1)}},{key:"setBinaryValue",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.state,r=this.settings;if(!t)return n.binaryValue=null,n.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(n.binaryValue===t)return this.clearNeedsUpdate(),!0;n.binaryValue=t,this.setNeedsRedraw(),ArrayBuffer.isView(t)&&(t={value:t});var i=r.transform||e!==this.startIndices;if(i){bt(ArrayBuffer.isView(t.value),"invalid ".concat(r.accessor));var a=t.size&&t.size!==this.size;return n.binaryAccessor=Ie(t.value,{size:t.size||this.size,stride:t.stride,offset:t.offset,startIndices:e,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}},{key:"getVertexOffset",value:function(t){var e=this.startIndices;return(e?e[t]:t)*this.size}},{key:"getShaderAttributes",value:function(){var t=this.settings.shaderAttributes||Object(T.a)({},this.id,null),e={};for(var r in t)Object.assign(e,Object(me.a)(Object(Z.a)(n.prototype),"getShaderAttributes",this).call(this,r,t[r]));return e}},{key:"_autoUpdater",value:function(t,e){var n=e.data,r=e.startRow,i=e.endRow,a=e.props,o=e.numInstances;if(!t.constant){var s=t.settings,c=t.state,u=t.value,l=t.size,h=t.startIndices,f=s.accessor,p=s.transform,d=c.binaryAccessor||("function"===typeof f?f:a[f]);bt("function"===typeof d,'accessor "'.concat(f,'" is not a function'));var v,y=t.getVertexOffset(r),g=Ee(n,r,i),b=g.iterable,m=g.objectInfo,w=Ke(b);try{for(w.s();!(v=w.n()).done;){var O=v.value;m.index++;var j=d(O,m);if(p&&(j=p.call(this,j)),h){var _=(m.index<h.length-1?h[m.index+1]:o)-h[m.index];if(j&&Array.isArray(j[0])){var P,S=y,k=Ke(j);try{for(k.s();!(P=k.n()).done;){var x=P.value;t._normalizeValue(x,u,S),S+=l}}catch(C){k.e(C)}finally{k.f()}}else j&&j.length>l?u.set(j,y):(t._normalizeValue(j,m.target,0),Fe({target:u,source:m.target,start:y,count:_}));y+=_*l}else t._normalizeValue(j,u,y),y+=l}}catch(C){w.e(C)}finally{w.f()}}}},{key:"_validateAttributeUpdaters",value:function(){var t=this.settings;if(!(t.noAlloc||"function"===typeof t.update))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}},{key:"_checkAttributeArray",value:function(){var t=this.value,e=Math.min(4,this.size);if(t&&t.length>=e){var n=!0;switch(e){case 4:n=n&&Number.isFinite(t[3]);case 3:n=n&&Number.isFinite(t[2]);case 2:n=n&&Number.isFinite(t[1]);case 1:n=n&&Number.isFinite(t[0]);break;default:n=!1}if(!n)throw new Error("Illegal attribute generated for ".concat(this.id))}}},{key:"startIndices",get:function(){return this.state.startIndices},set:function(t){this.state.startIndices=t}}]),n}(Me),tn={};function en(t){var e;q.level>0&&tn[t]&&(e=tn[t]).call.apply(e,arguments)}var nn=n(231);function rn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function an(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?rn(Object(n),!0).forEach((function(e){Object(T.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):rn(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function on(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return sn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sn(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function sn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var cn=function(){function t(e){var n=e.gl,r=e.attribute,i=e.timeline;Object(p.a)(this,t),this.gl=n,this.type="interpolation",this.transition=new zt(i),this.attribute=r,this.attributeInTransition=new Qe(n,r.settings),this.currentStartIndices=r.startIndices,this.currentLength=0,this.transform=function(t,e){var n=qe(e.size);return new nn.a(t,{vs:un,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}(n,r);var a={byteLength:0,usage:35050};this.buffers=[new je.a(n,a),new je.a(n,a)]}return Object(d.a)(t,[{key:"start",value:function(t,e){if(t.duration<=0)this.transition.cancel();else{this.gl;var n=this.buffers,r=this.attribute;Ye(n);var i,a={numInstances:e,attribute:r,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter},o=on(n);try{for(o.s();!(i=o.n()).done;){He(an({buffer:i.value},a))}}catch(s){o.e(s)}finally{o.f()}this.currentStartIndices=r.startIndices,this.currentLength=Je(r,e),this.attributeInTransition.update({buffer:n[1],value:r.value}),this.transition.start(t),this.transform.update({elementCount:Math.floor(this.currentLength/r.size),sourceBuffers:{aFrom:n[0],aTo:Ze(0,r)},feedbackBuffers:{vCurrent:n[1]}})}}},{key:"update",value:function(){var t=this.transition.update();if(t){var e=this.transition,n=e.time,r=e.settings,i=r.duration,a=(0,r.easing)(n/i);this.transform.run({uniforms:{time:a}})}return t}},{key:"cancel",value:function(){for(this.transition.cancel(),this.transform.delete();this.buffers.length;)this.buffers.pop().delete()}},{key:"inProgress",get:function(){return this.transition.inProgress}}]),t}(),un="\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nuniform float time;\nattribute ATTRIBUTE_TYPE aFrom;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vCurrent;\n\nvoid main(void) {\n  vCurrent = mix(aFrom, aTo, time);\n  gl_Position = vec4(0.0);\n}\n";var ln=n(127),hn=n(88),fn=n(64);function pn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function dn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?pn(Object(n),!0).forEach((function(e){Object(T.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):pn(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function vn(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return yn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return yn(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function yn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var gn={interpolation:cn,spring:function(){function t(e){var n=e.gl,r=e.attribute,i=e.timeline;Object(p.a)(this,t),this.gl=n,this.type="spring",this.transition=new zt(i),this.attribute=r,this.attributeInTransition=new Qe(n,Object.assign({},r.settings,{normalized:!1})),this.currentStartIndices=r.startIndices,this.currentLength=0,this.texture=function(t){return new hn.a(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}(n),this.framebuffer=function(t,e){return new fn.a(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:Object(T.a)({},36064,e)})}(n,this.texture),this.transform=function(t,e,n){var r=qe(e.size);return new nn.a(t,{framebuffer:n,vs:"\n#define SHADER_NAME spring-transition-vertex-shader\n\n#define EPSILON 0.00001\n\nuniform float stiffness;\nuniform float damping;\nattribute ATTRIBUTE_TYPE aPrev;\nattribute ATTRIBUTE_TYPE aCur;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vNext;\nvarying float vIsTransitioningFlag;\n\nATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {\n  ATTRIBUTE_TYPE velocity = cur - prev;\n  ATTRIBUTE_TYPE delta = dest - cur;\n  ATTRIBUTE_TYPE spring = delta * stiffness;\n  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;\n  return spring + damper + velocity + cur;\n}\n\nvoid main(void) {\n  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;\n  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;\n\n  vNext = getNextValue(aCur, aPrev, aTo);\n  gl_Position = vec4(0, 0, 0, 1);\n  gl_PointSize = 100.0;\n}\n",fs:"\n#define SHADER_NAME spring-transition-is-transitioning-fragment-shader\n\nvarying float vIsTransitioningFlag;\n\nvoid main(void) {\n  if (vIsTransitioningFlag == 0.0) {\n    discard;\n  }\n  gl_FragColor = vec4(1.0);\n}",defines:{ATTRIBUTE_TYPE:r},varyings:["vNext"]})}(n,r,this.framebuffer);var a={byteLength:0,usage:35050};this.buffers=[new je.a(n,a),new je.a(n,a),new je.a(n,a)]}return Object(d.a)(t,[{key:"start",value:function(t,e){this.gl;var n,r=this.buffers,i=this.attribute,a={numInstances:e,attribute:i,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter},o=vn(r);try{for(o.s();!(n=o.n()).done;){He(dn({buffer:n.value},a))}}catch(s){o.e(s)}finally{o.f()}this.currentStartIndices=i.startIndices,this.currentLength=Je(i,e),this.attributeInTransition.update({buffer:r[1],value:i.value}),this.transition.start(t),this.transform.update({elementCount:Math.floor(this.currentLength/i.size),sourceBuffers:{aTo:Ze(0,i)}})}},{key:"update",value:function(){var t=this.buffers,e=this.transform,n=this.framebuffer,r=this.transition;return!!r.update()&&(e.update({sourceBuffers:{aPrev:t[0],aCur:t[1]},feedbackBuffers:{vNext:t[2]}}),e.run({framebuffer:n,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:r.settings.stiffness,damping:r.settings.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),Ye(t),this.attributeInTransition.update({buffer:t[1],value:this.attribute.value}),Object(ln.b)(n)[0]>0||r.end(),!0)}},{key:"cancel",value:function(){for(this.transition.cancel(),this.transform.delete();this.buffers.length;)this.buffers.pop().delete();this.texture.delete(),this.texture=null,this.framebuffer.delete(),this.framebuffer=null}},{key:"inProgress",get:function(){return this.transition.inProgress}}]),t}()},bn=function(){function t(e,n){var r=n.id,i=n.timeline;Object(p.a)(this,t),this.id=r,this.gl=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,nn.a.isSupported(e)?this.isSupported=!0:e&&q.warn("WebGL2 not supported by this browser. Transition animation is disabled.")()}return Object(d.a)(t,[{key:"finalize",value:function(){for(var t in this.transitions)this._removeTransition(t)}},{key:"update",value:function(t){var e=t.attributes,n=t.transitions,r=void 0===n?{}:n,i=t.numInstances;if(this.numInstances=i||1,this.isSupported){for(var a in e){var o=e[a],s=o.getTransitionSetting(r);s&&this._updateAttribute(a,o,s)}for(var c in this.transitions){var u=e[c];u&&u.getTransitionSetting(r)||this._removeTransition(c)}}}},{key:"hasAttribute",value:function(t){var e=this.transitions[t];return e&&e.inProgress}},{key:"getAttributes",value:function(){var t={};for(var e in this.transitions){var n=this.transitions[e];n.inProgress&&(t[e]=n.attributeInTransition)}return t}},{key:"run",value:function(){if(!this.isSupported||0===this.numInstances)return!1;for(var t in this.transitions){this.transitions[t].update()&&(this.needsRedraw=!0)}var e=this.needsRedraw;return this.needsRedraw=!1,e}},{key:"_removeTransition",value:function(t){this.transitions[t].cancel(),delete this.transitions[t]}},{key:"_updateAttribute",value:function(t,e,n){var r=this.transitions[t],i=!r||r.type!==n.type;if(i){r&&this._removeTransition(t);var a=gn[n.type];a?this.transitions[t]=new a({attribute:e,timeline:this.timeline,gl:this.gl}):(q.error("unsupported transition type '".concat(n.type,"'"))(),i=!1)}(i||e.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(n,this.numInstances))}}]),t}(),mn="attributeManager.invalidate",wn="attributeManager.updateStart",On="attributeManager.updateEnd",jn=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.id,i=void 0===r?"attribute-manager":r,a=n.stats,o=n.timeline;Object(p.a)(this,t),this.id=i,this.gl=e,this.attributes={},this.updateTriggers={},this.accessors={},this.needsRedraw=!0,this.userData={},this.stats=a,this.attributeTransitionManager=new bn(e,{id:"".concat(i,"-transitions"),timeline:o}),Object.seal(this)}return Object(d.a)(t,[{key:"finalize",value:function(){for(var t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}},{key:"getNeedsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,e&&this.id}},{key:"setNeedsRedraw",value:function(){return this.needsRedraw=!0,this}},{key:"add",value:function(t,e){this._add(t,e)}},{key:"addInstanced",value:function(t,e){this._add(t,e,{instanced:1})}},{key:"remove",value:function(t){for(var e=0;e<t.length;e++){var n=t[e];void 0!==this.attributes[n]&&(this.attributes[n].delete(),delete this.attributes[n])}}},{key:"invalidate",value:function(t,e){var n=this._invalidateTrigger(t,e);en(mn,this,t,n)}},{key:"invalidateAll",value:function(t){for(var e in this.attributes)this.attributes[e].setNeedsUpdate(e,t);en(mn,this,"all")}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.data,n=t.numInstances,r=t.startIndices,i=void 0===r?null:r,a=t.transitions,o=t.props,s=void 0===o?{}:o,c=t.buffers,u=void 0===c?{}:c,l=t.context,h=void 0===l?{}:l,f=!1;for(var p in en(wn,this),this.stats&&this.stats.get("Update Attributes").timeStart(),this.attributes){var d=this.attributes[p],v=d.settings.accessor;d.startIndices=i,s[p]&&q.removed("props.".concat(p),"data.attributes.".concat(p))(),d.setExternalBuffer(u[p])||d.setBinaryValue(u[v],e.startIndices)||!u[v]&&d.setConstantValue(s[v])||d.needsUpdate()&&(f=!0,this._updateAttribute({attribute:d,numInstances:n,data:e,props:s,context:h})),this.needsRedraw|=d.needsRedraw()}f&&en(On,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:a})}},{key:"updateTransition",value:function(){var t=this.attributeTransitionManager.run();return this.needsRedraw=this.needsRedraw||t,t}},{key:"getAttributes",value:function(){return this.attributes}},{key:"getChangedAttributes",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearChangedFlags:!1},e=this.attributes,n=this.attributeTransitionManager,r=Object.assign({},n.getAttributes());for(var i in e){var a=e[i];a.needsRedraw(t)&&!n.hasAttribute(i)&&(r[i]=a)}return r}},{key:"getShaderAttributes",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t||(t=this.getAttributes());var n={};for(var r in t)e[r]||Object.assign(n,t[r].getShaderAttributes());return n}},{key:"getAccessors",value:function(){return this.updateTriggers}},{key:"_add",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e&&q.warn("AttributeManager.add({updaters}) - updater map no longer supported")();var r={};for(var i in t){var a=t[i],o=this._createAttribute(i,a,n);r[i]=o}Object.assign(this.attributes,r),this._mapUpdateTriggersToAttributes()}},{key:"_createAttribute",value:function(t,e,n){var r={id:t,constant:e.constant||!1,isIndexed:e.isIndexed||e.elements,size:e.elements?1:e.size,value:e.value||null,divisor:e.instanced||n.instanced?1:e.divisor};return new Qe(this.gl,Object.assign({},e,r))}},{key:"_mapUpdateTriggersToAttributes",value:function(){var t=this,e={},n=function(n){t.attributes[n].getUpdateTriggers().forEach((function(t){e[t]||(e[t]=[]),e[t].push(n)}))};for(var r in this.attributes)n(r);this.updateTriggers=e}},{key:"_invalidateTrigger",value:function(t,e){var n=this.attributes,r=this.updateTriggers[t];return r&&r.forEach((function(t){var r=n[t];r&&r.setNeedsUpdate(r.id,e)})),r}},{key:"_updateAttribute",value:function(t){var e=t.attribute,n=t.numInstances;en("attribute.updateStart",e),e.allocate(n)&&en("attribute.allocate",e,n),e.updateBuffer(t)&&(this.needsRedraw=!0,en("attribute.updateEnd",e,n))}}]),t}();function _n(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}var Pn=function(t){Object(G.a)(n,t);var e=_n(n);function n(){return Object(p.a)(this,n),e.apply(this,arguments)}return Object(d.a)(n,[{key:"_onUpdate",value:function(){var t=this.time,e=this.settings,n=e.fromValue,r=e.toValue,i=e.duration,a=(0,e.easing)(t/i);this._value=Object(J.e)(n,r,a)}},{key:"value",get:function(){return this._value}}]),n}(zt);function Sn(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}var kn=1e-5;function xn(t,e,n,r,i){var a=e-t;return(n-e)*i+-a*r+a+e}function Cn(t,e){if(Array.isArray(t)){for(var n=0,r=0;r<t.length;r++){var i=t[r]-e[r];n+=i*i}return Math.sqrt(n)}return Math.abs(t-e)}function An(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return Mn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Mn(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Mn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ln(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Rn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ln(Object(n),!0).forEach((function(e){Object(T.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ln(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var En={interpolation:Pn,spring:function(t){Object(G.a)(n,t);var e=Sn(n);function n(){return Object(p.a)(this,n),e.apply(this,arguments)}return Object(d.a)(n,[{key:"_onUpdate",value:function(){var t=this.settings,e=t.fromValue,n=t.toValue,r=t.damping,i=t.stiffness,a=this._prevValue,o=void 0===a?e:a,s=this._currValue,c=void 0===s?e:s,u=function(t,e,n,r,i){if(Array.isArray(n)){for(var a=[],o=0;o<n.length;o++)a[o]=xn(t[o],e[o],n[o],r,i);return a}return xn(t,e,n,r,i)}(o,c,n,r,i),l=Cn(u,n),h=Cn(u,c);l<kn&&h<kn&&(u=n,this.end()),this._prevValue=c,this._currValue=u}},{key:"value",get:function(){return this._currValue}}]),n}(zt)},Tn=function(){function t(e){Object(p.a)(this,t),this.transitions=new Map,this.timeline=e}return Object(d.a)(t,[{key:"add",value:function(t,e,n,r){var i=this.transitions;if(i.has(t)){var a=i.get(t),o=a.value;e=void 0===o?a.settings.fromValue:o,this.remove(t)}if(r=We(r)){var s=En[r.type];if(s){var c=new s(this.timeline);c.start(Rn(Rn({},r),{},{fromValue:e,toValue:n})),i.set(t,c)}else q.error("unsupported transition type '".concat(r.type,"'"))()}}},{key:"remove",value:function(t){var e=this.transitions;e.has(t)&&(e.get(t).cancel(),e.delete(t))}},{key:"update",value:function(){var t,e={},n=An(this.transitions);try{for(n.s();!(t=n.n()).done;){var r=Object(E.a)(t.value,2),i=r[0],a=r[1];a.update(),e[i]=a.value,a.inProgress||this.remove(i)}}catch(o){n.e(o)}finally{n.f()}return e}},{key:"clear",value:function(){var t,e=An(this.transitions.keys());try{for(e.s();!(t=e.n()).done;){var n=t.value;this.remove(n)}}catch(r){e.e(r)}finally{e.f()}}},{key:"active",get:function(){return this.transitions.size>0}}]),t}(),In="Awaiting state",Dn="Matched. State transferred from previous layer",zn="Initialized",Fn="Discarded. Awaiting garbage collection",Nn="No longer matched. Awaiting garbage collection",Vn="Finalized! Awaiting garbage collection",Un={COMPONENT:Symbol.for("component"),ASYNC_DEFAULTS:Symbol.for("asyncPropDefaults"),ASYNC_ORIGINAL:Symbol.for("asyncPropOriginal"),ASYNC_RESOLVED:Symbol.for("asyncPropResolved")},Bn=Un.COMPONENT;function Gn(t,e){var n=Zn({newProps:t,oldProps:e,propTypes:Hn(t),ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=function(t,e){if(null===e)return"oldProps is null, initial diff";var n=null,r=t.dataComparator,i=t._dataDiff;r?r(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied");n&&i&&(n=i(t.data,e.data)||n);return n}(t,e),i=!1;return r||(i=function(t,e){if(null===e)return"oldProps is null, initial diff";if("all"in t.updateTriggers){if(Jn(t,e,"all"))return{all:!0}}var n={},r=!1;for(var i in t.updateTriggers){if("all"!==i)Jn(t,e,i)&&(n[i]=!0,r=n)}return r}(t,e)),{dataChanged:r,propsChanged:n,updateTriggersChanged:i,extensionsChanged:Yn(t,e),transitionsChanged:Wn(t,e)}}function Wn(t,e){if(!t.transitions)return null;var n={},r=Hn(t);for(var i in t.transitions){var a=r[i],o=a&&a.type;("number"===o||"color"===o||"array"===o)&&qn(t[i],e[i],a)&&(n[i]=!0)}return n}function Zn(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.newProps,n=t.oldProps,r=t.ignoreProps,i=void 0===r?{}:r,a=t.propTypes,o=void 0===a?{}:a,s=t.triggerName,c=void 0===s?"props":s;if(n===e)return null;if("object"!==Object(v.a)(e)||null===e)return"".concat(c," changed shallowly");if("object"!==Object(v.a)(n)||null===n)return"".concat(c," changed shallowly");for(var u=0,l=Object.keys(e);u<l.length;u++){var h=l[u];if(!(h in i)){if(!(h in n))return"".concat(c,".").concat(h," added");var f=qn(e[h],n[h],o[h]);if(f)return"".concat(c,".").concat(h," ").concat(f)}}for(var p=0,d=Object.keys(n);p<d.length;p++){var y=d[p];if(!(y in i)){if(!(y in e))return"".concat(c,".").concat(y," dropped");if(!Object.hasOwnProperty.call(e,y)){var g=qn(e[y],n[y],o[y]);if(g)return"".concat(c,".").concat(y," ").concat(g)}}}return null}function qn(t,e,n){var r=n&&n.equal;return r&&!r(t,e,n)?"changed deeply":r||!(r=t&&e&&t.equals)||r.call(t,e)?r||e===t?null:"changed shallowly":"changed deeply"}function Yn(t,e){if(null===e)return"oldProps is null, initial diff";var n=e.extensions,r=t.extensions;if(r===n)return!1;if(r.length!==n.length)return!0;for(var i=0;i<r.length;i++)if(!r[i].equals(n[i]))return!0;return!1}function Jn(t,e,n){var r=t.updateTriggers[n];r=void 0===r||null===r?{}:r;var i=e.updateTriggers[n];return Zn({oldProps:i=void 0===i||null===i?{}:i,newProps:r,triggerName:n})}function Hn(t){var e=t[Bn],n=e&&e.constructor;return n?n._propTypes:{}}function Kn(t){if(null===(e=t)||"object"!==Object(v.a)(e))throw new Error("count(): argument not an object");var e;if("function"===typeof t.count)return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(function(t){return null!==t&&"object"===Object(v.a)(t)&&t.constructor===Object}(t))return Object.keys(t).length;throw new Error("count(): argument not a container")}var Xn=n(8);function $n(t,e){if(t===e)return!0;if(Array.isArray(t)){var n=t.length;if(!e||e.length!==n)return!1;for(var r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return!1}function Qn(t){var e,n={};return function(r){for(var i in r)if(!$n(r[i],n[i])){e=t(r),n=r;break}return e}}function tr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function er(t,e){if(!e)return t;var n=Object.assign({},t,e);if("defines"in e&&(n.defines=Object.assign({},t.defines,e.defines)),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some((function(t){return"project64"===t.name})))){var r=n.modules.findIndex((function(t){return"project32"===t.name}));r>=0&&n.modules.splice(r,1)}if("inject"in e)if(t.inject){var i=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?tr(Object(n),!0).forEach((function(e){Object(T.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):tr(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},t.inject);for(var a in e.inject)i[a]=(i[a]||"")+e.inject[a];n.inject=i}else n.inject=e.inject;return n}var nr=n(36),rr=[0,0,0,0],ir=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],ar=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],or=[0,0,0],sr=[0,0,0],cr=Qn((function(t){var e=t.viewport,n=t.devicePixelRatio,r=t.coordinateSystem,i=t.coordinateOrigin,a=function(t,e,n){var r=t.viewMatrixUncentered,i=t.projectionMatrix,a=t.viewMatrix,o=t.viewProjectionMatrix,s=rr,c=t.cameraPosition,u=ur(t,e,n),l=u.geospatialOrigin,h=u.shaderCoordinateOrigin;if(u.offsetMode){var f=t.projectPosition(l||h);c=[c[0]-f[0],c[1]-f[1],c[2]-f[2]],f[3]=1,s=nr.n([],f,o),a=r||a,o=it.h([],i,a),o=it.h([],o,ir)}return{viewMatrix:a,viewProjectionMatrix:o,projectionCenter:s,cameraPosCommon:c,shaderCoordinateOrigin:h,geospatialOrigin:l}}(e,r,i),o=a.projectionCenter,s=a.viewProjectionMatrix,c=a.cameraPosCommon,u=a.shaderCoordinateOrigin,l=a.geospatialOrigin,h=e.getDistanceScales(),f=[e.width*n,e.height*n],p={project_uCoordinateSystem:r,project_uProjectionMode:e.projectionMode,project_uCoordinateOrigin:u,project_uCenter:o,project_uAntimeridian:(e.longitude||0)-180,project_uViewportSize:f,project_uDevicePixelRatio:n,project_uFocalDistance:e.focalDistance||1,project_uCommonUnitsPerMeter:h.unitsPerMeter,project_uCommonUnitsPerWorldUnit:h.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:or,project_uScale:e.scale,project_uViewProjectionMatrix:s,project_uCameraPosition:c};if(l){var d=e.getDistanceScales(l);switch(r){case ot.METER_OFFSETS:p.project_uCommonUnitsPerWorldUnit=d.unitsPerMeter,p.project_uCommonUnitsPerWorldUnit2=d.unitsPerMeter2;break;case ot.LNGLAT:case ot.LNGLAT_OFFSETS:p.project_uCommonUnitsPerWorldUnit=d.unitsPerDegree,p.project_uCommonUnitsPerWorldUnit2=d.unitsPerDegree2;break;case ot.CARTESIAN:p.project_uCommonUnitsPerWorldUnit=[1,1,d.unitsPerMeter[2]],p.project_uCommonUnitsPerWorldUnit2=[0,0,d.unitsPerMeter2[2]]}}return p}));function ur(t,e){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:sr,i=r,a=!0;switch(n=e===ot.LNGLAT_OFFSETS||e===ot.METER_OFFSETS?r:t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case st.WEB_MERCATOR:e!==ot.LNGLAT&&e!==ot.CARTESIAN||(a=!1);break;case st.WEB_MERCATOR_AUTO_OFFSET:e===ot.LNGLAT?i=n:e===ot.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],n=t.unprojectPosition(i),i[0]-=r[0],i[1]-=r[1],i[2]-=r[2]);break;case st.IDENTITY:i=t.position.map(Math.fround);break;case st.GLOBE:a=!1,n=null;break;default:a=!1}return i[2]=i[2]||0,{geospatialOrigin:n,shaderCoordinateOrigin:i,offsetMode:a}}function lr(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.viewport,n=t.devicePixelRatio,r=void 0===n?1:n,i=t.modelMatrix,a=void 0===i?null:i,o=t.coordinateSystem,s=void 0===o?ot.DEFAULT:o,c=t.coordinateOrigin,u=t.autoWrapLongitude,l=void 0!==u&&u;t.projectionMode,t.positionOrigin;bt(e),s===ot.DEFAULT&&(s=e.isGeospatial?ot.LNGLAT:ot.CARTESIAN);var h=cr({viewport:e,devicePixelRatio:r,coordinateSystem:s,coordinateOrigin:c});return h.project_uWrapLongitude=l,h.project_uModelMatrix=a||ar,h}var hr=n(34);function fr(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.projectPosition(t);if(n&&e instanceof xt){var i=Object(E.a)(t,3),a=i[0],o=i[1],s=i[2],c=void 0===s?0:s,u=e.getDistanceScales([a,o]);r[2]=c*u.unitsPerMeter[2]}return r}function pr(t,e){var n=e.viewport,r=e.modelMatrix,i=e.coordinateSystem,a=e.coordinateOrigin,o=e.offsetMode,s=Object(E.a)(t,3),c=s[0],u=s[1],l=s[2],h=void 0===l?0:l;if(r){var f=nr.n([],[c,u,h,1],r),p=Object(E.a)(f,3);c=p[0],u=p[1],h=p[2]}switch(i){case ot.LNGLAT:return fr([c,u,h],n,o);case ot.LNGLAT_OFFSETS:return fr([c+a[0],u+a[1],h+(a[2]||0)],n,o);case ot.METER_OFFSETS:return fr(Object(at.a)(a,[c,u,h]),n,o);case ot.CARTESIAN:default:return n.isGeospatial?[c+a[0],u+a[1],h+a[2]]:n.projectPosition([c,u,h])}}function dr(t,e){var n=function(t){var e=Object.assign({},t),n=t.coordinateSystem,r=t.viewport,i=t.coordinateOrigin,a=t.fromCoordinateSystem,o=t.fromCoordinateOrigin;return n===ot.DEFAULT&&(n=r.isGeospatial?ot.LNGLAT:ot.CARTESIAN),void 0===a&&(e.fromCoordinateSystem=n),void 0===o&&(e.fromCoordinateOrigin=i),e.coordinateSystem=n,e}(e),r=n.viewport,i=n.coordinateSystem,a=n.coordinateOrigin,o=n.modelMatrix,s=n.fromCoordinateSystem,c=n.fromCoordinateOrigin,u=ur(r,i,a),l=u.geospatialOrigin,h=u.shaderCoordinateOrigin,f=u.offsetMode,p=pr(t,{viewport:r,modelMatrix:o,coordinateSystem:s,coordinateOrigin:c,offsetMode:f});if(f){var d=r.projectPosition(l||h);hr.l(p,p,d)}return p}var vr={boolean:{validate:function(t,e){return!0},equal:function(t,e,n){return Boolean(t)===Boolean(e)}},number:{validate:function(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate:function(t,e){return e.optional&&!t||mr(t)&&(3===t.length||4===t.length)},equal:function(t,e,n){return yr(t,e)}},accessor:{validate:function(t,e){var n=wr(t);return"function"===n||n===wr(e.value)},equal:function(t,e,n){return"function"===typeof e||yr(t,e)}},array:{validate:function(t,e){return e.optional&&!t||mr(t)},equal:function(t,e,n){return n.compare?yr(t,e):t===e}},function:{validate:function(t,e){return e.optional&&!t||"function"===typeof t},equal:function(t,e,n){return!n.compare||t===e}}};function yr(t,e){if(t===e)return!0;if(!mr(t)||!mr(e))return!1;var n=t.length;if(n!==e.length)return!1;for(var r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}function gr(t,e){switch(wr(e)){case"object":return br(t,e);case"array":return br(t,{type:"array",value:e,compare:!1});case"boolean":return br(t,{type:"boolean",value:e});case"number":return br(t,{type:"number",value:e});case"function":return br(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function br(t,e){return"type"in e?Object.assign({name:t},vr[e.type],e):"value"in e?Object.assign({name:t,type:wr(e.value)},e):{name:t,type:"object",value:e}}function mr(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function wr(t){return mr(t)?"array":null===t?"null":Object(v.a)(t)}function Or(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return jr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return jr(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function jr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var _r=Un.COMPONENT,Pr=Un.ASYNC_ORIGINAL,Sr=Un.ASYNC_RESOLVED,kr=Un.ASYNC_DEFAULTS;function xr(){var t=this,e=Cr(t.constructor),n=Object.create(e);n[_r]=t,n[Pr]={},n[Sr]={};for(var r=0;r<arguments.length;++r){var i=arguments[r];for(var a in i)n[a]=i[a]}return Object.freeze(n),n}function Cr(t){var e=Lr(t,"_mergedDefaultProps");return e||(function(t){if(!t.prototype)return;var e=Object.getPrototypeOf(t),n=Cr(e),r=function(t){for(var e={},n={},r={},i=0,a=Object.entries(t);i<a.length;i++){var o=Object(E.a)(a[i],2),s=o[0],c=o[1];if(c&&c.deprecatedFor)r[s]=Array.isArray(c.deprecatedFor)?c.deprecatedFor:[c.deprecatedFor];else{var u=gr(s,c);e[s]=u,n[s]=u.value}}return{propTypes:e,defaultProps:n,deprecatedProps:r}}(Lr(t,"defaultProps")||{}),i=function(t,e,n){var r=Object.create(null);Object.assign(r,e,t);var i=function(t){var e=Lr(t,"layerName")||Lr(t,"componentName");e||q.once(0,"".concat(t.name,".componentName not specified"))();return e||t.name}(n);return delete t.id,Object.defineProperties(r,{id:{writable:!0,value:i}}),r}(r.defaultProps,n,t),a=Object.assign({},e._propTypes,r.propTypes);!function(t,e){var n={},r={};for(var i in e){var a=e[i],o=a.name,s=a.value;a.async&&(n[o]=s,r[o]=Ar(o))}t[kr]=n,t[Pr]={},Object.defineProperties(t,r)}(i,a);var o=Object.assign({},e._deprecatedProps,r.deprecatedProps);(function(t,e){var n=function(n){Object.defineProperty(t,n,{enumerable:!1,set:function(t){var r,i="".concat(this.id,": ").concat(n),a=Or(e[n]);try{for(a.s();!(r=a.n()).done;){var o=r.value;Mr(this,o)||(this[o]=t)}}catch(s){a.e(s)}finally{a.f()}q.deprecated(i,e[n].join("/"))()}})};for(var r in e)n(r)})(i,o),t._mergedDefaultProps=i,t._propTypes=a,t._deprecatedProps=o}(t),t._mergedDefaultProps)}function Ar(t){return{enumerable:!0,set:function(e){"string"===typeof e||e instanceof Promise||Te(e)?this[Pr][t]=e:this[Sr][t]=e},get:function(){if(this[Sr]){if(t in this[Sr])return this[Sr][t]||this[kr][t];if(t in this[Pr]){var e=this[_r]&&this[_r].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[kr][t]}}return this[kr][t]}}}function Mr(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Lr(t,e){return Mr(t,e)&&t[e]}var Rr=n(86),Er=Un.ASYNC_ORIGINAL,Tr=Un.ASYNC_RESOLVED,Ir=Un.ASYNC_DEFAULTS,Dr=Object.freeze({}),zr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Object(p.a)(this,t),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=function(){},this.oldProps=Dr,this.oldAsyncProps=null}return Object(d.a)(t,[{key:"getOldProps",value:function(){return this.oldAsyncProps||this.oldProps}},{key:"resetOldProps",value:function(){this.oldAsyncProps=null,this.oldProps=this.component.props}},{key:"freezeAsyncOldProps",value:function(){if(!this.oldAsyncProps)for(var t in this.oldProps=this.oldProps||this.component.props,this.oldAsyncProps=Object.create(this.oldProps),this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}},{key:"hasAsyncProp",value:function(t){return t in this.asyncProps}},{key:"getAsyncProp",value:function(t){var e=this.asyncProps[t];return e&&e.resolvedValue}},{key:"isAsyncPropLoading",value:function(t){if(t){var e=this.asyncProps[t];return Boolean(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}for(var n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}},{key:"reloadAsyncProp",value:function(t,e){this._watchPromise(t,Promise.resolve(e))}},{key:"setAsyncProps",value:function(t){var e=t[Tr]||{},n=t[Er]||t,r=t[Ir]||{};for(var i in e){var a=e[i];this._createAsyncPropData(i,a,r[i]),this._updateAsyncProp(i,a)}for(var o in n){var s=n[o];this._createAsyncPropData(o,s,r[o]),this._updateAsyncProp(o,s)}}},{key:"_updateAsyncProp",value:function(t,e){if(this._didAsyncInputValueChange(t,e)){if("string"===typeof e){var n=this.layer&&this.layer.props.fetch;n&&(e=n(e,{propName:t,layer:this.layer}))}e instanceof Promise?this._watchPromise(t,e):Te(e)?this._resolveAsyncIterable(t,e):this._setPropValue(t,e)}}},{key:"_didAsyncInputValueChange",value:function(t,e){var n=this.asyncProps[t];return e!==n.lastValue&&(n.lastValue=e,!0)}},{key:"_setPropValue",value:function(t,e){var n=this.asyncProps[t];n.value=e,n.resolvedValue=e,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount}},{key:"_setAsyncPropValue",value:function(t,e,n){var r=this.asyncProps[t];r&&n>=r.resolvedLoadCount&&void 0!==e&&(this.freezeAsyncOldProps(),r.resolvedValue=e,r.resolvedLoadCount=n,this.onAsyncPropUpdated(t,e))}},{key:"_watchPromise",value:function(t,e){var n=this,r=this.asyncProps[t];r.pendingLoadCount++;var i=r.pendingLoadCount;e.then((function(e){e=n._postProcessValue(t,e),n._setAsyncPropValue(t,e,i);var r=n.layer&&n.layer.props.onDataLoad;"data"===t&&r&&r(e,{propName:t,layer:n.layer})})).catch((function(t){return q.error(t)()}))}},{key:"_resolveAsyncIterable",value:function(){var t=Object(be.a)(ge.a.mark((function t(e,n){var r,i,a,o,s,c,u,l,h,f,p,d;return ge.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:"data"!==e&&this._setPropValue(e,n),(r=this.asyncProps[e]).pendingLoadCount++,i=r.pendingLoadCount,a=[],o=0,s=!0,c=!1,t.prev=8,l=Object(Rr.a)(n);case 10:return t.next=12,l.next();case 12:return h=t.sent,s=h.done,t.next=16,h.value;case 16:if(f=t.sent,s){t.next=26;break}p=f,a=this._postProcessValue(e,p,a),Object.defineProperty(a,"__diff",{enumerable:!1,value:[{startRow:o,endRow:a.length}]}),o=a.length,this._setAsyncPropValue(e,a,i);case 23:s=!0,t.next=10;break;case 26:t.next=32;break;case 28:t.prev=28,t.t0=t.catch(8),c=!0,u=t.t0;case 32:if(t.prev=32,t.prev=33,s||null==l.return){t.next=37;break}return t.next=37,l.return();case 37:if(t.prev=37,!c){t.next=40;break}throw u;case 40:return t.finish(37);case 41:return t.finish(32);case 42:(d=this.layer&&this.layer.props.onDataLoad)&&d(a,{propName:e,layer:this.layer});case 44:case"end":return t.stop()}}),t,this,[[8,28,32,42],[33,,37,41]])})));return function(e,n){return t.apply(this,arguments)}}()},{key:"_postProcessValue",value:function(t,e,n){var r=(this.component?this.component.props:{}).dataTransform;return"data"!==t?e:r?r(e,n):n?n.concat(e):e}},{key:"_createAsyncPropData",value:function(t,e,n){this.asyncProps[t]||(this.asyncProps[t]={lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0})}}]),t}(),Fr=Un.ASYNC_ORIGINAL,Nr=Un.ASYNC_RESOLVED,Vr=Un.ASYNC_DEFAULTS,Ur=0,Br=function(){function t(){Object(p.a)(this,t),this.props=xr.apply(this,arguments),this.id=this.props.id,this.count=Ur++,this.lifecycle=In,this.parent=null,this.context=null,this.state=null,this.internalState=null,Object.seal(this)}return Object(d.a)(t,[{key:"clone",value:function(t){var e=this.props,n={};for(var r in e[Vr])r in e[Nr]?n[r]=e[Nr][r]:r in e[Fr]&&(n[r]=e[Fr][r]);return new this.constructor(Object.assign({},e,n,t))}},{key:"_initState",value:function(){this.internalState=new zr({})}},{key:"stats",get:function(){return this.internalState.stats}}]),t}();function Gr(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}Br.componentName="Component",Br.defaultProps={};var Wr=function(t){Object(G.a)(n,t);var e=Gr(n);function n(t){var r,i=t.attributeManager,a=t.layer;return Object(p.a)(this,n),(r=e.call(this,a)).attributeManager=i,r.model=null,r.needsRedraw=!0,r.subLayers=null,r}return Object(d.a)(n,[{key:"layer",get:function(){return this.component},set:function(t){this.component=t}}]),n}(zr),Zr=n(227);function qr(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return Yr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Yr(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Yr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Jr(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}var Hr=Object.freeze([]),Kr=Qn((function(t){var e=t.oldViewport,n=t.viewport;return e.equals(n)})),Xr=new Uint8ClampedArray(0),$r={data:{type:"data",value:Hr,async:!0},dataComparator:null,_dataDiff:{type:"function",value:function(t){return t&&t.__diff},compare:!1,optional:!0},dataTransform:{type:"function",value:null,compare:!1,optional:!0},onDataLoad:{type:"function",value:null,compare:!1,optional:!0},fetch:{type:"function",value:function(t,e){var n=e.propName,r=e.layer,i=r.context.resourceManager,a=r.getLoadOptions(),o=i.contains(t);return o||a||(i.add({resourceId:t,data:t,persistent:!1}),o=!0),o?i.subscribe({resourceId:t,onChange:function(t){return r.internalState.reloadAsyncProp(n,t)},consumerId:r.id,requestId:n}):Object(Zr.a)(t,a)},compare:!1},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:ot.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{},uniforms:{},extensions:[],getPolygonOffset:{type:"function",value:function(t){return[0,100*-t.layerIndex]},compare:!1},highlightedObjectIndex:-1,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}},Qr=function(t){Object(G.a)(n,t);var e=Jr(n);function n(){return Object(p.a)(this,n),e.apply(this,arguments)}return Object(d.a)(n,[{key:"toString",value:function(){var t=this.constructor.layerName||this.constructor.name;return"".concat(t,"({id: '").concat(this.props.id,"'})")}},{key:"setState",value:function(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}},{key:"setNeedsRedraw",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.internalState&&(this.internalState.needsRedraw=t)}},{key:"setNeedsUpdate",value:function(){this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0}},{key:"getNeedsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(t)}},{key:"needsUpdate",value:function(){return this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams())}},{key:"hasUniformTransition",value:function(){return this.internalState.uniformTransitions.active}},{key:"isPickable",value:function(){return this.props.pickable&&this.props.visible}},{key:"getModels",value:function(){return this.state&&(this.state.models||(this.state.model?[this.state.model]:[]))}},{key:"getAttributeManager",value:function(){return this.internalState&&this.internalState.attributeManager}},{key:"getCurrentLayer",value:function(){return this.internalState&&this.internalState.layer}},{key:"getLoadOptions",value:function(){return this.props.loadOptions}},{key:"project",value:function(t){var e=this.context.viewport,n=pr(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),r=Object(at.l)(n,e.pixelProjectionMatrix),i=Object(E.a)(r,3),a=i[0],o=i[1],s=i[2];return 2===t.length?[a,o]:[a,o,s]}},{key:"unproject",value:function(t){return this.context.viewport.unproject(t)}},{key:"projectPosition",value:function(t){return dr(t,{viewport:this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem})}},{key:"use64bitPositions",value:function(){var t=this.props.coordinateSystem;return t===ot.DEFAULT||t===ot.LNGLAT||t===ot.CARTESIAN}},{key:"onHover",value:function(t,e){return!!this.props.onHover&&this.props.onHover(t,e)}},{key:"onClick",value:function(t,e){return!!this.props.onClick&&this.props.onClick(t,e)}},{key:"nullPickingColor",value:function(){return[0,0,0]}},{key:"encodePickingColor",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}},{key:"decodePickingColor",value:function(t){bt(t instanceof Uint8Array);var e=Object(E.a)(t,3);return e[0]+256*e[1]+65536*e[2]-1}},{key:"initializeState",value:function(){throw new Error("Layer ".concat(this," has not defined initializeState"))}},{key:"getShaders",value:function(t){var e,n=qr(this.props.extensions);try{for(n.s();!(e=n.n()).done;){var r=e.value;t=er(t,r.getShaders.call(this,r))}}catch(i){n.e(i)}finally{n.f()}return t}},{key:"shouldUpdateState",value:function(t){t.oldProps,t.props,t.context;return t.changeFlags.propsOrDataChanged}},{key:"updateState",value:function(t){var e=t.oldProps,n=t.props,r=(t.context,t.changeFlags),i=this.getAttributeManager();if(r.dataChanged&&i){var a=r.dataChanged;if(Array.isArray(a)){var o,s=qr(a);try{for(s.s();!(o=s.n()).done;){var c=o.value;i.invalidateAll(c)}}catch(v){s.e(v)}finally{s.f()}}else i.invalidateAll()}var u=e.highlightedObjectIndex>=0||e.pickable,l=n.highlightedObjectIndex>=0||n.pickable;if(u!==l&&i){var h=i.attributes,f=h.pickingColors,p=h.instancePickingColors,d=f||p;d&&(l&&d.constant&&(d.constant=!1,i.invalidate(d.id)),d.value||l||(d.constant=!0,d.value=[0,0,0]))}}},{key:"finalizeState",value:function(){var t,e=qr(this.getModels());try{for(e.s();!(t=e.n()).done;){t.value.delete()}}catch(r){e.e(r)}finally{e.f()}var n=this.getAttributeManager();n&&n.finalize(),this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState.uniformTransitions.clear()}},{key:"draw",value:function(t){var e,n=qr(this.getModels());try{for(n.s();!(e=n.n()).done;){e.value.draw(t)}}catch(r){n.e(r)}finally{n.f()}}},{key:"getPickingInfo",value:function(t){var e=t.info,n=(t.mode,e.index);return n>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[n]),e}},{key:"activateViewport",value:function(t){var e=this.internalState.viewport;this.internalState.viewport=t,e&&Kr({oldViewport:e,viewport:t})||(this.setChangeFlags({viewportChanged:!0}),this._update())}},{key:"invalidateAttribute",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all",e=this.getAttributeManager();e&&("all"===t?e.invalidateAll():e.invalidate(t))}},{key:"updateAttributes",value:function(t){var e,n=qr(this.getModels());try{for(n.s();!(e=n.n()).done;){var r=e.value;this._setModelAttributes(r,t)}}catch(i){n.e(i)}finally{n.f()}}},{key:"_updateAttributes",value:function(t){var e=this.getAttributeManager();if(e){var n=this.getNumInstances(t),r=this.getStartIndices(t);e.update({data:t.data,numInstances:n,startIndices:r,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this,ignoreUnknownAttributes:!0});var i=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(i)}}},{key:"_updateAttributeTransition",value:function(){var t=this.getAttributeManager();t&&t.updateTransition()}},{key:"_updateUniformTransition",value:function(){var t=this.internalState.uniformTransitions;if(t.active){var e=t.update(),n=Object.create(this.props);for(var r in e)Object.defineProperty(n,r,{value:e[r]});return n}return this.props}},{key:"calculateInstancePickingColors",value:function(t,e){var n=e.numInstances;if(!t.constant){var r=Xr.length/3;if(r<n){var i=(Xr=Y.allocate(Xr,n,{size:3,copy:!0})).length/3,a=[];bt(i<16777215,"index out of picking color range");for(var o=r;o<i;o++)this.encodePickingColor(o,a),Xr[3*o+0]=a[0],Xr[3*o+1]=a[1],Xr[3*o+2]=a[2]}t.value=Xr.subarray(0,3*n)}}},{key:"_setModelAttributes",value:function(t,e){var n=this.getAttributeManager(),r=t.userData.excludeAttributes||{},i=n.getShaderAttributes(e,r);t.setAttributes(i)}},{key:"clearPickingColor",value:function(t){var e=this.getAttributeManager().attributes,n=e.pickingColors,r=e.instancePickingColors,i=n||r,a=this.decodePickingColor(t),o=i.getVertexOffset(a),s=i.getVertexOffset(a+1);i.buffer.subData({data:new Uint8Array(s-o),offset:o})}},{key:"restorePickingColors",value:function(){var t=this.getAttributeManager().attributes,e=t.pickingColors,n=t.instancePickingColors;(e||n).updateSubBuffer({startOffset:0})}},{key:"getNumInstances",value:function(t){return void 0!==(t=t||this.props).numInstances?t.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:Kn(t.data)}},{key:"getStartIndices",value:function(t){return void 0!==(t=t||this.props).startIndices?t.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}},{key:"_initialize",value:function(){en("layer.initialize",this),this._initState(),this.initializeState(this.context);var t,e=qr(this.props.extensions);try{for(e.s();!(t=e.n()).done;){var n=t.value;n.initializeState.call(this,this.context,n)}}catch(r){e.e(r)}finally{e.f()}this.setChangeFlags({dataChanged:!0,propsChanged:!0,viewportChanged:!0,extensionsChanged:!0}),this._updateState()}},{key:"_update",value:function(){var t=this.needsUpdate();en("layer.update",this,t),t&&this._updateState()}},{key:"_updateState",value:function(){var t=this.props,e=this.context.viewport,n=this._updateUniformTransition();this.internalState.propsInTransition=n,this.context.viewport=this.internalState.viewport||e,this.props=n;var r=this._getUpdateParams(),i=this.getModels();if(this.context.gl)this.updateState(r);else try{this.updateState(r)}catch(u){}var a,o=qr(this.props.extensions);try{for(o.s();!(a=o.n()).done;){var s=a.value;s.updateState.call(this,r,s)}}catch(l){o.e(l)}finally{o.f()}var c=this.getModels()[0]!==i[0];this._updateModules(r,c),this.isComposite?this._renderLayers(r):(this.setNeedsRedraw(),this._updateAttributes(this.props),this.state.model&&this.state.model.setInstanceCount(this.getNumInstances())),this.context.viewport=e,this.props=t,this.clearChangeFlags(),this.internalState.needsUpdate=!1,this.internalState.resetOldProps()}},{key:"_finalize",value:function(){en("layer.finalize",this),bt(this.internalState&&this.state),this.finalizeState(this.context);var t,e=qr(this.props.extensions);try{for(e.s();!(t=e.n()).done;){var n=t.value;n.finalizeState.call(this,n)}}catch(r){e.e(r)}finally{e.f()}}},{key:"drawLayer",value:function(t){var e=this,n=t.moduleParameters,r=void 0===n?null:n,i=t.uniforms,a=void 0===i?{}:i,o=t.parameters,s=void 0===o?{}:o;this._updateAttributeTransition();var c=this.props;this.props=this.internalState.propsInTransition||c;var u=this.props.opacity;a.opacity=Math.pow(u,1/2.2),r&&this.setModuleParameters(r);var l=this.props.getPolygonOffset,h=l&&l(a)||[0,0];Object(Xn.j)(this.context.gl,{polygonOffset:h}),Object(Xn.k)(this.context.gl,s,(function(){var t,n={moduleParameters:r,uniforms:a,parameters:s,context:e.context},i=qr(e.props.extensions);try{for(i.s();!(t=i.n()).done;){var o=t.value;o.draw.call(e,n,o)}}catch(c){i.e(c)}finally{i.f()}e.draw(n)})),this.props=c}},{key:"getChangeFlags",value:function(){return this.internalState.changeFlags}},{key:"setChangeFlags",value:function(t){var e=this.internalState.changeFlags;for(var n in t)if(t[n]){var r=!1;switch(n){case"dataChanged":Array.isArray(e[n])&&(e[n]=Array.isArray(t[n])?e[n].concat(t[n]):t[n],r=!0);default:e[n]||(e[n]=t[n],r=!0)}r&&en("layer.changeFlag",this,n,t)}var i=e.dataChanged||e.updateTriggersChanged||e.propsChanged||e.extensionsChanged;e.propsOrDataChanged=i,e.somethingChanged=i||t.viewportChanged||t.stateChanged}},{key:"clearChangeFlags",value:function(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}},{key:"diffProps",value:function(t,e){var n=Gn(t,e);if(n.updateTriggersChanged)for(var r in n.updateTriggersChanged)n.updateTriggersChanged[r]&&this.invalidateAttribute(r);if(n.transitionsChanged)for(var i in n.transitionsChanged)this.internalState.uniformTransitions.add(i,e[i],t[i],t.transitions[i]);return this.setChangeFlags(n)}},{key:"validateProps",value:function(){!function(t){var e=Hn(t);for(var n in e){var r=e[n],i=r.validate;if(i&&!i(t[n],r))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}(this.props)}},{key:"setModuleParameters",value:function(t){var e,n=qr(this.getModels());try{for(n.s();!(e=n.n()).done;){e.value.updateModuleSettings(t)}}catch(r){n.e(r)}finally{n.f()}}},{key:"_updateModules",value:function(t,e){var n=t.props,r=t.oldProps,i=n.autoHighlight,a=n.highlightedObjectIndex,o=n.highlightColor;if(e||r.autoHighlight!==i||r.highlightedObjectIndex!==a||r.highlightColor!==o){var s={};i||(s.pickingSelectedColor=null),Array.isArray(o)&&(s.pickingHighlightColor=o),Number.isInteger(a)&&(s.pickingSelectedColor=a>=0?this.encodePickingColor(a):null),this.setModuleParameters(s)}}},{key:"_getUpdateParams",value:function(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}},{key:"_getNeedsRedraw",value:function(t){if(!this.internalState)return!1;var e=!1;e=e||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags;var n=this.getAttributeManager(),r=n&&n.getNeedsRedraw(t);return e=e||r}},{key:"_getAttributeManager",value:function(){return new jn(this.context.gl,{id:this.props.id,stats:this.context.stats,timeline:this.context.timeline})}},{key:"_initState",value:function(){bt(!this.internalState&&!this.state),bt(isFinite(this.props.coordinateSystem),"".concat(this.id,": invalid coordinateSystem"));var t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Wr({attributeManager:t,layer:this}),this.clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:function(){return q.deprecated("layer.state.attributeManager","layer.getAttributeManager()"),t}}),this.internalState.layer=this,this.internalState.uniformTransitions=new Tn(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props)}},{key:"_transferState",value:function(t){en("layer.matched",this,this===t);var e=t.state,n=t.internalState;bt(e&&n),this!==t&&(this.internalState=n,this.internalState.layer=this,this.state=e,this.internalState.setAsyncProps(this.props),this.diffProps(this.props,this.internalState.getOldProps()))}},{key:"_onAsyncPropUpdated",value:function(){this.diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}},{key:"isLoaded",get:function(){return this.internalState&&!this.internalState.isAsyncPropLoading()}},{key:"wrapLongitude",get:function(){return this.props.wrapLongitude}}]),n}(Br);function ti(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return ei(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ei(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function ei(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ni(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}Qr.layerName="Layer",Qr.defaultProps=$r;var ri=function(t){Object(G.a)(n,t);var e=ni(n);function n(){return Object(p.a)(this,n),e.apply(this,arguments)}return Object(d.a)(n,[{key:"getSubLayers",value:function(){return this.internalState&&this.internalState.subLayers||[]}},{key:"initializeState",value:function(){}},{key:"setState",value:function(t){Object(me.a)(Object(Z.a)(n.prototype),"setState",this).call(this,t),this.setNeedsUpdate()}},{key:"getPickingInfo",value:function(t){var e=t.info,n=e.object;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id?Object.assign(e,{object:n.__source.object,index:n.__source.index}):e}},{key:"renderLayers",value:function(){return null}},{key:"shouldRenderSubLayer",value:function(t,e){var n=this.props._subLayerProps;return e&&e.length||n&&n[t]}},{key:"getSubLayerClass",value:function(t,e){var n=this.props._subLayerProps;return n&&n[t]&&n[t].type||e}},{key:"getSubLayerRow",value:function(t,e,n){return t.__source={parent:this,object:e,index:n},t}},{key:"getSubLayerAccessor",value:function(t){if("function"===typeof t){var e={data:this.props.data,target:[]};return function(n,r){return n.__source?(e.index=n.__source.index,t(n.__source.object,e)):t(n,r)}}return t}},{key:"getSubLayerProps",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.props,n=e.opacity,r=e.pickable,i=e.visible,a=e.parameters,o=e.getPolygonOffset,s=e.highlightedObjectIndex,c=e.autoHighlight,u=e.highlightColor,l=e.coordinateSystem,h=e.coordinateOrigin,f=e.wrapLongitude,p=e.positionFormat,d=e.modelMatrix,v=e.extensions,y=e._subLayerProps,g={opacity:n,pickable:r,visible:i,parameters:a,getPolygonOffset:o,highlightedObjectIndex:s,autoHighlight:c,highlightColor:u,coordinateSystem:l,coordinateOrigin:h,wrapLongitude:f,positionFormat:p,modelMatrix:d,extensions:v},b=y&&y[t.id],m=b&&b.updateTriggers,w=t.id||"sublayer";if(b){var O=this.constructor._propTypes;for(var j in b){var _=O[j];_&&"accessor"===_.type&&(b[j]=this.getSubLayerAccessor(b[j]))}}Object.assign(g,t,b,{id:"".concat(this.props.id,"-").concat(w),updateTriggers:Object.assign({all:this.props.updateTriggers.all},t.updateTriggers,m)});var P,S=ti(v);try{for(S.s();!(P=S.n()).done;){var k=P.value,x=k.getSubLayerProps.call(this,k);x&&Object.assign(g,x,{updateTriggers:Object.assign(g.updateTriggers,x.updateTriggers)})}}catch(C){S.e(C)}finally{S.f()}return g}},{key:"_getAttributeManager",value:function(){return null}},{key:"_renderLayers",value:function(){var t=this.internalState.subLayers,e=!t||this.needsUpdate();e&&(t=De(t=this.renderLayers(),Boolean),this.internalState.subLayers=t),en("compositeLayer.renderLayers",this,e,t);var n,r=ti(t);try{for(r.s();!(n=r.n()).done;){n.value.parent=this}}catch(i){r.e(i)}finally{r.f()}}},{key:"isComposite",get:function(){return!0}},{key:"isLoaded",get:function(){return Object(me.a)(Object(Z.a)(n.prototype),"isLoaded",this)&&this.getSubLayers().every((function(t){return t.isLoaded}))}}]),n}(Qr);ri.layerName="CompositeLayer";var ii=n(15),ai=n(232),oi=n(222),si=Object.keys(ot).map((function(t){return"const int COORDINATE_SYSTEM_".concat(t," = ").concat(ot[t],";")})).join(""),ci=Object.keys(st).map((function(t){return"const int PROJECTION_MODE_".concat(t," = ").concat(st[t],";")})).join(""),ui="".concat(si,"\n").concat(ci,"\n\nuniform int project_uCoordinateSystem;\nuniform int project_uProjectionMode;\nuniform float project_uScale;\nuniform bool project_uWrapLongitude;\nuniform float project_uAntimeridian;\nuniform vec3 project_uCommonUnitsPerMeter;\nuniform vec3 project_uCommonUnitsPerWorldUnit;\nuniform vec3 project_uCommonUnitsPerWorldUnit2;\nuniform vec4 project_uCenter;\nuniform mat4 project_uModelMatrix;\nuniform mat4 project_uViewProjectionMatrix;\nuniform vec2 project_uViewportSize;\nuniform float project_uDevicePixelRatio;\nuniform float project_uFocalDistance;\nuniform vec3 project_uCameraPosition;\nuniform vec3 project_uCoordinateOrigin;\n\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec3 ZERO_64_LOW = vec3(0.0);\nconst float EARTH_RADIUS = 6370972.0;\nconst float GLOBE_RADIUS = 256.0;\nfloat project_size(float meters) {\n  return meters * project_uCommonUnitsPerMeter.z;\n}\n\nvec2 project_size(vec2 meters) {\n  return meters * project_uCommonUnitsPerMeter.xy;\n}\n\nvec3 project_size(vec3 meters) {\n  return meters * project_uCommonUnitsPerMeter;\n}\n\nvec4 project_size(vec4 meters) {\n  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);\n}\nvec3 project_normal(vec3 vector) {\n  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);\n  return normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);\n}\n\nvec4 project_offset_(vec4 offset) {\n  float dy = offset.y;\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n    dy = clamp(dy, -1., 1.);\n  }\n  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;\n  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\nvec2 project_mercator_(vec2 lnglat) {\n  float x = lnglat.x;\n  if (project_uWrapLongitude) {\n    x = mod(x - project_uAntimeridian, 360.0) + project_uAntimeridian;\n  }\n  float y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2(\n    radians(x) + PI,\n    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))\n  );\n}\n\nvec3 project_globe_(vec3 lnglatz) {\n  float lambda = radians(lnglatz.x);\n  float phi = radians(lnglatz.y);\n  float cosPhi = cos(phi);\n  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\n\n  return vec3(\n    sin(lambda) * cosPhi,\n    -cos(lambda) * cosPhi,\n    sin(phi)\n  ) * D;\n}\nvec4 project_position(vec4 position, vec3 position64Low) {\n  vec4 position_world = project_uModelMatrix * position;\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4(\n        project_mercator_(position_world.xy) * WORLD_SCALE,\n        project_size(position_world.z),\n        position_world.w\n      );\n    }\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\n      position_world.xyz += project_uCoordinateOrigin;\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4(\n        project_globe_(position_world.xyz),\n        position_world.w\n      );\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||\n    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\n    position_world.xyz -= project_uCoordinateOrigin;\n  }\n  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));\n}\n\nvec4 project_position(vec4 position) {\n  return project_position(position, ZERO_64_LOW);\n}\n\nvec3 project_position(vec3 position, vec3 position64Low) {\n  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);\n  return projected_position.xyz;\n}\n\nvec3 project_position(vec3 position) {\n  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);\n  return projected_position.xyz;\n}\n\nvec2 project_position(vec2 position) {\n  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);\n  return projected_position.xy;\n}\n\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\n  return viewProjectionMatrix * position + center;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;\n  return offset * project_uFocalDistance;\n}\n\nfloat project_size_to_pixel(float meters) {\n  return project_size(meters) * project_uScale;\n}\nfloat project_pixel_size(float pixels) {\n  return pixels / project_uScale;\n}\nvec2 project_pixel_size(vec2 pixels) {\n  return pixels / project_uScale;\n}\nmat3 project_get_orientation_matrix(vec3 up) {\n  vec3 uz = normalize(up);\n  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));\n  vec3 uy = cross(uz, ux);\n  return mat3(ux, uy, uz);\n}\n\nbool project_needs_rotation(vec3 commonPosition, out mat3 transform) {\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    transform = project_get_orientation_matrix(commonPosition);\n    return true;\n  }\n  return false;\n}\n"),li={};var hi={name:"project",dependencies:[oi.a],vs:ui,getUniforms:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:li;return t.viewport?lr(t):{}}},fi={name:"project32",dependencies:[hi],vs:"\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64Low);\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    // offset is specified as ENU\n    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe\n    mat3 rotation = project_get_orientation_matrix(projectedPosition);\n    offset = rotation * offset;\n  }\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64Low, offset, commonPosition);\n}\n"},pi=n(223),di=Object.assign({inject:{"vs:DECKGL_FILTER_COLOR":"\n    picking_setPickingColor(geometry.pickingColor);\n    // for picking depth values\n    picking_setPickingAttribute(geometry.position.z);\n    ","fs:DECKGL_FILTER_COLOR":{order:99,injection:"\n    // use highlight color if this fragment belongs to the selected object.\n    color = picking_filterHighlightColor(color);\n\n    // use picking color if rendering to picking FBO.\n    color = picking_filterPickingColor(color);\n      "}}},pi.a),vi=n(155),yi=n(225);function gi(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}var bi=[0,0,0,255],mi={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,getPosition:{type:"accessor",value:function(t){return t.position}},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:bi},getLineColor:{type:"accessor",value:bi},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},wi=function(t){Object(G.a)(n,t);var e=gi(n);function n(){return Object(p.a)(this,n),e.apply(this,arguments)}return Object(d.a)(n,[{key:"getShaders",value:function(t){return Object(me.a)(Object(Z.a)(n.prototype),"getShaders",this).call(this,{vs:"#define SHADER_NAME scatterplot-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceRadius;\nattribute float instanceLineWidths;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusScale;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float lineWidthScale;\nuniform float lineWidthMinPixels;\nuniform float lineWidthMaxPixels;\nuniform float stroked;\nuniform bool filled;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\nvarying float outerRadiusPixels;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  outerRadiusPixels = clamp(\n    project_size_to_pixel(radiusScale * instanceRadius),\n    radiusMinPixels, radiusMaxPixels\n  );\n  float lineWidthPixels = clamp(\n    project_size_to_pixel(lineWidthScale * instanceLineWidths),\n    lineWidthMinPixels, lineWidthMaxPixels\n  );\n  outerRadiusPixels += stroked * lineWidthPixels / 2.0;\n  unitPosition = positions.xy;\n  geometry.uv = unitPosition;\n  geometry.pickingColor = instancePickingColors;\n\n  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;\n  \n  vec3 offset = positions * project_pixel_size(outerRadiusPixels);\n  DECKGL_FILTER_SIZE(offset, geometry);\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);\n  DECKGL_FILTER_COLOR(vFillColor, geometry);\n  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);\n  DECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#define SHADER_NAME scatterplot-layer-fragment-shader\n\nprecision highp float;\n\nuniform bool filled;\nuniform float stroked;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\nvarying float outerRadiusPixels;\n\nvoid main(void) {\n  geometry.uv = unitPosition;\n\n  float distToCenter = length(unitPosition) * outerRadiusPixels;\n  float inCircle = smoothedge(distToCenter, outerRadiusPixels);\n\n  if (inCircle == 0.0) {\n    discard;\n  }\n\n  if (stroked > 0.5) {\n    float isLine = smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter);\n    if (filled) {\n      gl_FragColor = mix(vFillColor, vLineColor, isLine);\n    } else {\n      if (isLine == 0.0) {\n        discard;\n      }\n      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);\n    }\n  } else if (filled) {\n    gl_FragColor = vFillColor;\n  } else {\n    discard;\n  }\n\n  gl_FragColor.a *= inCircle;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[fi,di]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}},{key:"updateState",value:function(t){var e=t.props,r=t.oldProps,i=t.changeFlags;if(Object(me.a)(Object(Z.a)(n.prototype),"updateState",this).call(this,{props:e,oldProps:r,changeFlags:i}),i.extensionsChanged){var a=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(a)}),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(t){var e=t.uniforms,n=this.context.viewport,r=this.props,i=r.radiusUnits,a=r.radiusScale,o=r.radiusMinPixels,s=r.radiusMaxPixels,c=r.stroked,u=r.filled,l=r.lineWidthUnits,h=r.lineWidthScale,f=r.lineWidthMinPixels,p=r.lineWidthMaxPixels,d="pixels"===i?n.metersPerPixel:1,v="pixels"===l?n.metersPerPixel:1;this.state.model.setUniforms(e).setUniforms({stroked:c?1:0,filled:u,radiusScale:a*d,radiusMinPixels:o,radiusMaxPixels:s,lineWidthScale:h*v,lineWidthMinPixels:f,lineWidthMaxPixels:p}).draw()}},{key:"_getModel",value:function(t){return new vi.a(t,Object.assign(this.getShaders(),{id:this.props.id,geometry:new yi.a({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0])}}}),isInstanced:!0}))}}]),n}(Qr);function Oi(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return ji(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ji(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function ji(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}wi.layerName="ScatterplotLayer",wi.defaultProps=mi;var _i=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(p.a)(this,t);var n=e.attributes,r=void 0===n?{}:n;this.typedArrayManager=Y,this.indexStarts=null,this.vertexStarts=null,this.vertexCount=0,this.instanceCount=0,this.attributes={},this._attributeDefs=r,this.opts=e,this.updateGeometry(e),Object.seal(this)}return Object(d.a)(t,[{key:"updateGeometry",value:function(t){Object.assign(this.opts,t);var e=this.opts,n=e.data,r=e.buffers,i=void 0===r?{}:r,a=e.getGeometry,o=e.geometryBuffer,s=e.positionFormat,c=e.dataChanged,u=e.normalize,l=void 0===u||u;if(this.data=n,this.getGeometry=a,this.positionSize=o&&o.size||("XY"===s?2:3),this.buffers=i,this.normalize=l,o&&(bt(n.startIndices,"binary data missing startIndices"),this.getGeometry=this.getGeometryFromBuffer(o),l||(i.positions=o)),this.geometryBuffer=i.positions,Array.isArray(c)){var h,f=Oi(c);try{for(f.s();!(h=f.n()).done;){var p=h.value;this._rebuildGeometry(p)}}catch(d){f.e(d)}finally{f.f()}}else this._rebuildGeometry()}},{key:"updatePartialGeometry",value:function(t){var e=t.startRow,n=t.endRow;this._rebuildGeometry({startRow:e,endRow:n})}},{key:"normalizeGeometry",value:function(t){return t}},{key:"updateGeometryAttributes",value:function(t,e,n){throw new Error("Not implemented")}},{key:"getGeometrySize",value:function(t){throw new Error("Not implemented")}},{key:"getGeometryFromBuffer",value:function(t){var e=t.value||t;return bt(ArrayBuffer.isView(e),"cannot read geometries"),Ie(e,{size:this.positionSize,offset:t.offset,stride:t.stride,startIndices:this.data.startIndices})}},{key:"_allocate",value:function(t,e){var n=this.attributes,r=this.buffers,i=this._attributeDefs,a=this.typedArrayManager;for(var o in i)if(o in r)a.release(n[o]),n[o]=null;else{var s=i[o];s.copy=e,n[o]=a.allocate(n[o],t,s)}}},{key:"_forEachGeometry",value:function(t,e,n){var r,i=this.data,a=this.getGeometry,o=Ee(i,e,n),s=o.iterable,c=o.objectInfo,u=Oi(s);try{for(u.s();!(r=u.n()).done;){var l=r.value;c.index++,t(a(l,c),c.index)}}catch(h){u.e(h)}finally{u.f()}}},{key:"_rebuildGeometry",value:function(t){var e=this;if(this.data&&this.getGeometry){var n=this.indexStarts,r=this.vertexStarts,i=this.instanceCount,a=this.data,o=this.geometryBuffer,s=t||{},c=s.startRow,u=void 0===c?0:c,l=s.endRow,h=void 0===l?1/0:l,f={};if(t||(n=[0],r=[0]),this.normalize||!o)this._forEachGeometry((function(t,n){t=e.normalizeGeometry(t),f[n]=t,r[n+1]=r[n]+e.getGeometrySize(t)}),u,h),i=r[r.length-1];else if(o.buffer instanceof je.a){var p=o.stride||4*this.positionSize;r=a.startIndices,i=r[a.length]||o.buffer.byteLength/p}else{var d=o.value||o,v=o.stride/d.BYTES_PER_ELEMENT||this.positionSize;r=a.startIndices,i=r[a.length]||d.length/v}this._allocate(i,Boolean(t)),this.indexStarts=n,this.vertexStarts=r,this.instanceCount=i;var y={};this._forEachGeometry((function(t,a){t=f[a]||t,y.vertexStart=r[a],y.indexStart=n[a];var o=a<r.length-1?r[a+1]:i;y.geometrySize=o-r[a],y.geometryIndex=a,e.updateGeometryAttributes(t,y)}),u,h),this.vertexCount=n[n.length-1]}}}]),t}(),Pi=n(89);function Si(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return ki(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ki(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function ki(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function xi(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Ci(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?xi(Object(n),!0).forEach((function(e){Object(T.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):xi(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Ai(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}var Mi=function(t){Object(G.a)(n,t);var e=Ai(n);function n(t){return Object(p.a)(this,n),e.call(this,Ci(Ci({},t),{},{attributes:{positions:{size:3,padding:18,initialize:!0,type:t.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}}))}return Object(d.a)(n,[{key:"getGeometryFromBuffer",value:function(t){return this.normalize?Object(me.a)(Object(Z.a)(n.prototype),"getGeometryFromBuffer",this).call(this,t):function(){return null}}},{key:"normalizeGeometry",value:function(t){return this.normalize?function(t,e,n,r){var i=t;if(Array.isArray(t[0])){var a=t.length*e;i=new Array(a);for(var o=0;o<t.length;o++)for(var s=0;s<e;s++)i[o*e+s]=t[o][s]||0}return n?Object(Pi.c)(i,{size:e,gridResolution:n}):r?Object(Pi.d)(i,{size:e}):i}(t,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):t}},{key:"get",value:function(t){return this.attributes[t]}},{key:"getGeometrySize",value:function(t){if(Array.isArray(t[0])){var e,n=0,r=Si(t);try{for(r.s();!(e=r.n()).done;){var i=e.value;n+=this.getGeometrySize(i)}}catch(o){r.e(o)}finally{r.f()}return n}var a=this.getPathLength(t);return a<2?0:this.isClosed(t)?a<3?0:a+2:a}},{key:"updateGeometryAttributes",value:function(t,e){if(0!==e.geometrySize)if(t&&Array.isArray(t[0])){var n,r=Si(t);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=this.getGeometrySize(i);e.geometrySize=a,this.updateGeometryAttributes(i,e),e.vertexStart+=a}}catch(o){r.e(o)}finally{r.f()}}else this._updateSegmentTypes(t,e),this._updatePositions(t,e)}},{key:"_updateSegmentTypes",value:function(t,e){var n=this.attributes.segmentTypes,r=this.isClosed(t),i=e.vertexStart,a=e.geometrySize;n.fill(0,i,i+a),r?(n[i]=4,n[i+a-2]=4):(n[i]+=1,n[i+a-2]+=2),n[i+a-1]=4}},{key:"_updatePositions",value:function(t,e){var n=this.attributes.positions;if(n)for(var r=e.vertexStart,i=e.geometrySize,a=new Array(3),o=r,s=0;s<i;o++,s++)this.getPointOnPath(t,s,a),n[3*o]=a[0],n[3*o+1]=a[1],n[3*o+2]=a[2]}},{key:"getPathLength",value:function(t){return t.length/this.positionSize}},{key:"getPointOnPath",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=this.positionSize;e*r>=t.length&&(e+=1-t.length/r);var i=e*r;return n[0]=t[i],n[1]=t[i+1],n[2]=3===r&&t[i+2]||0,n}},{key:"isClosed",value:function(t){if(!this.normalize)return this.opts.loop;var e=this.positionSize,n=t.length-e;return t[0]===t[n]&&t[1]===t[n+1]&&(2===e||t[2]===t[n+2])}}]),n}(_i);function Li(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}var Ri=[0,0,0,255],Ei={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},rounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:function(t){return t.path}},getColor:{type:"accessor",value:Ri},getWidth:{type:"accessor",value:1}},Ti={enter:function(t,e){return e.length?e.subarray(e.length-t.length):t}},Ii=function(t){Object(G.a)(n,t);var e=Li(n);function n(){return Object(p.a)(this,n),e.apply(this,arguments)}return Object(d.a)(n,[{key:"getShaders",value:function(){return Object(me.a)(Object(Z.a)(n.prototype),"getShaders",this).call(this,{vs:"#define SHADER_NAME path-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute float instanceTypes;\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec3 instanceLeftPositions;\nattribute vec3 instanceRightPositions;\nattribute vec3 instanceLeftPositions64Low;\nattribute vec3 instanceStartPositions64Low;\nattribute vec3 instanceEndPositions64Low;\nattribute vec3 instanceRightPositions64Low;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float miterLimit;\nuniform bool billboard;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\n\nconst float EPSILON = 0.001;\nconst vec3 ZERO_OFFSET = vec3(0.0);\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\nvec3 lineJoin(\n  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,\n  vec2 width\n) {\n  bool isEnd = positions.x > 0.0;\n  float sideOfPath = positions.y;\n  float isJoint = float(sideOfPath == 0.0);\n\n  vec3 deltaA3 = (currPoint - prevPoint);\n  vec3 deltaB3 = (nextPoint - currPoint);\n\n  mat3 rotationMatrix;\n  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);\n  if (needsRotation) {\n    deltaA3 = deltaA3 * rotationMatrix;\n    deltaB3 = deltaB3 * rotationMatrix;\n  }\n  vec2 deltaA = deltaA3.xy / width;\n  vec2 deltaB = deltaB3.xy / width;\n\n  float lenA = length(deltaA);\n  float lenB = length(deltaB);\n\n  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n  vec2 tangent = dirA + dirB;\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  vec2 dir = isEnd ? dirA : dirB;\n  vec2 perp = isEnd ? perpA : perpB;\n  float L = isEnd ? lenA : lenB;\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);\n  float cornerPosition = sideOfPath * turnDirection;\n\n  float miterSize = 1.0 / max(sinHalfA, EPSILON);\n  miterSize = mix(\n    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),\n    miterSize,\n    step(0.0, cornerPosition)\n  );\n\n  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))\n    * (sideOfPath + isJoint * turnDirection);\n  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));\n  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));\n  bool isCap = isStartCap || isEndCap;\n  if (isCap) {\n    offsetVec = mix(perp * sideOfPath, dir * jointType * 4.0 * flipIfTrue(isStartCap), isJoint);\n  }\n  vPathLength = L;\n  vCornerOffset = offsetVec;\n  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);\n  vMiterLength = isCap ? isJoint : vMiterLength;\n\n  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);\n  vPathPosition = vec2(\n    dot(offsetFromStartOfPath, perp),\n    dot(offsetFromStartOfPath, dir)\n  );\n  geometry.uv = vPathPosition;\n\n  float isValid = step(instanceTypes, 3.5);\n  vec3 offset = vec3(offsetVec * width * isValid, 0.0);\n\n  if (needsRotation) {\n    offset = rotationMatrix * offset;\n  }\n  return currPoint + offset;\n}\nvoid clipLine(inout vec4 position, vec4 refPosition) {\n  if (position.w < EPSILON) {\n    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);\n    position = refPosition + (position - refPosition) * r;\n  }\n}\n\nvoid main() {\n  geometry.worldPosition = instanceStartPositions;\n  geometry.worldPositionAlt = instanceEndPositions;\n  geometry.pickingColor = instancePickingColors;\n\n  vec2 widthPixels = vec2(clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n    widthMinPixels, widthMaxPixels) / 2.0);\n  vec3 width;\n\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);\n\n  float isEnd = positions.x;\n\n  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\n  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);\n\n  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\n  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);\n\n  if (billboard) {\n    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);\n    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);\n    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);\n\n    clipLine(prevPositionScreen, currPositionScreen);\n    clipLine(nextPositionScreen, currPositionScreen);\n    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));\n\n    width = vec3(widthPixels, 0.0);\n    DECKGL_FILTER_SIZE(width, geometry);\n\n    vec3 pos = lineJoin(\n      prevPositionScreen.xyz / prevPositionScreen.w,\n      currPositionScreen.xyz / currPositionScreen.w,\n      nextPositionScreen.xyz / nextPositionScreen.w,\n      project_pixel_size_to_clipspace(width.xy)\n    );\n\n    gl_Position = vec4(pos * currPositionScreen.w, currPositionScreen.w);\n  } else {\n    prevPosition = project_position(prevPosition, prevPosition64Low);\n    currPosition = project_position(currPosition, currPosition64Low);\n    nextPosition = project_position(nextPosition, nextPosition64Low);\n\n    width = vec3(project_pixel_size(widthPixels), 0.0);\n    DECKGL_FILTER_SIZE(width, geometry);\n\n    vec4 pos = vec4(\n      lineJoin(prevPosition, currPosition, nextPosition, width.xy),\n      1.0);\n    geometry.position = pos;\n    gl_Position = project_common_position_to_clipspace(pos);\n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME path-layer-fragment-shader\n\nprecision highp float;\n\nuniform float jointType;\nuniform float miterLimit;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\n\nvoid main(void) {\n  geometry.uv = vPathPosition;\n\n  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {\n    if (jointType > 0.0 && length(vCornerOffset) > 1.0) {\n      discard;\n    }\n    if (jointType == 0.0 && vMiterLength > miterLimit + 1.0) {\n      discard;\n    }\n  }\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[fi,di]})}},{key:"initializeState",value:function(){var t=this;this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:Ti,accessor:"getPath",update:this.calculatePositions,noAlloc:true,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:true},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Ti,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:Ti,defaultValue:Ri},instancePickingColors:{size:3,type:5121,accessor:function(e,n){var r=n.index,i=n.target;return t.encodePickingColor(e&&e.__source?e.__source.index:r,i)}}}),this.setState({pathTesselator:new Mi({fp64:this.use64bitPositions()})}),this.props.getDashArray&&!this.props.extensions.length&&q.removed("getDashArray","PathStyleExtension")()}},{key:"updateState",value:function(t){var e=t.oldProps,r=t.props,i=t.changeFlags;Object(me.a)(Object(Z.a)(n.prototype),"updateState",this).call(this,{props:r,oldProps:e,changeFlags:i});var a=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){var o=this.state.pathTesselator,s=r.data.attributes||{};o.updateGeometry({data:r.data,geometryBuffer:s.getPath,buffers:s,normalize:!r._pathType,loop:"loop"===r._pathType,getGeometry:r.getPath,positionFormat:r.positionFormat,wrapLongitude:r.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:o.instanceCount,startIndices:o.vertexStarts}),i.dataChanged||a.invalidateAll()}if(i.extensionsChanged){var c=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(c)}),a.invalidateAll()}}},{key:"getPickingInfo",value:function(t){var e=Object(me.a)(Object(Z.a)(n.prototype),"getPickingInfo",this).call(this,t),r=e.index,i=this.props.data;return i[0]&&i[0].__source&&(e.object=i.find((function(t){return t.__source.index===r}))),e}},{key:"draw",value:function(t){var e=t.uniforms,n=this.context.viewport,r=this.props,i=r.rounded,a=r.billboard,o=r.miterLimit,s=r.widthUnits,c=r.widthScale,u=r.widthMinPixels,l=r.widthMaxPixels,h="pixels"===s?n.metersPerPixel:1;this.state.model.setUniforms(Object.assign({},e,{jointType:Number(i),billboard:a,widthScale:c*h,miterLimit:o,widthMinPixels:u,widthMaxPixels:l})).draw()}},{key:"_getModel",value:function(t){return new vi.a(t,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new yi.a({drawMode:4,attributes:{indices:new Uint16Array([0,1,2,1,4,2,1,3,4,3,5,4]),positions:{value:new Float32Array([0,0,0,-1,0,1,1,-1,1,1,1,0]),size:2}}}),isInstanced:!0}))}},{key:"calculatePositions",value:function(t){var e=this.state.pathTesselator;t.startIndices=e.vertexStarts,t.value=e.get("positions")}},{key:"calculateSegmentTypes",value:function(t){var e=this.state.pathTesselator;t.startIndices=e.vertexStarts,t.value=e.get("segmentTypes")}},{key:"wrapLongitude",get:function(){return!1}}]),n}(Qr);Ii.layerName="PathLayer",Ii.defaultProps=Ei;var Di=n(234),zi=n(147),Fi=n.n(zi);function Ni(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return Vi(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Vi(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Vi(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ui(t,e,n,r){for(var i=0;i<e;i++)if(t[n+i]!==t[r-e+i])return!1;return!0}function Bi(t,e,n,r){for(var i=e,a=n.length,o=0;o<a;o++)for(var s=0;s<r;s++)t[i++]=n[o][s]||0;if(!function(t){var e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}(n))for(var c=0;c<r;c++)t[i++]=n[0][c]||0;return i}function Gi(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5?arguments[5]:void 0,o=(a=a||n.length)-i;if(o<=0)return e;for(var s=e,c=0;c<o;c++)t[s++]=n[i+c];if(!Ui(n,r,i,a))for(var u=0;u<r;u++)t[s++]=n[i+u];return s}function Wi(t,e){!function(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}(t);var n=[],r=[];if(t.positions){var i=t,a=i.positions,o=i.holeIndices;if(o){for(var s=0,c=0;c<=o.length;c++)s=Gi(n,s,a,e,o[c-1],o[c]),r.push(s);return r.pop(),{positions:n,holeIndices:r}}t=a}if(Number.isFinite(t[0]))return Gi(n,0,t,e),n;if(!function(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}(t)){var u,l=0,h=Ni(t);try{for(h.s();!(u=h.n()).done;){l=Bi(n,l,u.value,e),r.push(l)}}catch(f){h.e(f)}finally{h.f()}return r.pop(),{positions:n,holeIndices:r}}return Bi(n,0,t,e),n}function Zi(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return qi(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return qi(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function qi(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Yi(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Ji(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Yi(Object(n),!0).forEach((function(e){Object(T.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Yi(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Hi(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}var Ki=function(t){Object(G.a)(n,t);var e=Hi(n);function n(t){Object(p.a)(this,n);var r=t.fp64,i=t.IndexType,a=void 0===i?Uint32Array:i;return e.call(this,Ji(Ji({},t),{},{attributes:{positions:{size:3,type:r?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:a,size:1}}}))}return Object(d.a)(n,[{key:"get",value:function(t){var e=this.attributes;return"indices"===t?e.indices&&e.indices.subarray(0,this.vertexCount):e[t]}},{key:"updateGeometry",value:function(t){Object(me.a)(Object(Z.a)(n.prototype),"updateGeometry",this).call(this,t);var e=this.buffers.indices;e&&(this.vertexCount=(e.value||e).length)}},{key:"normalizeGeometry",value:function(t){if(this.normalize){if(t=Wi(t,this.positionSize),this.opts.resolution)return Object(Pi.a)(t.positions||t,t.holeIndices,{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0});if(this.opts.wrapLongitude)return Object(Pi.b)(t.positions||t,t.holeIndices,{size:this.positionSize,maxLatitude:86,edgeTypes:!0})}return t}},{key:"getGeometrySize",value:function(t){if(Array.isArray(t)&&!Number.isFinite(t[0])){var e,n=0,r=Zi(t);try{for(r.s();!(e=r.n()).done;){var i=e.value;n+=this.getGeometrySize(i)}}catch(a){r.e(a)}finally{r.f()}return n}return(t.positions||t).length/this.positionSize}},{key:"getGeometryFromBuffer",value:function(t){return this.normalize||!this.buffers.indices?Object(me.a)(Object(Z.a)(n.prototype),"getGeometryFromBuffer",this).call(this,t):function(){return null}}},{key:"updateGeometryAttributes",value:function(t,e){if(Array.isArray(t)&&!Number.isFinite(t[0])){var n,r=Zi(t);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=this.getGeometrySize(i);e.geometrySize=a,this.updateGeometryAttributes(i,e),e.vertexStart+=a,e.indexStart=this.indexStarts[e.geometryIndex+1]}}catch(o){r.e(o)}finally{r.f()}}else this._updateIndices(t,e),this._updatePositions(t,e),this._updateVertexValid(t,e)}},{key:"_updateIndices",value:function(t,e){var n=e.geometryIndex,r=e.vertexStart,i=e.indexStart,a=this.attributes,o=this.indexStarts,s=this.typedArrayManager,c=a.indices;if(c){var u=i,l=function(t,e,n){var r=null;t.holeIndices&&(r=t.holeIndices.map((function(t){return t/e})));var i=t.positions||t;if(n){var a=i.length;i=i.slice();for(var o=[],s=0;s<a;s+=e){o[0]=i[s],o[1]=i[s+1];var c=n(o);i[s]=c[0],i[s+1]=c[1]}}return Fi()(i,r,e)}(t,this.positionSize,this.opts.preproject);c=s.allocate(c,i+l.length,{copy:!0});for(var h=0;h<l.length;h++)c[u++]=l[h]+r;o[n+1]=i+l.length,a.indices=c}}},{key:"_updatePositions",value:function(t,e){var n=e.vertexStart,r=e.geometrySize,i=this.attributes.positions,a=this.positionSize;if(i)for(var o=t.positions||t,s=n,c=0;c<r;s++,c++){var u=o[c*a],l=o[c*a+1],h=a>2?o[c*a+2]:0;i[3*s]=u,i[3*s+1]=l,i[3*s+2]=h}}},{key:"_updateVertexValid",value:function(t,e){var n=e.vertexStart,r=e.geometrySize,i=this.attributes.vertexValid,a=this.positionSize,o=t&&t.holeIndices;if(t&&t.edgeTypes?i.set(t.edgeTypes,n):i.fill(1,n,n+r),o)for(var s=0;s<o.length;s++)i[n+o[s]/a-1]=0;i[n+r-1]=0}}]),n}(_i),Xi="\nattribute vec2 vertexPositions;\nattribute float vertexValid;\n\nuniform bool extruded;\nuniform bool isWireframe;\nuniform float elevationScale;\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying float isValid;\n\nstruct PolygonProps {\n  vec4 fillColors;\n  vec4 lineColors;\n  vec3 positions;\n  vec3 nextPositions;\n  vec3 pickingColors;\n  vec3 positions64Low;\n  vec3 nextPositions64Low;\n  float elevations;\n};\n\nvec3 project_offset_normal(vec3 vector) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\n    return normalize(vector * project_uCommonUnitsPerWorldUnit);\n  }\n  return project_normal(vector);\n}\n\nvoid calculatePosition(PolygonProps props) {\n  vec3 pos;\n  vec3 pos64Low;\n  vec3 normal;\n  vec4 colors = isWireframe ? props.lineColors : props.fillColors;\n\n  geometry.worldPosition = props.positions;\n  geometry.worldPositionAlt = props.nextPositions;\n  geometry.pickingColor = props.pickingColors;\n\n#ifdef IS_SIDE_VERTEX\n  pos = mix(props.positions, props.nextPositions, vertexPositions.x);\n  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);\n  isValid = vertexValid;\n#else\n  pos = props.positions;\n  pos64Low = props.positions64Low;\n  isValid = 1.0;\n#endif\n\n  if (extruded) {\n    pos.z += props.elevations * vertexPositions.y * elevationScale;\n\n#ifdef IS_SIDE_VERTEX\n    normal = vec3(\n      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),\n      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),\n      0.0);\n    normal = project_offset_normal(normal);\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n    geometry.normal = normal;\n  }\n\n  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  if (extruded) {\n    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);\n    vColor = vec4(lightColor, colors.a * opacity);\n  } else {\n    vColor = vec4(colors.rgb, colors.a * opacity);\n  }\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",$i="#define SHADER_NAME solid-polygon-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 positions64Low;\nattribute float elevations;\nattribute vec4 fillColors;\nattribute vec4 lineColors;\nattribute vec3 pickingColors;\n\n".concat(Xi,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  props.positions = positions;\n  props.positions64Low = positions64Low;\n  props.elevations = elevations;\n  props.fillColors = fillColors;\n  props.lineColors = lineColors;\n  props.pickingColors = pickingColors;\n\n  calculatePosition(props);\n}\n"),Qi="#define SHADER_NAME solid-polygon-layer-vertex-shader-side\n#define IS_SIDE_VERTEX\n\n\nattribute vec3 instancePositions;\nattribute vec3 nextPositions;\nattribute vec3 instancePositions64Low;\nattribute vec3 nextPositions64Low;\nattribute float instanceElevations;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\n".concat(Xi,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  props.positions = instancePositions;\n  props.positions64Low = instancePositions64Low;\n  props.elevations = instanceElevations;\n  props.fillColors = instanceFillColors;\n  props.lineColors = instanceLineColors;\n  props.pickingColors = instancePickingColors;\n  props.nextPositions = nextPositions;\n  props.nextPositions64Low = nextPositions64Low;\n\n  calculatePosition(props);\n}\n");function ta(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}var ea=[0,0,0,255],na={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:function(t){return t.polygon}},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:ea},getLineColor:{type:"accessor",value:ea},material:!0},ra={enter:function(t,e){return e.length?e.subarray(e.length-t.length):t}},ia=function(t){Object(G.a)(n,t);var e=ta(n);function n(){return Object(p.a)(this,n),e.apply(this,arguments)}return Object(d.a)(n,[{key:"getShaders",value:function(t){return Object(me.a)(Object(Z.a)(n.prototype),"getShaders",this).call(this,{vs:t,fs:"#define SHADER_NAME solid-polygon-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying float isValid;\n\nvoid main(void) {\n  if (isValid < 0.5) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",defines:{},modules:[fi,Di.a,di]})}},{key:"initializeState",value:function(){var t=this,e=this.context,n=e.gl,r=e.viewport,i=this.props.coordinateSystem;r.isGeospatial&&i===ot.DEFAULT&&(i=ot.LNGLAT),this.setState({numInstances:0,polygonTesselator:new Ki({preproject:i===ot.LNGLAT&&r.projectFlat,fp64:this.use64bitPositions(),IndexType:!n||Object(we.c)(n,Oe.a.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});var a=this.getAttributeManager(),o=!0;a.remove(["instancePickingColors"]),a.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:o},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:ra,accessor:"getPolygon",update:this.calculatePositions,noAlloc:o,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:o},elevations:{size:1,transition:ra,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{alias:"colors",size:this.props.colorFormat.length,type:5121,normalized:!0,transition:ra,accessor:"getFillColor",defaultValue:ea,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{alias:"colors",size:this.props.colorFormat.length,type:5121,normalized:!0,transition:ra,accessor:"getLineColor",defaultValue:ea,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:function(e,n){var r=n.index,i=n.target;return t.encodePickingColor(e&&e.__source?e.__source.index:r,i)},shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}},{key:"getPickingInfo",value:function(t){var e=Object(me.a)(Object(Z.a)(n.prototype),"getPickingInfo",this).call(this,t),r=e.index,i=this.props.data;return i[0]&&i[0].__source&&(e.object=i.find((function(t){return t.__source.index===r}))),e}},{key:"draw",value:function(t){var e=t.uniforms,n=this.props,r=n.extruded,i=n.filled,a=n.wireframe,o=n.elevationScale,s=this.state,c=s.topModel,u=s.sideModel,l=s.polygonTesselator,h=Object.assign({},e,{extruded:Boolean(r),elevationScale:o});u&&(u.setInstanceCount(l.instanceCount-1),u.setUniforms(h),a&&(u.setDrawMode(3),u.setUniforms({isWireframe:!0}).draw()),i&&(u.setDrawMode(6),u.setUniforms({isWireframe:!1}).draw())),c&&(c.setVertexCount(l.vertexCount),c.setUniforms(h).draw())}},{key:"updateState",value:function(t){Object(me.a)(Object(Z.a)(n.prototype),"updateState",this).call(this,t),this.updateGeometry(t);var e=t.props,r=t.oldProps,i=t.changeFlags,a=this.getAttributeManager();(i.extensionsChanged||e.filled!==r.filled||e.extruded!==r.extruded)&&(this.state.models&&this.state.models.forEach((function(t){return t.delete()})),this.setState(this._getModels(this.context.gl)),a.invalidateAll())}},{key:"updateGeometry",value:function(t){var e=t.props,n=(t.oldProps,t.changeFlags);if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){var r=this.state.polygonTesselator,i=e.data.attributes||{};r.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:i.getPolygon,buffers:i,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:n.dataChanged}),this.setState({numInstances:r.instanceCount,startIndices:r.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}},{key:"_getModels",value:function(t){var e,n,r=this.props,i=r.id,a=r.filled,o=r.extruded;if(a){var s=this.getShaders($i);s.defines.NON_INSTANCED_MODEL=1,e=new vi.a(t,Object.assign({},s,{id:"".concat(i,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0}))}return o&&((n=new vi.a(t,Object.assign({},this.getShaders(Qi),{id:"".concat(i,"-side"),geometry:new yi.a({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}))).userData.excludeAttributes={indices:!0}),{models:[n,e].filter(Boolean),topModel:e,sideModel:n}}},{key:"calculateIndices",value:function(t){var e=this.state.polygonTesselator;t.startIndices=e.indexStarts,t.value=e.get("indices")}},{key:"calculatePositions",value:function(t){var e=this.state.polygonTesselator;t.startIndices=e.vertexStarts,t.value=e.get("positions")}},{key:"calculateVertexValid",value:function(t){t.value=this.state.polygonTesselator.get("vertexValid")}},{key:"wrapLongitude",get:function(){return!1}}]),n}(Qr);function aa(t){for(var e=t.data,n=t.getIndex,r=t.dataRange,i=t.replace,a=r.startRow,o=void 0===a?0:a,s=r.endRow,c=void 0===s?1/0:s,u=e.length,l=u,h=u,f=0;f<u;f++){var p=n(e[f]);if(l>f&&p>=o&&(l=f),p>=c){h=f;break}}for(var d=l,v=h-l!==i.length,y=v&&e.slice(h),g=0;g<i.length;g++)e[d++]=i[g];if(v){for(var b=0;b<y.length;b++)e[d++]=y[b];e.length=d}return{startRow:l,endRow:l+i.length}}function oa(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},i=n.startRow,a=void 0===i?0:i,o=n.endRow,s=void 0===o?t.length:o,c=a;c<s;c++){var u=t[c];q.assert(u&&u.geometry,"GeoJSON does not have geometry");var l=u.geometry;if("GeometryCollection"===l.type){q.assert(Array.isArray(l.geometries),"GeoJSON does not have geometries array");for(var h=l.geometries,f=0;f<h.length;f++){var p=h[f];sa(p,r,e,u,c)}}else sa(l,r,e,u,c)}return r}function sa(t,e,n,r,i){var a=t.type,o=t.coordinates,s=e.pointFeatures,c=e.lineFeatures,u=e.polygonFeatures,l=e.polygonOutlineFeatures;if(function(t,e){var n=ca[t];q.assert(n,"Unknown GeoJSON type ".concat(t));for(;e&&--n>0;)e=e[0];return e&&Number.isFinite(e[0])}(a,o))switch(a){case"Point":s.push(n({geometry:t},r,i));break;case"MultiPoint":o.forEach((function(t){s.push(n({geometry:{type:"Point",coordinates:t}},r,i))}));break;case"LineString":c.push(n({geometry:t},r,i));break;case"MultiLineString":o.forEach((function(t){c.push(n({geometry:{type:"LineString",coordinates:t}},r,i))}));break;case"Polygon":u.push(n({geometry:t},r,i)),o.forEach((function(t){l.push(n({geometry:{type:"LineString",coordinates:t}},r,i))}));break;case"MultiPolygon":o.forEach((function(t){u.push(n({geometry:{type:"Polygon",coordinates:t}},r,i)),t.forEach((function(t){l.push(n({geometry:{type:"LineString",coordinates:t}},r,i))}))}))}else q.warn("".concat(a," coordinates are malformed"))()}ia.layerName="SolidPolygonLayer",ia.defaultProps=na;var ca={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function ua(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return la(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return la(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function la(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ha(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}var fa=[0,0,0,255],pa={stroked:!0,filled:!0,extruded:!1,wireframe:!1,lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,elevationScale:1,pointRadiusUnits:"meters",pointRadiusScale:1,pointRadiusMinPixels:0,pointRadiusMaxPixels:Number.MAX_SAFE_INTEGER,getLineColor:{type:"accessor",value:fa},getFillColor:{type:"accessor",value:[0,0,0,255]},getRadius:{type:"accessor",value:1},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};function da(t){return t.geometry.coordinates}var va=function(t){Object(G.a)(n,t);var e=ha(n);function n(){return Object(p.a)(this,n),e.apply(this,arguments)}return Object(d.a)(n,[{key:"initializeState",value:function(){this.state={features:{}},this.props.getLineDashArray&&q.removed("getLineDashArray","PathStyleExtension")()}},{key:"updateState",value:function(t){var e=t.props,n=t.changeFlags;if(n.dataChanged){var r=function(t){if(Array.isArray(t))return t;switch(q.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return q.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}(e.data),i=this.getSubLayerRow.bind(this);if(Array.isArray(n.dataChanged)){var a=this.state.features,o={},s={};for(var c in a)o[c]=a[c].slice(),s[c]=[];var u,l=ua(n.dataChanged);try{for(l.s();!(u=l.n()).done;){var h=u.value,f=oa(r,i,h);for(var p in a)s[p].push(aa({data:o[p],getIndex:function(t){return t.__source.index},dataRange:h,replace:f[p]}))}}catch(d){l.e(d)}finally{l.f()}this.setState({features:o,featuresDiff:s})}else this.setState({features:oa(r,i),featuresDiff:{}})}}},{key:"renderLayers",value:function(){var t=this.state,e=t.features,n=t.featuresDiff,r=e.pointFeatures,i=e.lineFeatures,a=e.polygonFeatures,o=e.polygonOutlineFeatures,s=this.props,c=s.stroked,u=s.filled,l=s.extruded,h=s.wireframe,f=s.material,p=s.transitions,d=this.props,v=d.lineWidthUnits,y=d.lineWidthScale,g=d.lineWidthMinPixels,b=d.lineWidthMaxPixels,m=d.lineJointRounded,w=d.lineMiterLimit,O=d.pointRadiusUnits,j=d.pointRadiusScale,_=d.pointRadiusMinPixels,P=d.pointRadiusMaxPixels,S=d.elevationScale,k=d.lineDashJustified,x=this.props,C=x.getLineColor,A=x.getFillColor,M=x.getRadius,L=x.getLineWidth,R=x.getLineDashArray,E=x.getElevation,T=x.updateTriggers,I=this.getSubLayerClass("polygons-fill",ia),D=this.getSubLayerClass("polygons-stroke",Ii),z=this.getSubLayerClass("line-strings",Ii),F=this.getSubLayerClass("points",wi),N=this.shouldRenderSubLayer("polygons-fill",a)&&new I({_dataDiff:n.polygonFeatures&&function(){return n.polygonFeatures},extruded:l,elevationScale:S,filled:u,wireframe:h,material:f,getElevation:this.getSubLayerAccessor(E),getFillColor:this.getSubLayerAccessor(A),getLineColor:this.getSubLayerAccessor(l&&h?C:fa),transitions:p&&{getPolygon:p.geometry,getElevation:p.getElevation,getFillColor:p.getFillColor,getLineColor:p.getLineColor}},this.getSubLayerProps({id:"polygons-fill",updateTriggers:{getElevation:T.getElevation,getFillColor:T.getFillColor,lineColors:l&&h,getLineColor:T.getLineColor}}),{data:a,getPolygon:da});return[!l&&N,!l&&c&&this.shouldRenderSubLayer("polygons-stroke",o)&&new D({_dataDiff:n.polygonOutlineFeatures&&function(){return n.polygonOutlineFeatures},widthUnits:v,widthScale:y,widthMinPixels:g,widthMaxPixels:b,rounded:m,miterLimit:w,dashJustified:k,getColor:this.getSubLayerAccessor(C),getWidth:this.getSubLayerAccessor(L),getDashArray:this.getSubLayerAccessor(R),transitions:p&&{getPath:p.geometry,getColor:p.getLineColor,getWidth:p.getLineWidth}},this.getSubLayerProps({id:"polygons-stroke",updateTriggers:{getColor:T.getLineColor,getWidth:T.getLineWidth,getDashArray:T.getLineDashArray}}),{data:o,getPath:da}),this.shouldRenderSubLayer("linestrings",i)&&new z({_dataDiff:n.lineFeatures&&function(){return n.lineFeatures},widthUnits:v,widthScale:y,widthMinPixels:g,widthMaxPixels:b,rounded:m,miterLimit:w,dashJustified:k,getColor:this.getSubLayerAccessor(C),getWidth:this.getSubLayerAccessor(L),getDashArray:this.getSubLayerAccessor(R),transitions:p&&{getPath:p.geometry,getColor:p.getLineColor,getWidth:p.getLineWidth}},this.getSubLayerProps({id:"line-strings",updateTriggers:{getColor:T.getLineColor,getWidth:T.getLineWidth,getDashArray:T.getLineDashArray}}),{data:i,getPath:da}),this.shouldRenderSubLayer("points",r)&&new F({_dataDiff:n.pointFeatures&&function(){return n.pointFeatures},stroked:c,filled:u,radiusUnits:O,radiusScale:j,radiusMinPixels:_,radiusMaxPixels:P,lineWidthUnits:v,lineWidthScale:y,lineWidthMinPixels:g,lineWidthMaxPixels:b,getFillColor:this.getSubLayerAccessor(A),getLineColor:this.getSubLayerAccessor(C),getRadius:this.getSubLayerAccessor(M),getLineWidth:this.getSubLayerAccessor(L),transitions:p&&{getPosition:p.geometry,getFillColor:p.getFillColor,getLineColor:p.getLineColor,getRadius:p.getRadius,getLineWidth:p.getLineWidth}},this.getSubLayerProps({id:"points",updateTriggers:{getFillColor:T.getFillColor,getLineColor:T.getLineColor,getRadius:T.getRadius,getLineWidth:T.getLineWidth}}),{data:r,getPosition:da,highlightedObjectIndex:this._getHighlightedIndex(r)}),l&&N]}},{key:"_getHighlightedIndex",value:function(t){var e=this.props.highlightedObjectIndex;return Number.isFinite(e)?t.findIndex((function(t){return t.__source.index===e})):null}}]),n}(ri);va.layerName="GeoJsonLayer",va.defaultProps=pa;var ya=function(){function t(e){var n=e.x,r=e.y,i=e.z,a=e.onTileLoad,o=e.onTileError;Object(p.a)(this,t),this.x=n,this.y=r,this.z=i,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._isLoaded=!1,this._isCancelled=!1,this.onTileLoad=a,this.onTileError=o}return Object(d.a)(t,[{key:"_loadData",value:function(){var t=Object(be.a)(ge.a.mark((function t(e,n){var r,i,a,o,s,c,u,l;return ge.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.x,i=this.y,a=this.z,o=this.bbox,this._abortController=new AbortController,s=this._abortController.signal,t.next=5,n.scheduleRequest(this,(function(t){return t.isSelected?1:-1}));case 5:if(c=t.sent){t.next=9;break}return this._isCancelled=!0,t.abrupt("return");case 9:if(!this._isCancelled){t.next=12;break}return c.done(),t.abrupt("return");case 12:return t.prev=12,t.next=15,e({x:r,y:i,z:a,bbox:o,signal:s});case 15:u=t.sent,t.next=21;break;case 18:t.prev=18,t.t0=t.catch(12),l=t.t0||!0;case 21:return t.prev=21,c.done(),this._isCancelled&&!u?this._isLoaded=!1:(this._isLoaded=!0,this._isCancelled=!1),t.finish(21);case 25:if(this._isLoaded){t.next=27;break}return t.abrupt("return");case 27:l?this.onTileError(l,this):(this.content=u,this.onTileLoad(this));case 28:case"end":return t.stop()}}),t,this,[[12,18,21,25]])})));return function(e,n){return t.apply(this,arguments)}}()},{key:"loadData",value:function(t,e){var n=this;t&&(this._isCancelled=!1,this._loader=this._loadData(t,e),this._loader.finally((function(){n._loader=void 0})))}},{key:"abort",value:function(){this.isLoaded||(this._isCancelled=!0,this._abortController.abort())}},{key:"data",get:function(){return this._isLoaded?this.content:this._loader}},{key:"isLoaded",get:function(){return this._isLoaded}},{key:"isLoading",get:function(){return Boolean(this._loader)}},{key:"isCancelled",get:function(){return this._isCancelled}},{key:"byteLength",get:function(){var t=this.content?this.content.byteLength:0;return Number.isFinite(t)||q.error("byteLength not defined in tile data")(),t}}]),t}(),ga=n(113);function ba(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return ma(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ma(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function ma(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var wa=function(){function t(e,n,r){Object(p.a)(this,t),this.x=e,this.y=n,this.z=r}return Object(d.a)(t,[{key:"update",value:function(t){var e=t.viewport,n=t.cullingVolume,r=t.elevationBounds,i=t.minZ,a=t.maxZ,o=t.offset,s=this.getBoundingVolume(r,o);if(n.computeVisibility(s)<0)return!1;if(!this.childVisible){var c=this.z;if(c<a&&c>=i){var u=s.distanceTo(e.cameraPosition)*e.scale/e.height;c+=Math.floor(Math.log2(u))}if(c>=a)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;var l,h=ba(this.children);try{for(h.s();!(l=h.n()).done;){l.value.update(t)}}catch(f){h.e(f)}finally{h.f()}return!0}},{key:"getSelected",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(this.selected&&t.push(this),this._children){var e,n=ba(this._children);try{for(n.s();!(e=n.n()).done;){var r=e.value;r.getSelected(t)}}catch(i){n.e(i)}finally{n.f()}}return t}},{key:"getBoundingVolume",value:function(t,e){var n=512/Math.pow(2,this.z),r=this.x*n+512*e,i=512-(this.y+1)*n;return new ga.a([r,i,t[0]],[r+n,i+n,t[1]])}},{key:"children",get:function(){if(!this._children){var e=2*this.x,n=2*this.y,r=this.z+1;this._children=[new t(e,n,r),new t(e,n+1,r),new t(e+1,n,r),new t(e+1,n+1,r)]}return this._children}}]),t}();var Oa=512,ja=[-1/0,-1/0,1/0,1/0],_a={type:"url",value:"",validate:function(t){return"string"===typeof t||Array.isArray(t)&&t.every((function(t){return"string"===typeof t}))},equals:function(t,e){if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e))return!1;var n=t.length;if(n!==e.length)return!1;for(var r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}};function Pa(t,e){var n=[e.transformPoint([t[0],t[1]]),e.transformPoint([t[2],t[1]]),e.transformPoint([t[0],t[3]]),e.transformPoint([t[2],t[3]])];return[Math.min.apply(Math,Object(ii.a)(n.map((function(t){return t[0]})))),Math.min.apply(Math,Object(ii.a)(n.map((function(t){return t[1]})))),Math.max.apply(Math,Object(ii.a)(n.map((function(t){return t[0]})))),Math.max.apply(Math,Object(ii.a)(n.map((function(t){return t[1]}))))]}function Sa(t,e){if(!t||!t.length)return null;Array.isArray(t)&&(t=t[Math.abs(e.x+e.y)%t.length]);var n=e.x,r=e.y,i=e.z;return t.replace("{x}",n).replace("{y}",r).replace("{z}",i).replace("{-y}",Math.pow(2,i)-r-1)}function ka(t){return Math.pow(2,t)}function xa(t,e,n){var r=ka(n),i=t/r*360-180,a=Math.PI-2*Math.PI*e/r;return[i,180/Math.PI*Math.atan(.5*(Math.exp(a)-Math.exp(-a)))]}function Ca(t,e,n){var r=ka(n);return[t/r*Oa,e/r*Oa]}function Aa(t,e,n,r){if(t.isGeospatial){var i=xa(e,n,r),a=Object(E.a)(i,2),o=a[0],s=a[1],c=xa(e+1,n+1,r),u=Object(E.a)(c,2);return{west:o,north:s,east:u[0],south:u[1]}}var l=Ca(e,n,r),h=Object(E.a)(l,2),f=h[0],p=h[1],d=Ca(e+1,n+1,r),v=Object(E.a)(d,2);return{left:f,top:p,right:v[0],bottom:v[1]}}function Ma(t,e,n,r){for(var i=function(t,e,n){return n?Pa(t,n).map((function(t){return t*e/Oa})):t.map((function(t){return t*e/Oa}))}(function(t,e,n){var r;if(e&&2===e.length){var i=Object(E.a)(e,2),a=i[0],o=i[1],s=t.getBounds({z:a}),c=t.getBounds({z:o});r=[Math.min(s[0],c[0]),Math.min(s[1],c[1]),Math.max(s[2],c[2]),Math.max(s[3],c[3])]}else r=t.getBounds();return t.isGeospatial?[Math.max(r[0],n[0]),Math.max(r[1],n[1]),Math.min(r[2],n[2]),Math.min(r[3],n[3])]:[Math.max(Math.min(r[0],n[2]),n[0]),Math.max(Math.min(r[1],n[3]),n[1]),Math.min(Math.max(r[2],n[0]),n[2]),Math.min(Math.max(r[3],n[1]),n[3])]}(t,null,n),ka(e),r),a=Object(E.a)(i,4),o=a[0],s=a[1],c=a[2],u=a[3],l=[],h=Math.floor(o);h<c;h++)for(var f=Math.floor(s);f<u;f++)l.push({x:h,y:f,z:e});return l}function La(t){var e=t.viewport,n=t.maxZoom,r=t.minZoom,i=t.zRange,a=t.extent,o=t.tileSize,s=void 0===o?Oa:o,c=t.modelMatrix,u=t.modelMatrixInverse,l=Math.round(e.zoom+Math.log2(Oa/s));if(Number.isFinite(r)&&l<r){if(!a)return[];l=r}Number.isFinite(n)&&l>n&&(l=n);var h=a;return c&&u&&a&&!e.isGeospatial&&(h=Pa(a,c)),e.isGeospatial?function(t,e,n){if(!(t instanceof xt)){var r=t.getBounds(),i=Object(at.b)({width:100,height:100,bounds:[[r[0],r[1]],[r[2],r[3]]]}),a=i.longitude,o=i.latitude,s=i.zoom;t=new xt({width:100,height:100,longitude:a,latitude:o,zoom:s,repeat:!0})}var c=Object.values(t.getFrustumPlanes()).map((function(t){var e=t.normal,n=t.distance;return new ga.c(e.clone().negate(),n)})),u=new ga.b(c),l=t.distanceScales.unitsPerMeter[2],h=n&&n[0]*l||0,f=n&&n[1]*l||0,p=t.pitch<=60?e:0,d=new wa(0,0,0),v={viewport:t,cullingVolume:u,elevationBounds:[h,f],minZ:p,maxZ:e,offset:0};if(d.update(v),t.subViewports&&t.subViewports.length>1){for(v.offset=-1;d.update(v)&&!(--v.offset<-3););for(v.offset=1;d.update(v)&&!(++v.offset>3););}return d.getSelected()}(e,l,i):Ma(e,l,h||ja,u)}var Ra=n(233);function Ea(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return Ta(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ta(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Ta(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Ia="best-available",Da=function(){function t(e){var n=this;Object(p.a)(this,t),this.opts=e,this._getTileData=e.getTileData,this.onTileError=e.onTileError,this.onTileLoad=function(t){e.onTileLoad(t),n.opts.maxCacheByteSize&&(n._cacheByteSize+=t.byteLength,n._resizeCache())},this.onTileUnload=e.onTileUnload,this._requestScheduler=new Ra.a({maxRequests:e.maxRequests,throttleRequests:e.maxRequests>0}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._selectedTiles=null,this._frameNumber=0,this.setOptions(e)}return Object(d.a)(t,[{key:"setOptions",value:function(t){Object.assign(this.opts,t),Number.isFinite(t.maxZoom)&&(this._maxZoom=Math.floor(t.maxZoom)),Number.isFinite(t.minZoom)&&(this._minZoom=Math.ceil(t.minZoom))}},{key:"update",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.zRange,i=n.modelMatrix,a=new J.a(i),o=!a.equals(this._modelMatrix);if(!t.equals(this._viewport)||o){o&&(this._modelMatrixInverse=i&&a.clone().invert(),this._modelMatrix=i&&a),this._viewport=t;var s=this.getTileIndices({viewport:t,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:r,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=s.map((function(t){return e._getTile(t,!0)})),this._dirty&&this._rebuildTree()}var c=this.updateTileStates();return this._dirty&&this._resizeCache(),c&&this._frameNumber++,this._frameNumber}},{key:"getTileIndices",value:function(t){var e=t.viewport,n=t.maxZoom,r=t.minZoom,i=t.zRange,a=t.modelMatrix,o=t.modelMatrixInverse,s=this.opts;return La({viewport:e,maxZoom:n,minZoom:r,zRange:i,tileSize:s.tileSize,extent:s.extent,modelMatrix:a,modelMatrixInverse:o})}},{key:"getTileMetadata",value:function(t){var e=t.x,n=t.y,r=t.z;return{bbox:Aa(this._viewport,e,n,r)}}},{key:"getParentIndex",value:function(t){return t.x=Math.floor(t.x/2),t.y=Math.floor(t.y/2),t.z-=1,t}},{key:"updateTileStates",value:function(){this._updateTileStates(this.selectedTiles);var t,e=this.opts.maxRequests,n=[],r=0,i=!1,a=Ea(this._cache.values());try{for(a.s();!(t=a.n()).done;){var o=t.value,s=Boolean(1&o.state);o.isVisible!==s&&(i=!0,o.isVisible=s),o.isSelected=5===o.state,o.isLoading&&(r++,o.isSelected||n.push(o))}}catch(c){a.e(c)}finally{a.f()}if(e>0)for(;r>e&&n.length>0;){n.shift().abort(),r--}return i}},{key:"_rebuildTree",value:function(){var t,e=this._cache,n=Ea(e.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;r.parent=null,r.children.length=0}}catch(c){n.e(c)}finally{n.f()}var i,a=Ea(e.values());try{for(a.s();!(i=a.n()).done;){var o=i.value,s=this._getNearestAncestor(o.x,o.y,o.z);o.parent=s,s&&s.children.push(o)}}catch(c){a.e(c)}finally{a.f()}}},{key:"_updateTileStates",value:function(t){var e,n=this._cache,r=this.opts.refinementStrategy||Ia,i=Ea(n.values());try{for(i.s();!(e=i.n()).done;){e.value.state=0}}catch(f){i.e(f)}finally{i.f()}var a,o=Ea(t);try{for(o.s();!(a=o.n()).done;){a.value.state=5}}catch(f){o.e(f)}finally{o.f()}if("never"!==r){var s,c=Ea(t);try{for(c.s();!(s=c.n()).done;){Fa(s.value,r)}}catch(f){c.e(f)}finally{c.f()}var u,l=Ea(t);try{for(l.s();!(u=l.n()).done;){var h=u.value;za(h)&&Na(h)}}catch(f){l.e(f)}finally{l.f()}}}},{key:"_resizeCache",value:function(){var t=this._cache,e=this.opts,n=e.maxCacheSize||(e.maxCacheByteSize?1/0:5*this.selectedTiles.length),r=e.maxCacheByteSize||1/0;if(t.size>n||this._cacheByteSize>r){var i,a=Ea(t);try{for(a.s();!(i=a.n()).done;){var o=Object(E.a)(i.value,2),s=o[0],c=o[1];if(c.isVisible||(this._cacheByteSize-=e.maxCacheByteSize?c.byteLength:0,t.delete(s),this.onTileUnload(c)),t.size<=n&&this._cacheByteSize<=r)break}}catch(u){a.e(u)}finally{a.f()}this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((function(t,e){return t.z-e.z})),this._dirty=!1)}},{key:"_getTile",value:function(t,e){var n=t.x,r=t.y,i=t.z,a="".concat(n,",").concat(r,",").concat(i),o=this._cache.get(a);return!o&&e?(o=new ya({x:n,y:r,z:i,onTileLoad:this.onTileLoad,onTileError:this.onTileError}),Object.assign(o,this.getTileMetadata(o)),o.loadData(this._getTileData,this._requestScheduler),this._cache.set(a,o),this._dirty=!0):o&&o.isCancelled&&!o.isLoading&&o.loadData(this._getTileData,this._requestScheduler),o}},{key:"_getNearestAncestor",value:function(t,e,n){for(var r=this._minZoom,i=void 0===r?0:r,a={x:t,y:e,z:n};a.z>i;){a=this.getParentIndex(a);var o=this._getTile(a);if(o)return o}return null}},{key:"tiles",get:function(){return this._tiles}},{key:"selectedTiles",get:function(){return this._selectedTiles}},{key:"isLoaded",get:function(){return this._selectedTiles.every((function(t){return t.isLoaded}))}}]),t}();function za(t){for(var e=t;e;){if(!1&e.state)return!0;if(e.isLoaded)return!1;e=e.parent}return!0}function Fa(t,e){for(var n,r=3;n=t.parent;){if(t.isLoaded&&(r=4,e===Ia))return;n.state=Math.max(n.state,r),t=n}}function Na(t){var e,n=Ea(t.children);try{for(n.s();!(e=n.n()).done;){var r=e.value;r.state=Math.max(r.state,3),r.isLoaded||Na(r)}}catch(i){n.e(i)}finally{n.f()}}function Va(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}function Ua(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}var Ba={data:[],dataComparator:_a.equals,renderSubLayers:{type:"function",value:function(t){return new va(t)},compare:!1},getTileData:{type:"function",optional:!0,value:null,compare:!1},onViewportLoad:{type:"function",optional:!0,value:null,compare:!1},onTileLoad:{type:"function",value:function(t){},compare:!1},onTileUnload:{type:"function",value:function(t){},compare:!1},onTileError:{type:"function",value:function(t){return console.error(t)},compare:!1},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:Ia,zRange:null,fetch:{type:"function",value:function(t,e){var n=e.layer,r=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ua(Object(n),!0).forEach((function(e){Object(T.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ua(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({signal:e.signal},n.getLoadOptions()||{});return Object(Zr.a)(t,r)},compare:!1},maxRequests:6},Ga=function(t){Object(G.a)(n,t);var e=Va(n);function n(){return Object(p.a)(this,n),e.apply(this,arguments)}return Object(d.a)(n,[{key:"initializeState",value:function(){this.state={tiles:[],isLoaded:!1}}},{key:"shouldUpdateState",value:function(t){return t.changeFlags.somethingChanged}},{key:"updateState",value:function(t){var e=t.props,n=(t.oldProps,t.context,t.changeFlags),r=this.state.tileset;if(!r||n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getTileData)){var i=Number.isFinite(this.state.maxZoom)?this.state.maxZoom:e.maxZoom,a=Number.isFinite(this.state.minZoom)?this.state.minZoom:e.minZoom,o=e.tileSize,s=e.maxCacheSize,c=e.maxCacheByteSize,u=e.refinementStrategy,l=e.extent,h=e.maxRequests;r=new Da({getTileData:this.getTileData.bind(this),maxCacheSize:s,maxCacheByteSize:c,maxZoom:i,minZoom:a,tileSize:o,refinementStrategy:u,extent:l,onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this),maxRequests:h}),this.setState({tileset:r})}else(n.propsChanged||n.updateTriggersChanged)&&(r.setOptions(e),this.state.tileset.tiles.forEach((function(t){t.layers=null})));this._updateTileset()}},{key:"_updateTileset",value:function(){var t=this.state.tileset,e=this.props,n=e.zRange,r=e.modelMatrix,i=t.update(this.context.viewport,{zRange:n,modelMatrix:r}),a=t.isLoaded,o=this.state.isLoaded!==a,s=this.state.frameNumber!==i;a&&(o||s)&&this._onViewportLoad(),s&&this.setState({frameNumber:i}),this.state.isLoaded=a}},{key:"_onViewportLoad",value:function(){var t=this.state.tileset,e=this.props.onViewportLoad;e&&e(t.selectedTiles.map((function(t){return t.data})))}},{key:"_onTileLoad",value:function(t){this.getCurrentLayer().props.onTileLoad(t),t.isVisible&&this.setNeedsUpdate()}},{key:"_onTileError",value:function(t,e){var n=this.getCurrentLayer();n.props.onTileError(t),n._updateTileset(),e.isVisible&&this.setNeedsUpdate()}},{key:"_onTileUnload",value:function(t){this.getCurrentLayer().props.onTileUnload(t)}},{key:"getTileData",value:function(t){var e=this.props.data,n=this.getCurrentLayer().props,r=n.getTileData,i=n.fetch,a=t.signal;return t.url=Sa(e,t),r?r(t):t.url?i(t.url,{layer:this,signal:a}):null}},{key:"renderSubLayers",value:function(t){return this.props.renderSubLayers(t)}},{key:"getHighlightedObjectIndex",value:function(){return-1}},{key:"getPickingInfo",value:function(t){var e=t.info,n=t.sourceLayer;return e.sourceLayer=n,e.tile=n.props.tile,e}},{key:"renderLayers",value:function(){var t=this,e=this.props.visible;return this.state.tileset.tiles.map((function(n){var r=e&&n.isVisible,i=t.getHighlightedObjectIndex(n);if(n.isLoaded)if(n.layers)!n.layers[0]||n.layers[0].props.visible===r&&n.layers[0].props.highlightedObjectIndex===i||(n.layers=n.layers.map((function(t){return t.clone({visible:r,highlightedObjectIndex:i})})));else{var a=t.renderSubLayers(Object.assign({},t.props,{id:"".concat(t.id,"-").concat(n.x,"-").concat(n.y,"-").concat(n.z),data:n.data,visible:r,_offset:0,tile:n,highlightedObjectIndex:i}));n.layers=De(a,Boolean)}else;return n.layers}))}},{key:"isLoaded",get:function(){return this.state.tileset.selectedTiles.every((function(t){return t.layers&&t.layers.every((function(t){return t.isLoaded}))}))}}]),n}(ri);Ga.layerName="TileLayer",Ga.defaultProps=Ba;var Wa=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(p.a)(this,t),this.opts=e}return Object(d.a)(t,[{key:"equals",value:function(t){return this===t||this.constructor===t.constructor&&gt(this.opts,t.opts)}},{key:"getShaders",value:function(t){return null}},{key:"getSubLayerProps",value:function(t){var e=t.constructor.defaultProps,n=void 0===e?{}:e,r={updateTriggers:{}};for(var i in n)if(i in this.props){var a=n[i],o=this.props[i];r[i]=o,a&&"accessor"===a.type&&(r.updateTriggers[i]=this.props.updateTriggers[i],"function"===typeof o&&(r[i]=this.getSubLayerAccessor(o,!0)))}return r}},{key:"initializeState",value:function(t,e){}},{key:"updateState",value:function(t,e){}},{key:"draw",value:function(t,e){}},{key:"finalizeState",value:function(t){}}]),t}();function Za(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}var qa={clipBounds:[0,0,1,1]},Ya="\nuniform vec4 clip_bounds;\n\nbool clip_isInBounds(vec2 position) {\n  return position.x >= clip_bounds[0] && position.y >= clip_bounds[1] && position.x < clip_bounds[2] && position.y < clip_bounds[3];\n}\n",Ja={name:"clip-vs",vs:Ya},Ha={"vs:#decl":"\nvarying float clip_isVisible;\n","vs:DECKGL_FILTER_GL_POSITION":"\n  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));\n","fs:#decl":"\nvarying float clip_isVisible;\n","fs:DECKGL_FILTER_COLOR":"\n  if (clip_isVisible < 0.5) discard;\n"},Ka={name:"clip-fs",fs:Ya},Xa={"vs:#decl":"\nvarying vec2 clip_commonPosition;\n","vs:DECKGL_FILTER_GL_POSITION":"\n  clip_commonPosition = geometry.position.xy;\n","fs:#decl":"\nvarying vec2 clip_commonPosition;\n","fs:DECKGL_FILTER_COLOR":"\n  if (!clip_isInBounds(clip_commonPosition)) discard;\n"},$a=function(t){Object(G.a)(n,t);var e=Za(n);function n(){return Object(p.a)(this,n),e.apply(this,arguments)}return Object(d.a)(n,[{key:"getShaders",value:function(){var t="instancePositions"in this.getAttributeManager().attributes;return"clipByInstance"in this.props&&(t=this.props.clipByInstance),this.state.clipByInstance=t,t?{modules:[Ja],inject:Ha}:{modules:[Ka],inject:Xa}}},{key:"draw",value:function(t){var e=t.uniforms,n=this.props.clipBounds,r=void 0===n?qa.clipBounds:n;if(this.state.clipByInstance)e.clip_bounds=r;else{var i=this.projectPosition([r[0],r[1],0]),a=this.projectPosition([r[2],r[3],0]);e.clip_bounds=[Math.min(i[0],a[0]),Math.min(i[1],a[1]),Math.max(i[0],a[0]),Math.max(i[1],a[1])]}}}]),n}(Wa);function Qa(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return to(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return to(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function to(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function eo(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function no(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?eo(Object(n),!0).forEach((function(e){Object(T.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):eo(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function ro(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}$a.extensionName="ClipExtension",$a.defaultProps=qa;function io(t){return ao.apply(this,arguments)}function ao(){return(ao=Object(be.a)(ge.a.mark((function t(e){return ge.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(Zr.a)(e);case 3:return t.abrupt("return",t.sent);case 6:throw t.prev=6,t.t0=t.catch(0),new Error("An error occurred fetching TileJSON: ".concat(t.t0));case 9:case"end":return t.stop()}}),t,null,[[0,6]])})))).apply(this,arguments)}var oo=function(t){Object(G.a)(n,t);var e=ro(n);function n(){return Object(p.a)(this,n),e.apply(this,arguments)}return Object(d.a)(n,[{key:"initializeState",value:function(){Object(me.a)(Object(Z.a)(n.prototype),"initializeState",this).call(this),this.setState({data:null,tileJSON:null})}},{key:"updateState",value:function(t){var e=t.props,r=t.oldProps,i=t.context,a=t.changeFlags;if(a.dataChanged&&this._updateTileData({props:e}),this.state.data){Object(me.a)(Object(Z.a)(n.prototype),"updateState",this).call(this,{props:e,oldProps:r,context:i,changeFlags:a});var o=this.state.tileset;a.viewportChanged&&o.isLoaded&&this._onViewportChange()}}},{key:"_updateTileData",value:function(){var t=Object(be.a)(ge.a.mark((function t(e){var n,r,i,a,o,s,c,u;return ge.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.props,r=this.props.onDataLoad,i=n.data,a=null,o=n.minZoom,s=n.maxZoom,"string"!==typeof i||/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(i)){t.next=13;break}return this.setState({data:null,tileJSON:null}),t.next=9,io(i);case 9:a=t.sent,r&&r(a),t.next=14;break;case 13:i.tilejson&&(a=i);case 14:a&&(i=a.tiles,c=parseInt(a.minzoom,10),u=parseInt(a.maxzoom,10),Number.isFinite(c)&&c>o&&(o=c),Number.isFinite(u)&&(!Number.isFinite(s)||u<s)&&(s=u)),this.setState({data:i,tileJSON:a,minZoom:o,maxZoom:s});case 16:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"renderLayers",value:function(){return this.state.data?Object(me.a)(Object(Z.a)(n.prototype),"renderLayers",this).call(this):null}},{key:"getTileData",value:function(t){var e=Sa(this.state.data,t);if(!e)return Promise.reject("Invalid URL");var n=this.getLoadOptions();return n=no(no({},n),{},{mvt:no(no({},n&&n.mvt),{},{coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:{x:t.x,y:t.y,z:t.z}})}),Object(Zr.a)(e,ai.a,n)}},{key:"renderSubLayers",value:function(t){var e=t.tile,r=Math.pow(2,e.z),i=512/r,a=-i,o=512*e.x/r,s=512*(1-e.y/r),c=(new J.a).scale([i,a,1]);return t.autoHighlight=!1,this.context.viewport.resolution||(t.modelMatrix=c,t.coordinateOrigin=[o,s,0],t.coordinateSystem=ot.CARTESIAN,t.extensions=[].concat(Object(ii.a)(t.extensions||[]),[new $a])),Object(me.a)(Object(Z.a)(n.prototype),"renderSubLayers",this).call(this,t)}},{key:"onHover",value:function(t,e){var r=this.props,i=r.uniqueIdProperty;if(r.autoHighlight){var a,o=this.state.hoveredFeatureId,s=t.object;s&&(a=so(s,i)),o!==a&&this.setState({hoveredFeatureId:a})}return Object(me.a)(Object(Z.a)(n.prototype),"onHover",this).call(this,t,e)}},{key:"getHighlightedObjectIndex",value:function(t){var e=this.state.hoveredFeatureId,n=this.props,r=n.uniqueIdProperty,i=n.highlightedFeatureId,a=t.data;if(!(co(e)||co(i))||!Array.isArray(a))return-1;var o=co(i)?i:e;return a.findIndex((function(t){return so(t,r)===o}))}},{key:"_pickObjects",value:function(t){var e=this.context,n=e.deck,r=e.viewport,i=r.width,a=r.height,o=r.x,s=r.y,c=[this.id];return n.pickObjects({x:o,y:s,width:i,height:a,layerIds:c,maxObjects:t})}},{key:"getRenderedFeatures",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=this._pickObjects(e),r=new Set,i=[],a=Qa(n);try{for(a.s();!(t=a.n()).done;){var o=t.value,s=so(o.object,this.props.uniqueIdProperty);-1===s?i.push(o.object):r.has(s)||(r.add(s),i.push(o.object))}}catch(c){a.e(c)}finally{a.f()}return i}},{key:"_onViewportChange",value:function(){var t=this.props.onViewportChange;if(t){var e=this.context.viewport;t({getRenderedFeatures:this.getRenderedFeatures.bind(this),viewport:e})}}},{key:"_onViewportLoad",value:function(){Object(me.a)(Object(Z.a)(n.prototype),"_onViewportLoad",this).call(this),this._onViewportChange()}},{key:"isLoaded",get:function(){return this.state.data&&this.state.tileset&&Object(me.a)(Object(Z.a)(n.prototype),"isLoaded",this)}}]),n}(Ga);function so(t,e){return e?t.properties[e]:"id"in t?t.id:-1}function co(t){return void 0!==t&&null!==t&&""!==t}oo.layerName="MVTLayer",oo.defaultProps={uniqueIdProperty:{type:"string",value:""},highlightedFeatureId:null,onViewportChange:{type:"function",optional:!0,value:null,compare:!1}};var uo={username:"public",apiKey:"default_public",region:"us",mapsVersion:null,sqlUrl:"https://{user}.carto.com/api/v2/sql",mapsUrl:"https://maps-api-v2.{region}.carto.com/user/{user}"};function lo(){return uo}function ho(t){var e=t||uo;return e.mapsVersion?e.mapsVersion:e.mapsUrl.includes("api/v1/map")?"v1":"v2"}function fo(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function po(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?fo(Object(n),!0).forEach((function(e){Object(T.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):fo(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var vo="{user}",yo="{region}";function go(t,e){return bo.apply(this,arguments)}function bo(){return(bo=Object(be.a)(ge.a.mark((function t(e,n){var r,i;return ge.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=po(po({},lo()),n),t.t0=ho(r),t.next="v1"===t.t0?4:"v2"===t.t0?8:11;break;case 4:return t.next=6,mo({mapConfig:e,credentials:r});case 6:return i=t.sent,t.abrupt("return",i.metadata.tilejson.vector);case 8:return t.next=10,mo({mapConfig:e,credentials:r});case 10:return t.abrupt("return",t.sent);case 11:throw new Error("Invalid maps API version. It shoud be v1 or v2");case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function mo(t){return wo.apply(this,arguments)}function wo(){return(wo=Object(be.a)(ge.a.mark((function t(e){var n,r,i,a,o;return ge.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.mapConfig,r=e.credentials,i=jo({mapConfig:n,credentials:r}),t.prev=2,t.next=5,fetch(i,{headers:{Accept:"application/json"}});case 5:a=t.sent,t.next=11;break;case 8:throw t.prev=8,t.t0=t.catch(2),new Error("Failed to connect to Maps API: ".concat(t.t0));case 11:return t.next=13,a.json();case 13:return o=t.sent,a.ok||Oo({response:a,json:o,credentials:r}),t.abrupt("return",o);case 16:case"end":return t.stop()}}),t,null,[[2,8]])})))).apply(this,arguments)}function Oo(t){var e=t.response,n=t.json,r=t.credentials;switch(e.status){case 401:throw new Error("Unauthorized access to Maps API: invalid combination of user ('".concat(r.username,"') and apiKey ('").concat(r.apiKey,"')"));case 403:throw new Error("Unauthorized access to dataset: the provided apiKey('".concat(r.apiKey,"') doesn't provide access to the requested data"));default:var i="v1"===ho()?JSON.stringify(n.errors):n.error;throw new Error(i)}}function jo(t){var e=t.mapConfig,n=t.credentials,r=JSON.stringify(e),i=[_o("api_key",n.apiKey),_o("client","deck-gl-carto")];return"".concat(function(t){return t.mapsUrl.replace(vo,t.username).replace(yo,t.region)}(n),"/tilejson?").concat(i.join("&"),"&").concat(_o("config",r))}function _o(t,e){return"".concat(t,"=").concat(encodeURIComponent(e))}function Po(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}var So={data:null,credentials:null,onDataLoad:{type:"function",value:function(t){},compare:!1},onDataError:{type:"function",value:function(t){return console.error(t)},compare:!1}},ko=function(t){Object(G.a)(n,t);var e=Po(n);function n(){return Object(p.a)(this,n),e.apply(this,arguments)}return Object(d.a)(n,[{key:"initializeState",value:function(){this.state={tilejson:null}}},{key:"updateState",value:function(t){var e=t.changeFlags,n=this.props.data;e.dataChanged&&n&&this._updateData()}},{key:"_updateData",value:function(){var t=Object(be.a)(ge.a.mark((function t(){var e;return ge.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this._updateTileJSON();case 3:e=t.sent,this.setState({tilejson:e}),this.props.onDataLoad(e),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),this.props.onDataError(t.t0);case 11:case"end":return t.stop()}}),t,this,[[0,8]])})));return function(){return t.apply(this,arguments)}}()},{key:"buildMapConfig",value:function(){throw new Error("You must use one of the specific carto layers: BQ or SQL type")}},{key:"_updateTileJSON",value:function(){var t=Object(be.a)(ge.a.mark((function t(){var e;return ge.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,go(this.buildMapConfig(this.props),this.props.credentials);case 2:return e=t.sent,t.abrupt("return",e);case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"onHover",value:function(t,e){var r=this.getSubLayers(),i=Object(E.a)(r,1)[0];return i?i.onHover(t,e):Object(me.a)(Object(Z.a)(n.prototype),"onHover",this).call(this,t,e)}},{key:"renderLayers",value:function(){if(!this.state.tilejson)return null;var t=this.props.updateTriggers;return new oo(this.props,this.getSubLayerProps({id:"mvt",data:this.state.tilejson,updateTriggers:t}))}}]),n}(ri);function xo(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}ko.layerName="CartoLayer",ko.defaultProps=So;var Co=function(t){Object(G.a)(n,t);var e=xo(n);function n(){return Object(p.a)(this,n),e.apply(this,arguments)}return Object(d.a)(n,[{key:"buildMapConfig",value:function(){return{version:"2.0.0",layers:[{type:"tileset",source:"bigquery",options:{tileset:this.props.data}}]}}}]),n}(ko);function Ao(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}Co.layerName="CartoBQTilerLayer";var Mo=function(t){Object(G.a)(n,t);var e=Ao(n);function n(){return Object(p.a)(this,n),e.apply(this,arguments)}return Object(d.a)(n,[{key:"buildMapConfig",value:function(){var t=this.props,e=t.data,n=t.bufferSize,r=t.tileExtent,i=ho(this.props.creds),a=e.search(" ")>-1?e:"SELECT * FROM ".concat(e);switch(i){case"v1":return{version:"1.3.1",buffersize:{mvt:n},layers:[{type:"mapnik",options:{sql:a.trim(),vector_extent:r}}]};case"v2":return{version:"2.0.0",buffer_size:n,tile_extent:r,layers:[{type:"sql",source:"postgres",options:{sql:a.trim(),vector_extent:r}}]};default:throw new Error("Cannot build MapConfig for unmatching version ".concat(i))}}}]),n}(ko);Mo.layerName="CartoSQLLayer",Mo.defaultProps={bufferSize:16,tileExtent:4096,uniqueIdProperty:"cartodb_id"};var Lo="https://basemaps.cartocdn.com/gl/{basemap}-gl-style/style.json",Ro={VOYAGER:Lo.replace("{basemap}","voyager"),POSITRON:Lo.replace("{basemap}","positron"),DARK_MATTER:Lo.replace("{basemap}","dark-matter"),VOYAGER_NOLABELS:Lo.replace("{basemap}","voyager-nolabels"),POSITRON_NOLABELS:Lo.replace("{basemap}","positron-nolabels"),DARK_MATTER_NOLABELS:Lo.replace("{basemap}","dark-matter-nolabels")},Eo={classes:Object.assign({MapView:ve},{CartoBQTilerLayer:Co,CartoSQLLayer:Mo}),enumerations:{CARTO_BASEMAP:Ro}},To=n(17),Io=n(16),Do=n(26),zo=n(98),Fo=n(46),No=n.n(Fo),Vo=n(149),Uo=n.n(Vo),Bo=n(226),Go=n(210);function Wo(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return Zo(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Zo(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Zo(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var qo=function(){function t(e,n,r){Object(p.a)(this,t),this.id=e,this.context=r,this._loadCount=0,this._subscribers=new Set,this.setData(n)}return Object(d.a)(t,[{key:"subscribe",value:function(t){this._subscribers.add(t)}},{key:"unsubscribe",value:function(t){this._subscribers.delete(t)}},{key:"inUse",value:function(){return this._subscribers.size>0}},{key:"delete",value:function(){}},{key:"getData",value:function(){var t=this;return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then((function(){return t.getData()}))}},{key:"setData",value:function(t,e){var n=this;if(t!==this._data||e){this._data=t;var r=++this._loadCount,i=t;"string"===typeof t&&(i=Object(Zr.a)(t)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then((function(t){n._loadCount===r&&(n.isLoaded=!0,n._error=null,n._content=t)})).catch((function(t){n._loadCount===r&&(n.isLoaded=!0,n._error=t||!0)}))):(this.isLoaded=!0,this._error=null,this._content=t);var a,o=Wo(this._subscribers);try{for(o.s();!(a=o.n()).done;){a.value.onChange(this.getData())}}catch(s){o.e(s)}finally{o.f()}}}}]),t}(),Yo=function(){function t(e){var n=e.gl,r=e.protocol;Object(p.a)(this,t),this.protocol=r||"resource://",this._context={gl:n,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}return Object(d.a)(t,[{key:"contains",value:function(t){return!!t.startsWith(this.protocol)||t in this._resources}},{key:"add",value:function(t){var e=t.resourceId,n=t.data,r=t.forceUpdate,i=void 0!==r&&r,a=t.persistent,o=void 0===a||a,s=this._resources[e];s?s.setData(n,i):(s=new qo(e,n,this._context),this._resources[e]=s),s.persistent=o}},{key:"remove",value:function(t){var e=this._resources[t];e&&(e.delete(),delete this._resources[t])}},{key:"unsubscribe",value:function(t){var e=t.consumerId,n=this._consumers[e];if(n){for(var r in n){var i=n[r];i.resource&&i.resource.unsubscribe(i)}delete this._consumers[e],this.prune()}}},{key:"subscribe",value:function(t){var e=t.resourceId,n=t.onChange,r=t.consumerId,i=t.requestId,a=void 0===i?"default":i,o=this._resources,s=this.protocol;e.startsWith(s)&&(o[e=e.replace(s,"")]||this.add({resourceId:e,data:null,persistent:!1}));var c=o[e];if(this._track(r,a,c,n),c)return c.getData()}},{key:"prune",value:function(){var t=this;this._pruneRequest||(this._pruneRequest=setTimeout((function(){return t._prune()}),0))}},{key:"finalize",value:function(){for(var t in this._resources)this._resources[t].delete()}},{key:"_track",value:function(t,e,n,r){var i=this._consumers,a=i[t]=i[t]||{},o=a[e]||{};o.resource&&(o.resource.unsubscribe(o),o.resource=null,this.prune()),n&&(a[e]=o,o.onChange=r,o.resource=n,n.subscribe(o))}},{key:"_prune",value:function(){this._pruneRequest=null;for(var t=0,e=Object.keys(this._resources);t<e.length;t++){var n=e[t],r=this._resources[n];r.persistent||r.inUse()||(r.delete(),delete this._resources[n])}}}]),t}(),Jo=n(156);function Ho(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return Ko(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ko(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Ko(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Xo=[{name:"geometry",vs:"\nstruct VertexGeometry {\n  vec4 position;\n  vec3 worldPosition;\n  vec3 worldPositionAlt;\n  vec3 normal;\n  vec2 uv;\n  vec3 pickingColor;\n} geometry;\n",fs:"\n#define SMOOTH_EDGE_RADIUS 0.5\n\nstruct FragmentGeometry {\n  vec2 uv;\n} geometry;\n\nfloat smoothedge(float edge, float x) {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n"},hi],$o=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function Qo(t){var e,n=Jo.a.getDefaultProgramManager(t),r=Ho(Xo);try{for(r.s();!(e=r.n()).done;){var i=e.value;n.addDefaultModule(i)}}catch(c){r.e(c)}finally{r.f()}var a,o=Ho($o);try{for(o.s();!(a=o.n()).done;){var s=a.value;n.addShaderHook(s)}}catch(c){o.e(c)}finally{o.f()}return n}function ts(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return es(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return es(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function es(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var ns="layerManager.setLayers",rs=Object.seal({layerManager:null,resourceManager:null,deck:null,gl:null,stats:null,shaderCache:null,pickingFBO:null,mousePosition:null,userData:{}}),is=function(t){return t instanceof Qr?"".concat(t):t?"invalid":"null"},as=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.deck,i=n.stats,a=n.viewport,o=n.timeline;Object(p.a)(this,t),this.lastRenderedLayers=[],this.layers=[],this.resourceManager=new Yo({gl:e,protocol:"deck://"}),this.context=Object.assign({},rs,{layerManager:this,gl:e,deck:r,programManager:e&&Qo(e),stats:i||new Go.a({id:"deck.gl"}),viewport:a||new pt({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new Bo.a,resourceManager:this.resourceManager}),this._needsRedraw="Initial render",this._needsUpdate=!1,this._debug=!1,this._onError=null,this.activateViewport=this.activateViewport.bind(this),Object.seal(this)}return Object(d.a)(t,[{key:"finalize",value:function(){this.resourceManager.finalize();var t,e=ts(this.layers);try{for(e.s();!(t=e.n()).done;){var n=t.value;this._finalizeLayer(n)}}catch(r){e.e(r)}finally{e.f()}}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);var n,r=ts(this.layers);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=i.getNeedsRedraw(t);e=e||a}}catch(o){r.e(o)}finally{r.f()}return e}},{key:"needsUpdate",value:function(){return this._needsUpdate}},{key:"setNeedsRedraw",value:function(t){this._needsRedraw=this._needsRedraw||t}},{key:"setNeedsUpdate",value:function(t){this._needsUpdate=this._needsUpdate||t}},{key:"getLayers",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.layerIds,n=void 0===e?null:e;return n?this.layers.filter((function(t){return n.find((function(e){return 0===t.id.indexOf(e)}))})):this.layers}},{key:"setProps",value:function(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&this.setLayers(t.layers),"onError"in t&&(this._onError=t.onError)}},{key:"setLayers",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e||t!==this.lastRenderedLayers;if(en(ns,this,n,t),!n)return this;this.lastRenderedLayers=t;var r,i=ts(t=De(t,Boolean));try{for(i.s();!(r=i.n()).done;){var a=r.value;a.context=this.context}}catch(o){i.e(o)}finally{i.f()}return this._updateLayers(this.layers,t),this}},{key:"updateLayers",value:function(){var t=this.needsUpdate();if(t){this.setNeedsRedraw("updating layers: ".concat(t));this.setLayers(this.lastRenderedLayers,!0)}}},{key:"activateViewport",value:function(t){return en("layerManager.activateViewport",this,t),t&&(this.context.viewport=t),this}},{key:"_handleError",value:function(t,e,n){this._onError?this._onError(e,n):q.error("error during ".concat(t," of ").concat(is(n)),e)()}},{key:"_updateLayers",value:function(t,e){var n,r={},i=ts(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;r[a.id]?q.warn("Multiple old layers with same id ".concat(is(a)))():r[a.id]=a}}catch(l){i.e(l)}finally{i.f()}var o=[];this._updateSublayersRecursively(e,r,o),this._finalizeOldLayers(r);for(var s=!1,c=0,u=o;c<u.length;c++){if(u[c].hasUniformTransition()){s=!0;break}}this._needsUpdate=s,this.layers=o}},{key:"_updateSublayersRecursively",value:function(t,e,n){var r,i=ts(t);try{for(i.s();!(r=i.n()).done;){var a=r.value;a.context=this.context;var o=e[a.id];null===o&&q.warn("Multiple new layers with same id ".concat(is(a)))(),e[a.id]=null;var s=null;try{this._debug&&o!==a&&a.validateProps(),o?(this._transferLayerState(o,a),this._updateLayer(a)):this._initializeLayer(a),n.push(a),s=a.isComposite&&a.getSubLayers()}catch(c){this._handleError("matching",c,a)}s&&this._updateSublayersRecursively(s,e,n)}}catch(c){i.e(c)}finally{i.f()}}},{key:"_finalizeOldLayers",value:function(t){for(var e in t){var n=t[e];n&&this._finalizeLayer(n)}}},{key:"_initializeLayer",value:function(t){try{t._initialize(),t.lifecycle=zn}catch(e){this._handleError("initialization",e,t)}}},{key:"_transferLayerState",value:function(t,e){e._transferState(t),e.lifecycle=Dn,e!==t&&(t.lifecycle=Fn)}},{key:"_updateLayer",value:function(t){try{t._update()}catch(e){this._handleError("update",e,t)}}},{key:"_finalizeLayer",value:function(t){this._needsRedraw=this._needsRedraw||"finalized ".concat(is(t)),t.lifecycle=Nn;try{t._finalize(),t.lifecycle=Vn}catch(e){this._handleError("finalization",e,t)}}}]),t}();function os(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ss(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?os(Object(n),!0).forEach((function(e){Object(T.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):os(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var cs=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(p.a)(this,t),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="Initial render",this._needsUpdate=!0,this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractiveStateChange:e.onInteractiveStateChange},Object.seal(this),this.setProps(e)}return Object(d.a)(t,[{key:"finalize",value:function(){for(var t in this.controllers)this.controllers[t]&&this.controllers[t].finalize();this.controllers={}}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}},{key:"setNeedsUpdate",value:function(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}},{key:"updateViewStates",value:function(){for(var t in this.controllers){var e=this.controllers[t];e&&e.updateTransition()}}},{key:"getViewports",value:function(t){return t?this._viewports.filter((function(e){return e.containsPixel(t)})):this._viewports}},{key:"getViews",value:function(){var t={};return this.views.forEach((function(e){t[e.id]=e})),t}},{key:"getView",value:function(t){return"string"===typeof t?this.views.find((function(e){return e.id===t})):t}},{key:"getViewState",value:function(t){var e=this.getView(t),n=e&&this.viewState[e.getViewStateId()]||this.viewState;return e?e.filterViewState(n):n}},{key:"getViewport",value:function(t){return this._viewportMap[t]}},{key:"unproject",value:function(t,e){for(var n=this.getViewports(),r={x:t[0],y:t[1]},i=n.length-1;i>=0;--i){var a=n[i];if(a.containsPixel(r)){var o=t.slice();return o[0]-=a.x,o[1]-=a.y,a.unproject(o,e)}}return null}},{key:"setProps",value:function(t){"views"in t&&this._setViews(t.views),"viewState"in t&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}},{key:"_update",value:function(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}},{key:"_setSize",value:function(t,e){bt(Number.isFinite(t)&&Number.isFinite(e)),t===this.width&&e===this.height||(this.width=t,this.height=e,this.setNeedsUpdate("Size changed"))}},{key:"_setViews",value:function(t){t=De(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}},{key:"_setViewState",value:function(t){t?(!gt(t,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):q.warn("missing `viewState` or `initialViewState`")()}},{key:"_onViewStateChange",value:function(t,e){e.viewId=t,this._eventCallbacks.onViewStateChange(e)}},{key:"_createController",value:function(t,e){return new(0,e.type)(ss({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,e.id),onStateChange:this._eventCallbacks.onInteractiveStateChange,makeViewport:t._getViewport.bind(t)},e))}},{key:"_updateController",value:function(t,e,n,r){var i=t.controller;return i?(i=ss(ss(ss(ss({},e),t.props),i),{},{id:t.id,x:n.x,y:n.y,width:n.width,height:n.height}),r?r.setProps(i):r=this._createController(t,i),r):null}},{key:"_rebuildViewports",value:function(){var t=this.width,e=this.height,n=this.views,r=this.controllers;this._viewports=[],this.controllers={};for(var i=n.length;i--;){var a=n[i],o=this.getViewState(a),s=a.makeViewport({width:t,height:e,viewState:o});this.controllers[a.id]=this._updateController(a,o,s,r[a.id]),this._viewports.unshift(s)}for(var c in r)r[c]&&!this.controllers[c]&&r[c].finalize();this._buildViewportMap()}},{key:"_buildViewportMap",value:function(){var t=this;this._viewportMap={},this._viewports.forEach((function(e){e.id&&(t._viewportMap[e.id]=t._viewportMap[e.id]||e)}))}},{key:"_diffViews",value:function(t,e){return t.length!==e.length||t.some((function(n,r){return!t[r].equals(e[r])}))}}]),t}(),us=[255,255,255],ls=0,hs=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(p.a)(this,t);var n=e.color,r=void 0===n?us:n,i=e.intensity,a=void 0===i?1:i;this.id=e.id||"ambient-".concat(ls++),this.color=r,this.intensity=a,this.type="ambient"},fs=[255,255,255],ps=[0,0,-1],ds=0,vs=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(p.a)(this,t);var n=e.color,r=void 0===n?fs:n,i=e.intensity,a=void 0===i?1:i,o=e.direction,s=void 0===o?ps:o,c=e._shadow,u=void 0!==c&&c;this.id=e.id||"directional-".concat(ds++),this.color=r,this.intensity=a,this.type="directional",this.direction=new J.b(s).normalize().toArray(),this.shadow=u}return Object(d.a)(t,[{key:"getProjectedLight",value:function(){return this}}]),t}(),ys=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(p.a)(this,t);var n=e.id,r=void 0===n?"effect":n;this.id=r,this.props={},Object.assign(this.props,e)}return Object(d.a)(t,[{key:"preRender",value:function(){}},{key:"getModuleParameters",value:function(){}},{key:"cleanup",value:function(){}}]),t}(),gs=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(p.a)(this,t);var r=n.id,i=void 0===r?"pass":r;this.id=i,this.gl=e,this.props={},Object.assign(this.props,n)}return Object(d.a)(t,[{key:"setProps",value:function(t){Object.assign(this.props,t)}},{key:"render",value:function(){}},{key:"cleanup",value:function(){}}]),t}(),bs=n(123);function ms(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return ws(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ws(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function ws(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Os(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}var js=function(t){Object(G.a)(n,t);var e=Os(n);function n(){return Object(p.a)(this,n),e.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(t){var e=this.gl;return Object(Xn.j)(e,{framebuffer:t.target}),this._drawLayers(t)}},{key:"_drawLayers",value:function(t){var e=t.viewports,n=t.views,r=t.onViewportActive,i=t.clearCanvas,a=void 0===i||i,o=this.gl;a&&function(t){var e=t.drawingBufferWidth,n=t.drawingBufferHeight;Object(Xn.j)(t,{viewport:[0,0,e,n]}),t.clear(16640)}(o);var s,c=[],u=ms(e);try{for(u.s();!(s=u.n()).done;){var l=s.value,h=l.viewport||l,f=n&&n[h.id];r(h);var p=this._getDrawLayerParams(h,t);t.view=f;var d,v=ms(h.subViewports||[h]);try{for(v.s();!(d=v.n()).done;){var y=d.value;t.viewport=y;var g=this._drawLayersInViewport(o,t,p);c.push(g)}}catch(b){v.e(b)}finally{v.f()}}}catch(b){u.e(b)}finally{u.f()}return c}},{key:"_getDrawLayerParams",value:function(t,e){for(var n=e.layers,r=e.pass,i=void 0===r?"unknown":r,a=e.layerFilter,o=e.effects,s=e.moduleParameters,c=[],u=_s(),l=0;l<n.length;l++){var h=n[l],f=this._shouldDrawLayer(h,t,i,a),p={shouldDrawLayer:f,layerRenderIndex:u(h,f)};f&&(p.moduleParameters=this._getModuleParameters(h,o,i,s),p.layerParameters=this.getLayerParameters(h,l)),c[l]=p}return c}},{key:"_drawLayersInViewport",value:function(t,e,n){var r=e.layers,i=e.onError,a=e.viewport,o=e.view,s=function(t,e){var n=e.viewport,r=t.canvas?t.canvas.clientHeight||t.canvas.height:100,i=n,a=Object(Xn.c)(t);return[i.x*a,(r-i.y-i.height)*a,i.width*a,i.height*a]}(t,{viewport:a});if(o&&o.props.clear){var c=!0===o.props.clear?{color:!0,depth:!0}:o.props.clear;Object(Xn.k)(t,{scissorTest:!0,scissor:s},(function(){return Object(bs.a)(t,c)}))}var u={totalCount:r.length,visibleCount:0,compositeCount:0,pickableCount:0};Object(Xn.j)(t,{viewport:s});for(var l=0;l<r.length;l++){var h=r[l],f=n[l],p=f.shouldDrawLayer,d=f.layerRenderIndex,v=f.moduleParameters,y=f.layerParameters;if(p&&h.props.pickable&&u.pickableCount++,h.isComposite)u.compositeCount++;else if(p){u.visibleCount++,v.viewport=a;try{h.drawLayer({moduleParameters:v,uniforms:{layerIndex:d},parameters:y})}catch(g){i?i(g,h):q.error("error during drawing of ".concat(h),g)()}}}return u}},{key:"shouldDrawLayer",value:function(t){return!0}},{key:"getModuleParameters",value:function(t,e){return null}},{key:"getLayerParameters",value:function(t,e){return t.props.parameters}},{key:"_shouldDrawLayer",value:function(t,e,n,r){var i=this.shouldDrawLayer(t)&&t.props.visible;return i&&r&&(i=r({layer:t,viewport:e,isPicking:n.startsWith("picking"),renderPass:n})),i&&t.activateViewport(e),i}},{key:"_getModuleParameters",value:function(t,e,n,r){var i=Object.assign(Object.create(t.props),{autoWrapLongitude:t.wrapLongitude,viewport:t.context.viewport,mousePosition:t.context.mousePosition,pickingActive:0,devicePixelRatio:Object(Xn.c)(this.gl)});if(e){var a,o=ms(e);try{for(o.s();!(a=o.n()).done;){var s=a.value;Object.assign(i,s.getModuleParameters(t))}}catch(c){o.e(c)}finally{o.f()}}return Object.assign(i,this.getModuleParameters(t,e),r)}}]),n}(gs);function _s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={},r=function r(i,a){var o,s=i.props._offset,c=i.id,u=i.parent&&i.parent.id;if(u&&!(u in e)&&r(i.parent,!1),u in n){var l=n[u]=n[u]||_s(e[u],e);o=l(i,a),n[c]=l}else Number.isFinite(s)?(o=s+(e[u]||0),n[c]=null):o=t;return a&&o>=t&&(t=o+1),e[c]=o,o};return r}var Ps=n(80);function Ss(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ks(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ss(Object(n),!0).forEach((function(e){Object(T.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ss(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function xs(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}var Cs=function(t){Object(G.a)(n,t);var e=xs(n);function n(t,r){var i,a,o;return Object(p.a)(this,n),(o=e.call(this,t,r)).shadowMap=new hn.a(t,{width:1,height:1,parameters:(i={},Object(T.a)(i,10241,9729),Object(T.a)(i,10240,9729),Object(T.a)(i,10242,33071),Object(T.a)(i,10243,33071),i)}),o.depthBuffer=new Ps.a(t,{format:33189,width:1,height:1}),o.fbo=new fn.a(t,{id:"shadowmap",width:1,height:1,attachments:(a={},Object(T.a)(a,36064,o.shadowMap),Object(T.a)(a,36096,o.depthBuffer),a)}),o}return Object(d.a)(n,[{key:"render",value:function(t){var e=this,r=this.fbo;Object(Xn.k)(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},(function(){var i=t.viewports[0],a=Object(Xn.c)(e.gl),o=i.width*a,s=i.height*a;o===r.width&&s===r.height||r.resize({width:o,height:s}),Object(me.a)(Object(Z.a)(n.prototype),"render",e).call(e,ks(ks({},t),{},{target:r,pass:"shadow"}))}))}},{key:"shouldDrawLayer",value:function(t){return!1!==t.props.shadowEnabled}},{key:"getModuleParameters",value:function(){return{drawToShadowMap:!0}}},{key:"delete",value:function(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}]),n}(js);function As(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return Ms(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ms(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Ms(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Ls=Qn((function(t){var e=t.viewport,n=t.center;return new J.a(e.viewProjectionMatrix).invert().transform(n)})),Rs=Qn((function(t){var e,n=t.viewport,r=t.shadowMatrices,i=[],a=n.pixelUnprojectionMatrix,o=n.isGeospatial?void 0:1,s=[[0,0,o],[n.width,0,o],[0,n.height,o],[n.width,n.height,o],[0,0,-1],[n.width,0,-1],[0,n.height,-1],[n.width,n.height,-1]].map((function(t){return function(t,e){var n=Object(E.a)(t,3),r=n[0],i=n[1],a=n[2],o=Object(at.j)([r,i,a],e);if(Number.isFinite(a))return o;return[o[0],o[1],0]}(t,a)})),c=As(r);try{var u=function(){var t=e.value,r=t.clone().translate(new J.b(n.center).negate()),a=s.map((function(t){return r.transform(t)})),o=(new J.a).ortho({left:Math.min.apply(Math,Object(ii.a)(a.map((function(t){return t[0]})))),right:Math.max.apply(Math,Object(ii.a)(a.map((function(t){return t[0]})))),bottom:Math.min.apply(Math,Object(ii.a)(a.map((function(t){return t[1]})))),top:Math.max.apply(Math,Object(ii.a)(a.map((function(t){return t[1]})))),near:Math.min.apply(Math,Object(ii.a)(a.map((function(t){return-t[2]})))),far:Math.max.apply(Math,Object(ii.a)(a.map((function(t){return-t[2]}))))});i.push(o.multiplyRight(t))};for(c.s();!(e=c.n()).done;)u()}catch(l){c.e(l)}finally{c.f()}return i})),Es=[0,0,0,1],Ts=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function Is(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={shadow_uDrawShadowMap:Boolean(t.drawToShadowMap),shadow_uUseShadowMap:!!t.shadowMaps&&t.shadowMaps.length>0,shadow_uColor:t.shadowColor||Es,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},r=Ls({viewport:t.viewport,center:e.project_uCenter}),i=[],a=Rs({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice(),o=0;o<t.shadowMatrices.length;o++){var s=a[o],c=s.clone().translate(new J.b(t.viewport.center).negate());e.project_uCoordinateSystem===ot.LNGLAT&&e.project_uProjectionMode===st.WEB_MERCATOR?(a[o]=c,i[o]=r):(a[o]=s.clone().multiplyRight(Ts),i[o]=c.transform(r))}for(var u=0;u<a.length;u++)n["shadow_uViewProjectionMatrices[".concat(u,"]")]=a[u],n["shadow_uProjectCenters[".concat(u,"]")]=i[u],t.shadowMaps&&t.shadowMaps.length>0?n["shadow_uShadowMap".concat(u)]=t.shadowMaps[u]:n["shadow_uShadowMap".concat(u)]=t.dummyShadowMap;return n}var Ds={name:"shadow",dependencies:[hi],vs:"\nconst int max_lights = 2;\nuniform mat4 shadow_uViewProjectionMatrices[max_lights];\nuniform vec4 shadow_uProjectCenters[max_lights];\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform int shadow_uLightId;\nuniform float shadow_uLightCount;\n\nvarying vec3 shadow_vPosition[max_lights];\n\nvec4 shadow_setVertexPosition(vec4 position_commonspace) {\n  if (shadow_uDrawShadowMap) {\n    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);\n  }\n  if (shadow_uUseShadowMap) {\n    for (int i = 0; i < max_lights; i++) {\n      if(i < int(shadow_uLightCount)) {\n        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);\n        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;\n      }\n    }\n  }\n  return gl_Position;\n}\n",fs:"\nconst int max_lights = 2;\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform sampler2D shadow_uShadowMap0;\nuniform sampler2D shadow_uShadowMap1;\nuniform vec4 shadow_uColor;\nuniform float shadow_uLightCount;\n\nvarying vec3 shadow_vPosition[max_lights];\n\nconst vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\nconst vec4 bitUnpackShift = 1.0 / bitPackShift;\nconst vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);\n\nfloat shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {\n  vec4 rgbaDepth = texture2D(shadowMap, position.xy);\n\n  float z = dot(rgbaDepth, bitUnpackShift);\n  return smoothstep(0.001, 0.01, position.z - z);\n}\n\nvec4 shadow_filterShadowColor(vec4 color) {\n  if (shadow_uDrawShadowMap) {\n    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);\n    rgbaDepth -= rgbaDepth.gbaa * bitMask;\n    return rgbaDepth;\n  }\n  if (shadow_uUseShadowMap) {\n    float shadowAlpha = 0.0;\n    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);\n    if(shadow_uLightCount > 1.0) {\n      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);\n    }\n    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;\n    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);\n\n    return vec4(\n      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),\n      blendedAlpha\n    );\n  }\n  return color;\n}\n",inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    position = shadow_setVertexPosition(geometry.position);\n    ","fs:DECKGL_FILTER_COLOR":"\n    color = shadow_filterShadowColor(color);\n    "},getUniforms:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0){var n={},r=t.shadowEnabled,i=void 0===r||r;return i&&t.shadowMatrices&&t.shadowMatrices.length>0?Object.assign(n,Is(t,e)):Object.assign(n,{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1}),n}return{}}};function zs(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return Fs(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Fs(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Fs(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ns(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}var Vs={color:[255,255,255],intensity:1},Us=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],Bs=[0,0,0,200/255],Gs=function(t){Object(G.a)(n,t);var e=Ns(n);function n(t){var r;for(var i in Object(p.a)(this,n),(r=e.call(this,t)).ambientLight=null,r.directionalLights=[],r.pointLights=[],r.shadowColor=Bs,r.shadowPasses=[],r.shadowMaps=[],r.dummyShadowMap=null,r.shadow=!1,r.programManager=null,t){var a=t[i];switch(a.type){case"ambient":r.ambientLight=a;break;case"directional":r.directionalLights.push(a);break;case"point":r.pointLights.push(a)}}return r._applyDefaultLights(),r.shadow=r.directionalLights.some((function(t){return t.shadow})),r}return Object(d.a)(n,[{key:"preRender",value:function(t,e){var n=e.layers,r=e.layerFilter,i=e.viewports,a=e.onViewportActive,o=e.views;if(this.shadow){this.shadowMatrices=this._createLightMatrix(),0===this.shadowPasses.length&&this._createShadowPasses(t),this.programManager||(this.programManager=Jo.a.getDefaultProgramManager(t),Ds&&this.programManager.addDefaultModule(Ds)),this.dummyShadowMap||(this.dummyShadowMap=new hn.a(t,{width:1,height:1}));for(var s=0;s<this.shadowPasses.length;s++){this.shadowPasses[s].render({layers:n,layerFilter:r,viewports:i,onViewportActive:a,views:o,moduleParameters:{shadowLightId:s,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}}},{key:"getModuleParameters",value:function(t){var e=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return e.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map((function(e){return e.getProjectedLight({layer:t})})),pointLights:this.pointLights.map((function(e){return e.getProjectedLight({layer:t})}))},e}},{key:"cleanup",value:function(){var t,e=zs(this.shadowPasses);try{for(e.s();!(t=e.n()).done;){t.value.delete()}}catch(n){e.e(n)}finally{e.f()}this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(Ds),this.programManager=null)}},{key:"_createLightMatrix",value:function(){var t,e=[],n=zs(this.directionalLights);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=(new J.a).lookAt({eye:new J.b(r.direction).negate()});e.push(i)}}catch(a){n.e(a)}finally{n.f()}return e}},{key:"_createShadowPasses",value:function(t){for(var e=0;e<this.directionalLights.length;e++){var n=new Cs(t);this.shadowPasses[e]=n,this.shadowMaps[e]=n.shadowMap}}},{key:"_applyDefaultLights",value:function(){var t=this.ambientLight,e=this.pointLights,n=this.directionalLights;t||0!==e.length||0!==n.length||(this.ambientLight=new hs(Vs),this.directionalLights.push(new vs(Us[0]),new vs(Us[1])))}}]),n}(ys);function Ws(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return Zs(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Zs(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Zs(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var qs=new Gs,Ys=function(){function t(){Object(p.a)(this,t),this.effects=[],this._internalEffects=[],this._needsRedraw="Initial render",this.setEffects()}return Object(d.a)(t,[{key:"setProps",value:function(t){"effects"in t&&(t.effects.length===this.effects.length&&gt(t.effects,this.effects)||(this.setEffects(t.effects),this._needsRedraw="effects changed"))}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}},{key:"getEffects",value:function(){return this._internalEffects}},{key:"finalize",value:function(){this.cleanup()}},{key:"setEffects",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.cleanup(),this.effects=t,this._createInternalEffects()}},{key:"cleanup",value:function(){var t,e=Ws(this.effects);try{for(e.s();!(t=e.n()).done;){t.value.cleanup()}}catch(i){e.e(i)}finally{e.f()}var n,r=Ws(this._internalEffects);try{for(r.s();!(n=r.n()).done;){n.value.cleanup()}}catch(i){r.e(i)}finally{r.f()}this.effects.length=0,this._internalEffects.length=0}},{key:"_createInternalEffects",value:function(){this._internalEffects=this.effects.slice(),this.effects.some((function(t){return t instanceof Gs}))||this._internalEffects.push(qs)}}]),t}();function Js(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}var Hs=function(t){Object(G.a)(n,t);var e=Js(n);function n(){return Object(p.a)(this,n),e.apply(this,arguments)}return n}(js);function Ks(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Xs(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ks(Object(n),!0).forEach((function(e){Object(T.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ks(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function $s(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}var Qs={blendFunc:[1,0,32771,0],blendEquation:32774},tc=function(t){Object(G.a)(n,t);var e=$s(n);function n(){return Object(p.a)(this,n),e.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(t){t.pickingFBO?this._drawPickingBuffer(t):Object(me.a)(Object(Z.a)(n.prototype),"render",this).call(this,t)}},{key:"_drawPickingBuffer",value:function(t){var e=this,r=t.layers,i=t.layerFilter,a=t.views,o=t.viewports,s=t.onViewportActive,c=t.pickingFBO,u=t.deviceRect,l=u.x,h=u.y,f=u.width,p=u.height,d=t.pass,v=void 0===d?"picking":d,y=t.redrawReason,g=t.pickZ,b=this.gl;return this.pickZ=g,Object(Xn.k)(b,Xs(Xs({scissorTest:!0,scissor:[l,h,f,p],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0]},Qs),{},{blend:!g}),(function(){Object(me.a)(Object(Z.a)(n.prototype),"render",e).call(e,{target:c,layers:r,layerFilter:i,views:a,viewports:o,onViewportActive:s,pass:v,redrawReason:y})}))}},{key:"shouldDrawLayer",value:function(t){return t.props.pickable}},{key:"getModuleParameters",value:function(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}},{key:"getLayerParameters",value:function(t,e){var n=this.pickZ?{blend:!1}:Xs(Xs({},Qs),{},{blend:!0,blendColor:[0,0,0,(e+1)/255]});return Object.assign({},t.props.parameters,n)}}]),n}(js);function ec(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return nc(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return nc(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function nc(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function rc(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ic(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?rc(Object(n),!0).forEach((function(e){Object(T.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):rc(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var ac=function(){function t(e){Object(p.a)(this,t),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Hs(e),this.pickLayersPass=new tc(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null,this._onError=null}return Object(d.a)(t,[{key:"setProps",value:function(t){"layerFilter"in t&&this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in t&&this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed"),"onError"in t&&(this._onError=t.onError)}},{key:"renderLayers",value:function(t){var e=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass;t.layerFilter=this.layerFilter,t.onError=this._onError,t.effects=t.effects||[],t.target=t.target||fn.a.getDefaultFramebuffer(this.gl),this._preRender(t.effects,t);var n=this.lastPostProcessEffect?this.renderBuffers[0]:t.target,r=e.render(ic(ic({},t),{},{target:n}));this._postRender(t.effects,t),this.renderCount++,en("deckRenderer.renderLayers",this,r,t)}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}},{key:"finalize",value:function(){var t,e=this.renderBuffers,n=ec(e);try{for(n.s();!(t=n.n()).done;){t.value.delete()}}catch(r){n.e(r)}finally{n.f()}e.length=0}},{key:"_preRender",value:function(t,e){var n,r=null,i=ec(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;a.preRender(this.gl,e),a.postRender&&(r=a)}}catch(o){i.e(o)}finally{i.f()}r&&this._resizeRenderBuffers(),this.lastPostProcessEffect=r}},{key:"_resizeRenderBuffers",value:function(){var t=this.renderBuffers;0===t.length&&t.push(new fn.a(this.gl),new fn.a(this.gl));var e,n=ec(t);try{for(n.s();!(e=n.n()).done;){e.value.resize()}}catch(r){n.e(r)}finally{n.f()}}},{key:"_postRender",value:function(t,e){var n,r=this.renderBuffers,i={inputBuffer:r[0],swapBuffer:r[1],target:null},a=ec(t);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(o.postRender){if(o===this.lastPostProcessEffect){i.target=e.target,o.postRender(this.gl,i);break}var s=o.postRender(this.gl,i);i.inputBuffer=s,i.swapBuffer=s===r[0]?r[1]:r[0]}}}catch(c){a.e(c)}finally{a.f()}}}]),t}(),oc={pickedColor:null,pickedLayer:null,pickedObjectIndex:-1};function sc(t){var e=t.pickedColors,n=t.layers,r=t.deviceX,i=t.deviceY,a=t.deviceRadius,o=t.deviceRect;if(e){for(var s=o.x,c=o.y,u=o.width,l=o.height,h=a*a,f=-1,p=0,d=0;d<l;d++){var v=d+c-i,y=v*v;if(y>h)p+=4*u;else for(var g=0;g<u;g++){if(e[p+3]-1>=0){var b=g+s-r,m=b*b+y;m<=h&&(h=m,f=p)}p+=4}}if(f>=0){var w=e[f+3]-1,O=e.slice(f,f+4),j=n[w];if(j){var _=j.decodePickingColor(O),P=Math.floor(f/4/u);return{pickedColor:O,pickedLayer:j,pickedObjectIndex:_,pickedX:s+(f/4-P*u),pickedY:c+P}}q.error("Picked non-existent layer. Is picking buffer corrupt?")()}}return oc}function cc(t){var e=t.pickInfo,n=t.viewports,r=t.pixelRatio,i=t.x,a=t.y,o=t.z,s={viewports:n}.viewports[0],c=s&&s.unproject([i-s.x,a-s.y],{targetZ:o});return{color:null,layer:null,index:-1,picked:!1,x:i,y:a,pixel:[i,a],coordinate:c,lngLat:c,devicePixel:e&&[e.pickedX,e.pickedY],pixelRatio:r}}function uc(t){var e=t.pickInfo,n=t.lastPickedInfo,r=t.mode,i=t.layers,a=e.pickedColor,o=e.pickedLayer,s=e.pickedObjectIndex,c=o?[o]:[];if("hover"===r){var u=n.index,l=n.layerId,h=o&&o.props.id;if(h!==l||s!==u){if(h!==l){var f=i.find((function(t){return t.props.id===l}));f&&c.unshift(f)}n.layerId=h,n.index=s,n.info=null}}var p=cc(t),d=new Map;return d.set(null,p),c.forEach((function(t){var e=Object.assign({},p);if(t===o&&(e.color=a,e.index=s,e.picked=!0),e=lc({layer:t,info:e,mode:r}),t===o&&"hover"===r&&(n.info=e),e&&d.set(e.layer.id,e),"hover"===r&&t.props.autoHighlight){var i={pickingSelectedColor:o===t?a:null},c=t.props.highlightColor;o===t&&"function"===typeof c&&(i.pickingHighlightColor=c(e)),t.setModuleParameters(i),t.setNeedsRedraw()}})),d}function lc(t){for(var e=t.layer,n=t.info,r=t.mode;e&&n;){var i=n.layer||e;n.layer=e,n=e.getPickingInfo({info:n,mode:r,sourceLayer:i}),e=e.parent}return n}function hc(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return fc(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return fc(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function fc(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var pc=function(){function t(e){Object(p.a)(this,t),this.gl=e,this.pickingFBO=null,this.pickLayersPass=new tc(e),this.layerFilter=null,this.lastPickedInfo={index:-1,layerId:null,info:null},this._onError=null}return Object(d.a)(t,[{key:"setProps",value:function(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"onError"in t&&(this._onError=t.onError),"_pickable"in t&&(this._pickable=t._pickable)}},{key:"finalize",value:function(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}},{key:"pickObject",value:function(t){return this._pickClosestObject(t)}},{key:"pickObjects",value:function(t){return this._pickVisibleObjects(t)}},{key:"getLastPickedObject",value:function(t){var e=t.x,n=t.y,r=t.layers,i=t.viewports,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.lastPickedInfo.info,o=a&&a.layer&&a.layer.id,s=o?r.find((function(t){return t.id===o})):null,c=i[0]&&i[0].unproject([e,n]),u={x:e,y:n,coordinate:c,lngLat:c,layer:s};return s?Object.assign({},a,u):Object.assign(u,{color:null,object:null,index:-1})}},{key:"_resizeBuffer",value:function(){var t=this.gl;return this.pickingFBO||(this.pickingFBO=new fn.a(t),fn.a.isSupported(t,{colorBufferFloat:!0})&&(this.depthFBO=new fn.a(t),this.depthFBO.attach(Object(T.a)({},36064,new hn.a(t,{format:Object(Xn.f)(t)?34836:6408,type:5126}))))),this.pickingFBO.resize({width:t.canvas.width,height:t.canvas.height}),this.depthFBO&&this.depthFBO.resize({width:t.canvas.width,height:t.canvas.height}),this.pickingFBO}},{key:"_getPickable",value:function(t){if(!1===this._pickable)return null;var e=t.filter((function(t){return t.isPickable()&&!t.isComposite}));return e.length>255?(q.warn("Too many pickable layers, only picking the first 255")(),e.slice(0,255)):e.length?e:null}},{key:"_pickClosestObject",value:function(t){var e=t.layers,n=t.views,r=t.viewports,i=t.x,a=t.y,o=t.radius,s=void 0===o?0:o,c=t.depth,u=void 0===c?1:c,l=t.mode,h=void 0===l?"query":l,f=t.unproject3D,p=t.onViewportActive;if(!(e=this._getPickable(e)))return{result:[],emptyInfo:cc({viewports:r,x:i,y:a})};this._resizeBuffer();for(var d,v=Object(Xn.c)(this.gl),y=Object(Xn.b)(this.gl,[i,a],!0),g=[y.x+Math.floor(y.width/2),y.y+Math.floor(y.height/2)],b=Math.round(s*v),m=this.pickingFBO,w=m.width,O=m.height,j=this._getPickingRect({deviceX:g[0],deviceY:g[1],deviceRadius:b,deviceWidth:w,deviceHeight:O}),_=[],P={},S=0;S<u;S++){var k=sc({pickedColors:j&&this._drawAndSample({layers:e,views:n,viewports:r,onViewportActive:p,deviceRect:j,pass:"picking:".concat(h),redrawReason:h}),layers:e,deviceX:g[0],deviceY:g[1],deviceRadius:b,deviceRect:j}),x=void 0;if(k.pickedLayer&&f&&this.depthFBO)x=this._drawAndSample({layers:[k.pickedLayer],views:n,viewports:r,onViewportActive:p,deviceRect:{x:k.pickedX,y:k.pickedY,width:1,height:1},pass:"picking:".concat(h),redrawReason:"pick-z",pickZ:!0})[0]*r[0].distanceScales.metersPerUnit[2]+r[0].position[2];if(k.pickedColor&&S+1<u){var C=k.pickedColor[3]-1;P[C]=!0,e[C].clearPickingColor(k.pickedColor)}var A,M=hc((d=uc({pickInfo:k,lastPickedInfo:this.lastPickedInfo,mode:h,layers:e,viewports:r,x:i,y:a,z:x,pixelRatio:v})).values());try{for(M.s();!(A=M.n()).done;){var L=A.value;L.layer&&_.push(L)}}catch(E){M.e(E)}finally{M.f()}if(!k.pickedColor)break}for(var R in P)e[R].restorePickingColors();return{result:_,emptyInfo:d&&d.get(null)}}},{key:"_pickVisibleObjects",value:function(t){var e=t.layers,n=t.views,r=t.viewports,i=t.x,a=t.y,o=t.width,s=void 0===o?1:o,c=t.height,u=void 0===c?1:c,l=t.mode,h=void 0===l?"query":l,f=t.maxObjects,p=void 0===f?null:f,d=t.onViewportActive;if(!(e=this._getPickable(e)))return[];this._resizeBuffer();for(var v=Object(Xn.c)(this.gl),y=Object(Xn.b)(this.gl,[i,a],!0),g=y.x,b=y.y+y.height,m=Object(Xn.b)(this.gl,[i+s,a+u],!0),w=m.x+m.width,O=m.y,j={x:g,y:O,width:w-g,height:b-O},_=function(t){var e=t.pickedColors,n=t.layers,r=new Map;if(e)for(var i=0;i<e.length;i+=4){var a=e[i+3]-1;if(a>=0){var o=e.slice(i,i+4),s=o.join(",");if(!r.has(s)){var c=n[a];c?r.set(s,{pickedColor:o,pickedLayer:c,pickedObjectIndex:c.decodePickingColor(o)}):q.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}({pickedColors:this._drawAndSample({layers:e,views:n,viewports:r,onViewportActive:d,deviceRect:j,pass:"picking:".concat(h),redrawReason:h}),layers:e}),P=new Map,S=Number.isFinite(p),k=0;k<_.length&&!(S&&P.size>=p);k++){var x=_[k],C={color:x.pickedColor,layer:null,index:x.pickedObjectIndex,picked:!0,x:i,y:a,width:s,height:u,pixelRatio:v};C=lc({layer:x.pickedLayer,info:C,mode:h}),P.has(C.object)||P.set(C.object,C)}return Array.from(P.values())}},{key:"_drawAndSample",value:function(t){var e=t.layers,n=t.views,r=t.viewports,i=t.onViewportActive,a=t.deviceRect,o=t.pass,s=t.redrawReason,c=t.pickZ;if(bt(a.width>0&&a.height>0),e.length<1)return null;var u=c?this.depthFBO:this.pickingFBO;this.pickLayersPass.render({layers:e,layerFilter:this.layerFilter,onError:this._onError,views:n,viewports:r,onViewportActive:i,pickingFBO:u,deviceRect:a,pass:o,redrawReason:s,pickZ:c});var l=a.x,h=a.y,f=a.width,p=a.height,d=new(c?Float32Array:Uint8Array)(f*p*4);return Object(ln.b)(u,{sourceX:l,sourceY:h,sourceWidth:f,sourceHeight:p,target:d}),d}},{key:"_getPickingRect",value:function(t){var e=t.deviceX,n=t.deviceY,r=t.deviceRadius,i=t.deviceWidth,a=t.deviceHeight,o=Math.max(0,e-r),s=Math.max(0,n-r),c=Math.min(i,e+r+1)-o,u=Math.min(a,n+r+1)-s;return c<=0||u<=0?null:{x:o,y:s,width:c,height:u}}}]),t}(),dc={zIndex:1,position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:0,left:0,display:"none"},vc=function(){function t(e){Object(p.a)(this,t);var n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,dc),n.appendChild(this.el))}return Object(d.a)(t,[{key:"setTooltip",value:function(t,e,n){var r=this.el;if("string"===typeof t)r.innerText=t;else{if(!t)return void(r.style.display="none");"text"in t&&(r.innerText=t.text),"html"in t&&(r.innerHTML=t.html),"className"in t&&(r.className=t.className),Object.assign(r.style,t.style)}r.style.display="block",r.style.transform="translate(".concat(e,"px, ").concat(n,"px)")}},{key:"remove",value:function(){this.el&&this.el.remove()}}]),t}(),yc=n(144),gc=n(228),bc=n(32);var mc={name:"JSON",extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:function(t){var e=t[0],n=t[t.length-1];return"{"===e&&"}"===n||"["===e&&"]"===n},parseTextSync:JSON.parse},wc="8.4.0-alpha.1",Oc=bc.global.deck&&bc.global.deck.VERSION;if(Oc&&Oc!==wc)throw new Error("deck.gl - multiple versions detected: ".concat(Oc," vs ").concat(wc));Oc||(bc.global.deck=Object.assign(bc.global.deck||{},{VERSION:wc,version:wc,log:q,_registerLoggers:function(t){tn=t}}),Object(yc.b)([mc,[gc.a,{imagebitmap:{premultiplyAlpha:"none"}}]]));var jc=bc.global.deck,_c=n(235),Pc=n(99),Sc=n(154);function kc(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function xc(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?kc(Object(n),!0).forEach((function(e){Object(T.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):kc(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Cc(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return Ac(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ac(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Ac(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Mc(){}var Lc={id:"deckgl-overlay",width:"100%",height:"100%",pickingRadius:0,layerFilter:null,glOptions:{},gl:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},onWebGLInitialized:Mc,onResize:Mc,onViewStateChange:Mc,onBeforeRender:Mc,onAfterRender:Mc,onLoad:Mc,onError:null,_onMetrics:null,getCursor:function(t){return t.isDragging?"grabbing":"grab"},debug:!1,drawPickingColors:!1},Rc=function(){function t(e){Object(p.a)(this,t),e=Object.assign({},Lc,e),this.props={},this.width=0,this.height=0,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this._needsRedraw=!0,this._pickRequest={},this._lastPointerDownInfo=null,this.viewState=null,this.interactiveState={isDragging:!1},this._onEvent=this._onEvent.bind(this),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerMove=this._onPointerMove.bind(this),this._pickAndCallback=this._pickAndCallback.bind(this),this._onRendererInitialized=this._onRendererInitialized.bind(this),this._onRenderFrame=this._onRenderFrame.bind(this),this._onViewStateChange=this._onViewStateChange.bind(this),this._onInteractiveStateChange=this._onInteractiveStateChange.bind(this),e.viewState&&e.initialViewState&&q.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),"IE"===Object(bc.getBrowser)()&&q.warn("IE 11 support will be deprecated in v8.0")(),e.gl||"undefined"!==typeof document&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new Go.a({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&Y.setProps(e._typedArrayManagerProps),this.animationLoop.start()}return Object(d.a)(t,[{key:"finalize",value:function(){this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager&&(this.layerManager.finalize(),this.layerManager=null,this.viewManager.finalize(),this.viewManager=null,this.effectManager.finalize(),this.effectManager=null,this.deckRenderer.finalize(),this.deckRenderer=null,this.deckPicker.finalize(),this.deckPicker=null,this.eventManager.destroy(),this.eventManager=null,this.tooltip.remove(),this.tooltip=null),this.props.canvas||this.props.gl||!this.canvas||(this.canvas.parentElement.removeChild(this.canvas),this.canvas=null)}},{key:"setProps",value:function(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&q.removed("onLayerHover","onHover")(),"onLayerClick"in t&&q.removed("onLayerClick","onClick")(),t.initialViewState&&!gt(this.props.initialViewState,t.initialViewState)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);var e=Object.create(this.props);Object.assign(e,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(e),this.layerManager&&(this.viewManager.setProps(e),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(e),this.effectManager.setProps(e),this.deckRenderer.setProps(e),this.deckPicker.setProps(e)),this.stats.get("setProps Time").timeEnd()}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};if(this.props._animate)return"Deck._animate";var e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);var n=this.viewManager.needsRedraw(t),r=this.layerManager.needsRedraw(t),i=this.effectManager.needsRedraw(t),a=this.deckRenderer.needsRedraw(t);return e=e||n||r||i||a}},{key:"redraw",value:function(t){if(this.layerManager){var e=t||this.needsRedraw({clearRedrawFlags:!0});e&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}}},{key:"getViews",value:function(){return this.viewManager.views}},{key:"getViewports",value:function(t){return this.viewManager.getViewports(t)}},{key:"pickObject",value:function(t){var e=this._pick("pickObject","pickObject Time",t).result;return e.length?e[0]:null}},{key:"pickMultipleObjects",value:function(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}},{key:"pickObjects",value:function(t){return this._pick("pickObjects","pickObjects Time",t)}},{key:"_addResources",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(var n in t)this.layerManager.resourceManager.add({resourceId:n,data:t[n],forceUpdate:e})}},{key:"_removeResources",value:function(t){var e,n=Cc(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;this.layerManager.resourceManager.remove(r)}}catch(i){n.e(i)}finally{n.f()}}},{key:"_pick",value:function(t,e,n){var r=this.stats;r.get("Pick Count").incrementCount(),r.get(e).timeStart();var i=this.deckPicker[t](Object.assign({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport},n));return r.get(e).timeEnd(),i}},{key:"_createCanvas",value:function(t){var e=t.canvas;("string"===typeof e&&bt(e=document.getElementById(e)),e)||(e=document.createElement("canvas"),(t.parent||document.body).appendChild(e));var n=t.id,r=t.style;return e.id=n,Object.assign(e.style,r),e}},{key:"_setCanvasSize",value:function(t){if(this.canvas){var e=t.width,n=t.height;(e||0===e)&&(e=Number.isFinite(e)?"".concat(e,"px"):e,this.canvas.style.width=e),(n||0===n)&&(n=Number.isFinite(n)?"".concat(n,"px"):n,this.canvas.style.position="absolute",this.canvas.style.height=n)}}},{key:"_updateCanvasSize",value:function(){if(this._checkForCanvasSizeChange()){var t=this.width,e=this.height;this.viewManager.setProps({width:t,height:e}),this.props.onResize({width:this.width,height:this.height})}}},{key:"_checkForCanvasSizeChange",value:function(){var t=this.canvas;if(!t)return!1;var e=t.clientWidth||t.width,n=t.clientHeight||t.height;return(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,!0)}},{key:"_createAnimationLoop",value:function(t){var e=this,n=t.width,r=t.height,i=t.gl,a=t.glOptions,o=t.debug,s=t.useDevicePixels,c=t.autoResizeDrawingBuffer;return new _c.a({width:n,height:r,useDevicePixels:s,autoResizeDrawingBuffer:c,autoResizeViewport:!1,gl:i,onCreateContext:function(t){return Object(Xn.a)(Object.assign({},a,t,{canvas:e.canvas,debug:o}))},onInitialize:this._onRendererInitialized,onRender:this._onRenderFrame,onBeforeRender:t.onBeforeRender,onAfterRender:t.onAfterRender})}},{key:"_getViewState",value:function(){return this.props.viewState||this.viewState}},{key:"_getViews",value:function(){var t=this.props.views||[new ve({id:"default-view"})];return(t=Array.isArray(t)?t:[t]).length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}},{key:"_onPointerMove",value:function(t){var e=this._pickRequest;if("pointerleave"===t.type)e.x=-1,e.y=-1,e.radius=0;else{if(t.leftButton||t.rightButton)return;var n=t.offsetCenter;if(!n)return;e.x=n.x,e.y=n.y,e.radius=this.props.pickingRadius}this.layerManager&&(this.layerManager.context.mousePosition={x:e.x,y:e.y}),e.event=t,e.mode="hover"}},{key:"_pickAndCallback",value:function(){var t=this._pickRequest;if(t.event){var e,n=this._pick("pickObject","pickObject Time",t),r=n.result,i=n.emptyInfo,a=!1,o=Cc(r);try{for(o.s();!(e=o.n()).done;){var s=e.value;i=s,a=s.layer.onHover(s,t.event)}}catch(u){o.e(u)}finally{o.f()}if(!a&&this.props.onHover&&this.props.onHover(i,t.event),this.props.getTooltip){var c=this.props.getTooltip(i);this.tooltip.setTooltip(c,i.x,i.y)}t.event=null}}},{key:"_updateCursor",value:function(){var t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.interactiveState))}},{key:"_setGLContext",value:function(t){if(!this.layerManager){this.canvas||(this.canvas=t.canvas,Object(Xn.d)(t,{enable:!0,copyState:!0})),this.tooltip=new vc(this.canvas),Object(Xn.j)(t,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(t);var e=new Bo.a;for(var n in e.play(),this.animationLoop.attachTimeline(e),this.eventManager=new Sc.a(this.props.parent||t.canvas,{touchAction:this.props.touchAction,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}}),ct)this.eventManager.on(n,this._onEvent);this.viewManager=new cs({timeline:e,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange,onInteractiveStateChange:this._onInteractiveStateChange,views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});var r=this.viewManager.getViewports()[0];this.layerManager=new as(t,{deck:this,stats:this.stats,viewport:r,timeline:e}),this.effectManager=new Ys,this.deckRenderer=new ac(t),this.deckPicker=new pc(t),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}}},{key:"_drawLayers",value:function(t,e){var n=this.layerManager.context.gl;Object(Xn.j)(n,this.props.parameters),this.props.onBeforeRender({gl:n}),this.deckRenderer.renderLayers(Object.assign({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",redrawReason:t,effects:this.effectManager.getEffects()},e)),this.props.onAfterRender({gl:n})}},{key:"_onRendererInitialized",value:function(t){var e=t.gl;this._setGLContext(e)}},{key:"_onRenderFrame",value:function(t){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),q.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(!1),this.viewManager&&this.viewManager.updateViewStates()}},{key:"_onViewStateChange",value:function(t){var e=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState=xc(xc({},this.viewState),{},Object(T.a)({},t.viewId,e)),this.props.viewState||this.viewManager.setProps({viewState:this.viewState}))}},{key:"_onInteractiveStateChange",value:function(t){var e=t.isDragging,n=void 0!==e&&e;n!==this.interactiveState.isDragging&&(this.interactiveState.isDragging=n)}},{key:"_onEvent",value:function(t){var e=ct[t.type],n=t.offsetCenter;if(e&&n){var r=this.layerManager.getLayers(),i=this.deckPicker.getLastPickedObject({x:n.x,y:n.y,layers:r,viewports:this.getViewports(n)},this._lastPointerDownInfo),a=i.layer,o=a&&(a[e.handler]||a.props[e.handler]),s=this.props[e.handler],c=!1;o&&(c=o.call(a,i,t)),!c&&s&&s(i,t)}}},{key:"_onPointerDown",value:function(t){var e=t.offsetCenter;this._lastPointerDownInfo=this.pickObject({x:e.x,y:e.y,radius:this.props.pickingRadius})}},{key:"_getFrameStats",value:function(){var t=this.stats;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();var e=this.animationLoop.stats;t.get("GPU Time").addTime(e.get("GPU Time").lastTiming),t.get("CPU Time").addTime(e.get("CPU Time").lastTiming)}},{key:"_getMetrics",value:function(){var t=this.metrics,e=this.stats;t.fps=e.get("frameRate").getHz(),t.setPropsTime=e.get("setProps Time").time,t.updateAttributesTime=e.get("Update Attributes").time,t.framesRedrawn=e.get("Redraw Count").count,t.pickTime=e.get("pickObject Time").time+e.get("pickMultipleObjects Time").time+e.get("pickObjects Time").time,t.pickCount=e.get("Pick Count").count,t.gpuTime=e.get("GPU Time").time,t.cpuTime=e.get("CPU Time").time,t.gpuTimePerFrame=e.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=e.get("CPU Time").getAverageTime();var n=Pc.a.get("Memory Usage");t.bufferMemory=n.get("Buffer Memory").count,t.textureMemory=n.get("Texture Memory").count,t.renderbufferMemory=n.get("Renderbuffer Memory").count,t.gpuMemory=n.get("GPU Memory").count}}]),t}();function Ec(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}function Tc(t){return t?"function"===typeof t?Object(Fo.createElement)(Ot,{},t):Array.isArray(t)?t.map(Tc):t.type===No.a.Fragment?Tc(t.props.children):(Ec(t.type,Ot),t):t}function Ic(t){var e=t.children,n=t.layers,r=t.views,i=[],a=[],o={};return No.a.Children.forEach(Tc(e),(function(t){if(t){var e=t.type;if(Ec(e,Qr)){var n=function(t,e){var n={},r=t.defaultProps||{};for(var i in e)r[i]!==e[i]&&(n[i]=e[i]);return new t(n)}(e,t.props);a.push(n)}else i.push(t);if(e!==Ot&&Ec(e,Ot)&&t.props.id){var r=new e(t.props);o[r.id]=r}}})),Object.keys(o).length>0&&(Array.isArray(r)?r.forEach((function(t){o[t.id]=t})):r&&(o[r.id]=r),r=Object.values(o)),{layers:n=a.length>0?[].concat(a,Object(ii.a)(n)):n,children:i,views:r}}Rc.getPropTypes=function(t){return{id:t.string,width:t.oneOfType([t.number,t.string]),height:t.oneOfType([t.number,t.string]),layers:t.oneOfType([t.object,t.array]),layerFilter:t.func,views:t.oneOfType([t.object,t.array]),viewState:t.object,effects:t.arrayOf(t.instanceOf(ys)),controller:t.oneOfType([t.func,t.bool,t.object]),gl:t.object,glOptions:t.object,parameters:t.object,pickingRadius:t.number,useDevicePixels:t.oneOfType([t.bool,t.number]),touchAction:t.string,onWebGLInitialized:t.func,onResize:t.func,onViewStateChange:t.func,onBeforeRender:t.func,onAfterRender:t.func,onLoad:t.func,onError:t.func,debug:t.bool,drawPickingColors:t.bool,_framebuffer:t.object,_animate:t.bool,_pickable:t.bool,_typedArrayManagerProps:t.object}},Rc.defaultProps=Lc,Rc.VERSION=jc.VERSION;var Dc={position:"absolute",zIndex:-1};function zc(t,e){return t?"function"===typeof t?t(e):Array.isArray(t)?t.map((function(t){return zc(t,e)})):function(t){var e=t&&t.type,n=e&&e.defaultProps;return n&&n.mapStyle}(t)?(e.style=Dc,Object(Fo.cloneElement)(t,e)):function(t){var e=t&&t.type;return e&&e.deckGLViewProps}(t)?Object(Fo.cloneElement)(t,e):t:t}function Fc(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return Nc(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Nc(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Nc(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Vc(t){var e=t.children,n=(t.viewports,t.deck),r=t.ContextProvider,i=(n||{}).viewManager;if(!i||!i.views.length)return[];var a,o={},s=i.views[0].id,c=Fc(e);try{for(c.s();!(a=c.n()).done;){var u=a.value,l=s,h=u;Ec(u.type,Ot)&&(l=u.props.id||s,h=u.props.children);var f=i.getViewport(l),p=i.getViewState(l);if(f)h=zc(h,{x:f.x,y:f.y,width:f.width,height:f.height,viewport:f,viewState:p}),o[l]||(o[l]={viewport:f,children:[]}),o[l].children.push(h)}}catch(d){c.e(d)}finally{c.f()}return Object.keys(o).map((function(t){var e=o[t],i=e.viewport,a=e.children,s={position:"absolute",left:i.x,top:i.y,width:i.width,height:i.height},c="view-".concat(t),u=Fo.createElement.apply(void 0,["div",{key:c,id:c,style:s}].concat(Object(ii.a)(a)));if(r){var l={viewport:i,container:n.canvas.offsetParent,eventManager:n.eventManager,onViewStateChange:function(e){e.viewId=t,n._onViewStateChange(e)}};return Object(Fo.createElement)(r,{key:c,value:l},u)}return u}))}var Uc={mixBlendMode:null};function Bc(t){var e=t.width,n=t.height,r=t.style,i={position:"absolute",zIndex:0,left:0,top:0,width:e,height:n},a={left:0,top:0};if(r)for(var o in r)o in Uc?a[o]=r[o]:i[o]=r[o];return{containerStyle:i,canvasStyle:a}}function Gc(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(Z.a)(t);if(e){var i=Object(Z.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(W.a)(this,n)}}var Wc=Rc.getPropTypes(Uo.a),Zc=Rc.defaultProps,qc=function(t){Object(G.a)(n,t);var e=Gc(n);function n(t){var r;return Object(p.a)(this,n),(r=e.call(this,t)).viewports=null,r.children=null,r._needsRedraw=null,r._containerRef=No.a.createRef(),r._canvasRef=No.a.createRef(),r.pickObject=r.pickObject.bind(Object(jt.a)(r)),r.pickMultipleObjects=r.pickMultipleObjects.bind(Object(jt.a)(r)),r.pickObjects=r.pickObjects.bind(Object(jt.a)(r)),r._extractJSXLayers=Qn(Ic),r._positionChildrenUnderViews=Qn(Vc),r._extractStyles=Qn(Bc),r}return Object(d.a)(n,[{key:"componentDidMount",value:function(){var t=this.props.Deck||Rc;this.deck=this.deck||new t(Object.assign({},this.props,{parent:this._containerRef.current,canvas:this._canvasRef.current,style:null,width:"100%",height:"100%",_customRender:this._customRender.bind(this)})),this._updateFromProps(this.props)}},{key:"shouldComponentUpdate",value:function(t){this._updateFromProps(t);var e=this.children!==this._parseJSX(t).children,n=this.deck.viewManager&&this.deck.viewManager.needsRedraw();return e&&!n}},{key:"componentDidUpdate",value:function(){this._redrawDeck()}},{key:"componentWillUnmount",value:function(){this.deck.finalize()}},{key:"pickObject",value:function(t){return this.deck.pickObject(t)}},{key:"pickMultipleObjects",value:function(t){return this.deck.pickMultipleObjects(t)}},{key:"pickObjects",value:function(t){return this.deck.pickObjects(t)}},{key:"_redrawDeck",value:function(){this._needsRedraw&&(this.deck._drawLayers(this._needsRedraw),this._needsRedraw=null)}},{key:"_customRender",value:function(t){this._needsRedraw=t,this.deck.viewManager.getViewports()!==this.viewports?this.forceUpdate():this._redrawDeck()}},{key:"_parseJSX",value:function(t){return this._extractJSXLayers({layers:t.layers,views:t.views,children:t.children})}},{key:"_updateFromProps",value:function(t){var e=this._parseJSX(t),n=e.layers,r=e.views,i=Object.assign({},t,{style:null,width:"100%",height:"100%",layers:n,views:r});this.deck.setProps(i)}},{key:"render",value:function(){var t=this.props,e=t.ContextProvider,n=t.width,r=t.height,i=t.style,a=(this.deck||{}).viewManager;this.viewports=a&&a.getViewports(),this.children=this._parseJSX(this.props).children;var o=this._positionChildrenUnderViews({children:this.children,viewports:this.viewports,deck:this.deck,ContextProvider:e}),s=this._extractStyles({width:n,height:r,style:i}),c=s.containerStyle,u=s.canvasStyle,l=Object(Fo.createElement)("canvas",{key:"canvas",ref:this._canvasRef,style:u});return Object(Fo.createElement)("div",{id:"deckgl-wrapper",ref:this._containerRef,style:c},[l,o])}}]),n}(No.a.Component);qc.propTypes=Wc,qc.defaultProps=Zc;var Yc=function(t){Object(Do.a)(n,t);var e=Object(zo.a)(n);function n(){return Object(To.a)(this,n),e.apply(this,arguments)}return Object(Io.a)(n,[{key:"render",value:function(){var t,e=this.props.views,n=void 0===e?[]:e,i=[],a=Object(f.a)(n);try{for(a.s();!(t=a.n()).done;){var o=t.value;(o.props.map||o.props.mapStyle)&&i.push(Object(r.jsx)(Ot,{id:o.props.id,children:Object(r.jsx)(this.props.Map,{reuseMap:!0,mapStyle:o.props.mapStyle})},o.props.id))}}catch(s){a.e(s)}finally{a.f()}return Object(r.jsxs)("div",{className:"deck-gl-map-container",children:[Object(r.jsx)(qc,Object(l.a)(Object(l.a)({id:"json-deck"},this.props),{},{children:i})),Object(r.jsxs)("div",{className:"zoom-control",children:[Object(r.jsx)("div",{className:"zoom-option","data-type":"zoom-in",onClick:this.props.onZoom,children:Object(r.jsx)("img",{src:"/icons/zoom-in.svg",alt:"Zoom In"})}),Object(r.jsx)("div",{className:"zoom-option","data-type":"zoom-out",onClick:this.props.onZoom,children:Object(r.jsx)("img",{src:"/icons/zoom-out.svg",alt:"Zoom Out"})})]})]})}}]),n}(i.Component);function Jc(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Hc(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Jc(Object(n),!0).forEach((function(e){Object(T.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Jc(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Kc=85.05113;function Xc(t,e,n,r){if(n){if(n.props.userData._googleMap===t)return n;Qc(n)}var i={click:null,dblclick:null,mousemove:null,mouseout:null};n=new Rc(Hc(Hc({},r),{},{style:null,parent:$c(e,r.style),initialViewState:{longitude:0,latitude:0,zoom:1},controller:!1,userData:{_googleMap:t,_eventListeners:i}}));var a=function(e){i[e]=t.addListener(e,(function(t){return function(t,e,n){var r={type:e,offsetCenter:tu(n,t),srcEvent:n};switch(e){case"click":t._lastPointerDownInfo=t.pickObject(r.offsetCenter),r.tapCount=1,t._onEvent(r);break;case"dblclick":r.type="click",r.tapCount=2,t._onEvent(r);break;case"mousemove":r.type="pointermove",t._onPointerMove(r);break;case"mouseout":r.type="pointerleave",t._onPointerMove(r);break;default:return}}(n,e,t)}))};for(var o in i)a(o);return n}function $c(t,e){var n=document.createElement("div");return n.style.position="absolute",Object.assign(n.style,e),t.getPanes().overlayLayer.appendChild(n),n}function Qc(t){var e=t.props.userData._eventListeners;for(var n in e)e[n].remove();t.finalize()}function tu(t,e){if(t.pixel)return t.pixel;var n=e.getViewports()[0].project([t.latLng.lng(),t.latLng.lat()]);return{x:n[0],y:n[1]}}var eu=function(){return!1},nu=function(){function t(e){Object(p.a)(this,t),this.props={},this._map=null;var n=new google.maps.OverlayView;n.onAdd=this._onAdd.bind(this),n.onRemove=this._onRemove.bind(this),n.draw=this._draw.bind(this),this._overlay=n,this.setProps(e)}return Object(d.a)(t,[{key:"setMap",value:function(t){t!==this._map&&(this._map&&(this._overlay.setMap(null),this._map=null),t&&(this._map=t,this._overlay.setMap(t)))}},{key:"setProps",value:function(t){Object.assign(this.props,t),this._deck&&(t.style&&(Object.assign(this._deck.canvas.parentElement.style,t.style),t.style=null),this._deck.setProps(t))}},{key:"pickObject",value:function(t){return this._deck&&this._deck.pickObject(t)}},{key:"pickMultipleObjects",value:function(t){return this._deck&&this._deck.pickMultipleObjects(t)}},{key:"pickObjects",value:function(t){return this._deck&&this._deck.pickObjects(t)}},{key:"finalize",value:function(){this.setMap(null),this._deck&&(Qc(this._deck),this._deck=null)}},{key:"_onAdd",value:function(){this._deck=Xc(this._map,this._overlay,this._deck,this.props)}},{key:"_onRemove",value:function(){this._deck.setProps({layerFilter:eu})}},{key:"_draw",value:function(){var t=this._deck,e=function(t,e){var n=t.getDiv().firstChild,r=n.offsetWidth,i=n.offsetHeight,a=e.getProjection(),o=t.getBounds(),s=o.getNorthEast(),c=o.getSouthWest(),u=a.fromLatLngToDivPixel(s),l=a.fromLatLngToDivPixel(c),h=new google.maps.Point(0,0),f=a.fromContainerPixelToLatLng(h),p=a.fromLatLngToDivPixel(f),d=p.x,v=p.y,y=a.getWorldWidth(),g=Math.ceil(r/y);d-=Math.floor(g/2)*y;var b=i?(l.y-u.y)/i:1,m=Math.log2(b||1)+t.getZoom()-1,w=new google.maps.Point(r/2,i/2),O=a.fromContainerPixelToLatLng(w),j=O.lat(),_=O.lng();if(Math.abs(j)>Kc){j=j>0?Kc:-85.05113;var P=new google.maps.LatLng(j,_);v+=(w=a.fromLatLngToContainerPixel(P)).y-i/2}return{width:r,height:i,left:d,top:v,zoom:m,pitch:t.getTilt(),latitude:j,longitude:_}}(this._map,this._overlay),n=e.width,r=e.height,i=e.left,a=e.top,o=e.zoom,s=e.pitch,c=e.latitude,u=e.longitude,l=0===s,h=t.canvas.parentElement.style;h.left="".concat(i,"px"),h.top="".concat(a,"px"),t.setProps({width:n,height:r,viewState:{latitude:c,longitude:u,zoom:o,repeat:!0},layerFilter:l?this.props.layerFilter:eu}),t.redraw()}}]),t}(),ru={height:"100%",width:"100%"};function iu(t,e){(function(t){return new Promise((function(e,n){var r=document.createElement("script");r.src=t,r.addEventListener("load",e),r.addEventListener("error",(function(t){return n(t.error)})),document.head.appendChild(r)}))})("".concat("https://maps.googleapis.com/maps/api/js","?key=").concat(t,"&libraries=places")).then((function(){return e()})).catch((function(t){return console.error(t)}))}var au=function(t){Object(Do.a)(n,t);var e=Object(zo.a)(n);function n(t){var r;return Object(To.a)(this,n),(r=e.call(this,t)).state={googleMapsLoaded:window.google&&window.google.maps},r}return Object(Io.a)(n,[{key:"componentDidMount",value:function(){var t=this,e=this.props.googleMapsToken;(!window.google||window.google&&!window.google.maps)&&iu(e,(function(){t.setState({googleMapsLoaded:!0})}))}},{key:"render",value:function(){return this.state.googleMapsLoaded?Object(r.jsx)(ou,Object(l.a)({},this.props)):Object(r.jsx)("img",{src:"https://upload.wikimedia.org/wikipedia/commons/d/de/Ajax-loader.gif",alt:"Loading Google Maps overlay..."})}}]),n}(i.Component),ou=function(t){Object(Do.a)(n,t);var e=Object(zo.a)(n);function n(t){var r;return Object(To.a)(this,n),(r=e.call(this,t)).state={isOverlayConfigured:!1},r.DeckOverlay=new nu({layers:[]}),r.containerRef=a.a.createRef(),r}return Object(Io.a)(n,[{key:"componentDidMount",value:function(){var t=this.props.initialViewState,e={center:{lat:t.latitude,lng:t.longitude},mapTypeId:this.props.mapTypeId||"satellite",zoom:t.zoom},n=new window.google.maps.Map(this.containerRef.current,e);this.DeckOverlay.setMap(n),this.DeckOverlay.setProps({layers:this.props.layers}),this.setState({isOverlayConfigured:!0})}},{key:"componentDidUpdate",value:function(t,e,n){this.DeckOverlay.setProps({layers:this.props.layers})}},{key:"componentWillUnmount",value:function(){delete this.DeckOverlay}},{key:"render",value:function(){return Object(r.jsx)("div",{ref:this.containerRef,style:ru})}}]),n}(i.Component),su=n(153);function cu(t){return t&&t&&t.google?Object(r.jsx)(au,Object(l.a)(Object(l.a)({id:"json-deck"},t),{},{googleMapsToken:"AIzaSyCb2CTi3B6uarznVAs33W8VMER-1wz3ZrI"})):Object(r.jsx)(Yc,Object(l.a)(Object(l.a)({id:"json-deck"},t),{},{Map:su.a,mapStyle:Ro.POSITRON,onZoom:t.onZoom}))}var uu=n(151),lu=n.n(uu);n(189),n(191);function hu(t){var e=Object(i.useState)(JSON.stringify(t.json,null,2)),n=Object(h.a)(e,2),a=n[0],o=n[1];return Object(i.useEffect)((function(){o(JSON.stringify(t.json,null,2))}),[t.json]),Object(r.jsx)("div",{className:"json-form",children:Object(r.jsx)(lu.a,{width:"100%",height:"100%",mode:"json",theme:"github",onChange:function(e,n){try{e&&JSON.parse(e),o(e),t.onJsonUpdated&&t.onJsonUpdated(e)}catch(r){}},name:"AceEditorDiv",editorProps:{$blockScrolling:!0},wrapEnabled:!0,value:a})})}var fu=function(t){var e=Object(i.useState)("carto"),n=Object(h.a)(e,2),a=n[0],o=n[1],s=Object(i.useState)(!0),c=Object(h.a)(s,2),u=c[0],l=c[1],f=Object(i.useState)(!0),p=Object(h.a)(f,2),d=p[0],v=p[1],y=Object(i.useState)(null),g=Object(h.a)(y,2),b=g[0],m=g[1];Object(i.useEffect)((function(){o(t.json.google?"gmaps":"carto")}),[t.json]),Object(i.useEffect)((function(){for(var e in t.json.views)if("MapView"===t.json.views[e]["@@type"]){m(t.json.views[e].mapStyle);break}}),[t.json]);var w=function(e){t.onBasemapChange(e.currentTarget.value)};return Object(r.jsxs)("div",{className:"configuration-sidebar",children:[Object(r.jsxs)("div",{className:"configuration-sidebar__title",children:[Object(r.jsx)("h2",{children:"Configuration"}),Object(r.jsx)("div",{className:"close-button",onClick:t.onClose,children:Object(r.jsx)("img",{src:"/icons/close.svg",alt:"Close"})})]}),Object(r.jsxs)("div",{className:"configuration-sidebar__section ".concat(u?"open":""),children:[Object(r.jsx)("div",{className:"section-title",onClick:function(){l(!u)},children:Object(r.jsx)("h3",{children:"Basemap"})}),Object(r.jsxs)("div",{className:"section-content",children:[Object(r.jsxs)("div",{className:"section-content__group",children:[Object(r.jsx)("input",{type:"radio",id:"gmaps",name:"basemap",value:"gmaps",onChange:w,checked:"gmaps"===a}),Object(r.jsx)("label",{htmlFor:"gmaps",children:"Google Maps"})]}),Object(r.jsxs)("div",{className:"section-content__group",children:[Object(r.jsx)("input",{type:"radio",id:"carto",name:"basemap",value:"carto",onChange:w,checked:"carto"===a}),Object(r.jsx)("label",{htmlFor:"carto",children:"CARTO"})]}),"carto"===a&&Object(r.jsxs)("div",{className:"section-content__selector",children:[Object(r.jsx)("label",{htmlFor:"basemapStyle",children:"Style"}),Object(r.jsxs)("select",{id:"basemapStyle",name:"basemapStyle",value:b,onChange:function(e){m(e.target.value),t.onStyleChange(e)},children:[Object(r.jsx)("option",{value:"@@#CARTO_BASEMAP.POSITRON",children:"Positron"}),Object(r.jsx)("option",{value:"@@#CARTO_BASEMAP.DARK_MATTER",children:"Dark Matter"}),Object(r.jsx)("option",{value:"@@#CARTO_BASEMAP.VOYAGER",children:"Voyager"})]})]})]})]}),Object(r.jsxs)("div",{className:"configuration-sidebar__section configuration-sidebar__section--editor ".concat(d?"open":""),children:[Object(r.jsx)("div",{className:"section-title",onClick:function(){v(!d)},children:Object(r.jsx)("h3",{children:"Editor"})}),Object(r.jsx)("div",{className:"section-content no-side-padding",children:t.json&&Object(r.jsx)(hu,{onJsonUpdated:t.onJsonUpdated,json:t.json})})]})]})};var pu=function(t){var e=Object(i.useState)(!0),n=Object(h.a)(e,2),a=n[0],o=n[1],s=Object(i.useState)(!0),c=Object(h.a)(s,2),u=c[0],f=c[1],p=Object(i.useRef)(),d=Object(i.useRef)(),v=function(t,e){var n=window.location,r=n.origin,i=n.pathname;e&&(t.initialViewState=Object(l.a)({},e));var a=encodeURIComponent(btoa(JSON.stringify(t,null,0)));return"".concat(r+i,"?config=").concat(a)},y=function(t,e){e.current.select(),document.execCommand("copy"),t.target.focus()};return Object(r.jsxs)("div",{className:"configuration-sidebar",children:[Object(r.jsxs)("div",{className:"configuration-sidebar__title",children:[Object(r.jsx)("h2",{children:"Share"}),Object(r.jsx)("div",{className:"close-button",onClick:t.onClose,children:Object(r.jsx)("img",{src:"/icons/close.svg",alt:"Close"})})]}),Object(r.jsxs)("div",{className:"configuration-sidebar__section ".concat(u?"open":""),children:[Object(r.jsx)("div",{className:"section-title",onClick:function(){f(!u)},children:Object(r.jsx)("h3",{children:"URL"})}),Object(r.jsxs)("div",{className:"section-content",children:[Object(r.jsx)("textarea",{ref:p,readOnly:!0,value:v(t.json,t.viewState)}),Object(r.jsx)("div",{className:"button-container",children:Object(r.jsx)("button",{className:"button",onClick:function(t){return y(t,p)},children:"Copy URL"})})]})]}),Object(r.jsxs)("div",{className:"configuration-sidebar__section ".concat(a?"open":""),children:[Object(r.jsx)("div",{className:"section-title",onClick:function(){o(!a)},children:Object(r.jsx)("h3",{children:"Embed map"})}),Object(r.jsxs)("div",{className:"section-content",children:[Object(r.jsx)("textarea",{ref:d,readOnly:!0,value:function(t,e){var n=v(t,e);return'<iframe src="'.concat(n,'&embed=true" title="Deck.gl Playground"/>')}(t.json,t.viewState)}),Object(r.jsx)("div",{className:"button-container",children:Object(r.jsx)("button",{className:"button",onClick:function(t){return y(t,d)},children:"Copy Code"})})]})]})]})};var du=function(t){var e=Object(i.useState)(!1),n=Object(h.a)(e,2),a=n[0],o=n[1],s=Object(i.useState)(!1),c=Object(h.a)(s,2),u=c[0],l=c[1],f=function(){t.onMenuCloses(),o(!1)},p=function(){t.onMenuCloses(),l(!1)};return Object(r.jsxs)("div",{className:"sidebar-container",children:[Object(r.jsxs)("div",{className:"sidebar",children:[Object(r.jsx)("div",{className:"sidebar__element sidebar__element--logo",children:Object(r.jsx)("img",{src:"/icons/carto-logo.svg",alt:"CARTO"})}),Object(r.jsx)("div",{className:"sidebar__element ".concat(a?"is-selected":""),onClick:function(){p(),o(!0)},children:Object(r.jsx)("img",{src:"/icons/settings.svg",alt:"Settings"})}),Object(r.jsx)("div",{className:"sidebar__element ".concat(u?"is-selected":""),onClick:function(){f(),l(!0)},children:Object(r.jsx)("img",{src:"/icons/share.svg",alt:"Share map"})})]}),a&&Object(r.jsx)(fu,{onBasemapChange:t.onBasemapChange,onStyleChange:t.onStyleChange,json:t.json,onJsonUpdated:t.onJsonUpdated,onClose:f}),u&&Object(r.jsx)(pu,{json:t.jsonMap,viewState:t.viewState,onClose:p})]})},vu={sql:"TYPE A SQL QUERY OR A DATASET NAME",tileset:"TYPE A TILESET NAME"},yu=new V({configuration:new L(Eo)});var gu=function(){var t=Object(i.useState)(),e=Object(h.a)(t,2),a=e[0],o=e[1],s=Object(i.useState)(),c=Object(h.a)(s,2),p=c[0],d=c[1],v=Object(i.useState)(null),y=Object(h.a)(v,2),g=y[0],b=y[1],m=Object(i.useState)(null),w=Object(h.a)(m,2),O=w[0],j=w[1],_=Object(i.useState)(!1),P=Object(h.a)(_,2),S=P[0],k=P[1],x=Object(u.f)(),C=Object(u.g)(),A=C.username,M=C.type;return Object(i.useEffect)((function(){if(!A)throw Error("Unknowm type ".concat(M));if("sql"!==M&&"bigquery"!==M)throw Error("Unknowm type ".concat(M));var t=new URLSearchParams(x.search);k(t.get("embed"));var e=function(t,e,r){var i,a,o=t.get("config");if(o)i=JSON.parse(atob(decodeURIComponent(o))),a=!0;else{var s=t.get("data")||vu[r],c=t.get("api_key")||"default_public",u=t.get("color_by_value");a=s!==vu.sql&&s!==vu.tileset,(i=n(202)("./template.".concat(r,".json"))).layers[0].data=s,i.layers[0].credentials={username:e,apiKey:c},u&&(i.layers[0].getFillColor="@@= properties.".concat(u," > 1000000 ? [207, 89, 126] : properties.").concat(u," > 100000 ? [232, 133, 113] : properties.").concat(u," > 10000 ? [238, 180, 121] : properties.").concat(u," > 1000 ? [233, 226, 156] : properties.").concat(u," > 100 ? [156, 203, 134] : properties.").concat(u," > 10 ? [57, 177, 133] : [0, 147, 146]"))}return{json:i,ready:a}}(t,A,M),r=e.json;e.ready||k(!1),o(r),d(r)}),[x,A,M]),Object(i.useEffect)((function(){!function(t){if(t&&t.layers){var e,n=Object(f.a)(t.layers);try{for(n.s();!(e=n.n()).done;){for(var r=e.value,i={},a=0,o=Object.entries(r);a<o.length;a++){var s=Object(h.a)(o[a],2),c=s[0],u=s[1];c.startsWith("get")&&"string"===typeof u&&(i[c]=u)}Object.keys(i).length&&(r.updateTriggers=i)}}catch(l){n.e(l)}finally{n.f()}}}(p);var t=yu.convert(p);b(t)}),[p]),Object(r.jsxs)("div",{className:"home ".concat(S?"home--embed":""),children:[!S&&Object(r.jsx)(du,{onBasemapChange:function(t){var e=Object(l.a)({},p);"carto"===t?delete e.google:"gmaps"===t&&(e.google=!0),e.initialViewState=O,o(e),d(e)},onStyleChange:function(t){var e=t.target.value,n=Object(l.a)({},p),r=-1;for(var i in n.views)if("MapView"===n.views[i]["@@type"]){r=i;break}if(r>=0)n.views[r].mapStyle=e;else{n.views||(n.views=[]);var a={"@@type":"MapView",controller:!0,mapStyle:e};n.views.push(a)}o(n),d(n)},onMenuCloses:function(t){o(p)},onJsonUpdated:function(t){var e=JSON.parse(t);d(e),j(e.initialViewState)},json:a,jsonMap:p,viewState:O}),Object(r.jsx)("div",{className:"map",children:g&&Object(r.jsx)(cu,Object(l.a)(Object(l.a)({},g),{},{onViewStateChange:function(t){delete t.viewState.height,delete t.viewState.width,j(t.viewState)},onZoom:function(t){var e=t.target.dataset.type,n=Object(l.a)({},p);if(O&&(n.initialViewState=Object(l.a)({},O)),"zoom-in"===e){var r=n.initialViewState.zoom;n.initialViewState.zoom=r>19?20:r+1,j(n.initialViewState),d(n)}else if("zoom-out"===e){var i=n.initialViewState.zoom;n.initialViewState.zoom=i<2?1:i-1,j(n.initialViewState),d(n)}}}))}),S&&Object(r.jsxs)("div",{className:"footer",children:[Object(r.jsxs)("p",{class:"footer__text",children:[Object(r.jsx)("img",{src:"/icons/carto-heart.png",alt:""}),"Created with ",Object(r.jsx)("a",{href:"https://carto.com",target:"_blank",rel:"noreferrer",children:"CARTO"})]}),Object(r.jsx)("a",{class:"footer__logo",href:"https://carto.com",target:"_blank",rel:"noreferrer",children:Object(r.jsx)("img",{src:"/icons/carto-full-logo.svg",alt:"CARTO"})})]})]})};var bu=function(){return Object(r.jsx)(c.a,{children:Object(r.jsx)("div",{children:Object(r.jsx)(u.c,{children:Object(r.jsx)(u.a,{path:"/user/:username/:type",children:Object(r.jsx)(gu,{})})})})})},mu=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,236)).then((function(e){var n=e.getCLS,r=e.getFID,i=e.getFCP,a=e.getLCP,o=e.getTTFB;n(t),r(t),i(t),a(t),o(t)}))};s.a.render(Object(r.jsx)(a.a.StrictMode,{children:Object(r.jsx)(bu,{})}),document.getElementById("root")),mu()}},[[207,1,2]]]);
//# sourceMappingURL=main.2b49ddad.chunk.js.map